function oE(t,r){for(var a=0;a<r.length;a++){const p=r[a];if(typeof p!="string"&&!Array.isArray(p)){for(const x in p)if(x!=="default"&&!(x in t)){const T=Object.getOwnPropertyDescriptor(p,x);T&&Object.defineProperty(t,x,T.get?T:{enumerable:!0,get:()=>p[x]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))p(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const b of T.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&p(b)}).observe(document,{childList:!0,subtree:!0});function a(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function p(x){if(x.ep)return;x.ep=!0;const T=a(x);fetch(x.href,T)}})();var Md=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var N2={exports:{}},b0={},j2={exports:{}},Vn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wg=Symbol.for("react.element"),sE=Symbol.for("react.portal"),aE=Symbol.for("react.fragment"),lE=Symbol.for("react.strict_mode"),cE=Symbol.for("react.profiler"),uE=Symbol.for("react.provider"),hE=Symbol.for("react.context"),dE=Symbol.for("react.forward_ref"),fE=Symbol.for("react.suspense"),pE=Symbol.for("react.memo"),mE=Symbol.for("react.lazy"),Kb=Symbol.iterator;function gE(t){return t===null||typeof t!="object"?null:(t=Kb&&t[Kb]||t["@@iterator"],typeof t=="function"?t:null)}var U2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V2=Object.assign,$2={};function yp(t,r,a){this.props=t,this.context=r,this.refs=$2,this.updater=a||U2}yp.prototype.isReactComponent={};yp.prototype.setState=function(t,r){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,r,"setState")};yp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Z2(){}Z2.prototype=yp.prototype;function Ox(t,r,a){this.props=t,this.context=r,this.refs=$2,this.updater=a||U2}var Bx=Ox.prototype=new Z2;Bx.constructor=Ox;V2(Bx,yp.prototype);Bx.isPureReactComponent=!0;var Yb=Array.isArray,G2=Object.prototype.hasOwnProperty,Nx={current:null},q2={key:!0,ref:!0,__self:!0,__source:!0};function W2(t,r,a){var p,x={},T=null,b=null;if(r!=null)for(p in r.ref!==void 0&&(b=r.ref),r.key!==void 0&&(T=""+r.key),r)G2.call(r,p)&&!q2.hasOwnProperty(p)&&(x[p]=r[p]);var l=arguments.length-2;if(l===1)x.children=a;else if(1<l){for(var L=Array(l),$=0;$<l;$++)L[$]=arguments[$+2];x.children=L}if(t&&t.defaultProps)for(p in l=t.defaultProps,l)x[p]===void 0&&(x[p]=l[p]);return{$$typeof:wg,type:t,key:T,ref:b,props:x,_owner:Nx.current}}function _E(t,r){return{$$typeof:wg,type:t.type,key:r,ref:t.ref,props:t.props,_owner:t._owner}}function jx(t){return typeof t=="object"&&t!==null&&t.$$typeof===wg}function yE(t){var r={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(a){return r[a]})}var Jb=/\/+/g;function $v(t,r){return typeof t=="object"&&t!==null&&t.key!=null?yE(""+t.key):r.toString(36)}function Ty(t,r,a,p,x){var T=typeof t;(T==="undefined"||T==="boolean")&&(t=null);var b=!1;if(t===null)b=!0;else switch(T){case"string":case"number":b=!0;break;case"object":switch(t.$$typeof){case wg:case sE:b=!0}}if(b)return b=t,x=x(b),t=p===""?"."+$v(b,0):p,Yb(x)?(a="",t!=null&&(a=t.replace(Jb,"$&/")+"/"),Ty(x,r,a,"",function($){return $})):x!=null&&(jx(x)&&(x=_E(x,a+(!x.key||b&&b.key===x.key?"":(""+x.key).replace(Jb,"$&/")+"/")+t)),r.push(x)),1;if(b=0,p=p===""?".":p+":",Yb(t))for(var l=0;l<t.length;l++){T=t[l];var L=p+$v(T,l);b+=Ty(T,r,a,L,x)}else if(L=gE(t),typeof L=="function")for(t=L.call(t),l=0;!(T=t.next()).done;)T=T.value,L=p+$v(T,l++),b+=Ty(T,r,a,L,x);else if(T==="object")throw r=String(t),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return b}function ty(t,r,a){if(t==null)return t;var p=[],x=0;return Ty(t,p,"","",function(T){return r.call(a,T,x++)}),p}function vE(t){if(t._status===-1){var r=t._result;r=r(),r.then(function(a){(t._status===0||t._status===-1)&&(t._status=1,t._result=a)},function(a){(t._status===0||t._status===-1)&&(t._status=2,t._result=a)}),t._status===-1&&(t._status=0,t._result=r)}if(t._status===1)return t._result.default;throw t._result}var ts={current:null},Cy={transition:null},xE={ReactCurrentDispatcher:ts,ReactCurrentBatchConfig:Cy,ReactCurrentOwner:Nx};function H2(){throw Error("act(...) is not supported in production builds of React.")}Vn.Children={map:ty,forEach:function(t,r,a){ty(t,function(){r.apply(this,arguments)},a)},count:function(t){var r=0;return ty(t,function(){r++}),r},toArray:function(t){return ty(t,function(r){return r})||[]},only:function(t){if(!jx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Vn.Component=yp;Vn.Fragment=aE;Vn.Profiler=cE;Vn.PureComponent=Ox;Vn.StrictMode=lE;Vn.Suspense=fE;Vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xE;Vn.act=H2;Vn.cloneElement=function(t,r,a){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var p=V2({},t.props),x=t.key,T=t.ref,b=t._owner;if(r!=null){if(r.ref!==void 0&&(T=r.ref,b=Nx.current),r.key!==void 0&&(x=""+r.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(L in r)G2.call(r,L)&&!q2.hasOwnProperty(L)&&(p[L]=r[L]===void 0&&l!==void 0?l[L]:r[L])}var L=arguments.length-2;if(L===1)p.children=a;else if(1<L){l=Array(L);for(var $=0;$<L;$++)l[$]=arguments[$+2];p.children=l}return{$$typeof:wg,type:t.type,key:x,ref:T,props:p,_owner:b}};Vn.createContext=function(t){return t={$$typeof:hE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:uE,_context:t},t.Consumer=t};Vn.createElement=W2;Vn.createFactory=function(t){var r=W2.bind(null,t);return r.type=t,r};Vn.createRef=function(){return{current:null}};Vn.forwardRef=function(t){return{$$typeof:dE,render:t}};Vn.isValidElement=jx;Vn.lazy=function(t){return{$$typeof:mE,_payload:{_status:-1,_result:t},_init:vE}};Vn.memo=function(t,r){return{$$typeof:pE,type:t,compare:r===void 0?null:r}};Vn.startTransition=function(t){var r=Cy.transition;Cy.transition={};try{t()}finally{Cy.transition=r}};Vn.unstable_act=H2;Vn.useCallback=function(t,r){return ts.current.useCallback(t,r)};Vn.useContext=function(t){return ts.current.useContext(t)};Vn.useDebugValue=function(){};Vn.useDeferredValue=function(t){return ts.current.useDeferredValue(t)};Vn.useEffect=function(t,r){return ts.current.useEffect(t,r)};Vn.useId=function(){return ts.current.useId()};Vn.useImperativeHandle=function(t,r,a){return ts.current.useImperativeHandle(t,r,a)};Vn.useInsertionEffect=function(t,r){return ts.current.useInsertionEffect(t,r)};Vn.useLayoutEffect=function(t,r){return ts.current.useLayoutEffect(t,r)};Vn.useMemo=function(t,r){return ts.current.useMemo(t,r)};Vn.useReducer=function(t,r,a){return ts.current.useReducer(t,r,a)};Vn.useRef=function(t){return ts.current.useRef(t)};Vn.useState=function(t){return ts.current.useState(t)};Vn.useSyncExternalStore=function(t,r,a){return ts.current.useSyncExternalStore(t,r,a)};Vn.useTransition=function(){return ts.current.useTransition()};Vn.version="18.3.1";j2.exports=Vn;var Lt=j2.exports;const Fl=bg(Lt),Qb=oE({__proto__:null,default:Fl},[Lt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bE=Lt,wE=Symbol.for("react.element"),SE=Symbol.for("react.fragment"),TE=Object.prototype.hasOwnProperty,CE=bE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,PE={key:!0,ref:!0,__self:!0,__source:!0};function X2(t,r,a){var p,x={},T=null,b=null;a!==void 0&&(T=""+a),r.key!==void 0&&(T=""+r.key),r.ref!==void 0&&(b=r.ref);for(p in r)TE.call(r,p)&&!PE.hasOwnProperty(p)&&(x[p]=r[p]);if(t&&t.defaultProps)for(p in r=t.defaultProps,r)x[p]===void 0&&(x[p]=r[p]);return{$$typeof:wE,type:t,key:T,ref:b,props:x,_owner:CE.current}}b0.Fragment=SE;b0.jsx=X2;b0.jsxs=X2;N2.exports=b0;var ct=N2.exports,z1={},K2={exports:{}},Gs={},Y2={exports:{}},J2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function r(dt,_t){var Rt=dt.length;dt.push(_t);e:for(;0<Rt;){var wt=Rt-1>>>1,Dt=dt[wt];if(0<x(Dt,_t))dt[wt]=_t,dt[Rt]=Dt,Rt=wt;else break e}}function a(dt){return dt.length===0?null:dt[0]}function p(dt){if(dt.length===0)return null;var _t=dt[0],Rt=dt.pop();if(Rt!==_t){dt[0]=Rt;e:for(var wt=0,Dt=dt.length,Tt=Dt>>>1;wt<Tt;){var gn=2*(wt+1)-1,nn=dt[gn],Pn=gn+1,mr=dt[Pn];if(0>x(nn,Rt))Pn<Dt&&0>x(mr,nn)?(dt[wt]=mr,dt[Pn]=Rt,wt=Pn):(dt[wt]=nn,dt[gn]=Rt,wt=gn);else if(Pn<Dt&&0>x(mr,Rt))dt[wt]=mr,dt[Pn]=Rt,wt=Pn;else break e}}return _t}function x(dt,_t){var Rt=dt.sortIndex-_t.sortIndex;return Rt!==0?Rt:dt.id-_t.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;t.unstable_now=function(){return T.now()}}else{var b=Date,l=b.now();t.unstable_now=function(){return b.now()-l}}var L=[],$=[],Q=1,ce=null,oe=3,Y=!1,Te=!1,et=!1,We=typeof setTimeout=="function"?setTimeout:null,he=typeof clearTimeout=="function"?clearTimeout:null,pe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ve(dt){for(var _t=a($);_t!==null;){if(_t.callback===null)p($);else if(_t.startTime<=dt)p($),_t.sortIndex=_t.expirationTime,r(L,_t);else break;_t=a($)}}function Oe(dt){if(et=!1,ve(dt),!Te)if(a(L)!==null)Te=!0,Kt(it);else{var _t=a($);_t!==null&&Zt(Oe,_t.startTime-dt)}}function it(dt,_t){Te=!1,et&&(et=!1,he(ne),ne=-1),Y=!0;var Rt=oe;try{for(ve(_t),ce=a(L);ce!==null&&(!(ce.expirationTime>_t)||dt&&!st());){var wt=ce.callback;if(typeof wt=="function"){ce.callback=null,oe=ce.priorityLevel;var Dt=wt(ce.expirationTime<=_t);_t=t.unstable_now(),typeof Dt=="function"?ce.callback=Dt:ce===a(L)&&p(L),ve(_t)}else p(L);ce=a(L)}if(ce!==null)var Tt=!0;else{var gn=a($);gn!==null&&Zt(Oe,gn.startTime-_t),Tt=!1}return Tt}finally{ce=null,oe=Rt,Y=!1}}var qe=!1,we=null,ne=-1,ye=5,ke=-1;function st(){return!(t.unstable_now()-ke<ye)}function lt(){if(we!==null){var dt=t.unstable_now();ke=dt;var _t=!0;try{_t=we(!0,dt)}finally{_t?bt():(qe=!1,we=null)}}else qe=!1}var bt;if(typeof pe=="function")bt=function(){pe(lt)};else if(typeof MessageChannel<"u"){var tn=new MessageChannel,lr=tn.port2;tn.port1.onmessage=lt,bt=function(){lr.postMessage(null)}}else bt=function(){We(lt,0)};function Kt(dt){we=dt,qe||(qe=!0,bt())}function Zt(dt,_t){ne=We(function(){dt(t.unstable_now())},_t)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(dt){dt.callback=null},t.unstable_continueExecution=function(){Te||Y||(Te=!0,Kt(it))},t.unstable_forceFrameRate=function(dt){0>dt||125<dt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ye=0<dt?Math.floor(1e3/dt):5},t.unstable_getCurrentPriorityLevel=function(){return oe},t.unstable_getFirstCallbackNode=function(){return a(L)},t.unstable_next=function(dt){switch(oe){case 1:case 2:case 3:var _t=3;break;default:_t=oe}var Rt=oe;oe=_t;try{return dt()}finally{oe=Rt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(dt,_t){switch(dt){case 1:case 2:case 3:case 4:case 5:break;default:dt=3}var Rt=oe;oe=dt;try{return _t()}finally{oe=Rt}},t.unstable_scheduleCallback=function(dt,_t,Rt){var wt=t.unstable_now();switch(typeof Rt=="object"&&Rt!==null?(Rt=Rt.delay,Rt=typeof Rt=="number"&&0<Rt?wt+Rt:wt):Rt=wt,dt){case 1:var Dt=-1;break;case 2:Dt=250;break;case 5:Dt=1073741823;break;case 4:Dt=1e4;break;default:Dt=5e3}return Dt=Rt+Dt,dt={id:Q++,callback:_t,priorityLevel:dt,startTime:Rt,expirationTime:Dt,sortIndex:-1},Rt>wt?(dt.sortIndex=Rt,r($,dt),a(L)===null&&dt===a($)&&(et?(he(ne),ne=-1):et=!0,Zt(Oe,Rt-wt))):(dt.sortIndex=Dt,r(L,dt),Te||Y||(Te=!0,Kt(it))),dt},t.unstable_shouldYield=st,t.unstable_wrapCallback=function(dt){var _t=oe;return function(){var Rt=oe;oe=_t;try{return dt.apply(this,arguments)}finally{oe=Rt}}}})(J2);Y2.exports=J2;var EE=Y2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ME=Lt,Vs=EE;function vt(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Q2=new Set,tg={};function qd(t,r){lp(t,r),lp(t+"Capture",r)}function lp(t,r){for(tg[t]=r,t=0;t<r.length;t++)Q2.add(r[t])}var Hc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R1=Object.prototype.hasOwnProperty,IE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ew={},tw={};function kE(t){return R1.call(tw,t)?!0:R1.call(ew,t)?!1:IE.test(t)?tw[t]=!0:(ew[t]=!0,!1)}function AE(t,r,a,p){if(a!==null&&a.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return p?!1:a!==null?!a.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zE(t,r,a,p){if(r===null||typeof r>"u"||AE(t,r,a,p))return!0;if(p)return!1;if(a!==null)switch(a.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function ns(t,r,a,p,x,T,b){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=p,this.attributeNamespace=x,this.mustUseProperty=a,this.propertyName=t,this.type=r,this.sanitizeURL=T,this.removeEmptyString=b}var vo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){vo[t]=new ns(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];vo[r]=new ns(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){vo[t]=new ns(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){vo[t]=new ns(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){vo[t]=new ns(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){vo[t]=new ns(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){vo[t]=new ns(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){vo[t]=new ns(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){vo[t]=new ns(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ux=/[\-:]([a-z])/g;function Vx(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(Ux,Vx);vo[r]=new ns(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(Ux,Vx);vo[r]=new ns(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(Ux,Vx);vo[r]=new ns(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){vo[t]=new ns(t,1,!1,t.toLowerCase(),null,!1,!1)});vo.xlinkHref=new ns("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){vo[t]=new ns(t,1,!1,t.toLowerCase(),null,!0,!0)});function $x(t,r,a,p){var x=vo.hasOwnProperty(r)?vo[r]:null;(x!==null?x.type!==0:p||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(zE(r,a,x,p)&&(a=null),p||x===null?kE(r)&&(a===null?t.removeAttribute(r):t.setAttribute(r,""+a)):x.mustUseProperty?t[x.propertyName]=a===null?x.type===3?!1:"":a:(r=x.attributeName,p=x.attributeNamespace,a===null?t.removeAttribute(r):(x=x.type,a=x===3||x===4&&a===!0?"":""+a,p?t.setAttributeNS(p,r,a):t.setAttribute(r,a))))}var Qc=ME.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ny=Symbol.for("react.element"),Zf=Symbol.for("react.portal"),Gf=Symbol.for("react.fragment"),Zx=Symbol.for("react.strict_mode"),D1=Symbol.for("react.profiler"),eS=Symbol.for("react.provider"),tS=Symbol.for("react.context"),Gx=Symbol.for("react.forward_ref"),L1=Symbol.for("react.suspense"),F1=Symbol.for("react.suspense_list"),qx=Symbol.for("react.memo"),rh=Symbol.for("react.lazy"),nS=Symbol.for("react.offscreen"),nw=Symbol.iterator;function km(t){return t===null||typeof t!="object"?null:(t=nw&&t[nw]||t["@@iterator"],typeof t=="function"?t:null)}var li=Object.assign,Zv;function jm(t){if(Zv===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);Zv=r&&r[1]||""}return`
`+Zv+t}var Gv=!1;function qv(t,r){if(!t||Gv)return"";Gv=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch($){var p=$}Reflect.construct(t,[],r)}else{try{r.call()}catch($){p=$}t.call(r.prototype)}else{try{throw Error()}catch($){p=$}t()}}catch($){if($&&p&&typeof $.stack=="string"){for(var x=$.stack.split(`
`),T=p.stack.split(`
`),b=x.length-1,l=T.length-1;1<=b&&0<=l&&x[b]!==T[l];)l--;for(;1<=b&&0<=l;b--,l--)if(x[b]!==T[l]){if(b!==1||l!==1)do if(b--,l--,0>l||x[b]!==T[l]){var L=`
`+x[b].replace(" at new "," at ");return t.displayName&&L.includes("<anonymous>")&&(L=L.replace("<anonymous>",t.displayName)),L}while(1<=b&&0<=l);break}}}finally{Gv=!1,Error.prepareStackTrace=a}return(t=t?t.displayName||t.name:"")?jm(t):""}function RE(t){switch(t.tag){case 5:return jm(t.type);case 16:return jm("Lazy");case 13:return jm("Suspense");case 19:return jm("SuspenseList");case 0:case 2:case 15:return t=qv(t.type,!1),t;case 11:return t=qv(t.type.render,!1),t;case 1:return t=qv(t.type,!0),t;default:return""}}function O1(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Gf:return"Fragment";case Zf:return"Portal";case D1:return"Profiler";case Zx:return"StrictMode";case L1:return"Suspense";case F1:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tS:return(t.displayName||"Context")+".Consumer";case eS:return(t._context.displayName||"Context")+".Provider";case Gx:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case qx:return r=t.displayName||null,r!==null?r:O1(t.type)||"Memo";case rh:r=t._payload,t=t._init;try{return O1(t(r))}catch{}}return null}function DE(t){var r=t.type;switch(t.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=r.render,t=t.displayName||t.name||"",r.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O1(r);case 8:return r===Zx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function _h(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function rS(t){var r=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function LE(t){var r=rS(t)?"checked":"value",a=Object.getOwnPropertyDescriptor(t.constructor.prototype,r),p=""+t[r];if(!t.hasOwnProperty(r)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var x=a.get,T=a.set;return Object.defineProperty(t,r,{configurable:!0,get:function(){return x.call(this)},set:function(b){p=""+b,T.call(this,b)}}),Object.defineProperty(t,r,{enumerable:a.enumerable}),{getValue:function(){return p},setValue:function(b){p=""+b},stopTracking:function(){t._valueTracker=null,delete t[r]}}}}function ry(t){t._valueTracker||(t._valueTracker=LE(t))}function iS(t){if(!t)return!1;var r=t._valueTracker;if(!r)return!0;var a=r.getValue(),p="";return t&&(p=rS(t)?t.checked?"true":"false":t.value),t=p,t!==a?(r.setValue(t),!0):!1}function Oy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function B1(t,r){var a=r.checked;return li({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??t._wrapperState.initialChecked})}function rw(t,r){var a=r.defaultValue==null?"":r.defaultValue,p=r.checked!=null?r.checked:r.defaultChecked;a=_h(r.value!=null?r.value:a),t._wrapperState={initialChecked:p,initialValue:a,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function oS(t,r){r=r.checked,r!=null&&$x(t,"checked",r,!1)}function N1(t,r){oS(t,r);var a=_h(r.value),p=r.type;if(a!=null)p==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+a):t.value!==""+a&&(t.value=""+a);else if(p==="submit"||p==="reset"){t.removeAttribute("value");return}r.hasOwnProperty("value")?j1(t,r.type,a):r.hasOwnProperty("defaultValue")&&j1(t,r.type,_h(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(t.defaultChecked=!!r.defaultChecked)}function iw(t,r,a){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var p=r.type;if(!(p!=="submit"&&p!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+t._wrapperState.initialValue,a||r===t.value||(t.value=r),t.defaultValue=r}a=t.name,a!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,a!==""&&(t.name=a)}function j1(t,r,a){(r!=="number"||Oy(t.ownerDocument)!==t)&&(a==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+a&&(t.defaultValue=""+a))}var Um=Array.isArray;function np(t,r,a,p){if(t=t.options,r){r={};for(var x=0;x<a.length;x++)r["$"+a[x]]=!0;for(a=0;a<t.length;a++)x=r.hasOwnProperty("$"+t[a].value),t[a].selected!==x&&(t[a].selected=x),x&&p&&(t[a].defaultSelected=!0)}else{for(a=""+_h(a),r=null,x=0;x<t.length;x++){if(t[x].value===a){t[x].selected=!0,p&&(t[x].defaultSelected=!0);return}r!==null||t[x].disabled||(r=t[x])}r!==null&&(r.selected=!0)}}function U1(t,r){if(r.dangerouslySetInnerHTML!=null)throw Error(vt(91));return li({},r,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ow(t,r){var a=r.value;if(a==null){if(a=r.children,r=r.defaultValue,a!=null){if(r!=null)throw Error(vt(92));if(Um(a)){if(1<a.length)throw Error(vt(93));a=a[0]}r=a}r==null&&(r=""),a=r}t._wrapperState={initialValue:_h(a)}}function sS(t,r){var a=_h(r.value),p=_h(r.defaultValue);a!=null&&(a=""+a,a!==t.value&&(t.value=a),r.defaultValue==null&&t.defaultValue!==a&&(t.defaultValue=a)),p!=null&&(t.defaultValue=""+p)}function sw(t){var r=t.textContent;r===t._wrapperState.initialValue&&r!==""&&r!==null&&(t.value=r)}function aS(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function V1(t,r){return t==null||t==="http://www.w3.org/1999/xhtml"?aS(r):t==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var iy,lS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,a,p,x){MSApp.execUnsafeLocalFunction(function(){return t(r,a,p,x)})}:t}(function(t,r){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=r;else{for(iy=iy||document.createElement("div"),iy.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=iy.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;r.firstChild;)t.appendChild(r.firstChild)}});function ng(t,r){if(r){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=r;return}}t.textContent=r}var Gm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},FE=["Webkit","ms","Moz","O"];Object.keys(Gm).forEach(function(t){FE.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),Gm[r]=Gm[t]})});function cS(t,r,a){return r==null||typeof r=="boolean"||r===""?"":a||typeof r!="number"||r===0||Gm.hasOwnProperty(t)&&Gm[t]?(""+r).trim():r+"px"}function uS(t,r){t=t.style;for(var a in r)if(r.hasOwnProperty(a)){var p=a.indexOf("--")===0,x=cS(a,r[a],p);a==="float"&&(a="cssFloat"),p?t.setProperty(a,x):t[a]=x}}var OE=li({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $1(t,r){if(r){if(OE[t]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(vt(137,t));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(vt(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(vt(61))}if(r.style!=null&&typeof r.style!="object")throw Error(vt(62))}}function Z1(t,r){if(t.indexOf("-")===-1)return typeof r.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var G1=null;function Wx(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var q1=null,rp=null,ip=null;function aw(t){if(t=Cg(t)){if(typeof q1!="function")throw Error(vt(280));var r=t.stateNode;r&&(r=P0(r),q1(t.stateNode,t.type,r))}}function hS(t){rp?ip?ip.push(t):ip=[t]:rp=t}function dS(){if(rp){var t=rp,r=ip;if(ip=rp=null,aw(t),r)for(t=0;t<r.length;t++)aw(r[t])}}function fS(t,r){return t(r)}function pS(){}var Wv=!1;function mS(t,r,a){if(Wv)return t(r,a);Wv=!0;try{return fS(t,r,a)}finally{Wv=!1,(rp!==null||ip!==null)&&(pS(),dS())}}function rg(t,r){var a=t.stateNode;if(a===null)return null;var p=P0(a);if(p===null)return null;a=p[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(t=t.type,p=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!p;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(vt(231,r,typeof a));return a}var W1=!1;if(Hc)try{var Am={};Object.defineProperty(Am,"passive",{get:function(){W1=!0}}),window.addEventListener("test",Am,Am),window.removeEventListener("test",Am,Am)}catch{W1=!1}function BE(t,r,a,p,x,T,b,l,L){var $=Array.prototype.slice.call(arguments,3);try{r.apply(a,$)}catch(Q){this.onError(Q)}}var qm=!1,By=null,Ny=!1,H1=null,NE={onError:function(t){qm=!0,By=t}};function jE(t,r,a,p,x,T,b,l,L){qm=!1,By=null,BE.apply(NE,arguments)}function UE(t,r,a,p,x,T,b,l,L){if(jE.apply(this,arguments),qm){if(qm){var $=By;qm=!1,By=null}else throw Error(vt(198));Ny||(Ny=!0,H1=$)}}function Wd(t){var r=t,a=t;if(t.alternate)for(;r.return;)r=r.return;else{t=r;do r=t,r.flags&4098&&(a=r.return),t=r.return;while(t)}return r.tag===3?a:null}function gS(t){if(t.tag===13){var r=t.memoizedState;if(r===null&&(t=t.alternate,t!==null&&(r=t.memoizedState)),r!==null)return r.dehydrated}return null}function lw(t){if(Wd(t)!==t)throw Error(vt(188))}function VE(t){var r=t.alternate;if(!r){if(r=Wd(t),r===null)throw Error(vt(188));return r!==t?null:t}for(var a=t,p=r;;){var x=a.return;if(x===null)break;var T=x.alternate;if(T===null){if(p=x.return,p!==null){a=p;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===a)return lw(x),t;if(T===p)return lw(x),r;T=T.sibling}throw Error(vt(188))}if(a.return!==p.return)a=x,p=T;else{for(var b=!1,l=x.child;l;){if(l===a){b=!0,a=x,p=T;break}if(l===p){b=!0,p=x,a=T;break}l=l.sibling}if(!b){for(l=T.child;l;){if(l===a){b=!0,a=T,p=x;break}if(l===p){b=!0,p=T,a=x;break}l=l.sibling}if(!b)throw Error(vt(189))}}if(a.alternate!==p)throw Error(vt(190))}if(a.tag!==3)throw Error(vt(188));return a.stateNode.current===a?t:r}function _S(t){return t=VE(t),t!==null?yS(t):null}function yS(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var r=yS(t);if(r!==null)return r;t=t.sibling}return null}var vS=Vs.unstable_scheduleCallback,cw=Vs.unstable_cancelCallback,$E=Vs.unstable_shouldYield,ZE=Vs.unstable_requestPaint,wi=Vs.unstable_now,GE=Vs.unstable_getCurrentPriorityLevel,Hx=Vs.unstable_ImmediatePriority,xS=Vs.unstable_UserBlockingPriority,jy=Vs.unstable_NormalPriority,qE=Vs.unstable_LowPriority,bS=Vs.unstable_IdlePriority,w0=null,Ol=null;function WE(t){if(Ol&&typeof Ol.onCommitFiberRoot=="function")try{Ol.onCommitFiberRoot(w0,t,void 0,(t.current.flags&128)===128)}catch{}}var el=Math.clz32?Math.clz32:KE,HE=Math.log,XE=Math.LN2;function KE(t){return t>>>=0,t===0?32:31-(HE(t)/XE|0)|0}var oy=64,sy=4194304;function Vm(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Uy(t,r){var a=t.pendingLanes;if(a===0)return 0;var p=0,x=t.suspendedLanes,T=t.pingedLanes,b=a&268435455;if(b!==0){var l=b&~x;l!==0?p=Vm(l):(T&=b,T!==0&&(p=Vm(T)))}else b=a&~x,b!==0?p=Vm(b):T!==0&&(p=Vm(T));if(p===0)return 0;if(r!==0&&r!==p&&!(r&x)&&(x=p&-p,T=r&-r,x>=T||x===16&&(T&4194240)!==0))return r;if(p&4&&(p|=a&16),r=t.entangledLanes,r!==0)for(t=t.entanglements,r&=p;0<r;)a=31-el(r),x=1<<a,p|=t[a],r&=~x;return p}function YE(t,r){switch(t){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JE(t,r){for(var a=t.suspendedLanes,p=t.pingedLanes,x=t.expirationTimes,T=t.pendingLanes;0<T;){var b=31-el(T),l=1<<b,L=x[b];L===-1?(!(l&a)||l&p)&&(x[b]=YE(l,r)):L<=r&&(t.expiredLanes|=l),T&=~l}}function X1(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function wS(){var t=oy;return oy<<=1,!(oy&4194240)&&(oy=64),t}function Hv(t){for(var r=[],a=0;31>a;a++)r.push(t);return r}function Sg(t,r,a){t.pendingLanes|=r,r!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,r=31-el(r),t[r]=a}function QE(t,r){var a=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;var p=t.eventTimes;for(t=t.expirationTimes;0<a;){var x=31-el(a),T=1<<x;r[x]=0,p[x]=-1,t[x]=-1,a&=~T}}function Xx(t,r){var a=t.entangledLanes|=r;for(t=t.entanglements;a;){var p=31-el(a),x=1<<p;x&r|t[p]&r&&(t[p]|=r),a&=~x}}var yr=0;function SS(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var TS,Kx,CS,PS,ES,K1=!1,ay=[],ch=null,uh=null,hh=null,ig=new Map,og=new Map,oh=[],eM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function uw(t,r){switch(t){case"focusin":case"focusout":ch=null;break;case"dragenter":case"dragleave":uh=null;break;case"mouseover":case"mouseout":hh=null;break;case"pointerover":case"pointerout":ig.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":og.delete(r.pointerId)}}function zm(t,r,a,p,x,T){return t===null||t.nativeEvent!==T?(t={blockedOn:r,domEventName:a,eventSystemFlags:p,nativeEvent:T,targetContainers:[x]},r!==null&&(r=Cg(r),r!==null&&Kx(r)),t):(t.eventSystemFlags|=p,r=t.targetContainers,x!==null&&r.indexOf(x)===-1&&r.push(x),t)}function tM(t,r,a,p,x){switch(r){case"focusin":return ch=zm(ch,t,r,a,p,x),!0;case"dragenter":return uh=zm(uh,t,r,a,p,x),!0;case"mouseover":return hh=zm(hh,t,r,a,p,x),!0;case"pointerover":var T=x.pointerId;return ig.set(T,zm(ig.get(T)||null,t,r,a,p,x)),!0;case"gotpointercapture":return T=x.pointerId,og.set(T,zm(og.get(T)||null,t,r,a,p,x)),!0}return!1}function MS(t){var r=kd(t.target);if(r!==null){var a=Wd(r);if(a!==null){if(r=a.tag,r===13){if(r=gS(a),r!==null){t.blockedOn=r,ES(t.priority,function(){CS(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Py(t){if(t.blockedOn!==null)return!1;for(var r=t.targetContainers;0<r.length;){var a=Y1(t.domEventName,t.eventSystemFlags,r[0],t.nativeEvent);if(a===null){a=t.nativeEvent;var p=new a.constructor(a.type,a);G1=p,a.target.dispatchEvent(p),G1=null}else return r=Cg(a),r!==null&&Kx(r),t.blockedOn=a,!1;r.shift()}return!0}function hw(t,r,a){Py(t)&&a.delete(r)}function nM(){K1=!1,ch!==null&&Py(ch)&&(ch=null),uh!==null&&Py(uh)&&(uh=null),hh!==null&&Py(hh)&&(hh=null),ig.forEach(hw),og.forEach(hw)}function Rm(t,r){t.blockedOn===r&&(t.blockedOn=null,K1||(K1=!0,Vs.unstable_scheduleCallback(Vs.unstable_NormalPriority,nM)))}function sg(t){function r(x){return Rm(x,t)}if(0<ay.length){Rm(ay[0],t);for(var a=1;a<ay.length;a++){var p=ay[a];p.blockedOn===t&&(p.blockedOn=null)}}for(ch!==null&&Rm(ch,t),uh!==null&&Rm(uh,t),hh!==null&&Rm(hh,t),ig.forEach(r),og.forEach(r),a=0;a<oh.length;a++)p=oh[a],p.blockedOn===t&&(p.blockedOn=null);for(;0<oh.length&&(a=oh[0],a.blockedOn===null);)MS(a),a.blockedOn===null&&oh.shift()}var op=Qc.ReactCurrentBatchConfig,Vy=!0;function rM(t,r,a,p){var x=yr,T=op.transition;op.transition=null;try{yr=1,Yx(t,r,a,p)}finally{yr=x,op.transition=T}}function iM(t,r,a,p){var x=yr,T=op.transition;op.transition=null;try{yr=4,Yx(t,r,a,p)}finally{yr=x,op.transition=T}}function Yx(t,r,a,p){if(Vy){var x=Y1(t,r,a,p);if(x===null)i1(t,r,p,$y,a),uw(t,p);else if(tM(x,t,r,a,p))p.stopPropagation();else if(uw(t,p),r&4&&-1<eM.indexOf(t)){for(;x!==null;){var T=Cg(x);if(T!==null&&TS(T),T=Y1(t,r,a,p),T===null&&i1(t,r,p,$y,a),T===x)break;x=T}x!==null&&p.stopPropagation()}else i1(t,r,p,null,a)}}var $y=null;function Y1(t,r,a,p){if($y=null,t=Wx(p),t=kd(t),t!==null)if(r=Wd(t),r===null)t=null;else if(a=r.tag,a===13){if(t=gS(r),t!==null)return t;t=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;t=null}else r!==t&&(t=null);return $y=t,null}function IS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(GE()){case Hx:return 1;case xS:return 4;case jy:case qE:return 16;case bS:return 536870912;default:return 16}default:return 16}}var ah=null,Jx=null,Ey=null;function kS(){if(Ey)return Ey;var t,r=Jx,a=r.length,p,x="value"in ah?ah.value:ah.textContent,T=x.length;for(t=0;t<a&&r[t]===x[t];t++);var b=a-t;for(p=1;p<=b&&r[a-p]===x[T-p];p++);return Ey=x.slice(t,1<p?1-p:void 0)}function My(t){var r=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&r===13&&(t=13)):t=r,t===10&&(t=13),32<=t||t===13?t:0}function ly(){return!0}function dw(){return!1}function qs(t){function r(a,p,x,T,b){this._reactName=a,this._targetInst=x,this.type=p,this.nativeEvent=T,this.target=b,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(a=t[l],this[l]=a?a(T):T[l]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ly:dw,this.isPropagationStopped=dw,this}return li(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=ly)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=ly)},persist:function(){},isPersistent:ly}),r}var vp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qx=qs(vp),Tg=li({},vp,{view:0,detail:0}),oM=qs(Tg),Xv,Kv,Dm,S0=li({},Tg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Dm&&(Dm&&t.type==="mousemove"?(Xv=t.screenX-Dm.screenX,Kv=t.screenY-Dm.screenY):Kv=Xv=0,Dm=t),Xv)},movementY:function(t){return"movementY"in t?t.movementY:Kv}}),fw=qs(S0),sM=li({},S0,{dataTransfer:0}),aM=qs(sM),lM=li({},Tg,{relatedTarget:0}),Yv=qs(lM),cM=li({},vp,{animationName:0,elapsedTime:0,pseudoElement:0}),uM=qs(cM),hM=li({},vp,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dM=qs(hM),fM=li({},vp,{data:0}),pw=qs(fM),pM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _M(t){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(t):(t=gM[t])?!!r[t]:!1}function eb(){return _M}var yM=li({},Tg,{key:function(t){if(t.key){var r=pM[t.key]||t.key;if(r!=="Unidentified")return r}return t.type==="keypress"?(t=My(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?mM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eb,charCode:function(t){return t.type==="keypress"?My(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?My(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),vM=qs(yM),xM=li({},S0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mw=qs(xM),bM=li({},Tg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eb}),wM=qs(bM),SM=li({},vp,{propertyName:0,elapsedTime:0,pseudoElement:0}),TM=qs(SM),CM=li({},S0,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),PM=qs(CM),EM=[9,13,27,32],tb=Hc&&"CompositionEvent"in window,Wm=null;Hc&&"documentMode"in document&&(Wm=document.documentMode);var MM=Hc&&"TextEvent"in window&&!Wm,AS=Hc&&(!tb||Wm&&8<Wm&&11>=Wm),gw=" ",_w=!1;function zS(t,r){switch(t){case"keyup":return EM.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function RS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var qf=!1;function IM(t,r){switch(t){case"compositionend":return RS(r);case"keypress":return r.which!==32?null:(_w=!0,gw);case"textInput":return t=r.data,t===gw&&_w?null:t;default:return null}}function kM(t,r){if(qf)return t==="compositionend"||!tb&&zS(t,r)?(t=kS(),Ey=Jx=ah=null,qf=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return AS&&r.locale!=="ko"?null:r.data;default:return null}}var AM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yw(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r==="input"?!!AM[t.type]:r==="textarea"}function DS(t,r,a,p){hS(p),r=Zy(r,"onChange"),0<r.length&&(a=new Qx("onChange","change",null,a,p),t.push({event:a,listeners:r}))}var Hm=null,ag=null;function zM(t){GS(t,0)}function T0(t){var r=Xf(t);if(iS(r))return t}function RM(t,r){if(t==="change")return r}var LS=!1;if(Hc){var Jv;if(Hc){var Qv="oninput"in document;if(!Qv){var vw=document.createElement("div");vw.setAttribute("oninput","return;"),Qv=typeof vw.oninput=="function"}Jv=Qv}else Jv=!1;LS=Jv&&(!document.documentMode||9<document.documentMode)}function xw(){Hm&&(Hm.detachEvent("onpropertychange",FS),ag=Hm=null)}function FS(t){if(t.propertyName==="value"&&T0(ag)){var r=[];DS(r,ag,t,Wx(t)),mS(zM,r)}}function DM(t,r,a){t==="focusin"?(xw(),Hm=r,ag=a,Hm.attachEvent("onpropertychange",FS)):t==="focusout"&&xw()}function LM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return T0(ag)}function FM(t,r){if(t==="click")return T0(r)}function OM(t,r){if(t==="input"||t==="change")return T0(r)}function BM(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var rl=typeof Object.is=="function"?Object.is:BM;function lg(t,r){if(rl(t,r))return!0;if(typeof t!="object"||t===null||typeof r!="object"||r===null)return!1;var a=Object.keys(t),p=Object.keys(r);if(a.length!==p.length)return!1;for(p=0;p<a.length;p++){var x=a[p];if(!R1.call(r,x)||!rl(t[x],r[x]))return!1}return!0}function bw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ww(t,r){var a=bw(t);t=0;for(var p;a;){if(a.nodeType===3){if(p=t+a.textContent.length,t<=r&&p>=r)return{node:a,offset:r-t};t=p}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=bw(a)}}function OS(t,r){return t&&r?t===r?!0:t&&t.nodeType===3?!1:r&&r.nodeType===3?OS(t,r.parentNode):"contains"in t?t.contains(r):t.compareDocumentPosition?!!(t.compareDocumentPosition(r)&16):!1:!1}function BS(){for(var t=window,r=Oy();r instanceof t.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)t=r.contentWindow;else break;r=Oy(t.document)}return r}function nb(t){var r=t&&t.nodeName&&t.nodeName.toLowerCase();return r&&(r==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||r==="textarea"||t.contentEditable==="true")}function NM(t){var r=BS(),a=t.focusedElem,p=t.selectionRange;if(r!==a&&a&&a.ownerDocument&&OS(a.ownerDocument.documentElement,a)){if(p!==null&&nb(a)){if(r=p.start,t=p.end,t===void 0&&(t=r),"selectionStart"in a)a.selectionStart=r,a.selectionEnd=Math.min(t,a.value.length);else if(t=(r=a.ownerDocument||document)&&r.defaultView||window,t.getSelection){t=t.getSelection();var x=a.textContent.length,T=Math.min(p.start,x);p=p.end===void 0?T:Math.min(p.end,x),!t.extend&&T>p&&(x=p,p=T,T=x),x=ww(a,T);var b=ww(a,p);x&&b&&(t.rangeCount!==1||t.anchorNode!==x.node||t.anchorOffset!==x.offset||t.focusNode!==b.node||t.focusOffset!==b.offset)&&(r=r.createRange(),r.setStart(x.node,x.offset),t.removeAllRanges(),T>p?(t.addRange(r),t.extend(b.node,b.offset)):(r.setEnd(b.node,b.offset),t.addRange(r)))}}for(r=[],t=a;t=t.parentNode;)t.nodeType===1&&r.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<r.length;a++)t=r[a],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jM=Hc&&"documentMode"in document&&11>=document.documentMode,Wf=null,J1=null,Xm=null,Q1=!1;function Sw(t,r,a){var p=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Q1||Wf==null||Wf!==Oy(p)||(p=Wf,"selectionStart"in p&&nb(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Xm&&lg(Xm,p)||(Xm=p,p=Zy(J1,"onSelect"),0<p.length&&(r=new Qx("onSelect","select",null,r,a),t.push({event:r,listeners:p}),r.target=Wf)))}function cy(t,r){var a={};return a[t.toLowerCase()]=r.toLowerCase(),a["Webkit"+t]="webkit"+r,a["Moz"+t]="moz"+r,a}var Hf={animationend:cy("Animation","AnimationEnd"),animationiteration:cy("Animation","AnimationIteration"),animationstart:cy("Animation","AnimationStart"),transitionend:cy("Transition","TransitionEnd")},e1={},NS={};Hc&&(NS=document.createElement("div").style,"AnimationEvent"in window||(delete Hf.animationend.animation,delete Hf.animationiteration.animation,delete Hf.animationstart.animation),"TransitionEvent"in window||delete Hf.transitionend.transition);function C0(t){if(e1[t])return e1[t];if(!Hf[t])return t;var r=Hf[t],a;for(a in r)if(r.hasOwnProperty(a)&&a in NS)return e1[t]=r[a];return t}var jS=C0("animationend"),US=C0("animationiteration"),VS=C0("animationstart"),$S=C0("transitionend"),ZS=new Map,Tw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xh(t,r){ZS.set(t,r),qd(r,[t])}for(var t1=0;t1<Tw.length;t1++){var n1=Tw[t1],UM=n1.toLowerCase(),VM=n1[0].toUpperCase()+n1.slice(1);xh(UM,"on"+VM)}xh(jS,"onAnimationEnd");xh(US,"onAnimationIteration");xh(VS,"onAnimationStart");xh("dblclick","onDoubleClick");xh("focusin","onFocus");xh("focusout","onBlur");xh($S,"onTransitionEnd");lp("onMouseEnter",["mouseout","mouseover"]);lp("onMouseLeave",["mouseout","mouseover"]);lp("onPointerEnter",["pointerout","pointerover"]);lp("onPointerLeave",["pointerout","pointerover"]);qd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qd("onBeforeInput",["compositionend","keypress","textInput","paste"]);qd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $m="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$M=new Set("cancel close invalid load scroll toggle".split(" ").concat($m));function Cw(t,r,a){var p=t.type||"unknown-event";t.currentTarget=a,UE(p,r,void 0,t),t.currentTarget=null}function GS(t,r){r=(r&4)!==0;for(var a=0;a<t.length;a++){var p=t[a],x=p.event;p=p.listeners;e:{var T=void 0;if(r)for(var b=p.length-1;0<=b;b--){var l=p[b],L=l.instance,$=l.currentTarget;if(l=l.listener,L!==T&&x.isPropagationStopped())break e;Cw(x,l,$),T=L}else for(b=0;b<p.length;b++){if(l=p[b],L=l.instance,$=l.currentTarget,l=l.listener,L!==T&&x.isPropagationStopped())break e;Cw(x,l,$),T=L}}}if(Ny)throw t=H1,Ny=!1,H1=null,t}function Or(t,r){var a=r[ix];a===void 0&&(a=r[ix]=new Set);var p=t+"__bubble";a.has(p)||(qS(r,t,2,!1),a.add(p))}function r1(t,r,a){var p=0;r&&(p|=4),qS(a,t,p,r)}var uy="_reactListening"+Math.random().toString(36).slice(2);function cg(t){if(!t[uy]){t[uy]=!0,Q2.forEach(function(a){a!=="selectionchange"&&($M.has(a)||r1(a,!1,t),r1(a,!0,t))});var r=t.nodeType===9?t:t.ownerDocument;r===null||r[uy]||(r[uy]=!0,r1("selectionchange",!1,r))}}function qS(t,r,a,p){switch(IS(r)){case 1:var x=rM;break;case 4:x=iM;break;default:x=Yx}a=x.bind(null,r,a,t),x=void 0,!W1||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(x=!0),p?x!==void 0?t.addEventListener(r,a,{capture:!0,passive:x}):t.addEventListener(r,a,!0):x!==void 0?t.addEventListener(r,a,{passive:x}):t.addEventListener(r,a,!1)}function i1(t,r,a,p,x){var T=p;if(!(r&1)&&!(r&2)&&p!==null)e:for(;;){if(p===null)return;var b=p.tag;if(b===3||b===4){var l=p.stateNode.containerInfo;if(l===x||l.nodeType===8&&l.parentNode===x)break;if(b===4)for(b=p.return;b!==null;){var L=b.tag;if((L===3||L===4)&&(L=b.stateNode.containerInfo,L===x||L.nodeType===8&&L.parentNode===x))return;b=b.return}for(;l!==null;){if(b=kd(l),b===null)return;if(L=b.tag,L===5||L===6){p=T=b;continue e}l=l.parentNode}}p=p.return}mS(function(){var $=T,Q=Wx(a),ce=[];e:{var oe=ZS.get(t);if(oe!==void 0){var Y=Qx,Te=t;switch(t){case"keypress":if(My(a)===0)break e;case"keydown":case"keyup":Y=vM;break;case"focusin":Te="focus",Y=Yv;break;case"focusout":Te="blur",Y=Yv;break;case"beforeblur":case"afterblur":Y=Yv;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=fw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=aM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=wM;break;case jS:case US:case VS:Y=uM;break;case $S:Y=TM;break;case"scroll":Y=oM;break;case"wheel":Y=PM;break;case"copy":case"cut":case"paste":Y=dM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=mw}var et=(r&4)!==0,We=!et&&t==="scroll",he=et?oe!==null?oe+"Capture":null:oe;et=[];for(var pe=$,ve;pe!==null;){ve=pe;var Oe=ve.stateNode;if(ve.tag===5&&Oe!==null&&(ve=Oe,he!==null&&(Oe=rg(pe,he),Oe!=null&&et.push(ug(pe,Oe,ve)))),We)break;pe=pe.return}0<et.length&&(oe=new Y(oe,Te,null,a,Q),ce.push({event:oe,listeners:et}))}}if(!(r&7)){e:{if(oe=t==="mouseover"||t==="pointerover",Y=t==="mouseout"||t==="pointerout",oe&&a!==G1&&(Te=a.relatedTarget||a.fromElement)&&(kd(Te)||Te[Xc]))break e;if((Y||oe)&&(oe=Q.window===Q?Q:(oe=Q.ownerDocument)?oe.defaultView||oe.parentWindow:window,Y?(Te=a.relatedTarget||a.toElement,Y=$,Te=Te?kd(Te):null,Te!==null&&(We=Wd(Te),Te!==We||Te.tag!==5&&Te.tag!==6)&&(Te=null)):(Y=null,Te=$),Y!==Te)){if(et=fw,Oe="onMouseLeave",he="onMouseEnter",pe="mouse",(t==="pointerout"||t==="pointerover")&&(et=mw,Oe="onPointerLeave",he="onPointerEnter",pe="pointer"),We=Y==null?oe:Xf(Y),ve=Te==null?oe:Xf(Te),oe=new et(Oe,pe+"leave",Y,a,Q),oe.target=We,oe.relatedTarget=ve,Oe=null,kd(Q)===$&&(et=new et(he,pe+"enter",Te,a,Q),et.target=ve,et.relatedTarget=We,Oe=et),We=Oe,Y&&Te)t:{for(et=Y,he=Te,pe=0,ve=et;ve;ve=jf(ve))pe++;for(ve=0,Oe=he;Oe;Oe=jf(Oe))ve++;for(;0<pe-ve;)et=jf(et),pe--;for(;0<ve-pe;)he=jf(he),ve--;for(;pe--;){if(et===he||he!==null&&et===he.alternate)break t;et=jf(et),he=jf(he)}et=null}else et=null;Y!==null&&Pw(ce,oe,Y,et,!1),Te!==null&&We!==null&&Pw(ce,We,Te,et,!0)}}e:{if(oe=$?Xf($):window,Y=oe.nodeName&&oe.nodeName.toLowerCase(),Y==="select"||Y==="input"&&oe.type==="file")var it=RM;else if(yw(oe))if(LS)it=OM;else{it=LM;var qe=DM}else(Y=oe.nodeName)&&Y.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(it=FM);if(it&&(it=it(t,$))){DS(ce,it,a,Q);break e}qe&&qe(t,oe,$),t==="focusout"&&(qe=oe._wrapperState)&&qe.controlled&&oe.type==="number"&&j1(oe,"number",oe.value)}switch(qe=$?Xf($):window,t){case"focusin":(yw(qe)||qe.contentEditable==="true")&&(Wf=qe,J1=$,Xm=null);break;case"focusout":Xm=J1=Wf=null;break;case"mousedown":Q1=!0;break;case"contextmenu":case"mouseup":case"dragend":Q1=!1,Sw(ce,a,Q);break;case"selectionchange":if(jM)break;case"keydown":case"keyup":Sw(ce,a,Q)}var we;if(tb)e:{switch(t){case"compositionstart":var ne="onCompositionStart";break e;case"compositionend":ne="onCompositionEnd";break e;case"compositionupdate":ne="onCompositionUpdate";break e}ne=void 0}else qf?zS(t,a)&&(ne="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(ne="onCompositionStart");ne&&(AS&&a.locale!=="ko"&&(qf||ne!=="onCompositionStart"?ne==="onCompositionEnd"&&qf&&(we=kS()):(ah=Q,Jx="value"in ah?ah.value:ah.textContent,qf=!0)),qe=Zy($,ne),0<qe.length&&(ne=new pw(ne,t,null,a,Q),ce.push({event:ne,listeners:qe}),we?ne.data=we:(we=RS(a),we!==null&&(ne.data=we)))),(we=MM?IM(t,a):kM(t,a))&&($=Zy($,"onBeforeInput"),0<$.length&&(Q=new pw("onBeforeInput","beforeinput",null,a,Q),ce.push({event:Q,listeners:$}),Q.data=we))}GS(ce,r)})}function ug(t,r,a){return{instance:t,listener:r,currentTarget:a}}function Zy(t,r){for(var a=r+"Capture",p=[];t!==null;){var x=t,T=x.stateNode;x.tag===5&&T!==null&&(x=T,T=rg(t,a),T!=null&&p.unshift(ug(t,T,x)),T=rg(t,r),T!=null&&p.push(ug(t,T,x))),t=t.return}return p}function jf(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Pw(t,r,a,p,x){for(var T=r._reactName,b=[];a!==null&&a!==p;){var l=a,L=l.alternate,$=l.stateNode;if(L!==null&&L===p)break;l.tag===5&&$!==null&&(l=$,x?(L=rg(a,T),L!=null&&b.unshift(ug(a,L,l))):x||(L=rg(a,T),L!=null&&b.push(ug(a,L,l)))),a=a.return}b.length!==0&&t.push({event:r,listeners:b})}var ZM=/\r\n?/g,GM=/\u0000|\uFFFD/g;function Ew(t){return(typeof t=="string"?t:""+t).replace(ZM,`
`).replace(GM,"")}function hy(t,r,a){if(r=Ew(r),Ew(t)!==r&&a)throw Error(vt(425))}function Gy(){}var ex=null,tx=null;function nx(t,r){return t==="textarea"||t==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var rx=typeof setTimeout=="function"?setTimeout:void 0,qM=typeof clearTimeout=="function"?clearTimeout:void 0,Mw=typeof Promise=="function"?Promise:void 0,WM=typeof queueMicrotask=="function"?queueMicrotask:typeof Mw<"u"?function(t){return Mw.resolve(null).then(t).catch(HM)}:rx;function HM(t){setTimeout(function(){throw t})}function o1(t,r){var a=r,p=0;do{var x=a.nextSibling;if(t.removeChild(a),x&&x.nodeType===8)if(a=x.data,a==="/$"){if(p===0){t.removeChild(x),sg(r);return}p--}else a!=="$"&&a!=="$?"&&a!=="$!"||p++;a=x}while(a);sg(r)}function dh(t){for(;t!=null;t=t.nextSibling){var r=t.nodeType;if(r===1||r===3)break;if(r===8){if(r=t.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return t}function Iw(t){t=t.previousSibling;for(var r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"){if(r===0)return t;r--}else a==="/$"&&r++}t=t.previousSibling}return null}var xp=Math.random().toString(36).slice(2),Ll="__reactFiber$"+xp,hg="__reactProps$"+xp,Xc="__reactContainer$"+xp,ix="__reactEvents$"+xp,XM="__reactListeners$"+xp,KM="__reactHandles$"+xp;function kd(t){var r=t[Ll];if(r)return r;for(var a=t.parentNode;a;){if(r=a[Xc]||a[Ll]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(t=Iw(t);t!==null;){if(a=t[Ll])return a;t=Iw(t)}return r}t=a,a=t.parentNode}return null}function Cg(t){return t=t[Ll]||t[Xc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Xf(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(vt(33))}function P0(t){return t[hg]||null}var ox=[],Kf=-1;function bh(t){return{current:t}}function Br(t){0>Kf||(t.current=ox[Kf],ox[Kf]=null,Kf--)}function Ar(t,r){Kf++,ox[Kf]=t.current,t.current=r}var yh={},Ao=bh(yh),_s=bh(!1),Od=yh;function cp(t,r){var a=t.type.contextTypes;if(!a)return yh;var p=t.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===r)return p.__reactInternalMemoizedMaskedChildContext;var x={},T;for(T in a)x[T]=r[T];return p&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=x),x}function ys(t){return t=t.childContextTypes,t!=null}function qy(){Br(_s),Br(Ao)}function kw(t,r,a){if(Ao.current!==yh)throw Error(vt(168));Ar(Ao,r),Ar(_s,a)}function WS(t,r,a){var p=t.stateNode;if(r=r.childContextTypes,typeof p.getChildContext!="function")return a;p=p.getChildContext();for(var x in p)if(!(x in r))throw Error(vt(108,DE(t)||"Unknown",x));return li({},a,p)}function Wy(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||yh,Od=Ao.current,Ar(Ao,t),Ar(_s,_s.current),!0}function Aw(t,r,a){var p=t.stateNode;if(!p)throw Error(vt(169));a?(t=WS(t,r,Od),p.__reactInternalMemoizedMergedChildContext=t,Br(_s),Br(Ao),Ar(Ao,t)):Br(_s),Ar(_s,a)}var Uc=null,E0=!1,s1=!1;function HS(t){Uc===null?Uc=[t]:Uc.push(t)}function YM(t){E0=!0,HS(t)}function wh(){if(!s1&&Uc!==null){s1=!0;var t=0,r=yr;try{var a=Uc;for(yr=1;t<a.length;t++){var p=a[t];do p=p(!0);while(p!==null)}Uc=null,E0=!1}catch(x){throw Uc!==null&&(Uc=Uc.slice(t+1)),vS(Hx,wh),x}finally{yr=r,s1=!1}}return null}var Yf=[],Jf=0,Hy=null,Xy=0,ma=[],ga=0,Bd=null,$c=1,Zc="";function Cd(t,r){Yf[Jf++]=Xy,Yf[Jf++]=Hy,Hy=t,Xy=r}function XS(t,r,a){ma[ga++]=$c,ma[ga++]=Zc,ma[ga++]=Bd,Bd=t;var p=$c;t=Zc;var x=32-el(p)-1;p&=~(1<<x),a+=1;var T=32-el(r)+x;if(30<T){var b=x-x%5;T=(p&(1<<b)-1).toString(32),p>>=b,x-=b,$c=1<<32-el(r)+x|a<<x|p,Zc=T+t}else $c=1<<T|a<<x|p,Zc=t}function rb(t){t.return!==null&&(Cd(t,1),XS(t,1,0))}function ib(t){for(;t===Hy;)Hy=Yf[--Jf],Yf[Jf]=null,Xy=Yf[--Jf],Yf[Jf]=null;for(;t===Bd;)Bd=ma[--ga],ma[ga]=null,Zc=ma[--ga],ma[ga]=null,$c=ma[--ga],ma[ga]=null}var Us=null,Ns=null,Xr=!1,Ja=null;function KS(t,r){var a=_a(5,null,null,0);a.elementType="DELETED",a.stateNode=r,a.return=t,r=t.deletions,r===null?(t.deletions=[a],t.flags|=16):r.push(a)}function zw(t,r){switch(t.tag){case 5:var a=t.type;return r=r.nodeType!==1||a.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(t.stateNode=r,Us=t,Ns=dh(r.firstChild),!0):!1;case 6:return r=t.pendingProps===""||r.nodeType!==3?null:r,r!==null?(t.stateNode=r,Us=t,Ns=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(a=Bd!==null?{id:$c,overflow:Zc}:null,t.memoizedState={dehydrated:r,treeContext:a,retryLane:1073741824},a=_a(18,null,null,0),a.stateNode=r,a.return=t,t.child=a,Us=t,Ns=null,!0):!1;default:return!1}}function sx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ax(t){if(Xr){var r=Ns;if(r){var a=r;if(!zw(t,r)){if(sx(t))throw Error(vt(418));r=dh(a.nextSibling);var p=Us;r&&zw(t,r)?KS(p,a):(t.flags=t.flags&-4097|2,Xr=!1,Us=t)}}else{if(sx(t))throw Error(vt(418));t.flags=t.flags&-4097|2,Xr=!1,Us=t}}}function Rw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Us=t}function dy(t){if(t!==Us)return!1;if(!Xr)return Rw(t),Xr=!0,!1;var r;if((r=t.tag!==3)&&!(r=t.tag!==5)&&(r=t.type,r=r!=="head"&&r!=="body"&&!nx(t.type,t.memoizedProps)),r&&(r=Ns)){if(sx(t))throw YS(),Error(vt(418));for(;r;)KS(t,r),r=dh(r.nextSibling)}if(Rw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(vt(317));e:{for(t=t.nextSibling,r=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"){if(r===0){Ns=dh(t.nextSibling);break e}r--}else a!=="$"&&a!=="$!"&&a!=="$?"||r++}t=t.nextSibling}Ns=null}}else Ns=Us?dh(t.stateNode.nextSibling):null;return!0}function YS(){for(var t=Ns;t;)t=dh(t.nextSibling)}function up(){Ns=Us=null,Xr=!1}function ob(t){Ja===null?Ja=[t]:Ja.push(t)}var JM=Qc.ReactCurrentBatchConfig;function Lm(t,r,a){if(t=a.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(vt(309));var p=a.stateNode}if(!p)throw Error(vt(147,t));var x=p,T=""+t;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===T?r.ref:(r=function(b){var l=x.refs;b===null?delete l[T]:l[T]=b},r._stringRef=T,r)}if(typeof t!="string")throw Error(vt(284));if(!a._owner)throw Error(vt(290,t))}return t}function fy(t,r){throw t=Object.prototype.toString.call(r),Error(vt(31,t==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":t))}function Dw(t){var r=t._init;return r(t._payload)}function JS(t){function r(he,pe){if(t){var ve=he.deletions;ve===null?(he.deletions=[pe],he.flags|=16):ve.push(pe)}}function a(he,pe){if(!t)return null;for(;pe!==null;)r(he,pe),pe=pe.sibling;return null}function p(he,pe){for(he=new Map;pe!==null;)pe.key!==null?he.set(pe.key,pe):he.set(pe.index,pe),pe=pe.sibling;return he}function x(he,pe){return he=gh(he,pe),he.index=0,he.sibling=null,he}function T(he,pe,ve){return he.index=ve,t?(ve=he.alternate,ve!==null?(ve=ve.index,ve<pe?(he.flags|=2,pe):ve):(he.flags|=2,pe)):(he.flags|=1048576,pe)}function b(he){return t&&he.alternate===null&&(he.flags|=2),he}function l(he,pe,ve,Oe){return pe===null||pe.tag!==6?(pe=f1(ve,he.mode,Oe),pe.return=he,pe):(pe=x(pe,ve),pe.return=he,pe)}function L(he,pe,ve,Oe){var it=ve.type;return it===Gf?Q(he,pe,ve.props.children,Oe,ve.key):pe!==null&&(pe.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===rh&&Dw(it)===pe.type)?(Oe=x(pe,ve.props),Oe.ref=Lm(he,pe,ve),Oe.return=he,Oe):(Oe=Ly(ve.type,ve.key,ve.props,null,he.mode,Oe),Oe.ref=Lm(he,pe,ve),Oe.return=he,Oe)}function $(he,pe,ve,Oe){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==ve.containerInfo||pe.stateNode.implementation!==ve.implementation?(pe=p1(ve,he.mode,Oe),pe.return=he,pe):(pe=x(pe,ve.children||[]),pe.return=he,pe)}function Q(he,pe,ve,Oe,it){return pe===null||pe.tag!==7?(pe=Ld(ve,he.mode,Oe,it),pe.return=he,pe):(pe=x(pe,ve),pe.return=he,pe)}function ce(he,pe,ve){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return pe=f1(""+pe,he.mode,ve),pe.return=he,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case ny:return ve=Ly(pe.type,pe.key,pe.props,null,he.mode,ve),ve.ref=Lm(he,null,pe),ve.return=he,ve;case Zf:return pe=p1(pe,he.mode,ve),pe.return=he,pe;case rh:var Oe=pe._init;return ce(he,Oe(pe._payload),ve)}if(Um(pe)||km(pe))return pe=Ld(pe,he.mode,ve,null),pe.return=he,pe;fy(he,pe)}return null}function oe(he,pe,ve,Oe){var it=pe!==null?pe.key:null;if(typeof ve=="string"&&ve!==""||typeof ve=="number")return it!==null?null:l(he,pe,""+ve,Oe);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case ny:return ve.key===it?L(he,pe,ve,Oe):null;case Zf:return ve.key===it?$(he,pe,ve,Oe):null;case rh:return it=ve._init,oe(he,pe,it(ve._payload),Oe)}if(Um(ve)||km(ve))return it!==null?null:Q(he,pe,ve,Oe,null);fy(he,ve)}return null}function Y(he,pe,ve,Oe,it){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return he=he.get(ve)||null,l(pe,he,""+Oe,it);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case ny:return he=he.get(Oe.key===null?ve:Oe.key)||null,L(pe,he,Oe,it);case Zf:return he=he.get(Oe.key===null?ve:Oe.key)||null,$(pe,he,Oe,it);case rh:var qe=Oe._init;return Y(he,pe,ve,qe(Oe._payload),it)}if(Um(Oe)||km(Oe))return he=he.get(ve)||null,Q(pe,he,Oe,it,null);fy(pe,Oe)}return null}function Te(he,pe,ve,Oe){for(var it=null,qe=null,we=pe,ne=pe=0,ye=null;we!==null&&ne<ve.length;ne++){we.index>ne?(ye=we,we=null):ye=we.sibling;var ke=oe(he,we,ve[ne],Oe);if(ke===null){we===null&&(we=ye);break}t&&we&&ke.alternate===null&&r(he,we),pe=T(ke,pe,ne),qe===null?it=ke:qe.sibling=ke,qe=ke,we=ye}if(ne===ve.length)return a(he,we),Xr&&Cd(he,ne),it;if(we===null){for(;ne<ve.length;ne++)we=ce(he,ve[ne],Oe),we!==null&&(pe=T(we,pe,ne),qe===null?it=we:qe.sibling=we,qe=we);return Xr&&Cd(he,ne),it}for(we=p(he,we);ne<ve.length;ne++)ye=Y(we,he,ne,ve[ne],Oe),ye!==null&&(t&&ye.alternate!==null&&we.delete(ye.key===null?ne:ye.key),pe=T(ye,pe,ne),qe===null?it=ye:qe.sibling=ye,qe=ye);return t&&we.forEach(function(st){return r(he,st)}),Xr&&Cd(he,ne),it}function et(he,pe,ve,Oe){var it=km(ve);if(typeof it!="function")throw Error(vt(150));if(ve=it.call(ve),ve==null)throw Error(vt(151));for(var qe=it=null,we=pe,ne=pe=0,ye=null,ke=ve.next();we!==null&&!ke.done;ne++,ke=ve.next()){we.index>ne?(ye=we,we=null):ye=we.sibling;var st=oe(he,we,ke.value,Oe);if(st===null){we===null&&(we=ye);break}t&&we&&st.alternate===null&&r(he,we),pe=T(st,pe,ne),qe===null?it=st:qe.sibling=st,qe=st,we=ye}if(ke.done)return a(he,we),Xr&&Cd(he,ne),it;if(we===null){for(;!ke.done;ne++,ke=ve.next())ke=ce(he,ke.value,Oe),ke!==null&&(pe=T(ke,pe,ne),qe===null?it=ke:qe.sibling=ke,qe=ke);return Xr&&Cd(he,ne),it}for(we=p(he,we);!ke.done;ne++,ke=ve.next())ke=Y(we,he,ne,ke.value,Oe),ke!==null&&(t&&ke.alternate!==null&&we.delete(ke.key===null?ne:ke.key),pe=T(ke,pe,ne),qe===null?it=ke:qe.sibling=ke,qe=ke);return t&&we.forEach(function(lt){return r(he,lt)}),Xr&&Cd(he,ne),it}function We(he,pe,ve,Oe){if(typeof ve=="object"&&ve!==null&&ve.type===Gf&&ve.key===null&&(ve=ve.props.children),typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case ny:e:{for(var it=ve.key,qe=pe;qe!==null;){if(qe.key===it){if(it=ve.type,it===Gf){if(qe.tag===7){a(he,qe.sibling),pe=x(qe,ve.props.children),pe.return=he,he=pe;break e}}else if(qe.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===rh&&Dw(it)===qe.type){a(he,qe.sibling),pe=x(qe,ve.props),pe.ref=Lm(he,qe,ve),pe.return=he,he=pe;break e}a(he,qe);break}else r(he,qe);qe=qe.sibling}ve.type===Gf?(pe=Ld(ve.props.children,he.mode,Oe,ve.key),pe.return=he,he=pe):(Oe=Ly(ve.type,ve.key,ve.props,null,he.mode,Oe),Oe.ref=Lm(he,pe,ve),Oe.return=he,he=Oe)}return b(he);case Zf:e:{for(qe=ve.key;pe!==null;){if(pe.key===qe)if(pe.tag===4&&pe.stateNode.containerInfo===ve.containerInfo&&pe.stateNode.implementation===ve.implementation){a(he,pe.sibling),pe=x(pe,ve.children||[]),pe.return=he,he=pe;break e}else{a(he,pe);break}else r(he,pe);pe=pe.sibling}pe=p1(ve,he.mode,Oe),pe.return=he,he=pe}return b(he);case rh:return qe=ve._init,We(he,pe,qe(ve._payload),Oe)}if(Um(ve))return Te(he,pe,ve,Oe);if(km(ve))return et(he,pe,ve,Oe);fy(he,ve)}return typeof ve=="string"&&ve!==""||typeof ve=="number"?(ve=""+ve,pe!==null&&pe.tag===6?(a(he,pe.sibling),pe=x(pe,ve),pe.return=he,he=pe):(a(he,pe),pe=f1(ve,he.mode,Oe),pe.return=he,he=pe),b(he)):a(he,pe)}return We}var hp=JS(!0),QS=JS(!1),Ky=bh(null),Yy=null,Qf=null,sb=null;function ab(){sb=Qf=Yy=null}function lb(t){var r=Ky.current;Br(Ky),t._currentValue=r}function lx(t,r,a){for(;t!==null;){var p=t.alternate;if((t.childLanes&r)!==r?(t.childLanes|=r,p!==null&&(p.childLanes|=r)):p!==null&&(p.childLanes&r)!==r&&(p.childLanes|=r),t===a)break;t=t.return}}function sp(t,r){Yy=t,sb=Qf=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&r&&(gs=!0),t.firstContext=null)}function xa(t){var r=t._currentValue;if(sb!==t)if(t={context:t,memoizedValue:r,next:null},Qf===null){if(Yy===null)throw Error(vt(308));Qf=t,Yy.dependencies={lanes:0,firstContext:t}}else Qf=Qf.next=t;return r}var Ad=null;function cb(t){Ad===null?Ad=[t]:Ad.push(t)}function eT(t,r,a,p){var x=r.interleaved;return x===null?(a.next=a,cb(r)):(a.next=x.next,x.next=a),r.interleaved=a,Kc(t,p)}function Kc(t,r){t.lanes|=r;var a=t.alternate;for(a!==null&&(a.lanes|=r),a=t,t=t.return;t!==null;)t.childLanes|=r,a=t.alternate,a!==null&&(a.childLanes|=r),a=t,t=t.return;return a.tag===3?a.stateNode:null}var ih=!1;function ub(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tT(t,r){t=t.updateQueue,r.updateQueue===t&&(r.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function qc(t,r){return{eventTime:t,lane:r,tag:0,payload:null,callback:null,next:null}}function fh(t,r,a){var p=t.updateQueue;if(p===null)return null;if(p=p.shared,er&2){var x=p.pending;return x===null?r.next=r:(r.next=x.next,x.next=r),p.pending=r,Kc(t,a)}return x=p.interleaved,x===null?(r.next=r,cb(p)):(r.next=x.next,x.next=r),p.interleaved=r,Kc(t,a)}function Iy(t,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194240)!==0)){var p=r.lanes;p&=t.pendingLanes,a|=p,r.lanes=a,Xx(t,a)}}function Lw(t,r){var a=t.updateQueue,p=t.alternate;if(p!==null&&(p=p.updateQueue,a===p)){var x=null,T=null;if(a=a.firstBaseUpdate,a!==null){do{var b={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};T===null?x=T=b:T=T.next=b,a=a.next}while(a!==null);T===null?x=T=r:T=T.next=r}else x=T=r;a={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:p.shared,effects:p.effects},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=r:t.next=r,a.lastBaseUpdate=r}function Jy(t,r,a,p){var x=t.updateQueue;ih=!1;var T=x.firstBaseUpdate,b=x.lastBaseUpdate,l=x.shared.pending;if(l!==null){x.shared.pending=null;var L=l,$=L.next;L.next=null,b===null?T=$:b.next=$,b=L;var Q=t.alternate;Q!==null&&(Q=Q.updateQueue,l=Q.lastBaseUpdate,l!==b&&(l===null?Q.firstBaseUpdate=$:l.next=$,Q.lastBaseUpdate=L))}if(T!==null){var ce=x.baseState;b=0,Q=$=L=null,l=T;do{var oe=l.lane,Y=l.eventTime;if((p&oe)===oe){Q!==null&&(Q=Q.next={eventTime:Y,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Te=t,et=l;switch(oe=r,Y=a,et.tag){case 1:if(Te=et.payload,typeof Te=="function"){ce=Te.call(Y,ce,oe);break e}ce=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=et.payload,oe=typeof Te=="function"?Te.call(Y,ce,oe):Te,oe==null)break e;ce=li({},ce,oe);break e;case 2:ih=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,oe=x.effects,oe===null?x.effects=[l]:oe.push(l))}else Y={eventTime:Y,lane:oe,tag:l.tag,payload:l.payload,callback:l.callback,next:null},Q===null?($=Q=Y,L=ce):Q=Q.next=Y,b|=oe;if(l=l.next,l===null){if(l=x.shared.pending,l===null)break;oe=l,l=oe.next,oe.next=null,x.lastBaseUpdate=oe,x.shared.pending=null}}while(!0);if(Q===null&&(L=ce),x.baseState=L,x.firstBaseUpdate=$,x.lastBaseUpdate=Q,r=x.shared.interleaved,r!==null){x=r;do b|=x.lane,x=x.next;while(x!==r)}else T===null&&(x.shared.lanes=0);jd|=b,t.lanes=b,t.memoizedState=ce}}function Fw(t,r,a){if(t=r.effects,r.effects=null,t!==null)for(r=0;r<t.length;r++){var p=t[r],x=p.callback;if(x!==null){if(p.callback=null,p=a,typeof x!="function")throw Error(vt(191,x));x.call(p)}}}var Pg={},Bl=bh(Pg),dg=bh(Pg),fg=bh(Pg);function zd(t){if(t===Pg)throw Error(vt(174));return t}function hb(t,r){switch(Ar(fg,r),Ar(dg,t),Ar(Bl,Pg),t=r.nodeType,t){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:V1(null,"");break;default:t=t===8?r.parentNode:r,r=t.namespaceURI||null,t=t.tagName,r=V1(r,t)}Br(Bl),Ar(Bl,r)}function dp(){Br(Bl),Br(dg),Br(fg)}function nT(t){zd(fg.current);var r=zd(Bl.current),a=V1(r,t.type);r!==a&&(Ar(dg,t),Ar(Bl,a))}function db(t){dg.current===t&&(Br(Bl),Br(dg))}var si=bh(0);function Qy(t){for(var r=t;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var a1=[];function fb(){for(var t=0;t<a1.length;t++)a1[t]._workInProgressVersionPrimary=null;a1.length=0}var ky=Qc.ReactCurrentDispatcher,l1=Qc.ReactCurrentBatchConfig,Nd=0,ai=null,Li=null,Qi=null,e0=!1,Km=!1,pg=0,QM=0;function Po(){throw Error(vt(321))}function pb(t,r){if(r===null)return!1;for(var a=0;a<r.length&&a<t.length;a++)if(!rl(t[a],r[a]))return!1;return!0}function mb(t,r,a,p,x,T){if(Nd=T,ai=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,ky.current=t===null||t.memoizedState===null?rI:iI,t=a(p,x),Km){T=0;do{if(Km=!1,pg=0,25<=T)throw Error(vt(301));T+=1,Qi=Li=null,r.updateQueue=null,ky.current=oI,t=a(p,x)}while(Km)}if(ky.current=t0,r=Li!==null&&Li.next!==null,Nd=0,Qi=Li=ai=null,e0=!1,r)throw Error(vt(300));return t}function gb(){var t=pg!==0;return pg=0,t}function Dl(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qi===null?ai.memoizedState=Qi=t:Qi=Qi.next=t,Qi}function ba(){if(Li===null){var t=ai.alternate;t=t!==null?t.memoizedState:null}else t=Li.next;var r=Qi===null?ai.memoizedState:Qi.next;if(r!==null)Qi=r,Li=t;else{if(t===null)throw Error(vt(310));Li=t,t={memoizedState:Li.memoizedState,baseState:Li.baseState,baseQueue:Li.baseQueue,queue:Li.queue,next:null},Qi===null?ai.memoizedState=Qi=t:Qi=Qi.next=t}return Qi}function mg(t,r){return typeof r=="function"?r(t):r}function c1(t){var r=ba(),a=r.queue;if(a===null)throw Error(vt(311));a.lastRenderedReducer=t;var p=Li,x=p.baseQueue,T=a.pending;if(T!==null){if(x!==null){var b=x.next;x.next=T.next,T.next=b}p.baseQueue=x=T,a.pending=null}if(x!==null){T=x.next,p=p.baseState;var l=b=null,L=null,$=T;do{var Q=$.lane;if((Nd&Q)===Q)L!==null&&(L=L.next={lane:0,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),p=$.hasEagerState?$.eagerState:t(p,$.action);else{var ce={lane:Q,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null};L===null?(l=L=ce,b=p):L=L.next=ce,ai.lanes|=Q,jd|=Q}$=$.next}while($!==null&&$!==T);L===null?b=p:L.next=l,rl(p,r.memoizedState)||(gs=!0),r.memoizedState=p,r.baseState=b,r.baseQueue=L,a.lastRenderedState=p}if(t=a.interleaved,t!==null){x=t;do T=x.lane,ai.lanes|=T,jd|=T,x=x.next;while(x!==t)}else x===null&&(a.lanes=0);return[r.memoizedState,a.dispatch]}function u1(t){var r=ba(),a=r.queue;if(a===null)throw Error(vt(311));a.lastRenderedReducer=t;var p=a.dispatch,x=a.pending,T=r.memoizedState;if(x!==null){a.pending=null;var b=x=x.next;do T=t(T,b.action),b=b.next;while(b!==x);rl(T,r.memoizedState)||(gs=!0),r.memoizedState=T,r.baseQueue===null&&(r.baseState=T),a.lastRenderedState=T}return[T,p]}function rT(){}function iT(t,r){var a=ai,p=ba(),x=r(),T=!rl(p.memoizedState,x);if(T&&(p.memoizedState=x,gs=!0),p=p.queue,_b(aT.bind(null,a,p,t),[t]),p.getSnapshot!==r||T||Qi!==null&&Qi.memoizedState.tag&1){if(a.flags|=2048,gg(9,sT.bind(null,a,p,x,r),void 0,null),eo===null)throw Error(vt(349));Nd&30||oT(a,r,x)}return x}function oT(t,r,a){t.flags|=16384,t={getSnapshot:r,value:a},r=ai.updateQueue,r===null?(r={lastEffect:null,stores:null},ai.updateQueue=r,r.stores=[t]):(a=r.stores,a===null?r.stores=[t]:a.push(t))}function sT(t,r,a,p){r.value=a,r.getSnapshot=p,lT(r)&&cT(t)}function aT(t,r,a){return a(function(){lT(r)&&cT(t)})}function lT(t){var r=t.getSnapshot;t=t.value;try{var a=r();return!rl(t,a)}catch{return!0}}function cT(t){var r=Kc(t,1);r!==null&&tl(r,t,1,-1)}function Ow(t){var r=Dl();return typeof t=="function"&&(t=t()),r.memoizedState=r.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mg,lastRenderedState:t},r.queue=t,t=t.dispatch=nI.bind(null,ai,t),[r.memoizedState,t]}function gg(t,r,a,p){return t={tag:t,create:r,destroy:a,deps:p,next:null},r=ai.updateQueue,r===null?(r={lastEffect:null,stores:null},ai.updateQueue=r,r.lastEffect=t.next=t):(a=r.lastEffect,a===null?r.lastEffect=t.next=t:(p=a.next,a.next=t,t.next=p,r.lastEffect=t)),t}function uT(){return ba().memoizedState}function Ay(t,r,a,p){var x=Dl();ai.flags|=t,x.memoizedState=gg(1|r,a,void 0,p===void 0?null:p)}function M0(t,r,a,p){var x=ba();p=p===void 0?null:p;var T=void 0;if(Li!==null){var b=Li.memoizedState;if(T=b.destroy,p!==null&&pb(p,b.deps)){x.memoizedState=gg(r,a,T,p);return}}ai.flags|=t,x.memoizedState=gg(1|r,a,T,p)}function Bw(t,r){return Ay(8390656,8,t,r)}function _b(t,r){return M0(2048,8,t,r)}function hT(t,r){return M0(4,2,t,r)}function dT(t,r){return M0(4,4,t,r)}function fT(t,r){if(typeof r=="function")return t=t(),r(t),function(){r(null)};if(r!=null)return t=t(),r.current=t,function(){r.current=null}}function pT(t,r,a){return a=a!=null?a.concat([t]):null,M0(4,4,fT.bind(null,r,t),a)}function yb(){}function mT(t,r){var a=ba();r=r===void 0?null:r;var p=a.memoizedState;return p!==null&&r!==null&&pb(r,p[1])?p[0]:(a.memoizedState=[t,r],t)}function gT(t,r){var a=ba();r=r===void 0?null:r;var p=a.memoizedState;return p!==null&&r!==null&&pb(r,p[1])?p[0]:(t=t(),a.memoizedState=[t,r],t)}function _T(t,r,a){return Nd&21?(rl(a,r)||(a=wS(),ai.lanes|=a,jd|=a,t.baseState=!0),r):(t.baseState&&(t.baseState=!1,gs=!0),t.memoizedState=a)}function eI(t,r){var a=yr;yr=a!==0&&4>a?a:4,t(!0);var p=l1.transition;l1.transition={};try{t(!1),r()}finally{yr=a,l1.transition=p}}function yT(){return ba().memoizedState}function tI(t,r,a){var p=mh(t);if(a={lane:p,action:a,hasEagerState:!1,eagerState:null,next:null},vT(t))xT(r,a);else if(a=eT(t,r,a,p),a!==null){var x=es();tl(a,t,p,x),bT(a,r,p)}}function nI(t,r,a){var p=mh(t),x={lane:p,action:a,hasEagerState:!1,eagerState:null,next:null};if(vT(t))xT(r,x);else{var T=t.alternate;if(t.lanes===0&&(T===null||T.lanes===0)&&(T=r.lastRenderedReducer,T!==null))try{var b=r.lastRenderedState,l=T(b,a);if(x.hasEagerState=!0,x.eagerState=l,rl(l,b)){var L=r.interleaved;L===null?(x.next=x,cb(r)):(x.next=L.next,L.next=x),r.interleaved=x;return}}catch{}finally{}a=eT(t,r,x,p),a!==null&&(x=es(),tl(a,t,p,x),bT(a,r,p))}}function vT(t){var r=t.alternate;return t===ai||r!==null&&r===ai}function xT(t,r){Km=e0=!0;var a=t.pending;a===null?r.next=r:(r.next=a.next,a.next=r),t.pending=r}function bT(t,r,a){if(a&4194240){var p=r.lanes;p&=t.pendingLanes,a|=p,r.lanes=a,Xx(t,a)}}var t0={readContext:xa,useCallback:Po,useContext:Po,useEffect:Po,useImperativeHandle:Po,useInsertionEffect:Po,useLayoutEffect:Po,useMemo:Po,useReducer:Po,useRef:Po,useState:Po,useDebugValue:Po,useDeferredValue:Po,useTransition:Po,useMutableSource:Po,useSyncExternalStore:Po,useId:Po,unstable_isNewReconciler:!1},rI={readContext:xa,useCallback:function(t,r){return Dl().memoizedState=[t,r===void 0?null:r],t},useContext:xa,useEffect:Bw,useImperativeHandle:function(t,r,a){return a=a!=null?a.concat([t]):null,Ay(4194308,4,fT.bind(null,r,t),a)},useLayoutEffect:function(t,r){return Ay(4194308,4,t,r)},useInsertionEffect:function(t,r){return Ay(4,2,t,r)},useMemo:function(t,r){var a=Dl();return r=r===void 0?null:r,t=t(),a.memoizedState=[t,r],t},useReducer:function(t,r,a){var p=Dl();return r=a!==void 0?a(r):r,p.memoizedState=p.baseState=r,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},p.queue=t,t=t.dispatch=tI.bind(null,ai,t),[p.memoizedState,t]},useRef:function(t){var r=Dl();return t={current:t},r.memoizedState=t},useState:Ow,useDebugValue:yb,useDeferredValue:function(t){return Dl().memoizedState=t},useTransition:function(){var t=Ow(!1),r=t[0];return t=eI.bind(null,t[1]),Dl().memoizedState=t,[r,t]},useMutableSource:function(){},useSyncExternalStore:function(t,r,a){var p=ai,x=Dl();if(Xr){if(a===void 0)throw Error(vt(407));a=a()}else{if(a=r(),eo===null)throw Error(vt(349));Nd&30||oT(p,r,a)}x.memoizedState=a;var T={value:a,getSnapshot:r};return x.queue=T,Bw(aT.bind(null,p,T,t),[t]),p.flags|=2048,gg(9,sT.bind(null,p,T,a,r),void 0,null),a},useId:function(){var t=Dl(),r=eo.identifierPrefix;if(Xr){var a=Zc,p=$c;a=(p&~(1<<32-el(p)-1)).toString(32)+a,r=":"+r+"R"+a,a=pg++,0<a&&(r+="H"+a.toString(32)),r+=":"}else a=QM++,r=":"+r+"r"+a.toString(32)+":";return t.memoizedState=r},unstable_isNewReconciler:!1},iI={readContext:xa,useCallback:mT,useContext:xa,useEffect:_b,useImperativeHandle:pT,useInsertionEffect:hT,useLayoutEffect:dT,useMemo:gT,useReducer:c1,useRef:uT,useState:function(){return c1(mg)},useDebugValue:yb,useDeferredValue:function(t){var r=ba();return _T(r,Li.memoizedState,t)},useTransition:function(){var t=c1(mg)[0],r=ba().memoizedState;return[t,r]},useMutableSource:rT,useSyncExternalStore:iT,useId:yT,unstable_isNewReconciler:!1},oI={readContext:xa,useCallback:mT,useContext:xa,useEffect:_b,useImperativeHandle:pT,useInsertionEffect:hT,useLayoutEffect:dT,useMemo:gT,useReducer:u1,useRef:uT,useState:function(){return u1(mg)},useDebugValue:yb,useDeferredValue:function(t){var r=ba();return Li===null?r.memoizedState=t:_T(r,Li.memoizedState,t)},useTransition:function(){var t=u1(mg)[0],r=ba().memoizedState;return[t,r]},useMutableSource:rT,useSyncExternalStore:iT,useId:yT,unstable_isNewReconciler:!1};function Ka(t,r){if(t&&t.defaultProps){r=li({},r),t=t.defaultProps;for(var a in t)r[a]===void 0&&(r[a]=t[a]);return r}return r}function cx(t,r,a,p){r=t.memoizedState,a=a(p,r),a=a==null?r:li({},r,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var I0={isMounted:function(t){return(t=t._reactInternals)?Wd(t)===t:!1},enqueueSetState:function(t,r,a){t=t._reactInternals;var p=es(),x=mh(t),T=qc(p,x);T.payload=r,a!=null&&(T.callback=a),r=fh(t,T,x),r!==null&&(tl(r,t,x,p),Iy(r,t,x))},enqueueReplaceState:function(t,r,a){t=t._reactInternals;var p=es(),x=mh(t),T=qc(p,x);T.tag=1,T.payload=r,a!=null&&(T.callback=a),r=fh(t,T,x),r!==null&&(tl(r,t,x,p),Iy(r,t,x))},enqueueForceUpdate:function(t,r){t=t._reactInternals;var a=es(),p=mh(t),x=qc(a,p);x.tag=2,r!=null&&(x.callback=r),r=fh(t,x,p),r!==null&&(tl(r,t,p,a),Iy(r,t,p))}};function Nw(t,r,a,p,x,T,b){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(p,T,b):r.prototype&&r.prototype.isPureReactComponent?!lg(a,p)||!lg(x,T):!0}function wT(t,r,a){var p=!1,x=yh,T=r.contextType;return typeof T=="object"&&T!==null?T=xa(T):(x=ys(r)?Od:Ao.current,p=r.contextTypes,T=(p=p!=null)?cp(t,x):yh),r=new r(a,T),t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=I0,t.stateNode=r,r._reactInternals=t,p&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=x,t.__reactInternalMemoizedMaskedChildContext=T),r}function jw(t,r,a,p){t=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,p),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,p),r.state!==t&&I0.enqueueReplaceState(r,r.state,null)}function ux(t,r,a,p){var x=t.stateNode;x.props=a,x.state=t.memoizedState,x.refs={},ub(t);var T=r.contextType;typeof T=="object"&&T!==null?x.context=xa(T):(T=ys(r)?Od:Ao.current,x.context=cp(t,T)),x.state=t.memoizedState,T=r.getDerivedStateFromProps,typeof T=="function"&&(cx(t,r,T,a),x.state=t.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(r=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),r!==x.state&&I0.enqueueReplaceState(x,x.state,null),Jy(t,a,x,p),x.state=t.memoizedState),typeof x.componentDidMount=="function"&&(t.flags|=4194308)}function fp(t,r){try{var a="",p=r;do a+=RE(p),p=p.return;while(p);var x=a}catch(T){x=`
Error generating stack: `+T.message+`
`+T.stack}return{value:t,source:r,stack:x,digest:null}}function h1(t,r,a){return{value:t,source:null,stack:a??null,digest:r??null}}function hx(t,r){try{console.error(r.value)}catch(a){setTimeout(function(){throw a})}}var sI=typeof WeakMap=="function"?WeakMap:Map;function ST(t,r,a){a=qc(-1,a),a.tag=3,a.payload={element:null};var p=r.value;return a.callback=function(){r0||(r0=!0,bx=p),hx(t,r)},a}function TT(t,r,a){a=qc(-1,a),a.tag=3;var p=t.type.getDerivedStateFromError;if(typeof p=="function"){var x=r.value;a.payload=function(){return p(x)},a.callback=function(){hx(t,r)}}var T=t.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(a.callback=function(){hx(t,r),typeof p!="function"&&(ph===null?ph=new Set([this]):ph.add(this));var b=r.stack;this.componentDidCatch(r.value,{componentStack:b!==null?b:""})}),a}function Uw(t,r,a){var p=t.pingCache;if(p===null){p=t.pingCache=new sI;var x=new Set;p.set(r,x)}else x=p.get(r),x===void 0&&(x=new Set,p.set(r,x));x.has(a)||(x.add(a),t=xI.bind(null,t,r,a),r.then(t,t))}function Vw(t){do{var r;if((r=t.tag===13)&&(r=t.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return t;t=t.return}while(t!==null);return null}function $w(t,r,a,p,x){return t.mode&1?(t.flags|=65536,t.lanes=x,t):(t===r?t.flags|=65536:(t.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(r=qc(-1,1),r.tag=2,fh(a,r,1))),a.lanes|=1),t)}var aI=Qc.ReactCurrentOwner,gs=!1;function Qo(t,r,a,p){r.child=t===null?QS(r,null,a,p):hp(r,t.child,a,p)}function Zw(t,r,a,p,x){a=a.render;var T=r.ref;return sp(r,x),p=mb(t,r,a,p,T,x),a=gb(),t!==null&&!gs?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~x,Yc(t,r,x)):(Xr&&a&&rb(r),r.flags|=1,Qo(t,r,p,x),r.child)}function Gw(t,r,a,p,x){if(t===null){var T=a.type;return typeof T=="function"&&!Pb(T)&&T.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(r.tag=15,r.type=T,CT(t,r,T,p,x)):(t=Ly(a.type,null,p,r,r.mode,x),t.ref=r.ref,t.return=r,r.child=t)}if(T=t.child,!(t.lanes&x)){var b=T.memoizedProps;if(a=a.compare,a=a!==null?a:lg,a(b,p)&&t.ref===r.ref)return Yc(t,r,x)}return r.flags|=1,t=gh(T,p),t.ref=r.ref,t.return=r,r.child=t}function CT(t,r,a,p,x){if(t!==null){var T=t.memoizedProps;if(lg(T,p)&&t.ref===r.ref)if(gs=!1,r.pendingProps=p=T,(t.lanes&x)!==0)t.flags&131072&&(gs=!0);else return r.lanes=t.lanes,Yc(t,r,x)}return dx(t,r,a,p,x)}function PT(t,r,a){var p=r.pendingProps,x=p.children,T=t!==null?t.memoizedState:null;if(p.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(tp,Bs),Bs|=a;else{if(!(a&1073741824))return t=T!==null?T.baseLanes|a:a,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:t,cachePool:null,transitions:null},r.updateQueue=null,Ar(tp,Bs),Bs|=t,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=T!==null?T.baseLanes:a,Ar(tp,Bs),Bs|=p}else T!==null?(p=T.baseLanes|a,r.memoizedState=null):p=a,Ar(tp,Bs),Bs|=p;return Qo(t,r,x,a),r.child}function ET(t,r){var a=r.ref;(t===null&&a!==null||t!==null&&t.ref!==a)&&(r.flags|=512,r.flags|=2097152)}function dx(t,r,a,p,x){var T=ys(a)?Od:Ao.current;return T=cp(r,T),sp(r,x),a=mb(t,r,a,p,T,x),p=gb(),t!==null&&!gs?(r.updateQueue=t.updateQueue,r.flags&=-2053,t.lanes&=~x,Yc(t,r,x)):(Xr&&p&&rb(r),r.flags|=1,Qo(t,r,a,x),r.child)}function qw(t,r,a,p,x){if(ys(a)){var T=!0;Wy(r)}else T=!1;if(sp(r,x),r.stateNode===null)zy(t,r),wT(r,a,p),ux(r,a,p,x),p=!0;else if(t===null){var b=r.stateNode,l=r.memoizedProps;b.props=l;var L=b.context,$=a.contextType;typeof $=="object"&&$!==null?$=xa($):($=ys(a)?Od:Ao.current,$=cp(r,$));var Q=a.getDerivedStateFromProps,ce=typeof Q=="function"||typeof b.getSnapshotBeforeUpdate=="function";ce||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(l!==p||L!==$)&&jw(r,b,p,$),ih=!1;var oe=r.memoizedState;b.state=oe,Jy(r,p,b,x),L=r.memoizedState,l!==p||oe!==L||_s.current||ih?(typeof Q=="function"&&(cx(r,a,Q,p),L=r.memoizedState),(l=ih||Nw(r,a,l,p,oe,L,$))?(ce||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(r.flags|=4194308)):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=p,r.memoizedState=L),b.props=p,b.state=L,b.context=$,p=l):(typeof b.componentDidMount=="function"&&(r.flags|=4194308),p=!1)}else{b=r.stateNode,tT(t,r),l=r.memoizedProps,$=r.type===r.elementType?l:Ka(r.type,l),b.props=$,ce=r.pendingProps,oe=b.context,L=a.contextType,typeof L=="object"&&L!==null?L=xa(L):(L=ys(a)?Od:Ao.current,L=cp(r,L));var Y=a.getDerivedStateFromProps;(Q=typeof Y=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(l!==ce||oe!==L)&&jw(r,b,p,L),ih=!1,oe=r.memoizedState,b.state=oe,Jy(r,p,b,x);var Te=r.memoizedState;l!==ce||oe!==Te||_s.current||ih?(typeof Y=="function"&&(cx(r,a,Y,p),Te=r.memoizedState),($=ih||Nw(r,a,$,p,oe,Te,L)||!1)?(Q||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(p,Te,L),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(p,Te,L)),typeof b.componentDidUpdate=="function"&&(r.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof b.componentDidUpdate!="function"||l===t.memoizedProps&&oe===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&oe===t.memoizedState||(r.flags|=1024),r.memoizedProps=p,r.memoizedState=Te),b.props=p,b.state=Te,b.context=L,p=$):(typeof b.componentDidUpdate!="function"||l===t.memoizedProps&&oe===t.memoizedState||(r.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&oe===t.memoizedState||(r.flags|=1024),p=!1)}return fx(t,r,a,p,T,x)}function fx(t,r,a,p,x,T){ET(t,r);var b=(r.flags&128)!==0;if(!p&&!b)return x&&Aw(r,a,!1),Yc(t,r,T);p=r.stateNode,aI.current=r;var l=b&&typeof a.getDerivedStateFromError!="function"?null:p.render();return r.flags|=1,t!==null&&b?(r.child=hp(r,t.child,null,T),r.child=hp(r,null,l,T)):Qo(t,r,l,T),r.memoizedState=p.state,x&&Aw(r,a,!0),r.child}function MT(t){var r=t.stateNode;r.pendingContext?kw(t,r.pendingContext,r.pendingContext!==r.context):r.context&&kw(t,r.context,!1),hb(t,r.containerInfo)}function Ww(t,r,a,p,x){return up(),ob(x),r.flags|=256,Qo(t,r,a,p),r.child}var px={dehydrated:null,treeContext:null,retryLane:0};function mx(t){return{baseLanes:t,cachePool:null,transitions:null}}function IT(t,r,a){var p=r.pendingProps,x=si.current,T=!1,b=(r.flags&128)!==0,l;if((l=b)||(l=t!==null&&t.memoizedState===null?!1:(x&2)!==0),l?(T=!0,r.flags&=-129):(t===null||t.memoizedState!==null)&&(x|=1),Ar(si,x&1),t===null)return ax(r),t=r.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(r.mode&1?t.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(b=p.children,t=p.fallback,T?(p=r.mode,T=r.child,b={mode:"hidden",children:b},!(p&1)&&T!==null?(T.childLanes=0,T.pendingProps=b):T=z0(b,p,0,null),t=Ld(t,p,a,null),T.return=r,t.return=r,T.sibling=t,r.child=T,r.child.memoizedState=mx(a),r.memoizedState=px,t):vb(r,b));if(x=t.memoizedState,x!==null&&(l=x.dehydrated,l!==null))return lI(t,r,b,p,l,x,a);if(T){T=p.fallback,b=r.mode,x=t.child,l=x.sibling;var L={mode:"hidden",children:p.children};return!(b&1)&&r.child!==x?(p=r.child,p.childLanes=0,p.pendingProps=L,r.deletions=null):(p=gh(x,L),p.subtreeFlags=x.subtreeFlags&14680064),l!==null?T=gh(l,T):(T=Ld(T,b,a,null),T.flags|=2),T.return=r,p.return=r,p.sibling=T,r.child=p,p=T,T=r.child,b=t.child.memoizedState,b=b===null?mx(a):{baseLanes:b.baseLanes|a,cachePool:null,transitions:b.transitions},T.memoizedState=b,T.childLanes=t.childLanes&~a,r.memoizedState=px,p}return T=t.child,t=T.sibling,p=gh(T,{mode:"visible",children:p.children}),!(r.mode&1)&&(p.lanes=a),p.return=r,p.sibling=null,t!==null&&(a=r.deletions,a===null?(r.deletions=[t],r.flags|=16):a.push(t)),r.child=p,r.memoizedState=null,p}function vb(t,r){return r=z0({mode:"visible",children:r},t.mode,0,null),r.return=t,t.child=r}function py(t,r,a,p){return p!==null&&ob(p),hp(r,t.child,null,a),t=vb(r,r.pendingProps.children),t.flags|=2,r.memoizedState=null,t}function lI(t,r,a,p,x,T,b){if(a)return r.flags&256?(r.flags&=-257,p=h1(Error(vt(422))),py(t,r,b,p)):r.memoizedState!==null?(r.child=t.child,r.flags|=128,null):(T=p.fallback,x=r.mode,p=z0({mode:"visible",children:p.children},x,0,null),T=Ld(T,x,b,null),T.flags|=2,p.return=r,T.return=r,p.sibling=T,r.child=p,r.mode&1&&hp(r,t.child,null,b),r.child.memoizedState=mx(b),r.memoizedState=px,T);if(!(r.mode&1))return py(t,r,b,null);if(x.data==="$!"){if(p=x.nextSibling&&x.nextSibling.dataset,p)var l=p.dgst;return p=l,T=Error(vt(419)),p=h1(T,p,void 0),py(t,r,b,p)}if(l=(b&t.childLanes)!==0,gs||l){if(p=eo,p!==null){switch(b&-b){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(p.suspendedLanes|b)?0:x,x!==0&&x!==T.retryLane&&(T.retryLane=x,Kc(t,x),tl(p,t,x,-1))}return Cb(),p=h1(Error(vt(421))),py(t,r,b,p)}return x.data==="$?"?(r.flags|=128,r.child=t.child,r=bI.bind(null,t),x._reactRetry=r,null):(t=T.treeContext,Ns=dh(x.nextSibling),Us=r,Xr=!0,Ja=null,t!==null&&(ma[ga++]=$c,ma[ga++]=Zc,ma[ga++]=Bd,$c=t.id,Zc=t.overflow,Bd=r),r=vb(r,p.children),r.flags|=4096,r)}function Hw(t,r,a){t.lanes|=r;var p=t.alternate;p!==null&&(p.lanes|=r),lx(t.return,r,a)}function d1(t,r,a,p,x){var T=t.memoizedState;T===null?t.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:p,tail:a,tailMode:x}:(T.isBackwards=r,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=a,T.tailMode=x)}function kT(t,r,a){var p=r.pendingProps,x=p.revealOrder,T=p.tail;if(Qo(t,r,p.children,a),p=si.current,p&2)p=p&1|2,r.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=r.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hw(t,a,r);else if(t.tag===19)Hw(t,a,r);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===r)break e;for(;t.sibling===null;){if(t.return===null||t.return===r)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}p&=1}if(Ar(si,p),!(r.mode&1))r.memoizedState=null;else switch(x){case"forwards":for(a=r.child,x=null;a!==null;)t=a.alternate,t!==null&&Qy(t)===null&&(x=a),a=a.sibling;a=x,a===null?(x=r.child,r.child=null):(x=a.sibling,a.sibling=null),d1(r,!1,x,a,T);break;case"backwards":for(a=null,x=r.child,r.child=null;x!==null;){if(t=x.alternate,t!==null&&Qy(t)===null){r.child=x;break}t=x.sibling,x.sibling=a,a=x,x=t}d1(r,!0,a,null,T);break;case"together":d1(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function zy(t,r){!(r.mode&1)&&t!==null&&(t.alternate=null,r.alternate=null,r.flags|=2)}function Yc(t,r,a){if(t!==null&&(r.dependencies=t.dependencies),jd|=r.lanes,!(a&r.childLanes))return null;if(t!==null&&r.child!==t.child)throw Error(vt(153));if(r.child!==null){for(t=r.child,a=gh(t,t.pendingProps),r.child=a,a.return=r;t.sibling!==null;)t=t.sibling,a=a.sibling=gh(t,t.pendingProps),a.return=r;a.sibling=null}return r.child}function cI(t,r,a){switch(r.tag){case 3:MT(r),up();break;case 5:nT(r);break;case 1:ys(r.type)&&Wy(r);break;case 4:hb(r,r.stateNode.containerInfo);break;case 10:var p=r.type._context,x=r.memoizedProps.value;Ar(Ky,p._currentValue),p._currentValue=x;break;case 13:if(p=r.memoizedState,p!==null)return p.dehydrated!==null?(Ar(si,si.current&1),r.flags|=128,null):a&r.child.childLanes?IT(t,r,a):(Ar(si,si.current&1),t=Yc(t,r,a),t!==null?t.sibling:null);Ar(si,si.current&1);break;case 19:if(p=(a&r.childLanes)!==0,t.flags&128){if(p)return kT(t,r,a);r.flags|=128}if(x=r.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),Ar(si,si.current),p)break;return null;case 22:case 23:return r.lanes=0,PT(t,r,a)}return Yc(t,r,a)}var AT,gx,zT,RT;AT=function(t,r){for(var a=r.child;a!==null;){if(a.tag===5||a.tag===6)t.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};gx=function(){};zT=function(t,r,a,p){var x=t.memoizedProps;if(x!==p){t=r.stateNode,zd(Bl.current);var T=null;switch(a){case"input":x=B1(t,x),p=B1(t,p),T=[];break;case"select":x=li({},x,{value:void 0}),p=li({},p,{value:void 0}),T=[];break;case"textarea":x=U1(t,x),p=U1(t,p),T=[];break;default:typeof x.onClick!="function"&&typeof p.onClick=="function"&&(t.onclick=Gy)}$1(a,p);var b;a=null;for($ in x)if(!p.hasOwnProperty($)&&x.hasOwnProperty($)&&x[$]!=null)if($==="style"){var l=x[$];for(b in l)l.hasOwnProperty(b)&&(a||(a={}),a[b]="")}else $!=="dangerouslySetInnerHTML"&&$!=="children"&&$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(tg.hasOwnProperty($)?T||(T=[]):(T=T||[]).push($,null));for($ in p){var L=p[$];if(l=x!=null?x[$]:void 0,p.hasOwnProperty($)&&L!==l&&(L!=null||l!=null))if($==="style")if(l){for(b in l)!l.hasOwnProperty(b)||L&&L.hasOwnProperty(b)||(a||(a={}),a[b]="");for(b in L)L.hasOwnProperty(b)&&l[b]!==L[b]&&(a||(a={}),a[b]=L[b])}else a||(T||(T=[]),T.push($,a)),a=L;else $==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,l=l?l.__html:void 0,L!=null&&l!==L&&(T=T||[]).push($,L)):$==="children"?typeof L!="string"&&typeof L!="number"||(T=T||[]).push($,""+L):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&(tg.hasOwnProperty($)?(L!=null&&$==="onScroll"&&Or("scroll",t),T||l===L||(T=[])):(T=T||[]).push($,L))}a&&(T=T||[]).push("style",a);var $=T;(r.updateQueue=$)&&(r.flags|=4)}};RT=function(t,r,a,p){a!==p&&(r.flags|=4)};function Fm(t,r){if(!Xr)switch(t.tailMode){case"hidden":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var p=null;a!==null;)a.alternate!==null&&(p=a),a=a.sibling;p===null?r||t.tail===null?t.tail=null:t.tail.sibling=null:p.sibling=null}}function Eo(t){var r=t.alternate!==null&&t.alternate.child===t.child,a=0,p=0;if(r)for(var x=t.child;x!==null;)a|=x.lanes|x.childLanes,p|=x.subtreeFlags&14680064,p|=x.flags&14680064,x.return=t,x=x.sibling;else for(x=t.child;x!==null;)a|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=t,x=x.sibling;return t.subtreeFlags|=p,t.childLanes=a,r}function uI(t,r,a){var p=r.pendingProps;switch(ib(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Eo(r),null;case 1:return ys(r.type)&&qy(),Eo(r),null;case 3:return p=r.stateNode,dp(),Br(_s),Br(Ao),fb(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(t===null||t.child===null)&&(dy(r)?r.flags|=4:t===null||t.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Ja!==null&&(Tx(Ja),Ja=null))),gx(t,r),Eo(r),null;case 5:db(r);var x=zd(fg.current);if(a=r.type,t!==null&&r.stateNode!=null)zT(t,r,a,p,x),t.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!p){if(r.stateNode===null)throw Error(vt(166));return Eo(r),null}if(t=zd(Bl.current),dy(r)){p=r.stateNode,a=r.type;var T=r.memoizedProps;switch(p[Ll]=r,p[hg]=T,t=(r.mode&1)!==0,a){case"dialog":Or("cancel",p),Or("close",p);break;case"iframe":case"object":case"embed":Or("load",p);break;case"video":case"audio":for(x=0;x<$m.length;x++)Or($m[x],p);break;case"source":Or("error",p);break;case"img":case"image":case"link":Or("error",p),Or("load",p);break;case"details":Or("toggle",p);break;case"input":rw(p,T),Or("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!T.multiple},Or("invalid",p);break;case"textarea":ow(p,T),Or("invalid",p)}$1(a,T),x=null;for(var b in T)if(T.hasOwnProperty(b)){var l=T[b];b==="children"?typeof l=="string"?p.textContent!==l&&(T.suppressHydrationWarning!==!0&&hy(p.textContent,l,t),x=["children",l]):typeof l=="number"&&p.textContent!==""+l&&(T.suppressHydrationWarning!==!0&&hy(p.textContent,l,t),x=["children",""+l]):tg.hasOwnProperty(b)&&l!=null&&b==="onScroll"&&Or("scroll",p)}switch(a){case"input":ry(p),iw(p,T,!0);break;case"textarea":ry(p),sw(p);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(p.onclick=Gy)}p=x,r.updateQueue=p,p!==null&&(r.flags|=4)}else{b=x.nodeType===9?x:x.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=aS(a)),t==="http://www.w3.org/1999/xhtml"?a==="script"?(t=b.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof p.is=="string"?t=b.createElement(a,{is:p.is}):(t=b.createElement(a),a==="select"&&(b=t,p.multiple?b.multiple=!0:p.size&&(b.size=p.size))):t=b.createElementNS(t,a),t[Ll]=r,t[hg]=p,AT(t,r,!1,!1),r.stateNode=t;e:{switch(b=Z1(a,p),a){case"dialog":Or("cancel",t),Or("close",t),x=p;break;case"iframe":case"object":case"embed":Or("load",t),x=p;break;case"video":case"audio":for(x=0;x<$m.length;x++)Or($m[x],t);x=p;break;case"source":Or("error",t),x=p;break;case"img":case"image":case"link":Or("error",t),Or("load",t),x=p;break;case"details":Or("toggle",t),x=p;break;case"input":rw(t,p),x=B1(t,p),Or("invalid",t);break;case"option":x=p;break;case"select":t._wrapperState={wasMultiple:!!p.multiple},x=li({},p,{value:void 0}),Or("invalid",t);break;case"textarea":ow(t,p),x=U1(t,p),Or("invalid",t);break;default:x=p}$1(a,x),l=x;for(T in l)if(l.hasOwnProperty(T)){var L=l[T];T==="style"?uS(t,L):T==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,L!=null&&lS(t,L)):T==="children"?typeof L=="string"?(a!=="textarea"||L!=="")&&ng(t,L):typeof L=="number"&&ng(t,""+L):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(tg.hasOwnProperty(T)?L!=null&&T==="onScroll"&&Or("scroll",t):L!=null&&$x(t,T,L,b))}switch(a){case"input":ry(t),iw(t,p,!1);break;case"textarea":ry(t),sw(t);break;case"option":p.value!=null&&t.setAttribute("value",""+_h(p.value));break;case"select":t.multiple=!!p.multiple,T=p.value,T!=null?np(t,!!p.multiple,T,!1):p.defaultValue!=null&&np(t,!!p.multiple,p.defaultValue,!0);break;default:typeof x.onClick=="function"&&(t.onclick=Gy)}switch(a){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Eo(r),null;case 6:if(t&&r.stateNode!=null)RT(t,r,t.memoizedProps,p);else{if(typeof p!="string"&&r.stateNode===null)throw Error(vt(166));if(a=zd(fg.current),zd(Bl.current),dy(r)){if(p=r.stateNode,a=r.memoizedProps,p[Ll]=r,(T=p.nodeValue!==a)&&(t=Us,t!==null))switch(t.tag){case 3:hy(p.nodeValue,a,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&hy(p.nodeValue,a,(t.mode&1)!==0)}T&&(r.flags|=4)}else p=(a.nodeType===9?a:a.ownerDocument).createTextNode(p),p[Ll]=r,r.stateNode=p}return Eo(r),null;case 13:if(Br(si),p=r.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Xr&&Ns!==null&&r.mode&1&&!(r.flags&128))YS(),up(),r.flags|=98560,T=!1;else if(T=dy(r),p!==null&&p.dehydrated!==null){if(t===null){if(!T)throw Error(vt(318));if(T=r.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(vt(317));T[Ll]=r}else up(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Eo(r),T=!1}else Ja!==null&&(Tx(Ja),Ja=null),T=!0;if(!T)return r.flags&65536?r:null}return r.flags&128?(r.lanes=a,r):(p=p!==null,p!==(t!==null&&t.memoizedState!==null)&&p&&(r.child.flags|=8192,r.mode&1&&(t===null||si.current&1?Fi===0&&(Fi=3):Cb())),r.updateQueue!==null&&(r.flags|=4),Eo(r),null);case 4:return dp(),gx(t,r),t===null&&cg(r.stateNode.containerInfo),Eo(r),null;case 10:return lb(r.type._context),Eo(r),null;case 17:return ys(r.type)&&qy(),Eo(r),null;case 19:if(Br(si),T=r.memoizedState,T===null)return Eo(r),null;if(p=(r.flags&128)!==0,b=T.rendering,b===null)if(p)Fm(T,!1);else{if(Fi!==0||t!==null&&t.flags&128)for(t=r.child;t!==null;){if(b=Qy(t),b!==null){for(r.flags|=128,Fm(T,!1),p=b.updateQueue,p!==null&&(r.updateQueue=p,r.flags|=4),r.subtreeFlags=0,p=a,a=r.child;a!==null;)T=a,t=p,T.flags&=14680066,b=T.alternate,b===null?(T.childLanes=0,T.lanes=t,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=b.childLanes,T.lanes=b.lanes,T.child=b.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=b.memoizedProps,T.memoizedState=b.memoizedState,T.updateQueue=b.updateQueue,T.type=b.type,t=b.dependencies,T.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),a=a.sibling;return Ar(si,si.current&1|2),r.child}t=t.sibling}T.tail!==null&&wi()>pp&&(r.flags|=128,p=!0,Fm(T,!1),r.lanes=4194304)}else{if(!p)if(t=Qy(b),t!==null){if(r.flags|=128,p=!0,a=t.updateQueue,a!==null&&(r.updateQueue=a,r.flags|=4),Fm(T,!0),T.tail===null&&T.tailMode==="hidden"&&!b.alternate&&!Xr)return Eo(r),null}else 2*wi()-T.renderingStartTime>pp&&a!==1073741824&&(r.flags|=128,p=!0,Fm(T,!1),r.lanes=4194304);T.isBackwards?(b.sibling=r.child,r.child=b):(a=T.last,a!==null?a.sibling=b:r.child=b,T.last=b)}return T.tail!==null?(r=T.tail,T.rendering=r,T.tail=r.sibling,T.renderingStartTime=wi(),r.sibling=null,a=si.current,Ar(si,p?a&1|2:a&1),r):(Eo(r),null);case 22:case 23:return Tb(),p=r.memoizedState!==null,t!==null&&t.memoizedState!==null!==p&&(r.flags|=8192),p&&r.mode&1?Bs&1073741824&&(Eo(r),r.subtreeFlags&6&&(r.flags|=8192)):Eo(r),null;case 24:return null;case 25:return null}throw Error(vt(156,r.tag))}function hI(t,r){switch(ib(r),r.tag){case 1:return ys(r.type)&&qy(),t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 3:return dp(),Br(_s),Br(Ao),fb(),t=r.flags,t&65536&&!(t&128)?(r.flags=t&-65537|128,r):null;case 5:return db(r),null;case 13:if(Br(si),t=r.memoizedState,t!==null&&t.dehydrated!==null){if(r.alternate===null)throw Error(vt(340));up()}return t=r.flags,t&65536?(r.flags=t&-65537|128,r):null;case 19:return Br(si),null;case 4:return dp(),null;case 10:return lb(r.type._context),null;case 22:case 23:return Tb(),null;case 24:return null;default:return null}}var my=!1,Io=!1,dI=typeof WeakSet=="function"?WeakSet:Set,jt=null;function ep(t,r){var a=t.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(p){mi(t,r,p)}else a.current=null}function _x(t,r,a){try{a()}catch(p){mi(t,r,p)}}var Xw=!1;function fI(t,r){if(ex=Vy,t=BS(),nb(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var p=a.getSelection&&a.getSelection();if(p&&p.rangeCount!==0){a=p.anchorNode;var x=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{a.nodeType,T.nodeType}catch{a=null;break e}var b=0,l=-1,L=-1,$=0,Q=0,ce=t,oe=null;t:for(;;){for(var Y;ce!==a||x!==0&&ce.nodeType!==3||(l=b+x),ce!==T||p!==0&&ce.nodeType!==3||(L=b+p),ce.nodeType===3&&(b+=ce.nodeValue.length),(Y=ce.firstChild)!==null;)oe=ce,ce=Y;for(;;){if(ce===t)break t;if(oe===a&&++$===x&&(l=b),oe===T&&++Q===p&&(L=b),(Y=ce.nextSibling)!==null)break;ce=oe,oe=ce.parentNode}ce=Y}a=l===-1||L===-1?null:{start:l,end:L}}else a=null}a=a||{start:0,end:0}}else a=null;for(tx={focusedElem:t,selectionRange:a},Vy=!1,jt=r;jt!==null;)if(r=jt,t=r.child,(r.subtreeFlags&1028)!==0&&t!==null)t.return=r,jt=t;else for(;jt!==null;){r=jt;try{var Te=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Te!==null){var et=Te.memoizedProps,We=Te.memoizedState,he=r.stateNode,pe=he.getSnapshotBeforeUpdate(r.elementType===r.type?et:Ka(r.type,et),We);he.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:var ve=r.stateNode.containerInfo;ve.nodeType===1?ve.textContent="":ve.nodeType===9&&ve.documentElement&&ve.removeChild(ve.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(vt(163))}}catch(Oe){mi(r,r.return,Oe)}if(t=r.sibling,t!==null){t.return=r.return,jt=t;break}jt=r.return}return Te=Xw,Xw=!1,Te}function Ym(t,r,a){var p=r.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var x=p=p.next;do{if((x.tag&t)===t){var T=x.destroy;x.destroy=void 0,T!==void 0&&_x(r,a,T)}x=x.next}while(x!==p)}}function k0(t,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&t)===t){var p=a.create;a.destroy=p()}a=a.next}while(a!==r)}}function yx(t){var r=t.ref;if(r!==null){var a=t.stateNode;switch(t.tag){case 5:t=a;break;default:t=a}typeof r=="function"?r(t):r.current=t}}function DT(t){var r=t.alternate;r!==null&&(t.alternate=null,DT(r)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(r=t.stateNode,r!==null&&(delete r[Ll],delete r[hg],delete r[ix],delete r[XM],delete r[KM])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function LT(t){return t.tag===5||t.tag===3||t.tag===4}function Kw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||LT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function vx(t,r,a){var p=t.tag;if(p===5||p===6)t=t.stateNode,r?a.nodeType===8?a.parentNode.insertBefore(t,r):a.insertBefore(t,r):(a.nodeType===8?(r=a.parentNode,r.insertBefore(t,a)):(r=a,r.appendChild(t)),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Gy));else if(p!==4&&(t=t.child,t!==null))for(vx(t,r,a),t=t.sibling;t!==null;)vx(t,r,a),t=t.sibling}function xx(t,r,a){var p=t.tag;if(p===5||p===6)t=t.stateNode,r?a.insertBefore(t,r):a.appendChild(t);else if(p!==4&&(t=t.child,t!==null))for(xx(t,r,a),t=t.sibling;t!==null;)xx(t,r,a),t=t.sibling}var _o=null,Ya=!1;function nh(t,r,a){for(a=a.child;a!==null;)FT(t,r,a),a=a.sibling}function FT(t,r,a){if(Ol&&typeof Ol.onCommitFiberUnmount=="function")try{Ol.onCommitFiberUnmount(w0,a)}catch{}switch(a.tag){case 5:Io||ep(a,r);case 6:var p=_o,x=Ya;_o=null,nh(t,r,a),_o=p,Ya=x,_o!==null&&(Ya?(t=_o,a=a.stateNode,t.nodeType===8?t.parentNode.removeChild(a):t.removeChild(a)):_o.removeChild(a.stateNode));break;case 18:_o!==null&&(Ya?(t=_o,a=a.stateNode,t.nodeType===8?o1(t.parentNode,a):t.nodeType===1&&o1(t,a),sg(t)):o1(_o,a.stateNode));break;case 4:p=_o,x=Ya,_o=a.stateNode.containerInfo,Ya=!0,nh(t,r,a),_o=p,Ya=x;break;case 0:case 11:case 14:case 15:if(!Io&&(p=a.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){x=p=p.next;do{var T=x,b=T.destroy;T=T.tag,b!==void 0&&(T&2||T&4)&&_x(a,r,b),x=x.next}while(x!==p)}nh(t,r,a);break;case 1:if(!Io&&(ep(a,r),p=a.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=a.memoizedProps,p.state=a.memoizedState,p.componentWillUnmount()}catch(l){mi(a,r,l)}nh(t,r,a);break;case 21:nh(t,r,a);break;case 22:a.mode&1?(Io=(p=Io)||a.memoizedState!==null,nh(t,r,a),Io=p):nh(t,r,a);break;default:nh(t,r,a)}}function Yw(t){var r=t.updateQueue;if(r!==null){t.updateQueue=null;var a=t.stateNode;a===null&&(a=t.stateNode=new dI),r.forEach(function(p){var x=wI.bind(null,t,p);a.has(p)||(a.add(p),p.then(x,x))})}}function Ha(t,r){var a=r.deletions;if(a!==null)for(var p=0;p<a.length;p++){var x=a[p];try{var T=t,b=r,l=b;e:for(;l!==null;){switch(l.tag){case 5:_o=l.stateNode,Ya=!1;break e;case 3:_o=l.stateNode.containerInfo,Ya=!0;break e;case 4:_o=l.stateNode.containerInfo,Ya=!0;break e}l=l.return}if(_o===null)throw Error(vt(160));FT(T,b,x),_o=null,Ya=!1;var L=x.alternate;L!==null&&(L.return=null),x.return=null}catch($){mi(x,r,$)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)OT(r,t),r=r.sibling}function OT(t,r){var a=t.alternate,p=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ha(r,t),Rl(t),p&4){try{Ym(3,t,t.return),k0(3,t)}catch(et){mi(t,t.return,et)}try{Ym(5,t,t.return)}catch(et){mi(t,t.return,et)}}break;case 1:Ha(r,t),Rl(t),p&512&&a!==null&&ep(a,a.return);break;case 5:if(Ha(r,t),Rl(t),p&512&&a!==null&&ep(a,a.return),t.flags&32){var x=t.stateNode;try{ng(x,"")}catch(et){mi(t,t.return,et)}}if(p&4&&(x=t.stateNode,x!=null)){var T=t.memoizedProps,b=a!==null?a.memoizedProps:T,l=t.type,L=t.updateQueue;if(t.updateQueue=null,L!==null)try{l==="input"&&T.type==="radio"&&T.name!=null&&oS(x,T),Z1(l,b);var $=Z1(l,T);for(b=0;b<L.length;b+=2){var Q=L[b],ce=L[b+1];Q==="style"?uS(x,ce):Q==="dangerouslySetInnerHTML"?lS(x,ce):Q==="children"?ng(x,ce):$x(x,Q,ce,$)}switch(l){case"input":N1(x,T);break;case"textarea":sS(x,T);break;case"select":var oe=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!T.multiple;var Y=T.value;Y!=null?np(x,!!T.multiple,Y,!1):oe!==!!T.multiple&&(T.defaultValue!=null?np(x,!!T.multiple,T.defaultValue,!0):np(x,!!T.multiple,T.multiple?[]:"",!1))}x[hg]=T}catch(et){mi(t,t.return,et)}}break;case 6:if(Ha(r,t),Rl(t),p&4){if(t.stateNode===null)throw Error(vt(162));x=t.stateNode,T=t.memoizedProps;try{x.nodeValue=T}catch(et){mi(t,t.return,et)}}break;case 3:if(Ha(r,t),Rl(t),p&4&&a!==null&&a.memoizedState.isDehydrated)try{sg(r.containerInfo)}catch(et){mi(t,t.return,et)}break;case 4:Ha(r,t),Rl(t);break;case 13:Ha(r,t),Rl(t),x=t.child,x.flags&8192&&(T=x.memoizedState!==null,x.stateNode.isHidden=T,!T||x.alternate!==null&&x.alternate.memoizedState!==null||(wb=wi())),p&4&&Yw(t);break;case 22:if(Q=a!==null&&a.memoizedState!==null,t.mode&1?(Io=($=Io)||Q,Ha(r,t),Io=$):Ha(r,t),Rl(t),p&8192){if($=t.memoizedState!==null,(t.stateNode.isHidden=$)&&!Q&&t.mode&1)for(jt=t,Q=t.child;Q!==null;){for(ce=jt=Q;jt!==null;){switch(oe=jt,Y=oe.child,oe.tag){case 0:case 11:case 14:case 15:Ym(4,oe,oe.return);break;case 1:ep(oe,oe.return);var Te=oe.stateNode;if(typeof Te.componentWillUnmount=="function"){p=oe,a=oe.return;try{r=p,Te.props=r.memoizedProps,Te.state=r.memoizedState,Te.componentWillUnmount()}catch(et){mi(p,a,et)}}break;case 5:ep(oe,oe.return);break;case 22:if(oe.memoizedState!==null){Qw(ce);continue}}Y!==null?(Y.return=oe,jt=Y):Qw(ce)}Q=Q.sibling}e:for(Q=null,ce=t;;){if(ce.tag===5){if(Q===null){Q=ce;try{x=ce.stateNode,$?(T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(l=ce.stateNode,L=ce.memoizedProps.style,b=L!=null&&L.hasOwnProperty("display")?L.display:null,l.style.display=cS("display",b))}catch(et){mi(t,t.return,et)}}}else if(ce.tag===6){if(Q===null)try{ce.stateNode.nodeValue=$?"":ce.memoizedProps}catch(et){mi(t,t.return,et)}}else if((ce.tag!==22&&ce.tag!==23||ce.memoizedState===null||ce===t)&&ce.child!==null){ce.child.return=ce,ce=ce.child;continue}if(ce===t)break e;for(;ce.sibling===null;){if(ce.return===null||ce.return===t)break e;Q===ce&&(Q=null),ce=ce.return}Q===ce&&(Q=null),ce.sibling.return=ce.return,ce=ce.sibling}}break;case 19:Ha(r,t),Rl(t),p&4&&Yw(t);break;case 21:break;default:Ha(r,t),Rl(t)}}function Rl(t){var r=t.flags;if(r&2){try{e:{for(var a=t.return;a!==null;){if(LT(a)){var p=a;break e}a=a.return}throw Error(vt(160))}switch(p.tag){case 5:var x=p.stateNode;p.flags&32&&(ng(x,""),p.flags&=-33);var T=Kw(t);xx(t,T,x);break;case 3:case 4:var b=p.stateNode.containerInfo,l=Kw(t);vx(t,l,b);break;default:throw Error(vt(161))}}catch(L){mi(t,t.return,L)}t.flags&=-3}r&4096&&(t.flags&=-4097)}function pI(t,r,a){jt=t,BT(t)}function BT(t,r,a){for(var p=(t.mode&1)!==0;jt!==null;){var x=jt,T=x.child;if(x.tag===22&&p){var b=x.memoizedState!==null||my;if(!b){var l=x.alternate,L=l!==null&&l.memoizedState!==null||Io;l=my;var $=Io;if(my=b,(Io=L)&&!$)for(jt=x;jt!==null;)b=jt,L=b.child,b.tag===22&&b.memoizedState!==null?e2(x):L!==null?(L.return=b,jt=L):e2(x);for(;T!==null;)jt=T,BT(T),T=T.sibling;jt=x,my=l,Io=$}Jw(t)}else x.subtreeFlags&8772&&T!==null?(T.return=x,jt=T):Jw(t)}}function Jw(t){for(;jt!==null;){var r=jt;if(r.flags&8772){var a=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Io||k0(5,r);break;case 1:var p=r.stateNode;if(r.flags&4&&!Io)if(a===null)p.componentDidMount();else{var x=r.elementType===r.type?a.memoizedProps:Ka(r.type,a.memoizedProps);p.componentDidUpdate(x,a.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var T=r.updateQueue;T!==null&&Fw(r,T,p);break;case 3:var b=r.updateQueue;if(b!==null){if(a=null,r.child!==null)switch(r.child.tag){case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}Fw(r,b,a)}break;case 5:var l=r.stateNode;if(a===null&&r.flags&4){a=l;var L=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":L.autoFocus&&a.focus();break;case"img":L.src&&(a.src=L.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var $=r.alternate;if($!==null){var Q=$.memoizedState;if(Q!==null){var ce=Q.dehydrated;ce!==null&&sg(ce)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(vt(163))}Io||r.flags&512&&yx(r)}catch(oe){mi(r,r.return,oe)}}if(r===t){jt=null;break}if(a=r.sibling,a!==null){a.return=r.return,jt=a;break}jt=r.return}}function Qw(t){for(;jt!==null;){var r=jt;if(r===t){jt=null;break}var a=r.sibling;if(a!==null){a.return=r.return,jt=a;break}jt=r.return}}function e2(t){for(;jt!==null;){var r=jt;try{switch(r.tag){case 0:case 11:case 15:var a=r.return;try{k0(4,r)}catch(L){mi(r,a,L)}break;case 1:var p=r.stateNode;if(typeof p.componentDidMount=="function"){var x=r.return;try{p.componentDidMount()}catch(L){mi(r,x,L)}}var T=r.return;try{yx(r)}catch(L){mi(r,T,L)}break;case 5:var b=r.return;try{yx(r)}catch(L){mi(r,b,L)}}}catch(L){mi(r,r.return,L)}if(r===t){jt=null;break}var l=r.sibling;if(l!==null){l.return=r.return,jt=l;break}jt=r.return}}var mI=Math.ceil,n0=Qc.ReactCurrentDispatcher,xb=Qc.ReactCurrentOwner,ya=Qc.ReactCurrentBatchConfig,er=0,eo=null,Mi=null,yo=0,Bs=0,tp=bh(0),Fi=0,_g=null,jd=0,A0=0,bb=0,Jm=null,ms=null,wb=0,pp=1/0,jc=null,r0=!1,bx=null,ph=null,gy=!1,lh=null,i0=0,Qm=0,wx=null,Ry=-1,Dy=0;function es(){return er&6?wi():Ry!==-1?Ry:Ry=wi()}function mh(t){return t.mode&1?er&2&&yo!==0?yo&-yo:JM.transition!==null?(Dy===0&&(Dy=wS()),Dy):(t=yr,t!==0||(t=window.event,t=t===void 0?16:IS(t.type)),t):1}function tl(t,r,a,p){if(50<Qm)throw Qm=0,wx=null,Error(vt(185));Sg(t,a,p),(!(er&2)||t!==eo)&&(t===eo&&(!(er&2)&&(A0|=a),Fi===4&&sh(t,yo)),vs(t,p),a===1&&er===0&&!(r.mode&1)&&(pp=wi()+500,E0&&wh()))}function vs(t,r){var a=t.callbackNode;JE(t,r);var p=Uy(t,t===eo?yo:0);if(p===0)a!==null&&cw(a),t.callbackNode=null,t.callbackPriority=0;else if(r=p&-p,t.callbackPriority!==r){if(a!=null&&cw(a),r===1)t.tag===0?YM(t2.bind(null,t)):HS(t2.bind(null,t)),WM(function(){!(er&6)&&wh()}),a=null;else{switch(SS(p)){case 1:a=Hx;break;case 4:a=xS;break;case 16:a=jy;break;case 536870912:a=bS;break;default:a=jy}a=qT(a,NT.bind(null,t))}t.callbackPriority=r,t.callbackNode=a}}function NT(t,r){if(Ry=-1,Dy=0,er&6)throw Error(vt(327));var a=t.callbackNode;if(ap()&&t.callbackNode!==a)return null;var p=Uy(t,t===eo?yo:0);if(p===0)return null;if(p&30||p&t.expiredLanes||r)r=o0(t,p);else{r=p;var x=er;er|=2;var T=UT();(eo!==t||yo!==r)&&(jc=null,pp=wi()+500,Dd(t,r));do try{yI();break}catch(l){jT(t,l)}while(!0);ab(),n0.current=T,er=x,Mi!==null?r=0:(eo=null,yo=0,r=Fi)}if(r!==0){if(r===2&&(x=X1(t),x!==0&&(p=x,r=Sx(t,x))),r===1)throw a=_g,Dd(t,0),sh(t,p),vs(t,wi()),a;if(r===6)sh(t,p);else{if(x=t.current.alternate,!(p&30)&&!gI(x)&&(r=o0(t,p),r===2&&(T=X1(t),T!==0&&(p=T,r=Sx(t,T))),r===1))throw a=_g,Dd(t,0),sh(t,p),vs(t,wi()),a;switch(t.finishedWork=x,t.finishedLanes=p,r){case 0:case 1:throw Error(vt(345));case 2:Pd(t,ms,jc);break;case 3:if(sh(t,p),(p&130023424)===p&&(r=wb+500-wi(),10<r)){if(Uy(t,0)!==0)break;if(x=t.suspendedLanes,(x&p)!==p){es(),t.pingedLanes|=t.suspendedLanes&x;break}t.timeoutHandle=rx(Pd.bind(null,t,ms,jc),r);break}Pd(t,ms,jc);break;case 4:if(sh(t,p),(p&4194240)===p)break;for(r=t.eventTimes,x=-1;0<p;){var b=31-el(p);T=1<<b,b=r[b],b>x&&(x=b),p&=~T}if(p=x,p=wi()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*mI(p/1960))-p,10<p){t.timeoutHandle=rx(Pd.bind(null,t,ms,jc),p);break}Pd(t,ms,jc);break;case 5:Pd(t,ms,jc);break;default:throw Error(vt(329))}}}return vs(t,wi()),t.callbackNode===a?NT.bind(null,t):null}function Sx(t,r){var a=Jm;return t.current.memoizedState.isDehydrated&&(Dd(t,r).flags|=256),t=o0(t,r),t!==2&&(r=ms,ms=a,r!==null&&Tx(r)),t}function Tx(t){ms===null?ms=t:ms.push.apply(ms,t)}function gI(t){for(var r=t;;){if(r.flags&16384){var a=r.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var p=0;p<a.length;p++){var x=a[p],T=x.getSnapshot;x=x.value;try{if(!rl(T(),x))return!1}catch{return!1}}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function sh(t,r){for(r&=~bb,r&=~A0,t.suspendedLanes|=r,t.pingedLanes&=~r,t=t.expirationTimes;0<r;){var a=31-el(r),p=1<<a;t[a]=-1,r&=~p}}function t2(t){if(er&6)throw Error(vt(327));ap();var r=Uy(t,0);if(!(r&1))return vs(t,wi()),null;var a=o0(t,r);if(t.tag!==0&&a===2){var p=X1(t);p!==0&&(r=p,a=Sx(t,p))}if(a===1)throw a=_g,Dd(t,0),sh(t,r),vs(t,wi()),a;if(a===6)throw Error(vt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=r,Pd(t,ms,jc),vs(t,wi()),null}function Sb(t,r){var a=er;er|=1;try{return t(r)}finally{er=a,er===0&&(pp=wi()+500,E0&&wh())}}function Ud(t){lh!==null&&lh.tag===0&&!(er&6)&&ap();var r=er;er|=1;var a=ya.transition,p=yr;try{if(ya.transition=null,yr=1,t)return t()}finally{yr=p,ya.transition=a,er=r,!(er&6)&&wh()}}function Tb(){Bs=tp.current,Br(tp)}function Dd(t,r){t.finishedWork=null,t.finishedLanes=0;var a=t.timeoutHandle;if(a!==-1&&(t.timeoutHandle=-1,qM(a)),Mi!==null)for(a=Mi.return;a!==null;){var p=a;switch(ib(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&qy();break;case 3:dp(),Br(_s),Br(Ao),fb();break;case 5:db(p);break;case 4:dp();break;case 13:Br(si);break;case 19:Br(si);break;case 10:lb(p.type._context);break;case 22:case 23:Tb()}a=a.return}if(eo=t,Mi=t=gh(t.current,null),yo=Bs=r,Fi=0,_g=null,bb=A0=jd=0,ms=Jm=null,Ad!==null){for(r=0;r<Ad.length;r++)if(a=Ad[r],p=a.interleaved,p!==null){a.interleaved=null;var x=p.next,T=a.pending;if(T!==null){var b=T.next;T.next=x,p.next=b}a.pending=p}Ad=null}return t}function jT(t,r){do{var a=Mi;try{if(ab(),ky.current=t0,e0){for(var p=ai.memoizedState;p!==null;){var x=p.queue;x!==null&&(x.pending=null),p=p.next}e0=!1}if(Nd=0,Qi=Li=ai=null,Km=!1,pg=0,xb.current=null,a===null||a.return===null){Fi=1,_g=r,Mi=null;break}e:{var T=t,b=a.return,l=a,L=r;if(r=yo,l.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){var $=L,Q=l,ce=Q.tag;if(!(Q.mode&1)&&(ce===0||ce===11||ce===15)){var oe=Q.alternate;oe?(Q.updateQueue=oe.updateQueue,Q.memoizedState=oe.memoizedState,Q.lanes=oe.lanes):(Q.updateQueue=null,Q.memoizedState=null)}var Y=Vw(b);if(Y!==null){Y.flags&=-257,$w(Y,b,l,T,r),Y.mode&1&&Uw(T,$,r),r=Y,L=$;var Te=r.updateQueue;if(Te===null){var et=new Set;et.add(L),r.updateQueue=et}else Te.add(L);break e}else{if(!(r&1)){Uw(T,$,r),Cb();break e}L=Error(vt(426))}}else if(Xr&&l.mode&1){var We=Vw(b);if(We!==null){!(We.flags&65536)&&(We.flags|=256),$w(We,b,l,T,r),ob(fp(L,l));break e}}T=L=fp(L,l),Fi!==4&&(Fi=2),Jm===null?Jm=[T]:Jm.push(T),T=b;do{switch(T.tag){case 3:T.flags|=65536,r&=-r,T.lanes|=r;var he=ST(T,L,r);Lw(T,he);break e;case 1:l=L;var pe=T.type,ve=T.stateNode;if(!(T.flags&128)&&(typeof pe.getDerivedStateFromError=="function"||ve!==null&&typeof ve.componentDidCatch=="function"&&(ph===null||!ph.has(ve)))){T.flags|=65536,r&=-r,T.lanes|=r;var Oe=TT(T,l,r);Lw(T,Oe);break e}}T=T.return}while(T!==null)}$T(a)}catch(it){r=it,Mi===a&&a!==null&&(Mi=a=a.return);continue}break}while(!0)}function UT(){var t=n0.current;return n0.current=t0,t===null?t0:t}function Cb(){(Fi===0||Fi===3||Fi===2)&&(Fi=4),eo===null||!(jd&268435455)&&!(A0&268435455)||sh(eo,yo)}function o0(t,r){var a=er;er|=2;var p=UT();(eo!==t||yo!==r)&&(jc=null,Dd(t,r));do try{_I();break}catch(x){jT(t,x)}while(!0);if(ab(),er=a,n0.current=p,Mi!==null)throw Error(vt(261));return eo=null,yo=0,Fi}function _I(){for(;Mi!==null;)VT(Mi)}function yI(){for(;Mi!==null&&!$E();)VT(Mi)}function VT(t){var r=GT(t.alternate,t,Bs);t.memoizedProps=t.pendingProps,r===null?$T(t):Mi=r,xb.current=null}function $T(t){var r=t;do{var a=r.alternate;if(t=r.return,r.flags&32768){if(a=hI(a,r),a!==null){a.flags&=32767,Mi=a;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Fi=6,Mi=null;return}}else if(a=uI(a,r,Bs),a!==null){Mi=a;return}if(r=r.sibling,r!==null){Mi=r;return}Mi=r=t}while(r!==null);Fi===0&&(Fi=5)}function Pd(t,r,a){var p=yr,x=ya.transition;try{ya.transition=null,yr=1,vI(t,r,a,p)}finally{ya.transition=x,yr=p}return null}function vI(t,r,a,p){do ap();while(lh!==null);if(er&6)throw Error(vt(327));a=t.finishedWork;var x=t.finishedLanes;if(a===null)return null;if(t.finishedWork=null,t.finishedLanes=0,a===t.current)throw Error(vt(177));t.callbackNode=null,t.callbackPriority=0;var T=a.lanes|a.childLanes;if(QE(t,T),t===eo&&(Mi=eo=null,yo=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||gy||(gy=!0,qT(jy,function(){return ap(),null})),T=(a.flags&15990)!==0,a.subtreeFlags&15990||T){T=ya.transition,ya.transition=null;var b=yr;yr=1;var l=er;er|=4,xb.current=null,fI(t,a),OT(a,t),NM(tx),Vy=!!ex,tx=ex=null,t.current=a,pI(a),ZE(),er=l,yr=b,ya.transition=T}else t.current=a;if(gy&&(gy=!1,lh=t,i0=x),T=t.pendingLanes,T===0&&(ph=null),WE(a.stateNode),vs(t,wi()),r!==null)for(p=t.onRecoverableError,a=0;a<r.length;a++)x=r[a],p(x.value,{componentStack:x.stack,digest:x.digest});if(r0)throw r0=!1,t=bx,bx=null,t;return i0&1&&t.tag!==0&&ap(),T=t.pendingLanes,T&1?t===wx?Qm++:(Qm=0,wx=t):Qm=0,wh(),null}function ap(){if(lh!==null){var t=SS(i0),r=ya.transition,a=yr;try{if(ya.transition=null,yr=16>t?16:t,lh===null)var p=!1;else{if(t=lh,lh=null,i0=0,er&6)throw Error(vt(331));var x=er;for(er|=4,jt=t.current;jt!==null;){var T=jt,b=T.child;if(jt.flags&16){var l=T.deletions;if(l!==null){for(var L=0;L<l.length;L++){var $=l[L];for(jt=$;jt!==null;){var Q=jt;switch(Q.tag){case 0:case 11:case 15:Ym(8,Q,T)}var ce=Q.child;if(ce!==null)ce.return=Q,jt=ce;else for(;jt!==null;){Q=jt;var oe=Q.sibling,Y=Q.return;if(DT(Q),Q===$){jt=null;break}if(oe!==null){oe.return=Y,jt=oe;break}jt=Y}}}var Te=T.alternate;if(Te!==null){var et=Te.child;if(et!==null){Te.child=null;do{var We=et.sibling;et.sibling=null,et=We}while(et!==null)}}jt=T}}if(T.subtreeFlags&2064&&b!==null)b.return=T,jt=b;else e:for(;jt!==null;){if(T=jt,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Ym(9,T,T.return)}var he=T.sibling;if(he!==null){he.return=T.return,jt=he;break e}jt=T.return}}var pe=t.current;for(jt=pe;jt!==null;){b=jt;var ve=b.child;if(b.subtreeFlags&2064&&ve!==null)ve.return=b,jt=ve;else e:for(b=pe;jt!==null;){if(l=jt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:k0(9,l)}}catch(it){mi(l,l.return,it)}if(l===b){jt=null;break e}var Oe=l.sibling;if(Oe!==null){Oe.return=l.return,jt=Oe;break e}jt=l.return}}if(er=x,wh(),Ol&&typeof Ol.onPostCommitFiberRoot=="function")try{Ol.onPostCommitFiberRoot(w0,t)}catch{}p=!0}return p}finally{yr=a,ya.transition=r}}return!1}function n2(t,r,a){r=fp(a,r),r=ST(t,r,1),t=fh(t,r,1),r=es(),t!==null&&(Sg(t,1,r),vs(t,r))}function mi(t,r,a){if(t.tag===3)n2(t,t,a);else for(;r!==null;){if(r.tag===3){n2(r,t,a);break}else if(r.tag===1){var p=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ph===null||!ph.has(p))){t=fp(a,t),t=TT(r,t,1),r=fh(r,t,1),t=es(),r!==null&&(Sg(r,1,t),vs(r,t));break}}r=r.return}}function xI(t,r,a){var p=t.pingCache;p!==null&&p.delete(r),r=es(),t.pingedLanes|=t.suspendedLanes&a,eo===t&&(yo&a)===a&&(Fi===4||Fi===3&&(yo&130023424)===yo&&500>wi()-wb?Dd(t,0):bb|=a),vs(t,r)}function ZT(t,r){r===0&&(t.mode&1?(r=sy,sy<<=1,!(sy&130023424)&&(sy=4194304)):r=1);var a=es();t=Kc(t,r),t!==null&&(Sg(t,r,a),vs(t,a))}function bI(t){var r=t.memoizedState,a=0;r!==null&&(a=r.retryLane),ZT(t,a)}function wI(t,r){var a=0;switch(t.tag){case 13:var p=t.stateNode,x=t.memoizedState;x!==null&&(a=x.retryLane);break;case 19:p=t.stateNode;break;default:throw Error(vt(314))}p!==null&&p.delete(r),ZT(t,a)}var GT;GT=function(t,r,a){if(t!==null)if(t.memoizedProps!==r.pendingProps||_s.current)gs=!0;else{if(!(t.lanes&a)&&!(r.flags&128))return gs=!1,cI(t,r,a);gs=!!(t.flags&131072)}else gs=!1,Xr&&r.flags&1048576&&XS(r,Xy,r.index);switch(r.lanes=0,r.tag){case 2:var p=r.type;zy(t,r),t=r.pendingProps;var x=cp(r,Ao.current);sp(r,a),x=mb(null,r,p,t,x,a);var T=gb();return r.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,ys(p)?(T=!0,Wy(r)):T=!1,r.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,ub(r),x.updater=I0,r.stateNode=x,x._reactInternals=r,ux(r,p,t,a),r=fx(null,r,p,!0,T,a)):(r.tag=0,Xr&&T&&rb(r),Qo(null,r,x,a),r=r.child),r;case 16:p=r.elementType;e:{switch(zy(t,r),t=r.pendingProps,x=p._init,p=x(p._payload),r.type=p,x=r.tag=TI(p),t=Ka(p,t),x){case 0:r=dx(null,r,p,t,a);break e;case 1:r=qw(null,r,p,t,a);break e;case 11:r=Zw(null,r,p,t,a);break e;case 14:r=Gw(null,r,p,Ka(p.type,t),a);break e}throw Error(vt(306,p,""))}return r;case 0:return p=r.type,x=r.pendingProps,x=r.elementType===p?x:Ka(p,x),dx(t,r,p,x,a);case 1:return p=r.type,x=r.pendingProps,x=r.elementType===p?x:Ka(p,x),qw(t,r,p,x,a);case 3:e:{if(MT(r),t===null)throw Error(vt(387));p=r.pendingProps,T=r.memoizedState,x=T.element,tT(t,r),Jy(r,p,null,a);var b=r.memoizedState;if(p=b.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},r.updateQueue.baseState=T,r.memoizedState=T,r.flags&256){x=fp(Error(vt(423)),r),r=Ww(t,r,p,a,x);break e}else if(p!==x){x=fp(Error(vt(424)),r),r=Ww(t,r,p,a,x);break e}else for(Ns=dh(r.stateNode.containerInfo.firstChild),Us=r,Xr=!0,Ja=null,a=QS(r,null,p,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(up(),p===x){r=Yc(t,r,a);break e}Qo(t,r,p,a)}r=r.child}return r;case 5:return nT(r),t===null&&ax(r),p=r.type,x=r.pendingProps,T=t!==null?t.memoizedProps:null,b=x.children,nx(p,x)?b=null:T!==null&&nx(p,T)&&(r.flags|=32),ET(t,r),Qo(t,r,b,a),r.child;case 6:return t===null&&ax(r),null;case 13:return IT(t,r,a);case 4:return hb(r,r.stateNode.containerInfo),p=r.pendingProps,t===null?r.child=hp(r,null,p,a):Qo(t,r,p,a),r.child;case 11:return p=r.type,x=r.pendingProps,x=r.elementType===p?x:Ka(p,x),Zw(t,r,p,x,a);case 7:return Qo(t,r,r.pendingProps,a),r.child;case 8:return Qo(t,r,r.pendingProps.children,a),r.child;case 12:return Qo(t,r,r.pendingProps.children,a),r.child;case 10:e:{if(p=r.type._context,x=r.pendingProps,T=r.memoizedProps,b=x.value,Ar(Ky,p._currentValue),p._currentValue=b,T!==null)if(rl(T.value,b)){if(T.children===x.children&&!_s.current){r=Yc(t,r,a);break e}}else for(T=r.child,T!==null&&(T.return=r);T!==null;){var l=T.dependencies;if(l!==null){b=T.child;for(var L=l.firstContext;L!==null;){if(L.context===p){if(T.tag===1){L=qc(-1,a&-a),L.tag=2;var $=T.updateQueue;if($!==null){$=$.shared;var Q=$.pending;Q===null?L.next=L:(L.next=Q.next,Q.next=L),$.pending=L}}T.lanes|=a,L=T.alternate,L!==null&&(L.lanes|=a),lx(T.return,a,r),l.lanes|=a;break}L=L.next}}else if(T.tag===10)b=T.type===r.type?null:T.child;else if(T.tag===18){if(b=T.return,b===null)throw Error(vt(341));b.lanes|=a,l=b.alternate,l!==null&&(l.lanes|=a),lx(b,a,r),b=T.sibling}else b=T.child;if(b!==null)b.return=T;else for(b=T;b!==null;){if(b===r){b=null;break}if(T=b.sibling,T!==null){T.return=b.return,b=T;break}b=b.return}T=b}Qo(t,r,x.children,a),r=r.child}return r;case 9:return x=r.type,p=r.pendingProps.children,sp(r,a),x=xa(x),p=p(x),r.flags|=1,Qo(t,r,p,a),r.child;case 14:return p=r.type,x=Ka(p,r.pendingProps),x=Ka(p.type,x),Gw(t,r,p,x,a);case 15:return CT(t,r,r.type,r.pendingProps,a);case 17:return p=r.type,x=r.pendingProps,x=r.elementType===p?x:Ka(p,x),zy(t,r),r.tag=1,ys(p)?(t=!0,Wy(r)):t=!1,sp(r,a),wT(r,p,x),ux(r,p,x,a),fx(null,r,p,!0,t,a);case 19:return kT(t,r,a);case 22:return PT(t,r,a)}throw Error(vt(156,r.tag))};function qT(t,r){return vS(t,r)}function SI(t,r,a,p){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _a(t,r,a,p){return new SI(t,r,a,p)}function Pb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function TI(t){if(typeof t=="function")return Pb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Gx)return 11;if(t===qx)return 14}return 2}function gh(t,r){var a=t.alternate;return a===null?(a=_a(t.tag,r,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=r,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&14680064,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,r=t.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a}function Ly(t,r,a,p,x,T){var b=2;if(p=t,typeof t=="function")Pb(t)&&(b=1);else if(typeof t=="string")b=5;else e:switch(t){case Gf:return Ld(a.children,x,T,r);case Zx:b=8,x|=8;break;case D1:return t=_a(12,a,r,x|2),t.elementType=D1,t.lanes=T,t;case L1:return t=_a(13,a,r,x),t.elementType=L1,t.lanes=T,t;case F1:return t=_a(19,a,r,x),t.elementType=F1,t.lanes=T,t;case nS:return z0(a,x,T,r);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case eS:b=10;break e;case tS:b=9;break e;case Gx:b=11;break e;case qx:b=14;break e;case rh:b=16,p=null;break e}throw Error(vt(130,t==null?t:typeof t,""))}return r=_a(b,a,r,x),r.elementType=t,r.type=p,r.lanes=T,r}function Ld(t,r,a,p){return t=_a(7,t,p,r),t.lanes=a,t}function z0(t,r,a,p){return t=_a(22,t,p,r),t.elementType=nS,t.lanes=a,t.stateNode={isHidden:!1},t}function f1(t,r,a){return t=_a(6,t,null,r),t.lanes=a,t}function p1(t,r,a){return r=_a(4,t.children!==null?t.children:[],t.key,r),r.lanes=a,r.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},r}function CI(t,r,a,p,x){this.tag=r,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Hv(0),this.expirationTimes=Hv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hv(0),this.identifierPrefix=p,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Eb(t,r,a,p,x,T,b,l,L){return t=new CI(t,r,a,l,L),r===1?(r=1,T===!0&&(r|=8)):r=0,T=_a(3,null,null,r),t.current=T,T.stateNode=t,T.memoizedState={element:p,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},ub(T),t}function PI(t,r,a){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zf,key:p==null?null:""+p,children:t,containerInfo:r,implementation:a}}function WT(t){if(!t)return yh;t=t._reactInternals;e:{if(Wd(t)!==t||t.tag!==1)throw Error(vt(170));var r=t;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(ys(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(vt(171))}if(t.tag===1){var a=t.type;if(ys(a))return WS(t,a,r)}return r}function HT(t,r,a,p,x,T,b,l,L){return t=Eb(a,p,!0,t,x,T,b,l,L),t.context=WT(null),a=t.current,p=es(),x=mh(a),T=qc(p,x),T.callback=r??null,fh(a,T,x),t.current.lanes=x,Sg(t,x,p),vs(t,p),t}function R0(t,r,a,p){var x=r.current,T=es(),b=mh(x);return a=WT(a),r.context===null?r.context=a:r.pendingContext=a,r=qc(T,b),r.payload={element:t},p=p===void 0?null:p,p!==null&&(r.callback=p),t=fh(x,r,b),t!==null&&(tl(t,x,b,T),Iy(t,x,b)),b}function s0(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function r2(t,r){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<r?a:r}}function Mb(t,r){r2(t,r),(t=t.alternate)&&r2(t,r)}function EI(){return null}var XT=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ib(t){this._internalRoot=t}D0.prototype.render=Ib.prototype.render=function(t){var r=this._internalRoot;if(r===null)throw Error(vt(409));R0(t,r,null,null)};D0.prototype.unmount=Ib.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var r=t.containerInfo;Ud(function(){R0(null,t,null,null)}),r[Xc]=null}};function D0(t){this._internalRoot=t}D0.prototype.unstable_scheduleHydration=function(t){if(t){var r=PS();t={blockedOn:null,target:t,priority:r};for(var a=0;a<oh.length&&r!==0&&r<oh[a].priority;a++);oh.splice(a,0,t),a===0&&MS(t)}};function kb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function L0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function i2(){}function MI(t,r,a,p,x){if(x){if(typeof p=="function"){var T=p;p=function(){var $=s0(b);T.call($)}}var b=HT(r,p,t,0,null,!1,!1,"",i2);return t._reactRootContainer=b,t[Xc]=b.current,cg(t.nodeType===8?t.parentNode:t),Ud(),b}for(;x=t.lastChild;)t.removeChild(x);if(typeof p=="function"){var l=p;p=function(){var $=s0(L);l.call($)}}var L=Eb(t,0,!1,null,null,!1,!1,"",i2);return t._reactRootContainer=L,t[Xc]=L.current,cg(t.nodeType===8?t.parentNode:t),Ud(function(){R0(r,L,a,p)}),L}function F0(t,r,a,p,x){var T=a._reactRootContainer;if(T){var b=T;if(typeof x=="function"){var l=x;x=function(){var L=s0(b);l.call(L)}}R0(r,b,t,x)}else b=MI(a,r,t,x,p);return s0(b)}TS=function(t){switch(t.tag){case 3:var r=t.stateNode;if(r.current.memoizedState.isDehydrated){var a=Vm(r.pendingLanes);a!==0&&(Xx(r,a|1),vs(r,wi()),!(er&6)&&(pp=wi()+500,wh()))}break;case 13:Ud(function(){var p=Kc(t,1);if(p!==null){var x=es();tl(p,t,1,x)}}),Mb(t,1)}};Kx=function(t){if(t.tag===13){var r=Kc(t,134217728);if(r!==null){var a=es();tl(r,t,134217728,a)}Mb(t,134217728)}};CS=function(t){if(t.tag===13){var r=mh(t),a=Kc(t,r);if(a!==null){var p=es();tl(a,t,r,p)}Mb(t,r)}};PS=function(){return yr};ES=function(t,r){var a=yr;try{return yr=t,r()}finally{yr=a}};q1=function(t,r,a){switch(r){case"input":if(N1(t,a),r=a.name,a.type==="radio"&&r!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<a.length;r++){var p=a[r];if(p!==t&&p.form===t.form){var x=P0(p);if(!x)throw Error(vt(90));iS(p),N1(p,x)}}}break;case"textarea":sS(t,a);break;case"select":r=a.value,r!=null&&np(t,!!a.multiple,r,!1)}};fS=Sb;pS=Ud;var II={usingClientEntryPoint:!1,Events:[Cg,Xf,P0,hS,dS,Sb]},Om={findFiberByHostInstance:kd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kI={bundleType:Om.bundleType,version:Om.version,rendererPackageName:Om.rendererPackageName,rendererConfig:Om.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=_S(t),t===null?null:t.stateNode},findFiberByHostInstance:Om.findFiberByHostInstance||EI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _y=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_y.isDisabled&&_y.supportsFiber)try{w0=_y.inject(kI),Ol=_y}catch{}}Gs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=II;Gs.createPortal=function(t,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kb(r))throw Error(vt(200));return PI(t,r,null,a)};Gs.createRoot=function(t,r){if(!kb(t))throw Error(vt(299));var a=!1,p="",x=XT;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(p=r.identifierPrefix),r.onRecoverableError!==void 0&&(x=r.onRecoverableError)),r=Eb(t,1,!1,null,null,a,!1,p,x),t[Xc]=r.current,cg(t.nodeType===8?t.parentNode:t),new Ib(r)};Gs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var r=t._reactInternals;if(r===void 0)throw typeof t.render=="function"?Error(vt(188)):(t=Object.keys(t).join(","),Error(vt(268,t)));return t=_S(r),t=t===null?null:t.stateNode,t};Gs.flushSync=function(t){return Ud(t)};Gs.hydrate=function(t,r,a){if(!L0(r))throw Error(vt(200));return F0(null,t,r,!0,a)};Gs.hydrateRoot=function(t,r,a){if(!kb(t))throw Error(vt(405));var p=a!=null&&a.hydratedSources||null,x=!1,T="",b=XT;if(a!=null&&(a.unstable_strictMode===!0&&(x=!0),a.identifierPrefix!==void 0&&(T=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),r=HT(r,null,t,1,a??null,x,!1,T,b),t[Xc]=r.current,cg(t),p)for(t=0;t<p.length;t++)a=p[t],x=a._getVersion,x=x(a._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[a,x]:r.mutableSourceEagerHydrationData.push(a,x);return new D0(r)};Gs.render=function(t,r,a){if(!L0(r))throw Error(vt(200));return F0(null,t,r,!1,a)};Gs.unmountComponentAtNode=function(t){if(!L0(t))throw Error(vt(40));return t._reactRootContainer?(Ud(function(){F0(null,null,t,!1,function(){t._reactRootContainer=null,t[Xc]=null})}),!0):!1};Gs.unstable_batchedUpdates=Sb;Gs.unstable_renderSubtreeIntoContainer=function(t,r,a,p){if(!L0(a))throw Error(vt(200));if(t==null||t._reactInternals===void 0)throw Error(vt(38));return F0(t,r,a,!1,p)};Gs.version="18.3.1-next-f1338f8080-20240426";function KT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KT)}catch(t){console.error(t)}}KT(),K2.exports=Gs;var AI=K2.exports,o2=AI;z1.createRoot=o2.createRoot,z1.hydrateRoot=o2.hydrateRoot;var YT={exports:{}},JT={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eg=Lt;function zI(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var RI=typeof Object.is=="function"?Object.is:zI,DI=Eg.useSyncExternalStore,LI=Eg.useRef,FI=Eg.useEffect,OI=Eg.useMemo,BI=Eg.useDebugValue;JT.useSyncExternalStoreWithSelector=function(t,r,a,p,x){var T=LI(null);if(T.current===null){var b={hasValue:!1,value:null};T.current=b}else b=T.current;T=OI(function(){function L(Y){if(!$){if($=!0,Q=Y,Y=p(Y),x!==void 0&&b.hasValue){var Te=b.value;if(x(Te,Y))return ce=Te}return ce=Y}if(Te=ce,RI(Q,Y))return Te;var et=p(Y);return x!==void 0&&x(Te,et)?Te:(Q=Y,ce=et)}var $=!1,Q,ce,oe=a===void 0?null:a;return[function(){return L(r())},oe===null?void 0:function(){return L(oe())}]},[r,a,p,x]);var l=DI(t,T[0],T[1]);return FI(function(){b.hasValue=!0,b.value=l},[l]),BI(l),l};YT.exports=JT;var NI=YT.exports,js="default"in Qb?Fl:Qb,s2=Symbol.for("react-redux-context"),a2=typeof globalThis<"u"?globalThis:{};function jI(){if(!js.createContext)return{};const t=a2[s2]??(a2[s2]=new Map);let r=t.get(js.createContext);return r||(r=js.createContext(null),t.set(js.createContext,r)),r}var vh=jI(),UI=()=>{throw new Error("uSES not initialized!")};function Ab(t=vh){return function(){return js.useContext(t)}}var QT=Ab(),eC=UI,VI=t=>{eC=t},$I=(t,r)=>t===r;function ZI(t=vh){const r=t===vh?QT:Ab(t),a=(p,x={})=>{const{equalityFn:T=$I,devModeChecks:b={}}=typeof x=="function"?{equalityFn:x}:x,{store:l,subscription:L,getServerState:$,stabilityCheck:Q,identityFunctionCheck:ce}=r();js.useRef(!0);const oe=js.useCallback({[p.name](Te){return p(Te)}}[p.name],[p,Q,b.stabilityCheck]),Y=eC(L.addNestedSub,l.getState,$||l.getState,oe,T);return js.useDebugValue(Y),Y};return Object.assign(a,{withTypes:()=>a}),a}var Oi=ZI();function GI(t){t()}function qI(){let t=null,r=null;return{clear(){t=null,r=null},notify(){GI(()=>{let a=t;for(;a;)a.callback(),a=a.next})},get(){const a=[];let p=t;for(;p;)a.push(p),p=p.next;return a},subscribe(a){let p=!0;const x=r={callback:a,next:null,prev:r};return x.prev?x.prev.next=x:t=x,function(){!p||t===null||(p=!1,x.next?x.next.prev=x.prev:r=x.prev,x.prev?x.prev.next=x.next:t=x.next)}}}}var l2={notify(){},get:()=>[]};function WI(t,r){let a,p=l2,x=0,T=!1;function b(et){Q();const We=p.subscribe(et);let he=!1;return()=>{he||(he=!0,We(),ce())}}function l(){p.notify()}function L(){Te.onStateChange&&Te.onStateChange()}function $(){return T}function Q(){x++,a||(a=t.subscribe(L),p=qI())}function ce(){x--,a&&x===0&&(a(),a=void 0,p.clear(),p=l2)}function oe(){T||(T=!0,Q())}function Y(){T&&(T=!1,ce())}const Te={addNestedSub:b,notifyNestedSubs:l,handleChangeWrapper:L,isSubscribed:$,trySubscribe:oe,tryUnsubscribe:Y,getListeners:()=>p};return Te}var HI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",XI=typeof navigator<"u"&&navigator.product==="ReactNative",KI=HI||XI?js.useLayoutEffect:js.useEffect;function YI({store:t,context:r,children:a,serverState:p,stabilityCheck:x="once",identityFunctionCheck:T="once"}){const b=js.useMemo(()=>{const $=WI(t);return{store:t,subscription:$,getServerState:p?()=>p:void 0,stabilityCheck:x,identityFunctionCheck:T}},[t,p,x,T]),l=js.useMemo(()=>t.getState(),[t]);KI(()=>{const{subscription:$}=b;return $.onStateChange=$.notifyNestedSubs,$.trySubscribe(),l!==t.getState()&&$.notifyNestedSubs(),()=>{$.tryUnsubscribe(),$.onStateChange=void 0}},[b,l]);const L=r||vh;return js.createElement(L.Provider,{value:b},a)}var JI=YI;function tC(t=vh){const r=t===vh?QT:Ab(t),a=()=>{const{store:p}=r();return p};return Object.assign(a,{withTypes:()=>a}),a}var QI=tC();function ek(t=vh){const r=t===vh?QI:tC(t),a=()=>r().dispatch;return Object.assign(a,{withTypes:()=>a}),a}var Mg=ek();VI(NI.useSyncExternalStoreWithSelector);const tk="modulepreload",nk=function(t){return"/"+t},c2={},Cx=function(r,a,p){let x=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const b=document.querySelector("meta[property=csp-nonce]"),l=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));x=Promise.allSettled(a.map(L=>{if(L=nk(L),L in c2)return;c2[L]=!0;const $=L.endsWith(".css"),Q=$?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${L}"]${Q}`))return;const ce=document.createElement("link");if(ce.rel=$?"stylesheet":tk,$||(ce.as="script"),ce.crossOrigin="",ce.href=L,l&&ce.setAttribute("nonce",l),document.head.appendChild(ce),$)return new Promise((oe,Y)=>{ce.addEventListener("load",oe),ce.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${L}`)))})}))}function T(b){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=b,window.dispatchEvent(l),!l.defaultPrevented)throw b}return x.then(b=>{for(const l of b||[])l.status==="rejected"&&T(l.reason);return r().catch(T)})},rk=Cx(()=>import("./country-borders-ulWffK1x.js"),[]),a0={USA:Cx(()=>import("./state-borders-usa-_8J44aaB.js"),[]),CAN:Cx(()=>import("./state-borders-can-CwVHHxpH.js"),[])},bp=async()=>(await rk).default,Vd=t=>t in a0,nC=async t=>{if(!(t in a0))throw Error(`Could not find state data for country ${t}`);return(await a0[t]).default};function ik(t,r){var a=0,p=0,x=0,T=0,b=0,l=0,L=0,$=0,Q=null,ce=null,oe=t[0],Y=t[1],Te=r.length;for(a;a<Te;a++){p=0;var et=r[a].length-1,We=r[a];if(Q=We[0],Q[0]!==We[et][0]&&Q[1]!==We[et][1])throw new Error("First and last coordinates in a ring must be the same");for(b=Q[0]-oe,l=Q[1]-Y,p;p<et;p++){if(ce=We[p+1],$=ce[1]-Y,l<0&&$<0||l>0&&$>0){Q=ce,l=$,b=Q[0]-oe;continue}if(L=ce[0]-t[0],$>0&&l<=0){if(T=b*$-L*l,T>0)x=x+1;else if(T===0)return 0}else if(l>0&&$<=0){if(T=b*$-L*l,T<0)x=x+1;else if(T===0)return 0}else if($===0&&l<0){if(T=b*$-L*l,T===0)return 0}else if(l===0&&$<0){if(T=b*$-L*l,T===0)return 0}else if(l===0&&$===0){if(L<=0&&b>=0)return 0;if(b<=0&&L>=0)return 0}Q=ce,l=$,b=L}}return x%2!==0}function ok(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function sk(t){return t.type==="Feature"?t.geometry:t}function ak(t,r,a={}){if(!t)throw new Error("point is required");if(!r)throw new Error("polygon is required");const p=ok(t),x=sk(r),T=x.type,b=r.bbox;let l=x.coordinates;if(b&&lk(p,b)===!1)return!1;T==="Polygon"&&(l=[l]);let L=!1;for(var $=0;$<l.length;++$){const Q=ik(p,l[$]);if(Q===0)return!a.ignoreBoundary;Q&&(L=!0)}return L}function lk(t,r){return r[0]<=t[0]&&r[1]<=t[1]&&r[2]>=t[0]&&r[3]>=t[1]}var ck=ak;const rC=async(t,r)=>{t=oC(t);const a=await bp();for(let p=0;p<a.length;p++){const x=a[p];if(sC(t,r,x.bbox,x.geojson))return await hk(x)}return null},iC=async(t,r,a)=>{t=oC(t);for(let p=0;p<a.length;p++){const x=a[p];if(sC(t,r,x.bbox,x.geojson))return x}return null},oC=t=>{for(;t>180;)t-=360;for(;t<-180;)t+=360;return t},sC=(t,r,a,p)=>uk(t,r,a)?ck([t,r],p):!1,uk=(t,r,a)=>{const p=a[0],x=a[1],T=a[2],b=a[3];return t>=p&&t<=T&&r>=x&&r<=b},hk=async t=>{let r=null;return Vd(t.codeIso3)&&(r=await nC(t.codeIso3)),{...t,statesData:r}};var aC={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var r={}.hasOwnProperty;function a(){for(var T="",b=0;b<arguments.length;b++){var l=arguments[b];l&&(T=x(T,p(l)))}return T}function p(T){if(typeof T=="string"||typeof T=="number")return T;if(typeof T!="object")return"";if(Array.isArray(T))return a.apply(null,T);if(T.toString!==Object.prototype.toString&&!T.toString.toString().includes("[native code]"))return T.toString();var b="";for(var l in T)r.call(T,l)&&T[l]&&(b=x(b,l));return b}function x(T,b){return b?T?T+" "+b:T+b:T}t.exports?(a.default=a,t.exports=a):window.classNames=a})()})(aC);var dk=aC.exports;const lC=bg(dk),fk="_container_dzzp1_1",pk="_bridge2AiImage_dzzp1_17",mk="_waveImage_dzzp1_25",gk="_isMobile_dzzp1_35",yy={container:fk,bridge2AiImage:pk,waveImage:mk,isMobile:gk},u2=({isMobile:t})=>ct.jsxs("div",{className:lC(yy.container,{[yy.isMobile]:t}),children:[ct.jsx("img",{src:"wave.png",className:yy.waveImage}),ct.jsx("img",{src:"bridge2aivoice.png",className:yy.bridge2AiImage,alt:"Bridge2AI Voice"})]}),_k="_container_idwfo_1",yk={container:_k},cC=({children:t,style:r,className:a})=>ct.jsx("div",{style:r,className:`${yk.container} ${a??""}`,children:t});var l0={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */l0.exports;(function(t,r){(function(){var a,p="4.17.21",x=200,T="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",b="Expected a function",l="Invalid `variable` option passed into `_.template`",L="__lodash_hash_undefined__",$=500,Q="__lodash_placeholder__",ce=1,oe=2,Y=4,Te=1,et=2,We=1,he=2,pe=4,ve=8,Oe=16,it=32,qe=64,we=128,ne=256,ye=512,ke=30,st="...",lt=800,bt=16,tn=1,lr=2,Kt=3,Zt=1/0,dt=9007199254740991,_t=17976931348623157e292,Rt=NaN,wt=4294967295,Dt=wt-1,Tt=wt>>>1,gn=[["ary",we],["bind",We],["bindKey",he],["curry",ve],["curryRight",Oe],["flip",ye],["partial",it],["partialRight",qe],["rearg",ne]],nn="[object Arguments]",Pn="[object Array]",mr="[object AsyncFunction]",rn="[object Boolean]",Qt="[object Date]",tr="[object DOMException]",Gt="[object Error]",on="[object Function]",Kn="[object GeneratorFunction]",qt="[object Map]",_n="[object Number]",ln="[object Null]",En="[object Object]",yn="[object Promise]",Bn="[object Proxy]",Rn="[object RegExp]",nr="[object Set]",zr="[object String]",Si="[object Symbol]",vr="[object Undefined]",Rr="[object WeakMap]",cr="[object WeakSet]",rr="[object ArrayBuffer]",xr="[object DataView]",Bi="[object Float32Array]",to="[object Float64Array]",Ni="[object Int8Array]",Kr="[object Int16Array]",no="[object Int32Array]",ji="[object Uint8Array]",ze="[object Uint8ClampedArray]",F="[object Uint16Array]",H="[object Uint32Array]",ee=/\b__p \+= '';/g,le=/\b(__p \+=) '' \+/g,xe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ie=/&(?:amp|lt|gt|quot|#39);/g,Ue=/[&<>"']/g,Me=RegExp(Ie.source),Xe=RegExp(Ue.source),$e=/<%-([\s\S]+?)%>/g,Re=/<%([\s\S]+?)%>/g,rt=/<%=([\s\S]+?)%>/g,De=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yt=/^\w*$/,Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jt=/[\\^$.*+?()[\]{}|]/g,Ht=RegExp(Jt.source),Ke=/^\s+/,It=/\s/,Pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,hn=/\{\n\/\* \[wrapped with (.+)\] \*/,Xt=/,? & /,dn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ut=/[()=,{}\[\]\/\s]/,Sa=/\\(\\)?/g,Nr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jr=/\w*$/,ur=/^[-+]0x[0-9a-f]+$/i,tu=/^0b[01]+$/i,Ui=/^\[object .+?Constructor\]$/,ir=/^0o[0-7]+$/i,Xd=/^(?:0|[1-9]\d*)$/,Vl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ol=/($^)/,Ws=/['\n\r\u2028\u2029\\]/g,xs="\\ud800-\\udfff",Ch="\\u0300-\\u036f",Kd="\\ufe20-\\ufe2f",Yd="\\u20d0-\\u20ff",Ta=Ch+Kd+Yd,Ph="\\u2700-\\u27bf",Jd="a-z\\xdf-\\xf6\\xf8-\\xff",Pp="\\xac\\xb1\\xd7\\xf7",Ep="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Eh="\\u2000-\\u206f",sl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nu="A-Z\\xc0-\\xd6\\xd8-\\xde",ru="\\ufe0e\\ufe0f",Ca=Pp+Ep+Eh+sl,$l="[']",Mh="["+xs+"]",Zl="["+Ca+"]",al="["+Ta+"]",Hs="\\d+",zo="["+Ph+"]",Mn="["+Jd+"]",Vi="[^"+xs+Ca+Hs+Ph+Jd+nu+"]",$i="\\ud83c[\\udffb-\\udfff]",An="(?:"+al+"|"+$i+")",Gl="[^"+xs+"]",ql="(?:\\ud83c[\\udde6-\\uddff]){2}",Zi="[\\ud800-\\udbff][\\udc00-\\udfff]",Ir="["+nu+"]",Yr="\\u200d",br="(?:"+Mn+"|"+Vi+")",Ih="(?:"+Ir+"|"+Vi+")",Jr="(?:"+$l+"(?:d|ll|m|re|s|t|ve))?",Ti="(?:"+$l+"(?:D|LL|M|RE|S|T|VE))?",Ii=An+"?",Wl="["+ru+"]?",Ro="(?:"+Yr+"(?:"+[Gl,ql,Zi].join("|")+")"+Wl+Ii+")*",Ur="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Xs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ro=Wl+Ii+Ro,Hl="(?:"+[zo,ql,Zi].join("|")+")"+ro,xo="(?:"+[Gl+al+"?",al,ql,Zi,Mh].join("|")+")",kh=RegExp($l,"g"),Do=RegExp(al,"g"),sr=RegExp($i+"(?="+$i+")|"+xo+ro,"g"),iu=RegExp([Ir+"?"+Mn+"+"+Jr+"(?="+[Zl,Ir,"$"].join("|")+")",Ih+"+"+Ti+"(?="+[Zl,Ir+br,"$"].join("|")+")",Ir+"?"+br+"+"+Jr,Ir+"+"+Ti,Xs,Ur,Hs,Hl].join("|"),"g"),Sn=RegExp("["+Yr+xs+Ta+ru+"]"),cn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ll=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],In=-1,Yn={};Yn[Bi]=Yn[to]=Yn[Ni]=Yn[Kr]=Yn[no]=Yn[ji]=Yn[ze]=Yn[F]=Yn[H]=!0,Yn[nn]=Yn[Pn]=Yn[rr]=Yn[rn]=Yn[xr]=Yn[Qt]=Yn[Gt]=Yn[on]=Yn[qt]=Yn[_n]=Yn[En]=Yn[Rn]=Yn[nr]=Yn[zr]=Yn[Rr]=!1;var Tn={};Tn[nn]=Tn[Pn]=Tn[rr]=Tn[xr]=Tn[rn]=Tn[Qt]=Tn[Bi]=Tn[to]=Tn[Ni]=Tn[Kr]=Tn[no]=Tn[qt]=Tn[_n]=Tn[En]=Tn[Rn]=Tn[nr]=Tn[zr]=Tn[Si]=Tn[ji]=Tn[ze]=Tn[F]=Tn[H]=!0,Tn[Gt]=Tn[on]=Tn[Rr]=!1;var Xl={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},ou={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Kl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},cl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ul=parseFloat,Mp=parseInt,Yl=typeof Md=="object"&&Md&&Md.Object===Object&&Md,Ah=typeof self=="object"&&self&&self.Object===Object&&self,Dr=Yl||Ah||Function("return this")(),ci=r&&!r.nodeType&&r,kr=ci&&!0&&t&&!t.nodeType&&t,Jl=kr&&kr.exports===ci,ki=Jl&&Yl.process,$n=function(){try{var Ae=kr&&kr.require&&kr.require("util").types;return Ae||ki&&ki.binding&&ki.binding("util")}catch{}}(),su=$n&&$n.isArrayBuffer,Ql=$n&&$n.isDate,Ks=$n&&$n.isMap,Qd=$n&&$n.isRegExp,ec=$n&&$n.isSet,au=$n&&$n.isTypedArray;function io(Ae,nt,Ve){switch(Ve.length){case 0:return Ae.call(nt);case 1:return Ae.call(nt,Ve[0]);case 2:return Ae.call(nt,Ve[0],Ve[1]);case 3:return Ae.call(nt,Ve[0],Ve[1],Ve[2])}return Ae.apply(nt,Ve)}function lu(Ae,nt,Ve,zt){for(var un=-1,jn=Ae==null?0:Ae.length;++un<jn;){var gr=Ae[un];nt(zt,gr,Ve(gr),Ae)}return zt}function Ai(Ae,nt){for(var Ve=-1,zt=Ae==null?0:Ae.length;++Ve<zt&&nt(Ae[Ve],Ve,Ae)!==!1;);return Ae}function Gi(Ae,nt){for(var Ve=Ae==null?0:Ae.length;Ve--&&nt(Ae[Ve],Ve,Ae)!==!1;);return Ae}function tc(Ae,nt){for(var Ve=-1,zt=Ae==null?0:Ae.length;++Ve<zt;)if(!nt(Ae[Ve],Ve,Ae))return!1;return!0}function qi(Ae,nt){for(var Ve=-1,zt=Ae==null?0:Ae.length,un=0,jn=[];++Ve<zt;){var gr=Ae[Ve];nt(gr,Ve,Ae)&&(jn[un++]=gr)}return jn}function hl(Ae,nt){var Ve=Ae==null?0:Ae.length;return!!Ve&&Ma(Ae,nt,0)>-1}function Pa(Ae,nt,Ve){for(var zt=-1,un=Ae==null?0:Ae.length;++zt<un;)if(Ve(nt,Ae[zt]))return!0;return!1}function Nn(Ae,nt){for(var Ve=-1,zt=Ae==null?0:Ae.length,un=Array(zt);++Ve<zt;)un[Ve]=nt(Ae[Ve],Ve,Ae);return un}function Ys(Ae,nt){for(var Ve=-1,zt=nt.length,un=Ae.length;++Ve<zt;)Ae[un+Ve]=nt[Ve];return Ae}function nc(Ae,nt,Ve,zt){var un=-1,jn=Ae==null?0:Ae.length;for(zt&&jn&&(Ve=Ae[++un]);++un<jn;)Ve=nt(Ve,Ae[un],un,Ae);return Ve}function rc(Ae,nt,Ve,zt){var un=Ae==null?0:Ae.length;for(zt&&un&&(Ve=Ae[--un]);un--;)Ve=nt(Ve,Ae[un],un,Ae);return Ve}function rs(Ae,nt){for(var Ve=-1,zt=Ae==null?0:Ae.length;++Ve<zt;)if(nt(Ae[Ve],Ve,Ae))return!0;return!1}var Ip=uu("length");function ic(Ae){return Ae.split("")}function ef(Ae){return Ae.match(dn)||[]}function Ea(Ae,nt,Ve){var zt;return Ve(Ae,function(un,jn,gr){if(nt(un,jn,gr))return zt=jn,!1}),zt}function oc(Ae,nt,Ve,zt){for(var un=Ae.length,jn=Ve+(zt?1:-1);zt?jn--:++jn<un;)if(nt(Ae[jn],jn,Ae))return jn;return-1}function Ma(Ae,nt,Ve){return nt===nt?Ap(Ae,nt,Ve):oc(Ae,zh,Ve)}function kp(Ae,nt,Ve,zt){for(var un=Ve-1,jn=Ae.length;++un<jn;)if(zt(Ae[un],nt))return un;return-1}function zh(Ae){return Ae!==Ae}function cu(Ae,nt){var Ve=Ae==null?0:Ae.length;return Ve?bs(Ae,nt)/Ve:Rt}function uu(Ae){return function(nt){return nt==null?a:nt[Ae]}}function sc(Ae){return function(nt){return Ae==null?a:Ae[nt]}}function hu(Ae,nt,Ve,zt,un){return un(Ae,function(jn,gr,qn){Ve=zt?(zt=!1,jn):nt(Ve,jn,gr,qn)}),Ve}function Rh(Ae,nt){var Ve=Ae.length;for(Ae.sort(nt);Ve--;)Ae[Ve]=Ae[Ve].value;return Ae}function bs(Ae,nt){for(var Ve,zt=-1,un=Ae.length;++zt<un;){var jn=nt(Ae[zt]);jn!==a&&(Ve=Ve===a?jn:Ve+jn)}return Ve}function du(Ae,nt){for(var Ve=-1,zt=Array(Ae);++Ve<Ae;)zt[Ve]=nt(Ve);return zt}function tf(Ae,nt){return Nn(nt,function(Ve){return[Ve,Ae[Ve]]})}function Js(Ae){return Ae&&Ae.slice(0,Bh(Ae)+1).replace(Ke,"")}function oo(Ae){return function(nt){return Ae(nt)}}function dl(Ae,nt){return Nn(nt,function(Ve){return Ae[Ve]})}function ac(Ae,nt){return Ae.has(nt)}function Dh(Ae,nt){for(var Ve=-1,zt=Ae.length;++Ve<zt&&Ma(nt,Ae[Ve],0)>-1;);return Ve}function fu(Ae,nt){for(var Ve=Ae.length;Ve--&&Ma(nt,Ae[Ve],0)>-1;);return Ve}function nf(Ae,nt){for(var Ve=Ae.length,zt=0;Ve--;)Ae[Ve]===nt&&++zt;return zt}var rf=sc(Xl),pu=sc(ou);function Lh(Ae){return"\\"+cl[Ae]}function mu(Ae,nt){return Ae==null?a:Ae[nt]}function Wi(Ae){return Sn.test(Ae)}function Fh(Ae){return cn.test(Ae)}function gu(Ae){for(var nt,Ve=[];!(nt=Ae.next()).done;)Ve.push(nt.value);return Ve}function lc(Ae){var nt=-1,Ve=Array(Ae.size);return Ae.forEach(function(zt,un){Ve[++nt]=[un,zt]}),Ve}function Oh(Ae,nt){return function(Ve){return Ae(nt(Ve))}}function is(Ae,nt){for(var Ve=-1,zt=Ae.length,un=0,jn=[];++Ve<zt;){var gr=Ae[Ve];(gr===nt||gr===Q)&&(Ae[Ve]=Q,jn[un++]=Ve)}return jn}function os(Ae){var nt=-1,Ve=Array(Ae.size);return Ae.forEach(function(zt){Ve[++nt]=zt}),Ve}function Dn(Ae){var nt=-1,Ve=Array(Ae.size);return Ae.forEach(function(zt){Ve[++nt]=[zt,zt]}),Ve}function Ap(Ae,nt,Ve){for(var zt=Ve-1,un=Ae.length;++zt<un;)if(Ae[zt]===nt)return zt;return-1}function zp(Ae,nt,Ve){for(var zt=Ve+1;zt--;)if(Ae[zt]===nt)return zt;return zt}function fl(Ae){return Wi(Ae)?of(Ae):Ip(Ae)}function Lo(Ae){return Wi(Ae)?_u(Ae):ic(Ae)}function Bh(Ae){for(var nt=Ae.length;nt--&&It.test(Ae.charAt(nt)););return nt}var Rp=sc(Kl);function of(Ae){for(var nt=sr.lastIndex=0;sr.test(Ae);)++nt;return nt}function _u(Ae){return Ae.match(sr)||[]}function yu(Ae){return Ae.match(iu)||[]}var vu=function Ae(nt){nt=nt==null?Dr:Qs.defaults(Dr.Object(),nt,Qs.pick(Dr,ll));var Ve=nt.Array,zt=nt.Date,un=nt.Error,jn=nt.Function,gr=nt.Math,qn=nt.Object,pl=nt.RegExp,cc=nt.String,zi=nt.TypeError,uc=Ve.prototype,ml=jn.prototype,Fo=qn.prototype,hc=nt["__core-js_shared__"],gl=ml.toString,Bt=Fo.hasOwnProperty,xu=0,sf=function(){var h=/[^.]+$/.exec(hc&&hc.keys&&hc.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),dc=Fo.toString,Ia=gl.call(qn),Dp=Dr._,Lp=pl("^"+gl.call(Bt).replace(Jt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fc=Jl?nt.Buffer:a,ws=nt.Symbol,_l=nt.Uint8Array,pc=fc?fc.allocUnsafe:a,ss=Oh(qn.getPrototypeOf,qn),mc=qn.create,bu=Fo.propertyIsEnumerable,gc=uc.splice,_c=ws?ws.isConcatSpreadable:a,ea=ws?ws.iterator:a,Ss=ws?ws.toStringTag:a,yc=function(){try{var h=ks(qn,"defineProperty");return h({},"",{}),h}catch{}}(),wu=nt.clearTimeout!==Dr.clearTimeout&&nt.clearTimeout,Fp=zt&&zt.now!==Dr.Date.now&&zt.now,af=nt.setTimeout!==Dr.setTimeout&&nt.setTimeout,ta=gr.ceil,ka=gr.floor,vc=qn.getOwnPropertySymbols,Nh=fc?fc.isBuffer:a,Aa=nt.isFinite,xc=uc.join,jh=Oh(qn.keys,qn),Tr=gr.max,Cn=gr.min,za=zt.now,bo=nt.parseInt,Su=gr.random,Uh=uc.reverse,Tu=ks(nt,"DataView"),Oo=ks(nt,"Map"),na=ks(nt,"Promise"),Bo=ks(nt,"Set"),yl=ks(nt,"WeakMap"),Ra=ks(qn,"create"),vl=yl&&new yl,Da={},Vh=Ac(Tu),ra=Ac(Oo),xl=Ac(na),lf=Ac(Bo),cf=Ac(yl),bc=ws?ws.prototype:a,bl=bc?bc.valueOf:a,$h=bc?bc.toString:a;function X(h){if(Gr(h)&&!pn(h)&&!(h instanceof en)){if(h instanceof Ln)return h;if(Bt.call(h,"__wrapped__"))return Mf(h)}return new Ln(h)}var so=function(){function h(){}return function(m){if(!Fr(m))return{};if(mc)return mc(m);h.prototype=m;var C=new h;return h.prototype=a,C}}();function Ts(){}function Ln(h,m){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!m,this.__index__=0,this.__values__=a}X.templateSettings={escape:$e,evaluate:Re,interpolate:rt,variable:"",imports:{_:X}},X.prototype=Ts.prototype,X.prototype.constructor=X,Ln.prototype=so(Ts.prototype),Ln.prototype.constructor=Ln;function en(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=wt,this.__views__=[]}function Zh(){var h=new en(this.__wrapped__);return h.__actions__=fr(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=fr(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=fr(this.__views__),h}function as(){if(this.__filtered__){var h=new en(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function wl(){var h=this.__wrapped__.value(),m=this.__dir__,C=pn(h),z=m<0,Z=C?h.length:0,te=H0(0,Z,this.__views__),_e=te.start,Ee=te.end,Le=Ee-_e,ut=z?Ee:_e-1,ht=this.__iteratees__,gt=ht.length,kt=0,Wt=Cn(Le,this.__takeCount__);if(!C||!z&&Z==Le&&Wt==Le)return $o(h,this.__actions__);var sn=[];e:for(;Le--&&kt<Wt;){ut+=m;for(var kn=-1,an=h[ut];++kn<gt;){var Un=ht[kn],Gn=Un.iteratee,Fs=Un.type,Yo=Gn(an);if(Fs==lr)an=Yo;else if(!Yo){if(Fs==tn)continue e;break e}}sn[kt++]=an}return sn}en.prototype=so(Ts.prototype),en.prototype.constructor=en;function No(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function uf(){this.__data__=Ra?Ra(null):{},this.size=0}function Gh(h){var m=this.has(h)&&delete this.__data__[h];return this.size-=m?1:0,m}function Op(h){var m=this.__data__;if(Ra){var C=m[h];return C===L?a:C}return Bt.call(m,h)?m[h]:a}function Cu(h){var m=this.__data__;return Ra?m[h]!==a:Bt.call(m,h)}function wc(h,m){var C=this.__data__;return this.size+=this.has(h)?0:1,C[h]=Ra&&m===a?L:m,this}No.prototype.clear=uf,No.prototype.delete=Gh,No.prototype.get=Op,No.prototype.has=Cu,No.prototype.set=wc;function Lr(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function St(){this.__data__=[],this.size=0}function Sl(h){var m=this.__data__,C=sa(m,h);if(C<0)return!1;var z=m.length-1;return C==z?m.pop():gc.call(m,C,1),--this.size,!0}function qh(h){var m=this.__data__,C=sa(m,h);return C<0?a:m[C][1]}function hf(h){return sa(this.__data__,h)>-1}function ia(h,m){var C=this.__data__,z=sa(C,h);return z<0?(++this.size,C.push([h,m])):C[z][1]=m,this}Lr.prototype.clear=St,Lr.prototype.delete=Sl,Lr.prototype.get=qh,Lr.prototype.has=hf,Lr.prototype.set=ia;function ao(h){var m=-1,C=h==null?0:h.length;for(this.clear();++m<C;){var z=h[m];this.set(z[0],z[1])}}function Pu(){this.size=0,this.__data__={hash:new No,map:new(Oo||Lr),string:new No}}function fn(h){var m=ad(this,h).delete(h);return this.size-=m?1:0,m}function Eu(h){return ad(this,h).get(h)}function df(h){return ad(this,h).has(h)}function Mu(h,m){var C=ad(this,h),z=C.size;return C.set(h,m),this.size+=C.size==z?0:1,this}ao.prototype.clear=Pu,ao.prototype.delete=fn,ao.prototype.get=Eu,ao.prototype.has=df,ao.prototype.set=Mu;function oa(h){var m=-1,C=h==null?0:h.length;for(this.__data__=new ao;++m<C;)this.add(h[m])}function Wh(h){return this.__data__.set(h,L),this}function Hh(h){return this.__data__.has(h)}oa.prototype.add=oa.prototype.push=Wh,oa.prototype.has=Hh;function lo(h){var m=this.__data__=new Lr(h);this.size=m.size}function Xh(){this.__data__=new Lr,this.size=0}function Bp(h){var m=this.__data__,C=m.delete(h);return this.size=m.size,C}function Kh(h){return this.__data__.get(h)}function ff(h){return this.__data__.has(h)}function pf(h,m){var C=this.__data__;if(C instanceof Lr){var z=C.__data__;if(!Oo||z.length<x-1)return z.push([h,m]),this.size=++C.size,this;C=this.__data__=new ao(z)}return C.set(h,m),this.size=C.size,this}lo.prototype.clear=Xh,lo.prototype.delete=Bp,lo.prototype.get=Kh,lo.prototype.has=ff,lo.prototype.set=pf;function Cs(h,m){var C=pn(h),z=!C&&Rc(h),Z=!C&&!z&&Ga(h),te=!C&&!z&&!Z&&zl(h),_e=C||z||Z||te,Ee=_e?du(h.length,cc):[],Le=Ee.length;for(var ut in h)(m||Bt.call(h,ut))&&!(_e&&(ut=="length"||Z&&(ut=="offset"||ut=="parent")||te&&(ut=="buffer"||ut=="byteLength"||ut=="byteOffset")||Qn(ut,Le)))&&Ee.push(ut);return Ee}function hr(h){var m=h.length;return m?h[He(0,m-1)]:a}function Sc(h,m){return Ef(fr(h),jo(m,0,h.length))}function Iu(h){return Ef(fr(h))}function Tc(h,m,C){(C!==a&&!hs(h[m],C)||C===a&&!(m in h))&&Et(h,m,C)}function La(h,m,C){var z=h[m];(!(Bt.call(h,m)&&hs(z,C))||C===a&&!(m in h))&&Et(h,m,C)}function sa(h,m){for(var C=h.length;C--;)if(hs(h[C][0],m))return C;return-1}function Np(h,m,C,z){return aa(h,function(Z,te,_e){m(z,Z,C(Z),_e)}),z}function co(h,m){return h&&So(m,Je(m),h)}function ku(h,m){return h&&So(m,Fe(m),h)}function Et(h,m,C){m=="__proto__"&&yc?yc(h,m,{configurable:!0,enumerable:!0,value:C,writable:!0}):h[m]=C}function Vt(h,m){for(var C=-1,z=m.length,Z=Ve(z),te=h==null;++C<z;)Z[C]=te?a:Ce(h,m[C]);return Z}function jo(h,m,C){return h===h&&(C!==a&&(h=h<=C?h:C),m!==a&&(h=h>=m?h:m)),h}function Ri(h,m,C,z,Z,te){var _e,Ee=m&ce,Le=m&oe,ut=m&Y;if(C&&(_e=Z?C(h,z,Z,te):C(h)),_e!==a)return _e;if(!Fr(h))return h;var ht=pn(h);if(ht){if(_e=Hp(h),!Ee)return fr(h,_e)}else{var gt=Ki(h),kt=gt==on||gt==Kn;if(Ga(h))return or(h,Ee);if(gt==En||gt==nn||kt&&!Z){if(_e=Le||kt?{}:Og(h),!Ee)return Le?Ru(h,ku(_e,h)):_f(h,co(_e,h))}else{if(!Tn[gt])return Z?h:{};_e=Bg(h,gt,Ee)}}te||(te=new lo);var Wt=te.get(h);if(Wt)return Wt;te.set(h,_e),V_(h)?h.forEach(function(an){_e.add(Ri(an,m,C,an,h,te))}):B_(h)&&h.forEach(function(an,Un){_e.set(Un,Ri(an,m,C,Un,h,te))});var sn=ut?Le?Gp:Zp:Le?Fe:Je,kn=ht?a:sn(h);return Ai(kn||h,function(an,Un){kn&&(Un=an,an=h[Un]),La(_e,Un,Ri(an,m,C,Un,h,te))}),_e}function Yh(h){var m=Je(h);return function(C){return Di(C,h,m)}}function Di(h,m,C){var z=C.length;if(h==null)return!z;for(h=qn(h);z--;){var Z=C[z],te=m[Z],_e=h[Z];if(_e===a&&!(Z in h)||!te(_e))return!1}return!0}function Jh(h,m,C){if(typeof h!="function")throw new zi(b);return Za(function(){h.apply(a,C)},m)}function Hi(h,m,C,z){var Z=-1,te=hl,_e=!0,Ee=h.length,Le=[],ut=m.length;if(!Ee)return Le;C&&(m=Nn(m,oo(C))),z?(te=Pa,_e=!1):m.length>=x&&(te=ac,_e=!1,m=new oa(m));e:for(;++Z<Ee;){var ht=h[Z],gt=C==null?ht:C(ht);if(ht=z||ht!==0?ht:0,_e&&gt===gt){for(var kt=ut;kt--;)if(m[kt]===gt)continue e;Le.push(ht)}else te(m,gt,z)||Le.push(ht)}return Le}var aa=Ec(uo),Uo=Ec(Ps,!0);function Cr(h,m){var C=!0;return aa(h,function(z,Z,te){return C=!!m(z,Z,te),C}),C}function wr(h,m,C){for(var z=-1,Z=h.length;++z<Z;){var te=h[z],_e=m(te);if(_e!=null&&(Ee===a?_e===_e&&!po(_e):C(_e,Ee)))var Ee=_e,Le=te}return Le}function mf(h,m,C,z){var Z=h.length;for(C=mn(C),C<0&&(C=-C>Z?0:Z+C),z=z===a||z>Z?Z:mn(z),z<0&&(z+=Z),z=C>z?0:Nf(z);C<z;)h[C++]=m;return h}function Fa(h,m){var C=[];return aa(h,function(z,Z,te){m(z,Z,te)&&C.push(z)}),C}function Vr(h,m,C,z,Z){var te=-1,_e=h.length;for(C||(C=K0),Z||(Z=[]);++te<_e;){var Ee=h[te];m>0&&C(Ee)?m>1?Vr(Ee,m-1,C,z,Z):Ys(Z,Ee):z||(Z[Z.length]=Ee)}return Z}var Cc=kg(),ls=kg(!0);function uo(h,m){return h&&Cc(h,m,Je)}function Ps(h,m){return h&&ls(h,m,Je)}function Oa(h,m){return qi(m,function(C){return ds(h[C])})}function Vo(h,m){m=ti(m,h);for(var C=0,z=m.length;h!=null&&C<z;)h=h[fa(m[C++])];return C&&C==z?h:a}function Au(h,m,C){var z=m(h);return pn(h)?z:Ys(z,C(h))}function $r(h){return h==null?h===a?vr:ln:Ss&&Ss in qn(h)?W0(h):ud(h)}function Es(h,m){return h>m}function Qh(h,m){return h!=null&&Bt.call(h,m)}function zu(h,m){return h!=null&&m in qn(h)}function Ba(h,m,C){return h>=Cn(m,C)&&h<Tr(m,C)}function Tl(h,m,C){for(var z=C?Pa:hl,Z=h[0].length,te=h.length,_e=te,Ee=Ve(te),Le=1/0,ut=[];_e--;){var ht=h[_e];_e&&m&&(ht=Nn(ht,oo(m))),Le=Cn(ht.length,Le),Ee[_e]=!C&&(m||Z>=120&&ht.length>=120)?new oa(_e&&ht):a}ht=h[0];var gt=-1,kt=Ee[0];e:for(;++gt<Z&&ut.length<Le;){var Wt=ht[gt],sn=m?m(Wt):Wt;if(Wt=C||Wt!==0?Wt:0,!(kt?ac(kt,sn):z(ut,sn,C))){for(_e=te;--_e;){var kn=Ee[_e];if(!(kn?ac(kn,sn):z(h[_e],sn,C)))continue e}kt&&kt.push(sn),ut.push(Wt)}}return ut}function ed(h,m,C,z){return uo(h,function(Z,te,_e){m(z,C(Z),te,_e)}),z}function la(h,m,C){m=ti(m,h),h=Xp(h,m);var z=h==null?h:h[fa(us(m))];return z==null?a:io(z,h,C)}function Pc(h){return Gr(h)&&$r(h)==nn}function g(h){return Gr(h)&&$r(h)==rr}function e(h){return Gr(h)&&$r(h)==Qt}function i(h,m,C,z,Z){return h===m?!0:h==null||m==null||!Gr(h)&&!Gr(m)?h!==h&&m!==m:u(h,m,C,z,i,Z)}function u(h,m,C,z,Z,te){var _e=pn(h),Ee=pn(m),Le=_e?Pn:Ki(h),ut=Ee?Pn:Ki(m);Le=Le==nn?En:Le,ut=ut==nn?En:ut;var ht=Le==En,gt=ut==En,kt=Le==ut;if(kt&&Ga(h)){if(!Ga(m))return!1;_e=!0,ht=!1}if(kt&&!ht)return te||(te=new lo),_e||zl(h)?Vp(h,m,C,z,Z,te):$p(h,m,Le,C,z,Z,te);if(!(C&Te)){var Wt=ht&&Bt.call(h,"__wrapped__"),sn=gt&&Bt.call(m,"__wrapped__");if(Wt||sn){var kn=Wt?h.value():h,an=sn?m.value():m;return te||(te=new lo),Z(kn,an,C,z,te)}}return kt?(te||(te=new lo),q0(h,m,C,z,Z,te)):!1}function d(h){return Gr(h)&&Ki(h)==qt}function _(h,m,C,z){var Z=C.length,te=Z,_e=!z;if(h==null)return!te;for(h=qn(h);Z--;){var Ee=C[Z];if(_e&&Ee[2]?Ee[1]!==h[Ee[0]]:!(Ee[0]in h))return!1}for(;++Z<te;){Ee=C[Z];var Le=Ee[0],ut=h[Le],ht=Ee[1];if(_e&&Ee[2]){if(ut===a&&!(Le in h))return!1}else{var gt=new lo;if(z)var kt=z(ut,ht,Le,h,m,gt);if(!(kt===a?i(ht,ut,Te|et,z,gt):kt))return!1}}return!0}function w(h){if(!Fr(h)||cd(h))return!1;var m=ds(h)?Lp:Ui;return m.test(Ac(h))}function P(h){return Gr(h)&&$r(h)==Rn}function M(h){return Gr(h)&&Ki(h)==nr}function k(h){return Gr(h)&&Dc(h.length)&&!!Yn[$r(h)]}function D(h){return typeof h=="function"?h:h==null?Co:typeof h=="object"?pn(h)?re(h[0],h[1]):ie(h):Hb(h)}function O(h){if(!Ou(h))return jh(h);var m=[];for(var C in qn(h))Bt.call(h,C)&&C!="constructor"&&m.push(C);return m}function B(h){if(!Fr(h))return ju(h);var m=Ou(h),C=[];for(var z in h)z=="constructor"&&(m||!Bt.call(h,z))||C.push(z);return C}function G(h,m){return h<m}function W(h,m){var C=-1,z=fo(h)?Ve(h.length):[];return aa(h,function(Z,te,_e){z[++C]=m(Z,te,_e)}),z}function ie(h){var m=$a(h);return m.length==1&&m[0][2]?Cf(m[0][0],m[0][1]):function(C){return C===h||_(C,h,m)}}function re(h,m){return Sf(h)&&Bu(m)?Cf(fa(h),m):function(C){var z=Ce(C,h);return z===a&&z===m?j(C,h):i(m,z,Te|et)}}function se(h,m,C,z,Z){h!==m&&Cc(m,function(te,_e){if(Z||(Z=new lo),Fr(te))ue(h,m,_e,C,se,z,Z);else{var Ee=z?z(Kp(h,_e),te,_e+"",h,m,Z):a;Ee===a&&(Ee=te),Tc(h,_e,Ee)}},Fe)}function ue(h,m,C,z,Z,te,_e){var Ee=Kp(h,C),Le=Kp(m,C),ut=_e.get(Le);if(ut){Tc(h,C,ut);return}var ht=te?te(Ee,Le,C+"",h,m,_e):a,gt=ht===a;if(gt){var kt=pn(Le),Wt=!kt&&Ga(Le),sn=!kt&&!Wt&&zl(Le);ht=Le,kt||Wt||sn?pn(Ee)?ht=Ee:Zr(Ee)?ht=fr(Ee):Wt?(gt=!1,ht=or(Le,!0)):sn?(gt=!1,ht=gf(Le,!0)):ht=[]:bd(Le)||Rc(Le)?(ht=Ee,Rc(Ee)?ht=G_(Ee):(!Fr(Ee)||ds(Ee))&&(ht=Og(Le))):gt=!1}gt&&(_e.set(Le,ht),Z(ht,Le,z,te,_e),_e.delete(Le)),Tc(h,C,ht)}function me(h,m){var C=h.length;if(C)return m+=m<0?C:0,Qn(m,C)?h[m]:a}function ge(h,m,C){m.length?m=Nn(m,function(te){return pn(te)?function(_e){return Vo(_e,te.length===1?te[0]:te)}:te}):m=[Co];var z=-1;m=Nn(m,oo(Yt()));var Z=W(h,function(te,_e,Ee){var Le=Nn(m,function(ut){return ut(te)});return{criteria:Le,index:++z,value:te}});return Rh(Z,function(te,_e){return nd(te,_e,C)})}function be(h,m){return Pe(h,m,function(C,z){return j(h,z)})}function Pe(h,m,C){for(var z=-1,Z=m.length,te={};++z<Z;){var _e=m[z],Ee=Vo(h,_e);C(Ee,_e)&&Mt(te,ti(_e,h),Ee)}return te}function Se(h){return function(m){return Vo(m,h)}}function Be(h,m,C,z){var Z=z?kp:Ma,te=-1,_e=m.length,Ee=h;for(h===m&&(m=fr(m)),C&&(Ee=Nn(h,oo(C)));++te<_e;)for(var Le=0,ut=m[te],ht=C?C(ut):ut;(Le=Z(Ee,ht,Le,z))>-1;)Ee!==h&&gc.call(Ee,Le,1),gc.call(h,Le,1);return h}function je(h,m){for(var C=h?m.length:0,z=C-1;C--;){var Z=m[C];if(C==z||Z!==te){var te=Z;Qn(Z)?gc.call(h,Z,1):ei(h,Z)}}return h}function He(h,m){return h+ka(Su()*(m-h+1))}function Ye(h,m,C,z){for(var Z=-1,te=Tr(ta((m-h)/(C||1)),0),_e=Ve(te);te--;)_e[z?te:++Z]=h,h+=C;return _e}function Ze(h,m){var C="";if(!h||m<1||m>dt)return C;do m%2&&(C+=h),m=ka(m/2),m&&(h+=h);while(m);return C}function tt(h,m){return hd(jg(h,m,Co),h+"")}function mt(h){return hr(Er(h))}function ot(h,m){var C=Er(h);return Ef(C,jo(m,0,C.length))}function Mt(h,m,C,z){if(!Fr(h))return h;m=ti(m,h);for(var Z=-1,te=m.length,_e=te-1,Ee=h;Ee!=null&&++Z<te;){var Le=fa(m[Z]),ut=C;if(Le==="__proto__"||Le==="constructor"||Le==="prototype")return h;if(Z!=_e){var ht=Ee[Le];ut=z?z(ht,Le,Ee):a,ut===a&&(ut=Fr(ht)?ht:Qn(m[Z+1])?[]:{})}La(Ee,Le,ut),Ee=Ee[Le]}return h}var Ot=vl?function(h,m){return vl.set(h,m),h}:Co,Fn=yc?function(h,m){return yc(h,"toString",{configurable:!0,enumerable:!1,value:th(m),writable:!0})}:Co;function ar(h){return Ef(Er(h))}function vn(h,m,C){var z=-1,Z=h.length;m<0&&(m=-m>Z?0:Z+m),C=C>Z?Z:C,C<0&&(C+=Z),Z=m>C?0:C-m>>>0,m>>>=0;for(var te=Ve(Z);++z<Z;)te[z]=h[z+m];return te}function _r(h,m){var C;return aa(h,function(z,Z,te){return C=m(z,Z,te),!C}),!!C}function Jn(h,m,C){var z=0,Z=h==null?z:h.length;if(typeof m=="number"&&m===m&&Z<=Tt){for(;z<Z;){var te=z+Z>>>1,_e=h[te];_e!==null&&!po(_e)&&(C?_e<=m:_e<m)?z=te+1:Z=te}return Z}return zn(h,m,Co,C)}function zn(h,m,C,z){var Z=0,te=h==null?0:h.length;if(te===0)return 0;m=C(m);for(var _e=m!==m,Ee=m===null,Le=po(m),ut=m===a;Z<te;){var ht=ka((Z+te)/2),gt=C(h[ht]),kt=gt!==a,Wt=gt===null,sn=gt===gt,kn=po(gt);if(_e)var an=z||sn;else ut?an=sn&&(z||kt):Ee?an=sn&&kt&&(z||!Wt):Le?an=sn&&kt&&!Wt&&(z||!kn):Wt||kn?an=!1:an=z?gt<=m:gt<m;an?Z=ht+1:te=ht}return Cn(te,Dt)}function Wn(h,m){for(var C=-1,z=h.length,Z=0,te=[];++C<z;){var _e=h[C],Ee=m?m(_e):_e;if(!C||!hs(Ee,Le)){var Le=Ee;te[Z++]=_e===0?0:_e}}return te}function Qr(h){return typeof h=="number"?h:po(h)?Rt:+h}function Hn(h){if(typeof h=="string")return h;if(pn(h))return Nn(h,Hn)+"";if(po(h))return $h?$h.call(h):"";var m=h+"";return m=="0"&&1/h==-Zt?"-0":m}function dr(h,m,C){var z=-1,Z=hl,te=h.length,_e=!0,Ee=[],Le=Ee;if(C)_e=!1,Z=Pa;else if(te>=x){var ut=m?null:G0(h);if(ut)return os(ut);_e=!1,Z=ac,Le=new oa}else Le=m?[]:Ee;e:for(;++z<te;){var ht=h[z],gt=m?m(ht):ht;if(ht=C||ht!==0?ht:0,_e&&gt===gt){for(var kt=Le.length;kt--;)if(Le[kt]===gt)continue e;m&&Le.push(gt),Ee.push(ht)}else Z(Le,gt,C)||(Le!==Ee&&Le.push(gt),Ee.push(ht))}return Ee}function ei(h,m){return m=ti(m,h),h=Xp(h,m),h==null||delete h[fa(us(m))]}function Ms(h,m,C,z){return Mt(h,m,C(Vo(h,m)),z)}function wo(h,m,C,z){for(var Z=h.length,te=z?Z:-1;(z?te--:++te<Z)&&m(h[te],te,h););return C?vn(h,z?0:te,z?te+1:Z):vn(h,z?te+1:0,z?Z:te)}function $o(h,m){var C=h;return C instanceof en&&(C=C.value()),nc(m,function(z,Z){return Z.func.apply(Z.thisArg,Ys([z],Z.args))},C)}function Xi(h,m,C){var z=h.length;if(z<2)return z?dr(h[0]):[];for(var Z=-1,te=Ve(z);++Z<z;)for(var _e=h[Z],Ee=-1;++Ee<z;)Ee!=Z&&(te[Z]=Hi(te[Z]||_e,h[Ee],m,C));return dr(Vr(te,1),m,C)}function ca(h,m,C){for(var z=-1,Z=h.length,te=m.length,_e={};++z<Z;){var Ee=z<te?m[z]:a;C(_e,h[z],Ee)}return _e}function Na(h){return Zr(h)?h:[]}function Is(h){return typeof h=="function"?h:Co}function ti(h,m){return pn(h)?h:Sf(h,m)?[h]:Ug(n(h))}var cs=tt;function ui(h,m,C){var z=h.length;return C=C===a?z:C,!m&&C>=z?h:vn(h,m,C)}var Zo=wu||function(h){return Dr.clearTimeout(h)};function or(h,m){if(m)return h.slice();var C=h.length,z=pc?pc(C):new h.constructor(C);return h.copy(z),z}function Xn(h){var m=new h.constructor(h.byteLength);return new _l(m).set(new _l(h)),m}function ni(h,m){var C=m?Xn(h.buffer):h.buffer;return new h.constructor(C,h.byteOffset,h.byteLength)}function ri(h){var m=new h.constructor(h.source,jr.exec(h));return m.lastIndex=h.lastIndex,m}function ja(h){return bl?qn(bl.call(h)):{}}function gf(h,m){var C=m?Xn(h.buffer):h.buffer;return new h.constructor(C,h.byteOffset,h.length)}function td(h,m){if(h!==m){var C=h!==a,z=h===null,Z=h===h,te=po(h),_e=m!==a,Ee=m===null,Le=m===m,ut=po(m);if(!Ee&&!ut&&!te&&h>m||te&&_e&&Le&&!Ee&&!ut||z&&_e&&Le||!C&&Le||!Z)return 1;if(!z&&!te&&!ut&&h<m||ut&&C&&Z&&!z&&!te||Ee&&C&&Z||!_e&&Z||!Le)return-1}return 0}function nd(h,m,C){for(var z=-1,Z=h.criteria,te=m.criteria,_e=Z.length,Ee=C.length;++z<_e;){var Le=td(Z[z],te[z]);if(Le){if(z>=Ee)return Le;var ut=C[z];return Le*(ut=="desc"?-1:1)}}return h.index-m.index}function rd(h,m,C,z){for(var Z=-1,te=h.length,_e=C.length,Ee=-1,Le=m.length,ut=Tr(te-_e,0),ht=Ve(Le+ut),gt=!z;++Ee<Le;)ht[Ee]=m[Ee];for(;++Z<_e;)(gt||Z<te)&&(ht[C[Z]]=h[Z]);for(;ut--;)ht[Ee++]=h[Z++];return ht}function ua(h,m,C,z){for(var Z=-1,te=h.length,_e=-1,Ee=C.length,Le=-1,ut=m.length,ht=Tr(te-Ee,0),gt=Ve(ht+ut),kt=!z;++Z<ht;)gt[Z]=h[Z];for(var Wt=Z;++Le<ut;)gt[Wt+Le]=m[Le];for(;++_e<Ee;)(kt||Z<te)&&(gt[Wt+C[_e]]=h[Z++]);return gt}function fr(h,m){var C=-1,z=h.length;for(m||(m=Ve(z));++C<z;)m[C]=h[C];return m}function So(h,m,C,z){var Z=!C;C||(C={});for(var te=-1,_e=m.length;++te<_e;){var Ee=m[te],Le=z?z(C[Ee],h[Ee],Ee,C,h):a;Le===a&&(Le=h[Ee]),Z?Et(C,Ee,Le):La(C,Ee,Le)}return C}function _f(h,m){return So(h,Wp(h),m)}function Ru(h,m){return So(h,Lg(h),m)}function Ua(h,m){return function(C,z){var Z=pn(C)?lu:Np,te=m?m():{};return Z(C,h,Yt(z,2),te)}}function Va(h){return tt(function(m,C){var z=-1,Z=C.length,te=Z>1?C[Z-1]:a,_e=Z>2?C[2]:a;for(te=h.length>3&&typeof te=="function"?(Z--,te):a,_e&&hi(C[0],C[1],_e)&&(te=Z<3?a:te,Z=1),m=qn(m);++z<Z;){var Ee=C[z];Ee&&h(m,Ee,z,te)}return m})}function Ec(h,m){return function(C,z){if(C==null)return C;if(!fo(C))return h(C,z);for(var Z=C.length,te=m?Z:-1,_e=qn(C);(m?te--:++te<Z)&&z(_e[te],te,_e)!==!1;);return C}}function kg(h){return function(m,C,z){for(var Z=-1,te=qn(m),_e=z(m),Ee=_e.length;Ee--;){var Le=_e[h?Ee:++Z];if(C(te[Le],Le,te)===!1)break}return m}}function jp(h,m,C){var z=m&We,Z=Du(h);function te(){var _e=this&&this!==Dr&&this instanceof te?Z:h;return _e.apply(z?C:this,arguments)}return te}function Ag(h){return function(m){m=n(m);var C=Wi(m)?Lo(m):a,z=C?C[0]:m.charAt(0),Z=C?ui(C,1).join(""):m.slice(1);return z[h]()+Z}}function Cl(h){return function(m){return nc(J_(Wr(m).replace(kh,"")),h,"")}}function Du(h){return function(){var m=arguments;switch(m.length){case 0:return new h;case 1:return new h(m[0]);case 2:return new h(m[0],m[1]);case 3:return new h(m[0],m[1],m[2]);case 4:return new h(m[0],m[1],m[2],m[3]);case 5:return new h(m[0],m[1],m[2],m[3],m[4]);case 6:return new h(m[0],m[1],m[2],m[3],m[4],m[5]);case 7:return new h(m[0],m[1],m[2],m[3],m[4],m[5],m[6])}var C=so(h.prototype),z=h.apply(C,m);return Fr(z)?z:C}}function zg(h,m,C){var z=Du(h);function Z(){for(var te=arguments.length,_e=Ve(te),Ee=te,Le=El(Z);Ee--;)_e[Ee]=arguments[Ee];var ut=te<3&&_e[0]!==Le&&_e[te-1]!==Le?[]:is(_e,Le);if(te-=ut.length,te<C)return Up(h,m,Pl,Z.placeholder,a,_e,ut,a,a,C-te);var ht=this&&this!==Dr&&this instanceof Z?z:h;return io(ht,this,_e)}return Z}function Mc(h){return function(m,C,z){var Z=qn(m);if(!fo(m)){var te=Yt(C,3);m=Je(m),C=function(Ee){return te(Z[Ee],Ee,Z)}}var _e=h(m,C,z);return _e>-1?Z[te?m[_e]:_e]:a}}function Rg(h){return da(function(m){var C=m.length,z=C,Z=Ln.prototype.thru;for(h&&m.reverse();z--;){var te=m[z];if(typeof te!="function")throw new zi(b);if(Z&&!_e&&wf(te)=="wrapper")var _e=new Ln([],!0)}for(z=_e?z:C;++z<C;){te=m[z];var Ee=wf(te),Le=Ee=="wrapper"?qp(te):a;Le&&Fu(Le[0])&&Le[1]==(we|ve|it|ne)&&!Le[4].length&&Le[9]==1?_e=_e[wf(Le[0])].apply(_e,Le[3]):_e=te.length==1&&Fu(te)?_e[Ee]():_e.thru(te)}return function(){var ut=arguments,ht=ut[0];if(_e&&ut.length==1&&pn(ht))return _e.plant(ht).value();for(var gt=0,kt=C?m[gt].apply(this,ut):ht;++gt<C;)kt=m[gt].call(this,kt);return kt}})}function Pl(h,m,C,z,Z,te,_e,Ee,Le,ut){var ht=m&we,gt=m&We,kt=m&he,Wt=m&(ve|Oe),sn=m&ye,kn=kt?a:Du(h);function an(){for(var Un=arguments.length,Gn=Ve(Un),Fs=Un;Fs--;)Gn[Fs]=arguments[Fs];if(Wt)var Yo=El(an),Os=nf(Gn,Yo);if(z&&(Gn=rd(Gn,z,Z,Wt)),te&&(Gn=ua(Gn,te,_e,Wt)),Un-=Os,Wt&&Un<ut){var bi=is(Gn,Yo);return Up(h,m,Pl,an.placeholder,C,Gn,bi,Ee,Le,ut-Un)}var Wa=gt?C:this,Bc=kt?Wa[h]:h;return Un=Gn.length,Ee?Gn=kc(Gn,Ee):sn&&Un>1&&Gn.reverse(),ht&&Le<Un&&(Gn.length=Le),this&&this!==Dr&&this instanceof an&&(Bc=kn||Du(Bc)),Bc.apply(Wa,Gn)}return an}function id(h,m){return function(C,z){return ed(C,h,m(z),{})}}function Ic(h,m){return function(C,z){var Z;if(C===a&&z===a)return m;if(C!==a&&(Z=C),z!==a){if(Z===a)return z;typeof C=="string"||typeof z=="string"?(C=Hn(C),z=Hn(z)):(C=Qr(C),z=Qr(z)),Z=h(C,z)}return Z}}function yf(h){return da(function(m){return m=Nn(m,oo(Yt())),tt(function(C){var z=this;return h(m,function(Z){return io(Z,z,C)})})})}function od(h,m){m=m===a?" ":Hn(m);var C=m.length;if(C<2)return C?Ze(m,h):m;var z=Ze(m,ta(h/fl(m)));return Wi(m)?ui(Lo(z),0,h).join(""):z.slice(0,h)}function Z0(h,m,C,z){var Z=m&We,te=Du(h);function _e(){for(var Ee=-1,Le=arguments.length,ut=-1,ht=z.length,gt=Ve(ht+Le),kt=this&&this!==Dr&&this instanceof _e?te:h;++ut<ht;)gt[ut]=z[ut];for(;Le--;)gt[ut++]=arguments[++Ee];return io(kt,Z?C:this,gt)}return _e}function Dg(h){return function(m,C,z){return z&&typeof z!="number"&&hi(m,C,z)&&(C=z=a),m=Wo(m),C===a?(C=m,m=0):C=Wo(C),z=z===a?m<C?1:-1:Wo(z),Ye(m,C,z,h)}}function sd(h){return function(m,C){return typeof m=="string"&&typeof C=="string"||(m=To(m),C=To(C)),h(m,C)}}function Up(h,m,C,z,Z,te,_e,Ee,Le,ut){var ht=m&ve,gt=ht?_e:a,kt=ht?a:_e,Wt=ht?te:a,sn=ht?a:te;m|=ht?it:qe,m&=~(ht?qe:it),m&pe||(m&=~(We|he));var kn=[h,m,Z,Wt,gt,sn,kt,Ee,Le,ut],an=C.apply(a,kn);return Fu(h)&&Yp(an,kn),an.placeholder=z,Jp(an,h,m)}function vf(h){var m=gr[h];return function(C,z){if(C=To(C),z=z==null?0:Cn(mn(z),292),z&&Aa(C)){var Z=(n(C)+"e").split("e"),te=m(Z[0]+"e"+(+Z[1]+z));return Z=(n(te)+"e").split("e"),+(Z[0]+"e"+(+Z[1]-z))}return m(C)}}var G0=Bo&&1/os(new Bo([,-0]))[1]==Zt?function(h){return new Bo(h)}:jv;function xf(h){return function(m){var C=Ki(m);return C==qt?lc(m):C==nr?Dn(m):tf(m,h(m))}}function ha(h,m,C,z,Z,te,_e,Ee){var Le=m&he;if(!Le&&typeof h!="function")throw new zi(b);var ut=z?z.length:0;if(ut||(m&=~(it|qe),z=Z=a),_e=_e===a?_e:Tr(mn(_e),0),Ee=Ee===a?Ee:mn(Ee),ut-=Z?Z.length:0,m&qe){var ht=z,gt=Z;z=Z=a}var kt=Le?a:qp(h),Wt=[h,m,C,z,Z,ht,gt,te,_e,Ee];if(kt&&Pf(Wt,kt),h=Wt[0],m=Wt[1],C=Wt[2],z=Wt[3],Z=Wt[4],Ee=Wt[9]=Wt[9]===a?Le?0:h.length:Tr(Wt[9]-ut,0),!Ee&&m&(ve|Oe)&&(m&=~(ve|Oe)),!m||m==We)var sn=jp(h,m,C);else m==ve||m==Oe?sn=zg(h,m,Ee):(m==it||m==(We|it))&&!Z.length?sn=Z0(h,m,C,z):sn=Pl.apply(a,Wt);var kn=kt?Ot:Yp;return Jp(kn(sn,Wt),h,m)}function bf(h,m,C,z){return h===a||hs(h,Fo[C])&&!Bt.call(z,C)?m:h}function Lu(h,m,C,z,Z,te){return Fr(h)&&Fr(m)&&(te.set(m,h),se(h,m,a,Lu,te),te.delete(m)),h}function Go(h){return bd(h)?a:h}function Vp(h,m,C,z,Z,te){var _e=C&Te,Ee=h.length,Le=m.length;if(Ee!=Le&&!(_e&&Le>Ee))return!1;var ut=te.get(h),ht=te.get(m);if(ut&&ht)return ut==m&&ht==h;var gt=-1,kt=!0,Wt=C&et?new oa:a;for(te.set(h,m),te.set(m,h);++gt<Ee;){var sn=h[gt],kn=m[gt];if(z)var an=_e?z(kn,sn,gt,m,h,te):z(sn,kn,gt,h,m,te);if(an!==a){if(an)continue;kt=!1;break}if(Wt){if(!rs(m,function(Un,Gn){if(!ac(Wt,Gn)&&(sn===Un||Z(sn,Un,C,z,te)))return Wt.push(Gn)})){kt=!1;break}}else if(!(sn===kn||Z(sn,kn,C,z,te))){kt=!1;break}}return te.delete(h),te.delete(m),kt}function $p(h,m,C,z,Z,te,_e){switch(C){case xr:if(h.byteLength!=m.byteLength||h.byteOffset!=m.byteOffset)return!1;h=h.buffer,m=m.buffer;case rr:return!(h.byteLength!=m.byteLength||!te(new _l(h),new _l(m)));case rn:case Qt:case _n:return hs(+h,+m);case Gt:return h.name==m.name&&h.message==m.message;case Rn:case zr:return h==m+"";case qt:var Ee=lc;case nr:var Le=z&Te;if(Ee||(Ee=os),h.size!=m.size&&!Le)return!1;var ut=_e.get(h);if(ut)return ut==m;z|=et,_e.set(h,m);var ht=Vp(Ee(h),Ee(m),z,Z,te,_e);return _e.delete(h),ht;case Si:if(bl)return bl.call(h)==bl.call(m)}return!1}function q0(h,m,C,z,Z,te){var _e=C&Te,Ee=Zp(h),Le=Ee.length,ut=Zp(m),ht=ut.length;if(Le!=ht&&!_e)return!1;for(var gt=Le;gt--;){var kt=Ee[gt];if(!(_e?kt in m:Bt.call(m,kt)))return!1}var Wt=te.get(h),sn=te.get(m);if(Wt&&sn)return Wt==m&&sn==h;var kn=!0;te.set(h,m),te.set(m,h);for(var an=_e;++gt<Le;){kt=Ee[gt];var Un=h[kt],Gn=m[kt];if(z)var Fs=_e?z(Gn,Un,kt,m,h,te):z(Un,Gn,kt,h,m,te);if(!(Fs===a?Un===Gn||Z(Un,Gn,C,z,te):Fs)){kn=!1;break}an||(an=kt=="constructor")}if(kn&&!an){var Yo=h.constructor,Os=m.constructor;Yo!=Os&&"constructor"in h&&"constructor"in m&&!(typeof Yo=="function"&&Yo instanceof Yo&&typeof Os=="function"&&Os instanceof Os)&&(kn=!1)}return te.delete(h),te.delete(m),kn}function da(h){return hd(jg(h,a,Uu),h+"")}function Zp(h){return Au(h,Je,Wp)}function Gp(h){return Au(h,Fe,Lg)}var qp=vl?function(h){return vl.get(h)}:jv;function wf(h){for(var m=h.name+"",C=Da[m],z=Bt.call(Da,m)?C.length:0;z--;){var Z=C[z],te=Z.func;if(te==null||te==h)return Z.name}return m}function El(h){var m=Bt.call(X,"placeholder")?X:h;return m.placeholder}function Yt(){var h=X.iteratee||xi;return h=h===xi?D:h,arguments.length?h(arguments[0],arguments[1]):h}function ad(h,m){var C=h.__data__;return Tf(m)?C[typeof m=="string"?"string":"hash"]:C.map}function $a(h){for(var m=Je(h),C=m.length;C--;){var z=m[C],Z=h[z];m[C]=[z,Z,Bu(Z)]}return m}function ks(h,m){var C=mu(h,m);return w(C)?C:a}function W0(h){var m=Bt.call(h,Ss),C=h[Ss];try{h[Ss]=a;var z=!0}catch{}var Z=dc.call(h);return z&&(m?h[Ss]=C:delete h[Ss]),Z}var Wp=vc?function(h){return h==null?[]:(h=qn(h),qi(vc(h),function(m){return bu.call(h,m)}))}:Uv,Lg=vc?function(h){for(var m=[];h;)Ys(m,Wp(h)),h=ss(h);return m}:Uv,Ki=$r;(Tu&&Ki(new Tu(new ArrayBuffer(1)))!=xr||Oo&&Ki(new Oo)!=qt||na&&Ki(na.resolve())!=yn||Bo&&Ki(new Bo)!=nr||yl&&Ki(new yl)!=Rr)&&(Ki=function(h){var m=$r(h),C=m==En?h.constructor:a,z=C?Ac(C):"";if(z)switch(z){case Vh:return xr;case ra:return qt;case xl:return yn;case lf:return nr;case cf:return Rr}return m});function H0(h,m,C){for(var z=-1,Z=C.length;++z<Z;){var te=C[z],_e=te.size;switch(te.type){case"drop":h+=_e;break;case"dropRight":m-=_e;break;case"take":m=Cn(m,h+_e);break;case"takeRight":h=Tr(h,m-_e);break}}return{start:h,end:m}}function X0(h){var m=h.match(hn);return m?m[1].split(Xt):[]}function Fg(h,m,C){m=ti(m,h);for(var z=-1,Z=m.length,te=!1;++z<Z;){var _e=fa(m[z]);if(!(te=h!=null&&C(h,_e)))break;h=h[_e]}return te||++z!=Z?te:(Z=h==null?0:h.length,!!Z&&Dc(Z)&&Qn(_e,Z)&&(pn(h)||Rc(h)))}function Hp(h){var m=h.length,C=new h.constructor(m);return m&&typeof h[0]=="string"&&Bt.call(h,"index")&&(C.index=h.index,C.input=h.input),C}function Og(h){return typeof h.constructor=="function"&&!Ou(h)?so(ss(h)):{}}function Bg(h,m,C){var z=h.constructor;switch(m){case rr:return Xn(h);case rn:case Qt:return new z(+h);case xr:return ni(h,C);case Bi:case to:case Ni:case Kr:case no:case ji:case ze:case F:case H:return gf(h,C);case qt:return new z;case _n:case zr:return new z(h);case Rn:return ri(h);case nr:return new z;case Si:return ja(h)}}function ld(h,m){var C=m.length;if(!C)return h;var z=C-1;return m[z]=(C>1?"& ":"")+m[z],m=m.join(C>2?", ":" "),h.replace(Pt,`{
/* [wrapped with `+m+`] */
`)}function K0(h){return pn(h)||Rc(h)||!!(_c&&h&&h[_c])}function Qn(h,m){var C=typeof h;return m=m??dt,!!m&&(C=="number"||C!="symbol"&&Xd.test(h))&&h>-1&&h%1==0&&h<m}function hi(h,m,C){if(!Fr(C))return!1;var z=typeof m;return(z=="number"?fo(C)&&Qn(m,C.length):z=="string"&&m in C)?hs(C[m],h):!1}function Sf(h,m){if(pn(h))return!1;var C=typeof h;return C=="number"||C=="symbol"||C=="boolean"||h==null||po(h)?!0:yt.test(h)||!De.test(h)||m!=null&&h in qn(m)}function Tf(h){var m=typeof h;return m=="string"||m=="number"||m=="symbol"||m=="boolean"?h!=="__proto__":h===null}function Fu(h){var m=wf(h),C=X[m];if(typeof C!="function"||!(m in en.prototype))return!1;if(h===C)return!0;var z=qp(C);return!!z&&h===z[0]}function cd(h){return!!sf&&sf in h}var Ng=hc?ds:Vv;function Ou(h){var m=h&&h.constructor,C=typeof m=="function"&&m.prototype||Fo;return h===C}function Bu(h){return h===h&&!Fr(h)}function Cf(h,m){return function(C){return C==null?!1:C[h]===m&&(m!==a||h in qn(C))}}function Nu(h){var m=qu(h,function(z){return C.size===$&&C.clear(),z}),C=m.cache;return m}function Pf(h,m){var C=h[1],z=m[1],Z=C|z,te=Z<(We|he|we),_e=z==we&&C==ve||z==we&&C==ne&&h[7].length<=m[8]||z==(we|ne)&&m[7].length<=m[8]&&C==ve;if(!(te||_e))return h;z&We&&(h[2]=m[2],Z|=C&We?0:pe);var Ee=m[3];if(Ee){var Le=h[3];h[3]=Le?rd(Le,Ee,m[4]):Ee,h[4]=Le?is(h[3],Q):m[4]}return Ee=m[5],Ee&&(Le=h[5],h[5]=Le?ua(Le,Ee,m[6]):Ee,h[6]=Le?is(h[5],Q):m[6]),Ee=m[7],Ee&&(h[7]=Ee),z&we&&(h[8]=h[8]==null?m[8]:Cn(h[8],m[8])),h[9]==null&&(h[9]=m[9]),h[0]=m[0],h[1]=Z,h}function ju(h){var m=[];if(h!=null)for(var C in qn(h))m.push(C);return m}function ud(h){return dc.call(h)}function jg(h,m,C){return m=Tr(m===a?h.length-1:m,0),function(){for(var z=arguments,Z=-1,te=Tr(z.length-m,0),_e=Ve(te);++Z<te;)_e[Z]=z[m+Z];Z=-1;for(var Ee=Ve(m+1);++Z<m;)Ee[Z]=z[Z];return Ee[m]=C(_e),io(h,this,Ee)}}function Xp(h,m){return m.length<2?h:Vo(h,vn(m,0,-1))}function kc(h,m){for(var C=h.length,z=Cn(m.length,C),Z=fr(h);z--;){var te=m[z];h[z]=Qn(te,C)?Z[te]:a}return h}function Kp(h,m){if(!(m==="constructor"&&typeof h[m]=="function")&&m!="__proto__")return h[m]}var Yp=Qp(Ot),Za=af||function(h,m){return Dr.setTimeout(h,m)},hd=Qp(Fn);function Jp(h,m,C){var z=m+"";return hd(h,ld(z,Y0(X0(z),C)))}function Qp(h){var m=0,C=0;return function(){var z=za(),Z=bt-(z-C);if(C=z,Z>0){if(++m>=lt)return arguments[0]}else m=0;return h.apply(a,arguments)}}function Ef(h,m){var C=-1,z=h.length,Z=z-1;for(m=m===a?z:m;++C<m;){var te=He(C,Z),_e=h[te];h[te]=h[C],h[C]=_e}return h.length=m,h}var Ug=Nu(function(h){var m=[];return h.charCodeAt(0)===46&&m.push(""),h.replace(Ft,function(C,z,Z,te){m.push(Z?te.replace(Sa,"$1"):z||C)}),m});function fa(h){if(typeof h=="string"||po(h))return h;var m=h+"";return m=="0"&&1/h==-Zt?"-0":m}function Ac(h){if(h!=null){try{return gl.call(h)}catch{}try{return h+""}catch{}}return""}function Y0(h,m){return Ai(gn,function(C){var z="_."+C[0];m&C[1]&&!hl(h,z)&&h.push(z)}),h.sort()}function Mf(h){if(h instanceof en)return h.clone();var m=new Ln(h.__wrapped__,h.__chain__);return m.__actions__=fr(h.__actions__),m.__index__=h.__index__,m.__values__=h.__values__,m}function Vg(h,m,C){(C?hi(h,m,C):m===a)?m=1:m=Tr(mn(m),0);var z=h==null?0:h.length;if(!z||m<1)return[];for(var Z=0,te=0,_e=Ve(ta(z/m));Z<z;)_e[te++]=vn(h,Z,Z+=m);return _e}function em(h){for(var m=-1,C=h==null?0:h.length,z=0,Z=[];++m<C;){var te=h[m];te&&(Z[z++]=te)}return Z}function $g(){var h=arguments.length;if(!h)return[];for(var m=Ve(h-1),C=arguments[0],z=h;z--;)m[z-1]=arguments[z];return Ys(pn(C)?fr(C):[C],Vr(m,1))}var tm=tt(function(h,m){return Zr(h)?Hi(h,Vr(m,1,Zr,!0)):[]}),Zg=tt(function(h,m){var C=us(m);return Zr(C)&&(C=a),Zr(h)?Hi(h,Vr(m,1,Zr,!0),Yt(C,2)):[]}),Gg=tt(function(h,m){var C=us(m);return Zr(C)&&(C=a),Zr(h)?Hi(h,Vr(m,1,Zr,!0),a,C):[]});function If(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:mn(m),vn(h,m<0?0:m,z)):[]}function qg(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:mn(m),m=z-m,vn(h,0,m<0?0:m)):[]}function Wg(h,m){return h&&h.length?wo(h,Yt(m,3),!0,!0):[]}function Hg(h,m){return h&&h.length?wo(h,Yt(m,3),!0):[]}function dd(h,m,C,z){var Z=h==null?0:h.length;return Z?(C&&typeof C!="number"&&hi(h,m,C)&&(C=0,z=Z),mf(h,m,C,z)):[]}function Xg(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var Z=C==null?0:mn(C);return Z<0&&(Z=Tr(z+Z,0)),oc(h,Yt(m,3),Z)}function kf(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var Z=z-1;return C!==a&&(Z=mn(C),Z=C<0?Tr(z+Z,0):Cn(Z,z-1)),oc(h,Yt(m,3),Z,!0)}function Uu(h){var m=h==null?0:h.length;return m?Vr(h,1):[]}function nm(h){var m=h==null?0:h.length;return m?Vr(h,Zt):[]}function J0(h,m){var C=h==null?0:h.length;return C?(m=m===a?1:mn(m),Vr(h,m)):[]}function Q0(h){for(var m=-1,C=h==null?0:h.length,z={};++m<C;){var Z=h[m];z[Z[0]]=Z[1]}return z}function rm(h){return h&&h.length?h[0]:a}function Kg(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var Z=C==null?0:mn(C);return Z<0&&(Z=Tr(z+Z,0)),Ma(h,m,Z)}function ev(h){var m=h==null?0:h.length;return m?vn(h,0,-1):[]}var tv=tt(function(h){var m=Nn(h,Na);return m.length&&m[0]===h[0]?Tl(m):[]}),fd=tt(function(h){var m=us(h),C=Nn(h,Na);return m===us(C)?m=a:C.pop(),C.length&&C[0]===h[0]?Tl(C,Yt(m,2)):[]}),Yg=tt(function(h){var m=us(h),C=Nn(h,Na);return m=typeof m=="function"?m:a,m&&C.pop(),C.length&&C[0]===h[0]?Tl(C,a,m):[]});function nv(h,m){return h==null?"":xc.call(h,m)}function us(h){var m=h==null?0:h.length;return m?h[m-1]:a}function rv(h,m,C){var z=h==null?0:h.length;if(!z)return-1;var Z=z;return C!==a&&(Z=mn(C),Z=Z<0?Tr(z+Z,0):Cn(Z,z-1)),m===m?zp(h,m,Z):oc(h,zh,Z,!0)}function iv(h,m){return h&&h.length?me(h,mn(m)):a}var ov=tt(Jg);function Jg(h,m){return h&&h.length&&m&&m.length?Be(h,m):h}function Qg(h,m,C){return h&&h.length&&m&&m.length?Be(h,m,Yt(C,2)):h}function im(h,m,C){return h&&h.length&&m&&m.length?Be(h,m,a,C):h}var e_=da(function(h,m){var C=h==null?0:h.length,z=Vt(h,m);return je(h,Nn(m,function(Z){return Qn(Z,C)?+Z:Z}).sort(td)),z});function t_(h,m){var C=[];if(!(h&&h.length))return C;var z=-1,Z=[],te=h.length;for(m=Yt(m,3);++z<te;){var _e=h[z];m(_e,z,h)&&(C.push(_e),Z.push(z))}return je(h,Z),C}function Af(h){return h==null?h:Uh.call(h)}function sv(h,m,C){var z=h==null?0:h.length;return z?(C&&typeof C!="number"&&hi(h,m,C)?(m=0,C=z):(m=m==null?0:mn(m),C=C===a?z:mn(C)),vn(h,m,C)):[]}function zf(h,m){return Jn(h,m)}function av(h,m,C){return zn(h,m,Yt(C,2))}function n_(h,m){var C=h==null?0:h.length;if(C){var z=Jn(h,m);if(z<C&&hs(h[z],m))return z}return-1}function lv(h,m){return Jn(h,m,!0)}function cv(h,m,C){return zn(h,m,Yt(C,2),!0)}function uv(h,m){var C=h==null?0:h.length;if(C){var z=Jn(h,m,!0)-1;if(hs(h[z],m))return z}return-1}function r_(h){return h&&h.length?Wn(h):[]}function hv(h,m){return h&&h.length?Wn(h,Yt(m,2)):[]}function dv(h){var m=h==null?0:h.length;return m?vn(h,1,m):[]}function pd(h,m,C){return h&&h.length?(m=C||m===a?1:mn(m),vn(h,0,m<0?0:m)):[]}function i_(h,m,C){var z=h==null?0:h.length;return z?(m=C||m===a?1:mn(m),m=z-m,vn(h,m<0?0:m,z)):[]}function om(h,m){return h&&h.length?wo(h,Yt(m,3),!1,!0):[]}function o_(h,m){return h&&h.length?wo(h,Yt(m,3)):[]}var ii=tt(function(h){return dr(Vr(h,1,Zr,!0))}),sm=tt(function(h){var m=us(h);return Zr(m)&&(m=a),dr(Vr(h,1,Zr,!0),Yt(m,2))}),fv=tt(function(h){var m=us(h);return m=typeof m=="function"?m:a,dr(Vr(h,1,Zr,!0),a,m)});function s_(h){return h&&h.length?dr(h):[]}function am(h,m){return h&&h.length?dr(h,Yt(m,2)):[]}function lm(h,m){return m=typeof m=="function"?m:a,h&&h.length?dr(h,a,m):[]}function cm(h){if(!(h&&h.length))return[];var m=0;return h=qi(h,function(C){if(Zr(C))return m=Tr(C.length,m),!0}),du(m,function(C){return Nn(h,uu(C))})}function a_(h,m){if(!(h&&h.length))return[];var C=cm(h);return m==null?C:Nn(C,function(z){return io(m,a,z)})}var pv=tt(function(h,m){return Zr(h)?Hi(h,m):[]}),mv=tt(function(h){return Xi(qi(h,Zr))}),l_=tt(function(h){var m=us(h);return Zr(m)&&(m=a),Xi(qi(h,Zr),Yt(m,2))}),ho=tt(function(h){var m=us(h);return m=typeof m=="function"?m:a,Xi(qi(h,Zr),a,m)}),um=tt(cm);function c_(h,m){return ca(h||[],m||[],La)}function Ml(h,m){return ca(h||[],m||[],Mt)}var Rf=tt(function(h){var m=h.length,C=m>1?h[m-1]:a;return C=typeof C=="function"?(h.pop(),C):a,a_(h,C)});function Vu(h){var m=X(h);return m.__chain__=!0,m}function $u(h,m){return m(h),h}function zc(h,m){return m(h)}var Df=da(function(h){var m=h.length,C=m?h[0]:0,z=this.__wrapped__,Z=function(te){return Vt(te,h)};return m>1||this.__actions__.length||!(z instanceof en)||!Qn(C)?this.thru(Z):(z=z.slice(C,+C+(m?1:0)),z.__actions__.push({func:zc,args:[Z],thisArg:a}),new Ln(z,this.__chain__).thru(function(te){return m&&!te.length&&te.push(a),te}))});function gv(){return Vu(this)}function _v(){return new Ln(this.value(),this.__chain__)}function u_(){this.__values__===a&&(this.__values__=Td(this.value()));var h=this.__index__>=this.__values__.length,m=h?a:this.__values__[this.__index__++];return{done:h,value:m}}function h_(){return this}function yv(h){for(var m,C=this;C instanceof Ts;){var z=Mf(C);z.__index__=0,z.__values__=a,m?Z.__wrapped__=z:m=z;var Z=z;C=C.__wrapped__}return Z.__wrapped__=h,m}function d_(){var h=this.__wrapped__;if(h instanceof en){var m=h;return this.__actions__.length&&(m=new en(this)),m=m.reverse(),m.__actions__.push({func:zc,args:[Af],thisArg:a}),new Ln(m,this.__chain__)}return this.thru(Af)}function f_(){return $o(this.__wrapped__,this.__actions__)}var hm=Ua(function(h,m,C){Bt.call(h,C)?++h[C]:Et(h,C,1)});function dm(h,m,C){var z=pn(h)?tc:Cr;return C&&hi(h,m,C)&&(m=a),z(h,Yt(m,3))}function vv(h,m){var C=pn(h)?qi:Fa;return C(h,Yt(m,3))}var p_=Mc(Xg),xv=Mc(kf);function bv(h,m){return Vr(gd(h,m),1)}function wv(h,m){return Vr(gd(h,m),Zt)}function Sv(h,m,C){return C=C===a?1:mn(C),Vr(gd(h,m),C)}function m_(h,m){var C=pn(h)?Ai:aa;return C(h,Yt(m,3))}function fm(h,m){var C=pn(h)?Gi:Uo;return C(h,Yt(m,3))}var g_=Ua(function(h,m,C){Bt.call(h,C)?h[C].push(m):Et(h,C,[m])});function md(h,m,C,z){h=fo(h)?h:Er(h),C=C&&!z?mn(C):0;var Z=h.length;return C<0&&(C=Tr(Z+C,0)),wd(h)?C<=Z&&h.indexOf(m,C)>-1:!!Z&&Ma(h,m,C)>-1}var pa=tt(function(h,m,C){var z=-1,Z=typeof m=="function",te=fo(h)?Ve(h.length):[];return aa(h,function(_e){te[++z]=Z?io(m,_e,C):la(_e,m,C)}),te}),Il=Ua(function(h,m,C){Et(h,C,m)});function gd(h,m){var C=pn(h)?Nn:W;return C(h,Yt(m,3))}function pm(h,m,C,z){return h==null?[]:(pn(m)||(m=m==null?[]:[m]),C=z?a:C,pn(C)||(C=C==null?[]:[C]),ge(h,m,C))}var Tv=Ua(function(h,m,C){h[C?0:1].push(m)},function(){return[[],[]]});function Cv(h,m,C){var z=pn(h)?nc:hu,Z=arguments.length<3;return z(h,Yt(m,4),C,Z,aa)}function Lf(h,m,C){var z=pn(h)?rc:hu,Z=arguments.length<3;return z(h,Yt(m,4),C,Z,Uo)}function mm(h,m){var C=pn(h)?qi:Fa;return C(h,As(Yt(m,3)))}function Pv(h){var m=pn(h)?hr:mt;return m(h)}function gm(h,m,C){(C?hi(h,m,C):m===a)?m=1:m=mn(m);var z=pn(h)?Sc:ot;return z(h,m)}function _m(h){var m=pn(h)?Iu:ar;return m(h)}function Zu(h){if(h==null)return 0;if(fo(h))return wd(h)?fl(h):h.length;var m=Ki(h);return m==qt||m==nr?h.size:O(h).length}function __(h,m,C){var z=pn(h)?rs:_r;return C&&hi(h,m,C)&&(m=a),z(h,Yt(m,3))}var y_=tt(function(h,m){if(h==null)return[];var C=m.length;return C>1&&hi(h,m[0],m[1])?m=[]:C>2&&hi(m[0],m[1],m[2])&&(m=[m[0]]),ge(h,Vr(m,1),[])}),Gu=Fp||function(){return Dr.Date.now()};function v_(h,m){if(typeof m!="function")throw new zi(b);return h=mn(h),function(){if(--h<1)return m.apply(this,arguments)}}function _d(h,m,C){return m=C?a:m,m=h&&m==null?h.length:m,ha(h,we,a,a,a,a,m)}function ym(h,m){var C;if(typeof m!="function")throw new zi(b);return h=mn(h),function(){return--h>0&&(C=m.apply(this,arguments)),h<=1&&(m=a),C}}var vm=tt(function(h,m,C){var z=We;if(C.length){var Z=is(C,El(vm));z|=it}return ha(h,z,m,C,Z)}),x_=tt(function(h,m,C){var z=We|he;if(C.length){var Z=is(C,El(x_));z|=it}return ha(m,z,h,C,Z)});function xm(h,m,C){m=C?a:m;var z=ha(h,ve,a,a,a,a,a,m);return z.placeholder=xm.placeholder,z}function b_(h,m,C){m=C?a:m;var z=ha(h,Oe,a,a,a,a,a,m);return z.placeholder=b_.placeholder,z}function w_(h,m,C){var z,Z,te,_e,Ee,Le,ut=0,ht=!1,gt=!1,kt=!0;if(typeof h!="function")throw new zi(b);m=To(m)||0,Fr(C)&&(ht=!!C.leading,gt="maxWait"in C,te=gt?Tr(To(C.maxWait)||0,m):te,kt="trailing"in C?!!C.trailing:kt);function Wt(bi){var Wa=z,Bc=Z;return z=Z=a,ut=bi,_e=h.apply(Bc,Wa),_e}function sn(bi){return ut=bi,Ee=Za(Un,m),ht?Wt(bi):_e}function kn(bi){var Wa=bi-Le,Bc=bi-ut,Xb=m-Wa;return gt?Cn(Xb,te-Bc):Xb}function an(bi){var Wa=bi-Le,Bc=bi-ut;return Le===a||Wa>=m||Wa<0||gt&&Bc>=te}function Un(){var bi=Gu();if(an(bi))return Gn(bi);Ee=Za(Un,kn(bi))}function Gn(bi){return Ee=a,kt&&z?Wt(bi):(z=Z=a,_e)}function Fs(){Ee!==a&&Zo(Ee),ut=0,z=Le=Z=Ee=a}function Yo(){return Ee===a?_e:Gn(Gu())}function Os(){var bi=Gu(),Wa=an(bi);if(z=arguments,Z=this,Le=bi,Wa){if(Ee===a)return sn(Le);if(gt)return Zo(Ee),Ee=Za(Un,m),Wt(Le)}return Ee===a&&(Ee=Za(Un,m)),_e}return Os.cancel=Fs,Os.flush=Yo,Os}var Ev=tt(function(h,m){return Jh(h,1,m)}),Mv=tt(function(h,m,C){return Jh(h,To(m)||0,C)});function Iv(h){return ha(h,ye)}function qu(h,m){if(typeof h!="function"||m!=null&&typeof m!="function")throw new zi(b);var C=function(){var z=arguments,Z=m?m.apply(this,z):z[0],te=C.cache;if(te.has(Z))return te.get(Z);var _e=h.apply(this,z);return C.cache=te.set(Z,_e)||te,_e};return C.cache=new(qu.Cache||ao),C}qu.Cache=ao;function As(h){if(typeof h!="function")throw new zi(b);return function(){var m=arguments;switch(m.length){case 0:return!h.call(this);case 1:return!h.call(this,m[0]);case 2:return!h.call(this,m[0],m[1]);case 3:return!h.call(this,m[0],m[1],m[2])}return!h.apply(this,m)}}function S_(h){return ym(2,h)}var T_=cs(function(h,m){m=m.length==1&&pn(m[0])?Nn(m[0],oo(Yt())):Nn(Vr(m,1),oo(Yt()));var C=m.length;return tt(function(z){for(var Z=-1,te=Cn(z.length,C);++Z<te;)z[Z]=m[Z].call(this,z[Z]);return io(h,this,z)})}),Ff=tt(function(h,m){var C=is(m,El(Ff));return ha(h,it,a,m,C)}),bm=tt(function(h,m){var C=is(m,El(bm));return ha(h,qe,a,m,C)}),C_=da(function(h,m){return ha(h,ne,a,a,a,m)});function wm(h,m){if(typeof h!="function")throw new zi(b);return m=m===a?m:mn(m),tt(h,m)}function P_(h,m){if(typeof h!="function")throw new zi(b);return m=m==null?0:Tr(mn(m),0),tt(function(C){var z=C[m],Z=ui(C,0,m);return z&&Ys(Z,z),io(h,this,Z)})}function yd(h,m,C){var z=!0,Z=!0;if(typeof h!="function")throw new zi(b);return Fr(C)&&(z="leading"in C?!!C.leading:z,Z="trailing"in C?!!C.trailing:Z),w_(h,m,{leading:z,maxWait:m,trailing:Z})}function E_(h){return _d(h,1)}function Sm(h,m){return Ff(Is(m),h)}function M_(){if(!arguments.length)return[];var h=arguments[0];return pn(h)?h:[h]}function qo(h){return Ri(h,Y)}function Wu(h,m){return m=typeof m=="function"?m:a,Ri(h,Y,m)}function I_(h){return Ri(h,ce|Y)}function k_(h,m){return m=typeof m=="function"?m:a,Ri(h,ce|Y,m)}function A_(h,m){return m==null||Di(h,m,Je(m))}function hs(h,m){return h===m||h!==h&&m!==m}var z_=sd(Es),R_=sd(function(h,m){return h>=m}),Rc=Pc(function(){return arguments}())?Pc:function(h){return Gr(h)&&Bt.call(h,"callee")&&!bu.call(h,"callee")},pn=Ve.isArray,kl=su?oo(su):g;function fo(h){return h!=null&&Dc(h.length)&&!ds(h)}function Zr(h){return Gr(h)&&fo(h)}function D_(h){return h===!0||h===!1||Gr(h)&&$r(h)==rn}var Ga=Nh||Vv,kv=Ql?oo(Ql):e;function Av(h){return Gr(h)&&h.nodeType===1&&!bd(h)}function L_(h){if(h==null)return!0;if(fo(h)&&(pn(h)||typeof h=="string"||typeof h.splice=="function"||Ga(h)||zl(h)||Rc(h)))return!h.length;var m=Ki(h);if(m==qt||m==nr)return!h.size;if(Ou(h))return!O(h).length;for(var C in h)if(Bt.call(h,C))return!1;return!0}function vd(h,m){return i(h,m)}function F_(h,m,C){C=typeof C=="function"?C:a;var z=C?C(h,m):a;return z===a?i(h,m,a,C):!!z}function Hu(h){if(!Gr(h))return!1;var m=$r(h);return m==Gt||m==tr||typeof h.message=="string"&&typeof h.name=="string"&&!bd(h)}function O_(h){return typeof h=="number"&&Aa(h)}function ds(h){if(!Fr(h))return!1;var m=$r(h);return m==on||m==Kn||m==mr||m==Bn}function xd(h){return typeof h=="number"&&h==mn(h)}function Dc(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=dt}function Fr(h){var m=typeof h;return h!=null&&(m=="object"||m=="function")}function Gr(h){return h!=null&&typeof h=="object"}var B_=Ks?oo(Ks):d;function Xu(h,m){return h===m||_(h,m,$a(m))}function Ci(h,m,C){return C=typeof C=="function"?C:a,_(h,m,$a(m),C)}function Al(h){return Of(h)&&h!=+h}function Tm(h){if(Ng(h))throw new un(T);return w(h)}function N_(h){return h===null}function j_(h){return h==null}function Of(h){return typeof h=="number"||Gr(h)&&$r(h)==_n}function bd(h){if(!Gr(h)||$r(h)!=En)return!1;var m=ss(h);if(m===null)return!0;var C=Bt.call(m,"constructor")&&m.constructor;return typeof C=="function"&&C instanceof C&&gl.call(C)==Ia}var Bf=Qd?oo(Qd):P;function U_(h){return xd(h)&&h>=-dt&&h<=dt}var V_=ec?oo(ec):M;function wd(h){return typeof h=="string"||!pn(h)&&Gr(h)&&$r(h)==zr}function po(h){return typeof h=="symbol"||Gr(h)&&$r(h)==Si}var zl=au?oo(au):k;function $_(h){return h===a}function Sd(h){return Gr(h)&&Ki(h)==Rr}function Cm(h){return Gr(h)&&$r(h)==cr}var Z_=sd(G),Pm=sd(function(h,m){return h<=m});function Td(h){if(!h)return[];if(fo(h))return wd(h)?Lo(h):fr(h);if(ea&&h[ea])return gu(h[ea]());var m=Ki(h),C=m==qt?lc:m==nr?os:Er;return C(h)}function Wo(h){if(!h)return h===0?h:0;if(h=To(h),h===Zt||h===-Zt){var m=h<0?-1:1;return m*_t}return h===h?h:0}function mn(h){var m=Wo(h),C=m%1;return m===m?C?m-C:m:0}function Nf(h){return h?jo(mn(h),0,wt):0}function To(h){if(typeof h=="number")return h;if(po(h))return Rt;if(Fr(h)){var m=typeof h.valueOf=="function"?h.valueOf():h;h=Fr(m)?m+"":m}if(typeof h!="string")return h===0?h:+h;h=Js(h);var C=tu.test(h);return C||ir.test(h)?Mp(h.slice(2),C?2:8):ur.test(h)?Rt:+h}function G_(h){return So(h,Fe(h))}function o(h){return h?jo(mn(h),-dt,dt):h===0?h:0}function n(h){return h==null?"":Hn(h)}var s=Va(function(h,m){if(Ou(m)||fo(m)){So(m,Je(m),h);return}for(var C in m)Bt.call(m,C)&&La(h,C,m[C])}),c=Va(function(h,m){So(m,Fe(m),h)}),f=Va(function(h,m,C,z){So(m,Fe(m),h,z)}),y=Va(function(h,m,C,z){So(m,Je(m),h,z)}),v=da(Vt);function S(h,m){var C=so(h);return m==null?C:co(C,m)}var E=tt(function(h,m){h=qn(h);var C=-1,z=m.length,Z=z>2?m[2]:a;for(Z&&hi(m[0],m[1],Z)&&(z=1);++C<z;)for(var te=m[C],_e=Fe(te),Ee=-1,Le=_e.length;++Ee<Le;){var ut=_e[Ee],ht=h[ut];(ht===a||hs(ht,Fo[ut])&&!Bt.call(h,ut))&&(h[ut]=te[ut])}return h}),I=tt(function(h){return h.push(a,Lu),io(pt,a,h)});function A(h,m){return Ea(h,Yt(m,3),uo)}function R(h,m){return Ea(h,Yt(m,3),Ps)}function N(h,m){return h==null?h:Cc(h,Yt(m,3),Fe)}function U(h,m){return h==null?h:ls(h,Yt(m,3),Fe)}function V(h,m){return h&&uo(h,Yt(m,3))}function q(h,m){return h&&Ps(h,Yt(m,3))}function J(h){return h==null?[]:Oa(h,Je(h))}function ae(h){return h==null?[]:Oa(h,Fe(h))}function Ce(h,m,C){var z=h==null?a:Vo(h,m);return z===a?C:z}function de(h,m){return h!=null&&Fg(h,m,Qh)}function j(h,m){return h!=null&&Fg(h,m,zu)}var K=id(function(h,m,C){m!=null&&typeof m.toString!="function"&&(m=dc.call(m)),h[m]=C},th(Co)),fe=id(function(h,m,C){m!=null&&typeof m.toString!="function"&&(m=dc.call(m)),Bt.call(h,m)?h[m].push(C):h[m]=[C]},Yt),Ne=tt(la);function Je(h){return fo(h)?Cs(h):O(h)}function Fe(h){return fo(h)?Cs(h,!0):B(h)}function Ge(h,m){var C={};return m=Yt(m,3),uo(h,function(z,Z,te){Et(C,m(z,Z,te),z)}),C}function ft(h,m){var C={};return m=Yt(m,3),uo(h,function(z,Z,te){Et(C,Z,m(z,Z,te))}),C}var at=Va(function(h,m,C){se(h,m,C)}),pt=Va(function(h,m,C,z){se(h,m,C,z)}),Qe=da(function(h,m){var C={};if(h==null)return C;var z=!1;m=Nn(m,function(te){return te=ti(te,h),z||(z=te.length>1),te}),So(h,Gp(h),C),z&&(C=Ri(C,ce|oe|Y,Go));for(var Z=m.length;Z--;)ei(C,m[Z]);return C});function Ct(h,m){return Nt(h,As(Yt(m)))}var $t=da(function(h,m){return h==null?{}:be(h,m)});function Nt(h,m){if(h==null)return{};var C=Nn(Gp(h),function(z){return[z]});return m=Yt(m),Pe(h,C,function(z,Z){return m(z,Z[0])})}function At(h,m,C){m=ti(m,h);var z=-1,Z=m.length;for(Z||(Z=1,h=a);++z<Z;){var te=h==null?a:h[fa(m[z])];te===a&&(z=Z,te=C),h=ds(te)?te.call(h):te}return h}function xn(h,m,C){return h==null?h:Mt(h,m,C)}function Pr(h,m,C,z){return z=typeof z=="function"?z:a,h==null?h:Mt(h,m,C,z)}var qr=xf(Je),gi=xf(Fe);function Ho(h,m,C){var z=pn(h),Z=z||Ga(h)||zl(h);if(m=Yt(m,4),C==null){var te=h&&h.constructor;Z?C=z?new te:[]:Fr(h)?C=ds(te)?so(ss(h)):{}:C={}}return(Z?Ai:uo)(h,function(_e,Ee,Le){return m(C,_e,Ee,Le)}),C}function mo(h,m){return h==null?!0:ei(h,m)}function _i(h,m,C){return h==null?h:Ms(h,m,Is(C))}function Sr(h,m,C,z){return z=typeof z=="function"?z:a,h==null?h:Ms(h,m,Is(C),z)}function Er(h){return h==null?[]:dl(h,Je(h))}function yi(h){return h==null?[]:dl(h,Fe(h))}function vi(h,m,C){return C===a&&(C=m,m=a),C!==a&&(C=To(C),C=C===C?C:0),m!==a&&(m=To(m),m=m===m?m:0),jo(To(h),m,C)}function Yi(h,m,C){return m=Wo(m),C===a?(C=m,m=0):C=Wo(C),h=To(h),Ba(h,m,C)}function Xo(h,m,C){if(C&&typeof C!="boolean"&&hi(h,m,C)&&(m=C=a),C===a&&(typeof m=="boolean"?(C=m,m=a):typeof h=="boolean"&&(C=h,h=a)),h===a&&m===a?(h=0,m=1):(h=Wo(h),m===a?(m=h,h=0):m=Wo(m)),h>m){var z=h;h=m,m=z}if(C||h%1||m%1){var Z=Su();return Cn(h+Z*(m-h+ul("1e-"+((Z+"").length-1))),m)}return He(h,m)}var di=Cl(function(h,m,C){return m=m.toLowerCase(),h+(C?Ji(m):m)});function Ji(h){return Im(n(h).toLowerCase())}function Wr(h){return h=n(h),h&&h.replace(Vl,rf).replace(Do,"")}function fi(h,m,C){h=n(h),m=Hn(m);var z=h.length;C=C===a?z:jo(mn(C),0,z);var Z=C;return C-=m.length,C>=0&&h.slice(C,Z)==m}function pi(h){return h=n(h),h&&Xe.test(h)?h.replace(Ue,pu):h}function Hr(h){return h=n(h),h&&Ht.test(h)?h.replace(Jt,"\\$&"):h}var pr=Cl(function(h,m,C){return h+(C?"-":"")+m.toLowerCase()}),zs=Cl(function(h,m,C){return h+(C?" ":"")+m.toLowerCase()}),Ku=Ag("toLowerCase");function Rs(h,m,C){h=n(h),m=mn(m);var z=m?fl(h):0;if(!m||z>=m)return h;var Z=(m-z)/2;return od(ka(Z),C)+h+od(ta(Z),C)}function zv(h,m,C){h=n(h),m=mn(m);var z=m?fl(h):0;return m&&z<m?h+od(m-z,C):h}function Yu(h,m,C){h=n(h),m=mn(m);var z=m?fl(h):0;return m&&z<m?od(m-z,C)+h:h}function Lc(h,m,C){return C||m==null?m=0:m&&(m=+m),bo(n(h).replace(Ke,""),m||0)}function Ju(h,m,C){return(C?hi(h,m,C):m===a)?m=1:m=mn(m),Ze(n(h),m)}function Qu(){var h=arguments,m=n(h[0]);return h.length<3?m:m.replace(h[1],h[2])}var eh=Cl(function(h,m,C){return h+(C?"_":"")+m.toLowerCase()});function q_(h,m,C){return C&&typeof C!="number"&&hi(h,m,C)&&(m=C=a),C=C===a?wt:C>>>0,C?(h=n(h),h&&(typeof m=="string"||m!=null&&!Bf(m))&&(m=Hn(m),!m&&Wi(h))?ui(Lo(h),0,C):h.split(m,C)):[]}var W_=Cl(function(h,m,C){return h+(C?" ":"")+Im(m)});function H_(h,m,C){return h=n(h),C=C==null?0:jo(mn(C),0,h.length),m=Hn(m),h.slice(C,C+m.length)==m}function X_(h,m,C){var z=X.templateSettings;C&&hi(h,m,C)&&(m=a),h=n(h),m=f({},m,z,bf);var Z=f({},m.imports,z.imports,bf),te=Je(Z),_e=dl(Z,te),Ee,Le,ut=0,ht=m.interpolate||ol,gt="__p += '",kt=pl((m.escape||ol).source+"|"+ht.source+"|"+(ht===rt?Nr:ol).source+"|"+(m.evaluate||ol).source+"|$","g"),Wt="//# sourceURL="+(Bt.call(m,"sourceURL")?(m.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++In+"]")+`
`;h.replace(kt,function(an,Un,Gn,Fs,Yo,Os){return Gn||(Gn=Fs),gt+=h.slice(ut,Os).replace(Ws,Lh),Un&&(Ee=!0,gt+=`' +
__e(`+Un+`) +
'`),Yo&&(Le=!0,gt+=`';
`+Yo+`;
__p += '`),Gn&&(gt+=`' +
((__t = (`+Gn+`)) == null ? '' : __t) +
'`),ut=Os+an.length,an}),gt+=`';
`;var sn=Bt.call(m,"variable")&&m.variable;if(!sn)gt=`with (obj) {
`+gt+`
}
`;else if(Ut.test(sn))throw new un(l);gt=(Le?gt.replace(ee,""):gt).replace(le,"$1").replace(xe,"$1;"),gt="function("+(sn||"obj")+`) {
`+(sn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ee?", __e = _.escape":"")+(Le?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+gt+`return __p
}`;var kn=Q_(function(){return jn(te,Wt+"return "+gt).apply(a,_e)});if(kn.source=gt,Hu(kn))throw kn;return kn}function Em(h){return n(h).toLowerCase()}function Mm(h){return n(h).toUpperCase()}function qa(h,m,C){if(h=n(h),h&&(C||m===a))return Js(h);if(!h||!(m=Hn(m)))return h;var z=Lo(h),Z=Lo(m),te=Dh(z,Z),_e=fu(z,Z)+1;return ui(z,te,_e).join("")}function K_(h,m,C){if(h=n(h),h&&(C||m===a))return h.slice(0,Bh(h)+1);if(!h||!(m=Hn(m)))return h;var z=Lo(h),Z=fu(z,Lo(m))+1;return ui(z,0,Z).join("")}function Y_(h,m,C){if(h=n(h),h&&(C||m===a))return h.replace(Ke,"");if(!h||!(m=Hn(m)))return h;var z=Lo(h),Z=Dh(z,Lo(m));return ui(z,Z).join("")}function Rv(h,m){var C=ke,z=st;if(Fr(m)){var Z="separator"in m?m.separator:Z;C="length"in m?mn(m.length):C,z="omission"in m?Hn(m.omission):z}h=n(h);var te=h.length;if(Wi(h)){var _e=Lo(h);te=_e.length}if(C>=te)return h;var Ee=C-fl(z);if(Ee<1)return z;var Le=_e?ui(_e,0,Ee).join(""):h.slice(0,Ee);if(Z===a)return Le+z;if(_e&&(Ee+=Le.length-Ee),Bf(Z)){if(h.slice(Ee).search(Z)){var ut,ht=Le;for(Z.global||(Z=pl(Z.source,n(jr.exec(Z))+"g")),Z.lastIndex=0;ut=Z.exec(ht);)var gt=ut.index;Le=Le.slice(0,gt===a?Ee:gt)}}else if(h.indexOf(Hn(Z),Ee)!=Ee){var kt=Le.lastIndexOf(Z);kt>-1&&(Le=Le.slice(0,kt))}return Le+z}function Dv(h){return h=n(h),h&&Me.test(h)?h.replace(Ie,Rp):h}var Lv=Cl(function(h,m,C){return h+(C?" ":"")+m.toUpperCase()}),Im=Ag("toUpperCase");function J_(h,m,C){return h=n(h),m=C?a:m,m===a?Fh(h)?yu(h):ef(h):h.match(m)||[]}var Q_=tt(function(h,m){try{return io(h,a,m)}catch(C){return Hu(C)?C:new un(C)}}),Fv=da(function(h,m){return Ai(m,function(C){C=fa(C),Et(h,C,vm(h[C],h))}),h});function Ov(h){var m=h==null?0:h.length,C=Yt();return h=m?Nn(h,function(z){if(typeof z[1]!="function")throw new zi(b);return[C(z[0]),z[1]]}):[],tt(function(z){for(var Z=-1;++Z<m;){var te=h[Z];if(io(te[0],this,z))return io(te[1],this,z)}})}function Ds(h){return Yh(Ri(h,ce))}function th(h){return function(){return h}}function ey(h,m){return h==null||h!==h?m:h}var Bv=Rg(),Nv=Rg(!0);function Co(h){return h}function xi(h){return D(typeof h=="function"?h:Ri(h,ce))}function Ko(h){return ie(Ri(h,ce))}function Fc(h,m){return re(h,Ri(m,ce))}var Ls=tt(function(h,m){return function(C){return la(C,h,m)}}),Oc=tt(function(h,m){return function(C){return la(h,C,m)}});function fs(h,m,C){var z=Je(m),Z=Oa(m,z);C==null&&!(Fr(m)&&(Z.length||!z.length))&&(C=m,m=h,h=this,Z=Oa(m,Je(m)));var te=!(Fr(C)&&"chain"in C)||!!C.chain,_e=ds(h);return Ai(Z,function(Ee){var Le=m[Ee];h[Ee]=Le,_e&&(h.prototype[Ee]=function(){var ut=this.__chain__;if(te||ut){var ht=h(this.__wrapped__),gt=ht.__actions__=fr(this.__actions__);return gt.push({func:Le,args:arguments,thisArg:h}),ht.__chain__=ut,ht}return Le.apply(h,Ys([this.value()],arguments))})}),h}function kP(){return Dr._===this&&(Dr._=Dp),this}function jv(){}function AP(h){return h=mn(h),tt(function(m){return me(m,h)})}var zP=yf(Nn),RP=yf(tc),DP=yf(rs);function Hb(h){return Sf(h)?uu(fa(h)):Se(h)}function LP(h){return function(m){return h==null?a:Vo(h,m)}}var FP=Dg(),OP=Dg(!0);function Uv(){return[]}function Vv(){return!1}function BP(){return{}}function NP(){return""}function jP(){return!0}function UP(h,m){if(h=mn(h),h<1||h>dt)return[];var C=wt,z=Cn(h,wt);m=Yt(m),h-=wt;for(var Z=du(z,m);++C<h;)m(C);return Z}function VP(h){return pn(h)?Nn(h,fa):po(h)?[h]:fr(Ug(n(h)))}function $P(h){var m=++xu;return n(h)+m}var ZP=Ic(function(h,m){return h+m},0),GP=vf("ceil"),qP=Ic(function(h,m){return h/m},1),WP=vf("floor");function HP(h){return h&&h.length?wr(h,Co,Es):a}function XP(h,m){return h&&h.length?wr(h,Yt(m,2),Es):a}function KP(h){return cu(h,Co)}function YP(h,m){return cu(h,Yt(m,2))}function JP(h){return h&&h.length?wr(h,Co,G):a}function QP(h,m){return h&&h.length?wr(h,Yt(m,2),G):a}var eE=Ic(function(h,m){return h*m},1),tE=vf("round"),nE=Ic(function(h,m){return h-m},0);function rE(h){return h&&h.length?bs(h,Co):0}function iE(h,m){return h&&h.length?bs(h,Yt(m,2)):0}return X.after=v_,X.ary=_d,X.assign=s,X.assignIn=c,X.assignInWith=f,X.assignWith=y,X.at=v,X.before=ym,X.bind=vm,X.bindAll=Fv,X.bindKey=x_,X.castArray=M_,X.chain=Vu,X.chunk=Vg,X.compact=em,X.concat=$g,X.cond=Ov,X.conforms=Ds,X.constant=th,X.countBy=hm,X.create=S,X.curry=xm,X.curryRight=b_,X.debounce=w_,X.defaults=E,X.defaultsDeep=I,X.defer=Ev,X.delay=Mv,X.difference=tm,X.differenceBy=Zg,X.differenceWith=Gg,X.drop=If,X.dropRight=qg,X.dropRightWhile=Wg,X.dropWhile=Hg,X.fill=dd,X.filter=vv,X.flatMap=bv,X.flatMapDeep=wv,X.flatMapDepth=Sv,X.flatten=Uu,X.flattenDeep=nm,X.flattenDepth=J0,X.flip=Iv,X.flow=Bv,X.flowRight=Nv,X.fromPairs=Q0,X.functions=J,X.functionsIn=ae,X.groupBy=g_,X.initial=ev,X.intersection=tv,X.intersectionBy=fd,X.intersectionWith=Yg,X.invert=K,X.invertBy=fe,X.invokeMap=pa,X.iteratee=xi,X.keyBy=Il,X.keys=Je,X.keysIn=Fe,X.map=gd,X.mapKeys=Ge,X.mapValues=ft,X.matches=Ko,X.matchesProperty=Fc,X.memoize=qu,X.merge=at,X.mergeWith=pt,X.method=Ls,X.methodOf=Oc,X.mixin=fs,X.negate=As,X.nthArg=AP,X.omit=Qe,X.omitBy=Ct,X.once=S_,X.orderBy=pm,X.over=zP,X.overArgs=T_,X.overEvery=RP,X.overSome=DP,X.partial=Ff,X.partialRight=bm,X.partition=Tv,X.pick=$t,X.pickBy=Nt,X.property=Hb,X.propertyOf=LP,X.pull=ov,X.pullAll=Jg,X.pullAllBy=Qg,X.pullAllWith=im,X.pullAt=e_,X.range=FP,X.rangeRight=OP,X.rearg=C_,X.reject=mm,X.remove=t_,X.rest=wm,X.reverse=Af,X.sampleSize=gm,X.set=xn,X.setWith=Pr,X.shuffle=_m,X.slice=sv,X.sortBy=y_,X.sortedUniq=r_,X.sortedUniqBy=hv,X.split=q_,X.spread=P_,X.tail=dv,X.take=pd,X.takeRight=i_,X.takeRightWhile=om,X.takeWhile=o_,X.tap=$u,X.throttle=yd,X.thru=zc,X.toArray=Td,X.toPairs=qr,X.toPairsIn=gi,X.toPath=VP,X.toPlainObject=G_,X.transform=Ho,X.unary=E_,X.union=ii,X.unionBy=sm,X.unionWith=fv,X.uniq=s_,X.uniqBy=am,X.uniqWith=lm,X.unset=mo,X.unzip=cm,X.unzipWith=a_,X.update=_i,X.updateWith=Sr,X.values=Er,X.valuesIn=yi,X.without=pv,X.words=J_,X.wrap=Sm,X.xor=mv,X.xorBy=l_,X.xorWith=ho,X.zip=um,X.zipObject=c_,X.zipObjectDeep=Ml,X.zipWith=Rf,X.entries=qr,X.entriesIn=gi,X.extend=c,X.extendWith=f,fs(X,X),X.add=ZP,X.attempt=Q_,X.camelCase=di,X.capitalize=Ji,X.ceil=GP,X.clamp=vi,X.clone=qo,X.cloneDeep=I_,X.cloneDeepWith=k_,X.cloneWith=Wu,X.conformsTo=A_,X.deburr=Wr,X.defaultTo=ey,X.divide=qP,X.endsWith=fi,X.eq=hs,X.escape=pi,X.escapeRegExp=Hr,X.every=dm,X.find=p_,X.findIndex=Xg,X.findKey=A,X.findLast=xv,X.findLastIndex=kf,X.findLastKey=R,X.floor=WP,X.forEach=m_,X.forEachRight=fm,X.forIn=N,X.forInRight=U,X.forOwn=V,X.forOwnRight=q,X.get=Ce,X.gt=z_,X.gte=R_,X.has=de,X.hasIn=j,X.head=rm,X.identity=Co,X.includes=md,X.indexOf=Kg,X.inRange=Yi,X.invoke=Ne,X.isArguments=Rc,X.isArray=pn,X.isArrayBuffer=kl,X.isArrayLike=fo,X.isArrayLikeObject=Zr,X.isBoolean=D_,X.isBuffer=Ga,X.isDate=kv,X.isElement=Av,X.isEmpty=L_,X.isEqual=vd,X.isEqualWith=F_,X.isError=Hu,X.isFinite=O_,X.isFunction=ds,X.isInteger=xd,X.isLength=Dc,X.isMap=B_,X.isMatch=Xu,X.isMatchWith=Ci,X.isNaN=Al,X.isNative=Tm,X.isNil=j_,X.isNull=N_,X.isNumber=Of,X.isObject=Fr,X.isObjectLike=Gr,X.isPlainObject=bd,X.isRegExp=Bf,X.isSafeInteger=U_,X.isSet=V_,X.isString=wd,X.isSymbol=po,X.isTypedArray=zl,X.isUndefined=$_,X.isWeakMap=Sd,X.isWeakSet=Cm,X.join=nv,X.kebabCase=pr,X.last=us,X.lastIndexOf=rv,X.lowerCase=zs,X.lowerFirst=Ku,X.lt=Z_,X.lte=Pm,X.max=HP,X.maxBy=XP,X.mean=KP,X.meanBy=YP,X.min=JP,X.minBy=QP,X.stubArray=Uv,X.stubFalse=Vv,X.stubObject=BP,X.stubString=NP,X.stubTrue=jP,X.multiply=eE,X.nth=iv,X.noConflict=kP,X.noop=jv,X.now=Gu,X.pad=Rs,X.padEnd=zv,X.padStart=Yu,X.parseInt=Lc,X.random=Xo,X.reduce=Cv,X.reduceRight=Lf,X.repeat=Ju,X.replace=Qu,X.result=At,X.round=tE,X.runInContext=Ae,X.sample=Pv,X.size=Zu,X.snakeCase=eh,X.some=__,X.sortedIndex=zf,X.sortedIndexBy=av,X.sortedIndexOf=n_,X.sortedLastIndex=lv,X.sortedLastIndexBy=cv,X.sortedLastIndexOf=uv,X.startCase=W_,X.startsWith=H_,X.subtract=nE,X.sum=rE,X.sumBy=iE,X.template=X_,X.times=UP,X.toFinite=Wo,X.toInteger=mn,X.toLength=Nf,X.toLower=Em,X.toNumber=To,X.toSafeInteger=o,X.toString=n,X.toUpper=Mm,X.trim=qa,X.trimEnd=K_,X.trimStart=Y_,X.truncate=Rv,X.unescape=Dv,X.uniqueId=$P,X.upperCase=Lv,X.upperFirst=Im,X.each=m_,X.eachRight=fm,X.first=rm,fs(X,function(){var h={};return uo(X,function(m,C){Bt.call(X.prototype,C)||(h[C]=m)}),h}(),{chain:!1}),X.VERSION=p,Ai(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){X[h].placeholder=X}),Ai(["drop","take"],function(h,m){en.prototype[h]=function(C){C=C===a?1:Tr(mn(C),0);var z=this.__filtered__&&!m?new en(this):this.clone();return z.__filtered__?z.__takeCount__=Cn(C,z.__takeCount__):z.__views__.push({size:Cn(C,wt),type:h+(z.__dir__<0?"Right":"")}),z},en.prototype[h+"Right"]=function(C){return this.reverse()[h](C).reverse()}}),Ai(["filter","map","takeWhile"],function(h,m){var C=m+1,z=C==tn||C==Kt;en.prototype[h]=function(Z){var te=this.clone();return te.__iteratees__.push({iteratee:Yt(Z,3),type:C}),te.__filtered__=te.__filtered__||z,te}}),Ai(["head","last"],function(h,m){var C="take"+(m?"Right":"");en.prototype[h]=function(){return this[C](1).value()[0]}}),Ai(["initial","tail"],function(h,m){var C="drop"+(m?"":"Right");en.prototype[h]=function(){return this.__filtered__?new en(this):this[C](1)}}),en.prototype.compact=function(){return this.filter(Co)},en.prototype.find=function(h){return this.filter(h).head()},en.prototype.findLast=function(h){return this.reverse().find(h)},en.prototype.invokeMap=tt(function(h,m){return typeof h=="function"?new en(this):this.map(function(C){return la(C,h,m)})}),en.prototype.reject=function(h){return this.filter(As(Yt(h)))},en.prototype.slice=function(h,m){h=mn(h);var C=this;return C.__filtered__&&(h>0||m<0)?new en(C):(h<0?C=C.takeRight(-h):h&&(C=C.drop(h)),m!==a&&(m=mn(m),C=m<0?C.dropRight(-m):C.take(m-h)),C)},en.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},en.prototype.toArray=function(){return this.take(wt)},uo(en.prototype,function(h,m){var C=/^(?:filter|find|map|reject)|While$/.test(m),z=/^(?:head|last)$/.test(m),Z=X[z?"take"+(m=="last"?"Right":""):m],te=z||/^find/.test(m);Z&&(X.prototype[m]=function(){var _e=this.__wrapped__,Ee=z?[1]:arguments,Le=_e instanceof en,ut=Ee[0],ht=Le||pn(_e),gt=function(Un){var Gn=Z.apply(X,Ys([Un],Ee));return z&&kt?Gn[0]:Gn};ht&&C&&typeof ut=="function"&&ut.length!=1&&(Le=ht=!1);var kt=this.__chain__,Wt=!!this.__actions__.length,sn=te&&!kt,kn=Le&&!Wt;if(!te&&ht){_e=kn?_e:new en(this);var an=h.apply(_e,Ee);return an.__actions__.push({func:zc,args:[gt],thisArg:a}),new Ln(an,kt)}return sn&&kn?h.apply(this,Ee):(an=this.thru(gt),sn?z?an.value()[0]:an.value():an)})}),Ai(["pop","push","shift","sort","splice","unshift"],function(h){var m=uc[h],C=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",z=/^(?:pop|shift)$/.test(h);X.prototype[h]=function(){var Z=arguments;if(z&&!this.__chain__){var te=this.value();return m.apply(pn(te)?te:[],Z)}return this[C](function(_e){return m.apply(pn(_e)?_e:[],Z)})}}),uo(en.prototype,function(h,m){var C=X[m];if(C){var z=C.name+"";Bt.call(Da,z)||(Da[z]=[]),Da[z].push({name:m,func:C})}}),Da[Pl(a,he).name]=[{name:"wrapper",func:a}],en.prototype.clone=Zh,en.prototype.reverse=as,en.prototype.value=wl,X.prototype.at=Df,X.prototype.chain=gv,X.prototype.commit=_v,X.prototype.next=u_,X.prototype.plant=yv,X.prototype.reverse=d_,X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=f_,X.prototype.first=X.prototype.head,ea&&(X.prototype[ea]=h_),X},Qs=vu();kr?((kr.exports=Qs)._=Qs,ci._=Qs):Dr._=Qs}).call(Md)})(l0,l0.exports);var vk=l0.exports;const $d=bg(vk);var uC={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/(function(t,r){((a,p)=>{t.exports=p()})(Md,function a(){var p=typeof self<"u"?self:typeof window<"u"?window:p!==void 0?p:{},x,T=!p.document&&!!p.postMessage,b=p.IS_PAPA_WORKER||!1,l={},L=0,$={};function Q(ne){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(ye){var ke=it(ye);ke.chunkSize=parseInt(ke.chunkSize),ye.step||ye.chunk||(ke.chunkSize=null),this._handle=new et(ke),(this._handle.streamer=this)._config=ke}).call(this,ne),this.parseChunk=function(ye,ke){var st=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<st){let bt=this._config.newline;bt||(lt=this._config.quoteChar||'"',bt=this._handle.guessLineEndings(ye,lt)),ye=[...ye.split(bt).slice(st)].join(bt)}this.isFirstChunk&&we(this._config.beforeFirstChunk)&&(lt=this._config.beforeFirstChunk(ye))!==void 0&&(ye=lt),this.isFirstChunk=!1,this._halted=!1;var st=this._partialLine+ye,lt=(this._partialLine="",this._handle.parse(st,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(ye=lt.meta.cursor,st=(this._finished||(this._partialLine=st.substring(ye-this._baseIndex),this._baseIndex=ye),lt&&lt.data&&(this._rowCount+=lt.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),b)p.postMessage({results:lt,workerId:$.WORKER_ID,finished:st});else if(we(this._config.chunk)&&!ke){if(this._config.chunk(lt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=lt=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(lt.data),this._completeResults.errors=this._completeResults.errors.concat(lt.errors),this._completeResults.meta=lt.meta),this._completed||!st||!we(this._config.complete)||lt&&lt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),st||lt&&lt.meta.paused||this._nextChunk(),lt}this._halted=!0},this._sendError=function(ye){we(this._config.error)?this._config.error(ye):b&&this._config.error&&p.postMessage({workerId:$.WORKER_ID,error:ye,finished:!1})}}function ce(ne){var ye;(ne=ne||{}).chunkSize||(ne.chunkSize=$.RemoteChunkSize),Q.call(this,ne),this._nextChunk=T?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(ke){this._input=ke,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(ye=new XMLHttpRequest,this._config.withCredentials&&(ye.withCredentials=this._config.withCredentials),T||(ye.onload=qe(this._chunkLoaded,this),ye.onerror=qe(this._chunkError,this)),ye.open(this._config.downloadRequestBody?"POST":"GET",this._input,!T),this._config.downloadRequestHeaders){var ke,st=this._config.downloadRequestHeaders;for(ke in st)ye.setRequestHeader(ke,st[ke])}var lt;this._config.chunkSize&&(lt=this._start+this._config.chunkSize-1,ye.setRequestHeader("Range","bytes="+this._start+"-"+lt));try{ye.send(this._config.downloadRequestBody)}catch(bt){this._chunkError(bt.message)}T&&ye.status===0&&this._chunkError()}},this._chunkLoaded=function(){ye.readyState===4&&(ye.status<200||400<=ye.status?this._chunkError():(this._start+=this._config.chunkSize||ye.responseText.length,this._finished=!this._config.chunkSize||this._start>=(ke=>(ke=ke.getResponseHeader("Content-Range"))!==null?parseInt(ke.substring(ke.lastIndexOf("/")+1)):-1)(ye),this.parseChunk(ye.responseText)))},this._chunkError=function(ke){ke=ye.statusText||ke,this._sendError(new Error(ke))}}function oe(ne){(ne=ne||{}).chunkSize||(ne.chunkSize=$.LocalChunkSize),Q.call(this,ne);var ye,ke,st=typeof FileReader<"u";this.stream=function(lt){this._input=lt,ke=lt.slice||lt.webkitSlice||lt.mozSlice,st?((ye=new FileReader).onload=qe(this._chunkLoaded,this),ye.onerror=qe(this._chunkError,this)):ye=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var lt=this._input,bt=(this._config.chunkSize&&(bt=Math.min(this._start+this._config.chunkSize,this._input.size),lt=ke.call(lt,this._start,bt)),ye.readAsText(lt,this._config.encoding));st||this._chunkLoaded({target:{result:bt}})},this._chunkLoaded=function(lt){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(lt.target.result)},this._chunkError=function(){this._sendError(ye.error)}}function Y(ne){var ye;Q.call(this,ne=ne||{}),this.stream=function(ke){return ye=ke,this._nextChunk()},this._nextChunk=function(){var ke,st;if(!this._finished)return ke=this._config.chunkSize,ye=ke?(st=ye.substring(0,ke),ye.substring(ke)):(st=ye,""),this._finished=!ye,this.parseChunk(st)}}function Te(ne){Q.call(this,ne=ne||{});var ye=[],ke=!0,st=!1;this.pause=function(){Q.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Q.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(lt){this._input=lt,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){st&&ye.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),ye.length?this.parseChunk(ye.shift()):ke=!0},this._streamData=qe(function(lt){try{ye.push(typeof lt=="string"?lt:lt.toString(this._config.encoding)),ke&&(ke=!1,this._checkIsFinished(),this.parseChunk(ye.shift()))}catch(bt){this._streamError(bt)}},this),this._streamError=qe(function(lt){this._streamCleanUp(),this._sendError(lt)},this),this._streamEnd=qe(function(){this._streamCleanUp(),st=!0,this._streamData("")},this),this._streamCleanUp=qe(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function et(ne){var ye,ke,st,lt,bt=Math.pow(2,53),tn=-bt,lr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Kt=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Zt=this,dt=0,_t=0,Rt=!1,wt=!1,Dt=[],Tt={data:[],errors:[],meta:{}};function gn(rn){return ne.skipEmptyLines==="greedy"?rn.join("").trim()==="":rn.length===1&&rn[0].length===0}function nn(){if(Tt&&st&&(mr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+$.DefaultDelimiter+"'"),st=!1),ne.skipEmptyLines&&(Tt.data=Tt.data.filter(function(on){return!gn(on)})),Pn()){let on=function(Kn,qt){we(ne.transformHeader)&&(Kn=ne.transformHeader(Kn,qt)),Dt.push(Kn)};var Gt=on;if(Tt)if(Array.isArray(Tt.data[0])){for(var rn=0;Pn()&&rn<Tt.data.length;rn++)Tt.data[rn].forEach(on);Tt.data.splice(0,1)}else Tt.data.forEach(on)}function Qt(on,Kn){for(var qt=ne.header?{}:[],_n=0;_n<on.length;_n++){var ln=_n,En=on[_n],En=((yn,Bn)=>(Rn=>(ne.dynamicTypingFunction&&ne.dynamicTyping[Rn]===void 0&&(ne.dynamicTyping[Rn]=ne.dynamicTypingFunction(Rn)),(ne.dynamicTyping[Rn]||ne.dynamicTyping)===!0))(yn)?Bn==="true"||Bn==="TRUE"||Bn!=="false"&&Bn!=="FALSE"&&((Rn=>{if(lr.test(Rn)&&(Rn=parseFloat(Rn),tn<Rn&&Rn<bt))return 1})(Bn)?parseFloat(Bn):Kt.test(Bn)?new Date(Bn):Bn===""?null:Bn):Bn)(ln=ne.header?_n>=Dt.length?"__parsed_extra":Dt[_n]:ln,En=ne.transform?ne.transform(En,ln):En);ln==="__parsed_extra"?(qt[ln]=qt[ln]||[],qt[ln].push(En)):qt[ln]=En}return ne.header&&(_n>Dt.length?mr("FieldMismatch","TooManyFields","Too many fields: expected "+Dt.length+" fields but parsed "+_n,_t+Kn):_n<Dt.length&&mr("FieldMismatch","TooFewFields","Too few fields: expected "+Dt.length+" fields but parsed "+_n,_t+Kn)),qt}var tr;Tt&&(ne.header||ne.dynamicTyping||ne.transform)&&(tr=1,!Tt.data.length||Array.isArray(Tt.data[0])?(Tt.data=Tt.data.map(Qt),tr=Tt.data.length):Tt.data=Qt(Tt.data,0),ne.header&&Tt.meta&&(Tt.meta.fields=Dt),_t+=tr)}function Pn(){return ne.header&&Dt.length===0}function mr(rn,Qt,tr,Gt){rn={type:rn,code:Qt,message:tr},Gt!==void 0&&(rn.row=Gt),Tt.errors.push(rn)}we(ne.step)&&(lt=ne.step,ne.step=function(rn){Tt=rn,Pn()?nn():(nn(),Tt.data.length!==0&&(dt+=rn.data.length,ne.preview&&dt>ne.preview?ke.abort():(Tt.data=Tt.data[0],lt(Tt,Zt))))}),this.parse=function(rn,Qt,tr){var Gt=ne.quoteChar||'"',Gt=(ne.newline||(ne.newline=this.guessLineEndings(rn,Gt)),st=!1,ne.delimiter?we(ne.delimiter)&&(ne.delimiter=ne.delimiter(rn),Tt.meta.delimiter=ne.delimiter):((Gt=((on,Kn,qt,_n,ln)=>{var En,yn,Bn,Rn;ln=ln||[",","	","|",";",$.RECORD_SEP,$.UNIT_SEP];for(var nr=0;nr<ln.length;nr++){for(var zr,Si=ln[nr],vr=0,Rr=0,cr=0,rr=(Bn=void 0,new he({comments:_n,delimiter:Si,newline:Kn,preview:10}).parse(on)),xr=0;xr<rr.data.length;xr++)qt&&gn(rr.data[xr])?cr++:(zr=rr.data[xr].length,Rr+=zr,Bn===void 0?Bn=zr:0<zr&&(vr+=Math.abs(zr-Bn),Bn=zr));0<rr.data.length&&(Rr/=rr.data.length-cr),(yn===void 0||vr<=yn)&&(Rn===void 0||Rn<Rr)&&1.99<Rr&&(yn=vr,En=Si,Rn=Rr)}return{successful:!!(ne.delimiter=En),bestDelimiter:En}})(rn,ne.newline,ne.skipEmptyLines,ne.comments,ne.delimitersToGuess)).successful?ne.delimiter=Gt.bestDelimiter:(st=!0,ne.delimiter=$.DefaultDelimiter),Tt.meta.delimiter=ne.delimiter),it(ne));return ne.preview&&ne.header&&Gt.preview++,ye=rn,ke=new he(Gt),Tt=ke.parse(ye,Qt,tr),nn(),Rt?{meta:{paused:!0}}:Tt||{meta:{paused:!1}}},this.paused=function(){return Rt},this.pause=function(){Rt=!0,ke.abort(),ye=we(ne.chunk)?"":ye.substring(ke.getCharIndex())},this.resume=function(){Zt.streamer._halted?(Rt=!1,Zt.streamer.parseChunk(ye,!0)):setTimeout(Zt.resume,3)},this.aborted=function(){return wt},this.abort=function(){wt=!0,ke.abort(),Tt.meta.aborted=!0,we(ne.complete)&&ne.complete(Tt),ye=""},this.guessLineEndings=function(on,Gt){on=on.substring(0,1048576);var Gt=new RegExp(We(Gt)+"([^]*?)"+We(Gt),"gm"),tr=(on=on.replace(Gt,"")).split("\r"),Gt=on.split(`
`),on=1<Gt.length&&Gt[0].length<tr[0].length;if(tr.length===1||on)return`
`;for(var Kn=0,qt=0;qt<tr.length;qt++)tr[qt][0]===`
`&&Kn++;return Kn>=tr.length/2?`\r
`:"\r"}}function We(ne){return ne.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(ne){var ye=(ne=ne||{}).delimiter,ke=ne.newline,st=ne.comments,lt=ne.step,bt=ne.preview,tn=ne.fastMode,lr=null,Kt=!1,Zt=ne.quoteChar==null?'"':ne.quoteChar,dt=Zt;if(ne.escapeChar!==void 0&&(dt=ne.escapeChar),(typeof ye!="string"||-1<$.BAD_DELIMITERS.indexOf(ye))&&(ye=","),st===ye)throw new Error("Comment character same as delimiter");st===!0?st="#":(typeof st!="string"||-1<$.BAD_DELIMITERS.indexOf(st))&&(st=!1),ke!==`
`&&ke!=="\r"&&ke!==`\r
`&&(ke=`
`);var _t=0,Rt=!1;this.parse=function(wt,Dt,Tt){if(typeof wt!="string")throw new Error("Input must be a string");var gn=wt.length,nn=ye.length,Pn=ke.length,mr=st.length,rn=we(lt),Qt=[],tr=[],Gt=[],on=_t=0;if(!wt)return vr();if(tn||tn!==!1&&wt.indexOf(Zt)===-1){for(var Kn=wt.split(ke),qt=0;qt<Kn.length;qt++){if(Gt=Kn[qt],_t+=Gt.length,qt!==Kn.length-1)_t+=ke.length;else if(Tt)return vr();if(!st||Gt.substring(0,mr)!==st){if(rn){if(Qt=[],Rn(Gt.split(ye)),Rr(),Rt)return vr()}else Rn(Gt.split(ye));if(bt&&bt<=qt)return Qt=Qt.slice(0,bt),vr(!0)}}return vr()}for(var _n=wt.indexOf(ye,_t),ln=wt.indexOf(ke,_t),En=new RegExp(We(dt)+We(Zt),"g"),yn=wt.indexOf(Zt,_t);;)if(wt[_t]===Zt)for(yn=_t,_t++;;){if((yn=wt.indexOf(Zt,yn+1))===-1)return Tt||tr.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Qt.length,index:_t}),zr();if(yn===gn-1)return zr(wt.substring(_t,yn).replace(En,Zt));if(Zt===dt&&wt[yn+1]===dt)yn++;else if(Zt===dt||yn===0||wt[yn-1]!==dt){_n!==-1&&_n<yn+1&&(_n=wt.indexOf(ye,yn+1));var Bn=nr((ln=ln!==-1&&ln<yn+1?wt.indexOf(ke,yn+1):ln)===-1?_n:Math.min(_n,ln));if(wt.substr(yn+1+Bn,nn)===ye){Gt.push(wt.substring(_t,yn).replace(En,Zt)),wt[_t=yn+1+Bn+nn]!==Zt&&(yn=wt.indexOf(Zt,_t)),_n=wt.indexOf(ye,_t),ln=wt.indexOf(ke,_t);break}if(Bn=nr(ln),wt.substring(yn+1+Bn,yn+1+Bn+Pn)===ke){if(Gt.push(wt.substring(_t,yn).replace(En,Zt)),Si(yn+1+Bn+Pn),_n=wt.indexOf(ye,_t),yn=wt.indexOf(Zt,_t),rn&&(Rr(),Rt))return vr();if(bt&&Qt.length>=bt)return vr(!0);break}tr.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Qt.length,index:_t}),yn++}}else if(st&&Gt.length===0&&wt.substring(_t,_t+mr)===st){if(ln===-1)return vr();_t=ln+Pn,ln=wt.indexOf(ke,_t),_n=wt.indexOf(ye,_t)}else if(_n!==-1&&(_n<ln||ln===-1))Gt.push(wt.substring(_t,_n)),_t=_n+nn,_n=wt.indexOf(ye,_t);else{if(ln===-1)break;if(Gt.push(wt.substring(_t,ln)),Si(ln+Pn),rn&&(Rr(),Rt))return vr();if(bt&&Qt.length>=bt)return vr(!0)}return zr();function Rn(cr){Qt.push(cr),on=_t}function nr(cr){var rr=0;return rr=cr!==-1&&(cr=wt.substring(yn+1,cr))&&cr.trim()===""?cr.length:rr}function zr(cr){return Tt||(cr===void 0&&(cr=wt.substring(_t)),Gt.push(cr),_t=gn,Rn(Gt),rn&&Rr()),vr()}function Si(cr){_t=cr,Rn(Gt),Gt=[],ln=wt.indexOf(ke,_t)}function vr(cr){if(ne.header&&!Dt&&Qt.length&&!Kt){var rr=Qt[0],xr={},Bi=new Set(rr);let to=!1;for(let Ni=0;Ni<rr.length;Ni++){let Kr=rr[Ni];if(xr[Kr=we(ne.transformHeader)?ne.transformHeader(Kr,Ni):Kr]){let no,ji=xr[Kr];for(;no=Kr+"_"+ji,ji++,Bi.has(no););Bi.add(no),rr[Ni]=no,xr[Kr]++,to=!0,(lr=lr===null?{}:lr)[no]=Kr}else xr[Kr]=1,rr[Ni]=Kr;Bi.add(Kr)}to&&console.warn("Duplicate headers found and renamed."),Kt=!0}return{data:Qt,errors:tr,meta:{delimiter:ye,linebreak:ke,aborted:Rt,truncated:!!cr,cursor:on+(Dt||0),renamedHeaders:lr}}}function Rr(){lt(vr()),Qt=[],tr=[]}},this.abort=function(){Rt=!0},this.getCharIndex=function(){return _t}}function pe(ne){var ye=ne.data,ke=l[ye.workerId],st=!1;if(ye.error)ke.userError(ye.error,ye.file);else if(ye.results&&ye.results.data){var lt={abort:function(){st=!0,ve(ye.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Oe,resume:Oe};if(we(ke.userStep)){for(var bt=0;bt<ye.results.data.length&&(ke.userStep({data:ye.results.data[bt],errors:ye.results.errors,meta:ye.results.meta},lt),!st);bt++);delete ye.results}else we(ke.userChunk)&&(ke.userChunk(ye.results,lt,ye.file),delete ye.results)}ye.finished&&!st&&ve(ye.workerId,ye.results)}function ve(ne,ye){var ke=l[ne];we(ke.userComplete)&&ke.userComplete(ye),ke.terminate(),delete l[ne]}function Oe(){throw new Error("Not implemented.")}function it(ne){if(typeof ne!="object"||ne===null)return ne;var ye,ke=Array.isArray(ne)?[]:{};for(ye in ne)ke[ye]=it(ne[ye]);return ke}function qe(ne,ye){return function(){ne.apply(ye,arguments)}}function we(ne){return typeof ne=="function"}return $.parse=function(ne,ye){var ke=(ye=ye||{}).dynamicTyping||!1;if(we(ke)&&(ye.dynamicTypingFunction=ke,ke={}),ye.dynamicTyping=ke,ye.transform=!!we(ye.transform)&&ye.transform,!ye.worker||!$.WORKERS_SUPPORTED)return ke=null,$.NODE_STREAM_INPUT,typeof ne=="string"?(ne=(st=>st.charCodeAt(0)!==65279?st:st.slice(1))(ne),ke=new(ye.download?ce:Y)(ye)):ne.readable===!0&&we(ne.read)&&we(ne.on)?ke=new Te(ye):(p.File&&ne instanceof File||ne instanceof Object)&&(ke=new oe(ye)),ke.stream(ne);(ke=(()=>{var st;return!!$.WORKERS_SUPPORTED&&(st=(()=>{var lt=p.URL||p.webkitURL||null,bt=a.toString();return $.BLOB_URL||($.BLOB_URL=lt.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",bt,")();"],{type:"text/javascript"})))})(),(st=new p.Worker(st)).onmessage=pe,st.id=L++,l[st.id]=st)})()).userStep=ye.step,ke.userChunk=ye.chunk,ke.userComplete=ye.complete,ke.userError=ye.error,ye.step=we(ye.step),ye.chunk=we(ye.chunk),ye.complete=we(ye.complete),ye.error=we(ye.error),delete ye.worker,ke.postMessage({input:ne,config:ye,workerId:ke.id})},$.unparse=function(ne,ye){var ke=!1,st=!0,lt=",",bt=`\r
`,tn='"',lr=tn+tn,Kt=!1,Zt=null,dt=!1,_t=((()=>{if(typeof ye=="object"){if(typeof ye.delimiter!="string"||$.BAD_DELIMITERS.filter(function(Dt){return ye.delimiter.indexOf(Dt)!==-1}).length||(lt=ye.delimiter),typeof ye.quotes!="boolean"&&typeof ye.quotes!="function"&&!Array.isArray(ye.quotes)||(ke=ye.quotes),typeof ye.skipEmptyLines!="boolean"&&typeof ye.skipEmptyLines!="string"||(Kt=ye.skipEmptyLines),typeof ye.newline=="string"&&(bt=ye.newline),typeof ye.quoteChar=="string"&&(tn=ye.quoteChar),typeof ye.header=="boolean"&&(st=ye.header),Array.isArray(ye.columns)){if(ye.columns.length===0)throw new Error("Option columns is empty");Zt=ye.columns}ye.escapeChar!==void 0&&(lr=ye.escapeChar+tn),ye.escapeFormulae instanceof RegExp?dt=ye.escapeFormulae:typeof ye.escapeFormulae=="boolean"&&ye.escapeFormulae&&(dt=/^[=+\-@\t\r].*$/)}})(),new RegExp(We(tn),"g"));if(typeof ne=="string"&&(ne=JSON.parse(ne)),Array.isArray(ne)){if(!ne.length||Array.isArray(ne[0]))return Rt(null,ne,Kt);if(typeof ne[0]=="object")return Rt(Zt||Object.keys(ne[0]),ne,Kt)}else if(typeof ne=="object")return typeof ne.data=="string"&&(ne.data=JSON.parse(ne.data)),Array.isArray(ne.data)&&(ne.fields||(ne.fields=ne.meta&&ne.meta.fields||Zt),ne.fields||(ne.fields=Array.isArray(ne.data[0])?ne.fields:typeof ne.data[0]=="object"?Object.keys(ne.data[0]):[]),Array.isArray(ne.data[0])||typeof ne.data[0]=="object"||(ne.data=[ne.data])),Rt(ne.fields||[],ne.data||[],Kt);throw new Error("Unable to serialize unrecognized input");function Rt(Dt,Tt,gn){var nn="",Pn=(typeof Dt=="string"&&(Dt=JSON.parse(Dt)),typeof Tt=="string"&&(Tt=JSON.parse(Tt)),Array.isArray(Dt)&&0<Dt.length),mr=!Array.isArray(Tt[0]);if(Pn&&st){for(var rn=0;rn<Dt.length;rn++)0<rn&&(nn+=lt),nn+=wt(Dt[rn],rn);0<Tt.length&&(nn+=bt)}for(var Qt=0;Qt<Tt.length;Qt++){var tr=(Pn?Dt:Tt[Qt]).length,Gt=!1,on=Pn?Object.keys(Tt[Qt]).length===0:Tt[Qt].length===0;if(gn&&!Pn&&(Gt=gn==="greedy"?Tt[Qt].join("").trim()==="":Tt[Qt].length===1&&Tt[Qt][0].length===0),gn==="greedy"&&Pn){for(var Kn=[],qt=0;qt<tr;qt++){var _n=mr?Dt[qt]:qt;Kn.push(Tt[Qt][_n])}Gt=Kn.join("").trim()===""}if(!Gt){for(var ln=0;ln<tr;ln++){0<ln&&!on&&(nn+=lt);var En=Pn&&mr?Dt[ln]:ln;nn+=wt(Tt[Qt][En],ln)}Qt<Tt.length-1&&(!gn||0<tr&&!on)&&(nn+=bt)}}return nn}function wt(Dt,Tt){var gn,nn;return Dt==null?"":Dt.constructor===Date?JSON.stringify(Dt).slice(1,25):(nn=!1,dt&&typeof Dt=="string"&&dt.test(Dt)&&(Dt="'"+Dt,nn=!0),gn=Dt.toString().replace(_t,lr),(nn=nn||ke===!0||typeof ke=="function"&&ke(Dt,Tt)||Array.isArray(ke)&&ke[Tt]||((Pn,mr)=>{for(var rn=0;rn<mr.length;rn++)if(-1<Pn.indexOf(mr[rn]))return!0;return!1})(gn,$.BAD_DELIMITERS)||-1<gn.indexOf(lt)||gn.charAt(0)===" "||gn.charAt(gn.length-1)===" ")?tn+gn+tn:gn)}},$.RECORD_SEP="",$.UNIT_SEP="",$.BYTE_ORDER_MARK="\uFEFF",$.BAD_DELIMITERS=["\r",`
`,'"',$.BYTE_ORDER_MARK],$.WORKERS_SUPPORTED=!T&&!!p.Worker,$.NODE_STREAM_INPUT=1,$.LocalChunkSize=10485760,$.RemoteChunkSize=5242880,$.DefaultDelimiter=",",$.Parser=he,$.ParserHandle=et,$.NetworkStreamer=ce,$.FileStreamer=oe,$.StringStreamer=Y,$.ReadableStreamStreamer=Te,p.jQuery&&((x=p.jQuery).fn.parse=function(ne){var ye=ne.config||{},ke=[];return this.each(function(bt){if(!(x(this).prop("tagName").toUpperCase()==="INPUT"&&x(this).attr("type").toLowerCase()==="file"&&p.FileReader)||!this.files||this.files.length===0)return!0;for(var tn=0;tn<this.files.length;tn++)ke.push({file:this.files[tn],inputElem:this,instanceConfig:x.extend({},ye)})}),st(),this;function st(){if(ke.length===0)we(ne.complete)&&ne.complete();else{var bt,tn,lr,Kt,Zt=ke[0];if(we(ne.before)){var dt=ne.before(Zt.file,Zt.inputElem);if(typeof dt=="object"){if(dt.action==="abort")return bt="AbortError",tn=Zt.file,lr=Zt.inputElem,Kt=dt.reason,void(we(ne.error)&&ne.error({name:bt},tn,lr,Kt));if(dt.action==="skip")return void lt();typeof dt.config=="object"&&(Zt.instanceConfig=x.extend(Zt.instanceConfig,dt.config))}else if(dt==="skip")return void lt()}var _t=Zt.instanceConfig.complete;Zt.instanceConfig.complete=function(Rt){we(_t)&&_t(Rt,Zt.file,Zt.inputElem),lt()},$.parse(Zt.file,Zt.instanceConfig)}}function lt(){ke.splice(0,1),st()}}),b&&(p.onmessage=function(ne){ne=ne.data,$.WORKER_ID===void 0&&ne&&($.WORKER_ID=ne.workerId),typeof ne.input=="string"?p.postMessage({workerId:$.WORKER_ID,results:$.parse(ne.input,ne.config),finished:!0}):(p.File&&ne.input instanceof File||ne.input instanceof Object)&&(ne=$.parse(ne.input,ne.config))&&p.postMessage({workerId:$.WORKER_ID,results:ne,finished:!0})}),(ce.prototype=Object.create(Q.prototype)).constructor=ce,(oe.prototype=Object.create(Q.prototype)).constructor=oe,(Y.prototype=Object.create(Y.prototype)).constructor=Y,(Te.prototype=Object.create(Q.prototype)).constructor=Te,$})})(uC);var xk=uC.exports;const bk=bg(xk),wk=(async()=>{const t={};return(await bp()).forEach(a=>{t[a.codeIso3]=a}),t})(),Sk=(async()=>{const t={};for(const[r,a]of Object.entries(a0)){const p=(await a).default;t[r]={},p.forEach(x=>{t[r][x.stateCode]=x})}return t})(),hC=async t=>(await wk)[t]??null,dC=async(t,r)=>Vd(t)?(await Sk)[t][r]??null:null,c0=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Mo={INSTITUTIONAL_INFORMATION:"Institutional Information",DATASET_INFORMATION:"Dataset Information",ACCESSIBILITY:"Accessibility"},zb="Country Code",fC="State Code",Fy="B",Tk=c0.indexOf(Fy),Px="C",Ck=c0.indexOf(Px),Pk=[{name:"Name of Dataset",column:"A"},{name:zb,column:Fy},{name:fC,column:Px,hide:t=>!t},{name:"Country",column:Fy,category:Mo.INSTITUTIONAL_INFORMATION,transform:async t=>{const r=await hC(t);return(r==null?void 0:r.name)??null}},{name:"State",columns:[Fy,Px],category:Mo.INSTITUTIONAL_INFORMATION,transform:async([t,r])=>{const a=await dC(t,r);return(a==null?void 0:a.name)??null},hide:t=>!t},{name:"Institution",column:"D",category:Mo.INSTITUTIONAL_INFORMATION},{name:"Source",column:"E",category:Mo.INSTITUTIONAL_INFORMATION},{name:"URL",column:"F",category:Mo.INSTITUTIONAL_INFORMATION,transform:t=>t?ct.jsx("a",{href:t,target:"_",rel:"noreferrer",children:t}):null},{name:"Number of Participants",column:"G",category:Mo.DATASET_INFORMATION},{name:"Number of Samples",column:"H",category:Mo.DATASET_INFORMATION},{name:"Language",column:"L",category:Mo.DATASET_INFORMATION},{name:"Disease Category",column:"I",category:Mo.DATASET_INFORMATION},{name:"Diagnoses",column:"J",category:Mo.DATASET_INFORMATION},{name:"Speech Task(s)",column:"K",category:Mo.DATASET_INFORMATION},{name:"Speaker Details",column:"M",category:Mo.DATASET_INFORMATION},{name:"Demographics",column:"N",category:Mo.DATASET_INFORMATION},{name:"Accessibility",column:"O",category:Mo.ACCESSIBILITY},{name:"Access Instructions",column:"P",category:Mo.ACCESSIBILITY},{name:"License Types",column:"Q",category:Mo.ACCESSIBILITY}],Ek=async(t,r)=>{const p=`row ${r+2} (${t[0]})`,x=t[Tk];if(!x)return console.warn(`Skipping ${p} due to missing country code.`),null;if(hC(x)===null)return console.warn(`Skipping ${p} due to unknown country code (${x}).`),null;if(Vd(x)){const L=t[Ck];if(!L)return console.warn(`Skipping ${p} due to missing state code.`),null;if(dC(x,L)===null)return console.warn(`Skipping ${p} due to unknown state code (${L}) for country '${x}'.`),null}const l=[];for(const L of Pk){const{name:$,column:Q,columns:ce,category:oe}=L,Y=L.hide??(()=>!1),Te=L.transform??(he=>he);let et;if(Q){const he=c0.findIndex(pe=>pe===Q);et=t[he]}else if(ce)et=ce.map(he=>{const pe=c0.findIndex(ve=>ve===he);return t[pe]});else throw Error("Neither 'column' nor 'columns' defined.");const We=await Te(et);Y(We)||l.push({name:$,value:We,category:oe,hide:Y})}return l},Mk=(async()=>{let t=[],r=[];try{const p=await(await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRhVfbSe0_jQBHdqbssbutK2n77y0KyB5Th2E70C3whkSoxMFnuBfkD7xjnHU1VIA/pub?gid=1792955439&single=true&output=csv")).text(),{data:x}=bk.parse(p);r=x.slice(1)}catch(a){alert("Error loading datasets CSV."),console.error(a)}for(let a=0;a<r.length;a++){const p=r[a],x=await Ek(p,a);x!==null&&t.push(x)}return t})(),pC=async()=>await Mk,Ik=(async()=>{const t=await pC(),r={};for(const a of t){const x=$d.find(a,{name:zb}).value;r[x]??(r[x]=[]),r[x].push(a)}return r})(),kk=(async()=>{var a;const t=await pC(),r={};for(const p of t){const T=$d.find(p,{name:zb}).value,b=p.find(L=>L.name===fC);if(!b)continue;const l=b.value;r[T]??(r[T]={}),(a=r[T])[l]??(a[l]=[]),r[T][l].push(p)}return r})(),Rb=async()=>await Ik,mC=async()=>{const t=await Rb(),r={};for(const a in t){const p=t[a].length;r[a]=p}return r},gC=async t=>(await Rb())[t]??[],Ak=async t=>(await gC(t)).length,_C=async()=>{const t=await mC();return $d(t).values().maxBy()},yC=async t=>(await kk)[t]??{},vC=async t=>{const r=await yC(t),a={};for(const p in r){const x=r[p].length;a[p]=x}return a},xC=async(t,r)=>(await yC(t))[r]??[],zk=async(t,r)=>(await xC(t,r)).length,bC=async t=>{const r=await vC(t);return $d(r).values().maxBy()},Rk="_container_12zem_1",Dk="_title_12zem_6",Lk="_description_12zem_10",m1={container:Rk,title:Dk,description:Lk},Rd=({title:t,descriptions:r,children:a,className:p})=>ct.jsxs("div",{className:`${m1.container} ${p??""}`,children:[t!==void 0&&ct.jsx("h2",{className:m1.title,children:t}),r!==void 0&&r.map((x,T)=>ct.jsx("p",{className:m1.description,children:x},T)),a]});var wC={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},h2=Fl.createContext&&Fl.createContext(wC),Fk=["attr","size","title"];function Ok(t,r){if(t==null)return{};var a=Bk(t,r),p,x;if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(t);for(x=0;x<T.length;x++)p=T[x],!(r.indexOf(p)>=0)&&Object.prototype.propertyIsEnumerable.call(t,p)&&(a[p]=t[p])}return a}function Bk(t,r){if(t==null)return{};var a={};for(var p in t)if(Object.prototype.hasOwnProperty.call(t,p)){if(r.indexOf(p)>=0)continue;a[p]=t[p]}return a}function u0(){return u0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&(t[p]=a[p])}return t},u0.apply(this,arguments)}function d2(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);r&&(p=p.filter(function(x){return Object.getOwnPropertyDescriptor(t,x).enumerable})),a.push.apply(a,p)}return a}function h0(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?d2(Object(a),!0).forEach(function(p){Nk(t,p,a[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d2(Object(a)).forEach(function(p){Object.defineProperty(t,p,Object.getOwnPropertyDescriptor(a,p))})}return t}function Nk(t,r,a){return r=jk(r),r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function jk(t){var r=Uk(t,"string");return typeof r=="symbol"?r:r+""}function Uk(t,r){if(typeof t!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var p=a.call(t,r||"default");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function SC(t){return t&&t.map((r,a)=>Fl.createElement(r.tag,h0({key:a},r.attr),SC(r.child)))}function TC(t){return r=>Fl.createElement(Vk,u0({attr:h0({},t.attr)},r),SC(t.child))}function Vk(t){var r=a=>{var{attr:p,size:x,title:T}=t,b=Ok(t,Fk),l=x||a.size||"1em",L;return a.className&&(L=a.className),t.className&&(L=(L?L+" ":"")+t.className),Fl.createElement("svg",u0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,p,b,{className:L,style:h0(h0({color:t.color||a.color},a.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),T&&Fl.createElement("title",null,T),t.children)};return h2!==void 0?Fl.createElement(h2.Consumer,null,a=>r(a)):r(wC)}function $k(t){return TC({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(t)}function Zk(t){return TC({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(t)}const Gk="_container_ce3n2_1",qk="_back_ce3n2_5",Wk="_backText_ce3n2_17",g1={container:Gk,back:qk,backText:Wk},Hk=({onClick:t})=>ct.jsx(Rd,{className:g1.container,children:ct.jsxs("div",{className:g1.back,onClick:t,children:[ct.jsx($k,{size:12}),ct.jsx("div",{className:g1.backText,children:"Back"})]})}),Xk="_container_1d3e8_1",Kk="_header_1d3e8_5",Yk="_isExpanded_1d3e8_15",Jk="_title_1d3e8_20",Qk="_details_1d3e8_35",eA="_categoryTitle_1d3e8_51",tA="_categoryRows_1d3e8_57",nA="_categoryRow_1d3e8_57",rA="_categoryRowKey_1d3e8_73",iA="_categoryRowValue_1d3e8_82",oA="_arrow_1d3e8_87",Xa={container:Xk,header:Kk,isExpanded:Yk,title:Jk,details:Qk,categoryTitle:eA,categoryRows:tA,categoryRow:nA,categoryRowKey:rA,categoryRowValue:iA,arrow:oA},sA=({dataset:t})=>{const[r,a]=Lt.useState(!1),p=Lt.useMemo(()=>{const x=$d(t).groupBy("category").entries().filter(([T])=>T!=="undefined").value();return ct.jsx("div",{className:Xa.details,children:x.map(([T,b],l)=>ct.jsxs("div",{children:[ct.jsx("h3",{className:Xa.categoryTitle,children:T}),ct.jsx("div",{className:Xa.categoryRows,children:b.map((L,$)=>ct.jsxs("div",{className:Xa.categoryRow,children:[ct.jsxs("div",{className:Xa.categoryRowKey,children:[L.name,":"]}),ct.jsx("div",{className:Xa.categoryRowValue,children:L.value})]},`row-${$}`))})]},`category-${l}`))})},[t]);return t?ct.jsxs("div",{className:`${Xa.container} ${r?Xa.isExpanded:""}`,children:[ct.jsxs("div",{className:Xa.header,onClick:()=>a(!r),children:[ct.jsx("div",{className:Xa.title,children:t[0].value}),ct.jsx("div",{className:`${Xa.arrow}`,children:ct.jsx(Zk,{})})]}),r?p:null]}):null},CC=({title:t,extraDescriptions:r,getDatasets:a,onClickBack:p})=>{const[x,T]=Lt.useState(null);return Lt.useEffect(()=>{(async()=>{const b=await a(),l=b.length;T(ct.jsxs(ct.Fragment,{children:[ct.jsx(Hk,{onClick:p}),ct.jsx(Rd,{title:t,descriptions:[`Number of Datasets: ${l}`,...r]}),ct.jsx(Rd,{title:`Datasets (${l})`,children:b.map((L,$)=>ct.jsx(sA,{dataset:L},`${$}-${L[0].value}`))})]}))})()},[r,a,p,t]),x};function go(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var aA=typeof Symbol=="function"&&Symbol.observable||"@@observable",f2=aA,_1=()=>Math.random().toString(36).substring(7).split("").join("."),lA={INIT:`@@redux/INIT${_1()}`,REPLACE:`@@redux/REPLACE${_1()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${_1()}`},d0=lA;function Db(t){if(typeof t!="object"||t===null)return!1;let r=t;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(t)===r||Object.getPrototypeOf(t)===null}function PC(t,r,a){if(typeof t!="function")throw new Error(go(2));if(typeof r=="function"&&typeof a=="function"||typeof a=="function"&&typeof arguments[3]=="function")throw new Error(go(0));if(typeof r=="function"&&typeof a>"u"&&(a=r,r=void 0),typeof a<"u"){if(typeof a!="function")throw new Error(go(1));return a(PC)(t,r)}let p=t,x=r,T=new Map,b=T,l=0,L=!1;function $(){b===T&&(b=new Map,T.forEach((We,he)=>{b.set(he,We)}))}function Q(){if(L)throw new Error(go(3));return x}function ce(We){if(typeof We!="function")throw new Error(go(4));if(L)throw new Error(go(5));let he=!0;$();const pe=l++;return b.set(pe,We),function(){if(he){if(L)throw new Error(go(6));he=!1,$(),b.delete(pe),T=null}}}function oe(We){if(!Db(We))throw new Error(go(7));if(typeof We.type>"u")throw new Error(go(8));if(typeof We.type!="string")throw new Error(go(17));if(L)throw new Error(go(9));try{L=!0,x=p(x,We)}finally{L=!1}return(T=b).forEach(pe=>{pe()}),We}function Y(We){if(typeof We!="function")throw new Error(go(10));p=We,oe({type:d0.REPLACE})}function Te(){const We=ce;return{subscribe(he){if(typeof he!="object"||he===null)throw new Error(go(11));function pe(){const Oe=he;Oe.next&&Oe.next(Q())}return pe(),{unsubscribe:We(pe)}},[f2](){return this}}}return oe({type:d0.INIT}),{dispatch:oe,subscribe:ce,getState:Q,replaceReducer:Y,[f2]:Te}}function cA(t){Object.keys(t).forEach(r=>{const a=t[r];if(typeof a(void 0,{type:d0.INIT})>"u")throw new Error(go(12));if(typeof a(void 0,{type:d0.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(go(13))})}function uA(t){const r=Object.keys(t),a={};for(let T=0;T<r.length;T++){const b=r[T];typeof t[b]=="function"&&(a[b]=t[b])}const p=Object.keys(a);let x;try{cA(a)}catch(T){x=T}return function(b={},l){if(x)throw x;let L=!1;const $={};for(let Q=0;Q<p.length;Q++){const ce=p[Q],oe=a[ce],Y=b[ce],Te=oe(Y,l);if(typeof Te>"u")throw l&&l.type,new Error(go(14));$[ce]=Te,L=L||Te!==Y}return L=L||p.length!==Object.keys(b).length,L?$:b}}function f0(...t){return t.length===0?r=>r:t.length===1?t[0]:t.reduce((r,a)=>(...p)=>r(a(...p)))}function hA(...t){return r=>(a,p)=>{const x=r(a,p);let T=()=>{throw new Error(go(15))};const b={getState:x.getState,dispatch:(L,...$)=>T(L,...$)},l=t.map(L=>L(b));return T=f0(...l)(x.dispatch),{...x,dispatch:T}}}function dA(t){return Db(t)&&"type"in t&&typeof t.type=="string"}var EC=Symbol.for("immer-nothing"),p2=Symbol.for("immer-draftable"),$s=Symbol.for("immer-state");function Qa(t,...r){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var mp=Object.getPrototypeOf;function Zd(t){return!!t&&!!t[$s]}function Jc(t){var r;return t?MC(t)||Array.isArray(t)||!!t[p2]||!!((r=t.constructor)!=null&&r[p2])||B0(t)||N0(t):!1}var fA=Object.prototype.constructor.toString();function MC(t){if(!t||typeof t!="object")return!1;const r=mp(t);if(r===null)return!0;const a=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return a===Object?!0:typeof a=="function"&&Function.toString.call(a)===fA}function p0(t,r){O0(t)===0?Reflect.ownKeys(t).forEach(a=>{r(a,t[a],t)}):t.forEach((a,p)=>r(p,a,t))}function O0(t){const r=t[$s];return r?r.type_:Array.isArray(t)?1:B0(t)?2:N0(t)?3:0}function Ex(t,r){return O0(t)===2?t.has(r):Object.prototype.hasOwnProperty.call(t,r)}function IC(t,r,a){const p=O0(t);p===2?t.set(r,a):p===3?t.add(a):t[r]=a}function pA(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}function B0(t){return t instanceof Map}function N0(t){return t instanceof Set}function Ed(t){return t.copy_||t.base_}function Mx(t,r){if(B0(t))return new Map(t);if(N0(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const a=MC(t);if(r===!0||r==="class_only"&&!a){const p=Object.getOwnPropertyDescriptors(t);delete p[$s];let x=Reflect.ownKeys(p);for(let T=0;T<x.length;T++){const b=x[T],l=p[b];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(p[b]={configurable:!0,writable:!0,enumerable:l.enumerable,value:t[b]})}return Object.create(mp(t),p)}else{const p=mp(t);if(p!==null&&a)return{...t};const x=Object.create(p);return Object.assign(x,t)}}function Lb(t,r=!1){return j0(t)||Zd(t)||!Jc(t)||(O0(t)>1&&(t.set=t.add=t.clear=t.delete=mA),Object.freeze(t),r&&Object.entries(t).forEach(([a,p])=>Lb(p,!0))),t}function mA(){Qa(2)}function j0(t){return Object.isFrozen(t)}var gA={};function Gd(t){const r=gA[t];return r||Qa(0,t),r}var yg;function kC(){return yg}function _A(t,r){return{drafts_:[],parent_:t,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function m2(t,r){r&&(Gd("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=r)}function Ix(t){kx(t),t.drafts_.forEach(yA),t.drafts_=null}function kx(t){t===yg&&(yg=t.parent_)}function g2(t){return yg=_A(yg,t)}function yA(t){const r=t[$s];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function _2(t,r){r.unfinalizedDrafts_=r.drafts_.length;const a=r.drafts_[0];return t!==void 0&&t!==a?(a[$s].modified_&&(Ix(r),Qa(4)),Jc(t)&&(t=m0(r,t),r.parent_||g0(r,t)),r.patches_&&Gd("Patches").generateReplacementPatches_(a[$s].base_,t,r.patches_,r.inversePatches_)):t=m0(r,a,[]),Ix(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),t!==EC?t:void 0}function m0(t,r,a){if(j0(r))return r;const p=r[$s];if(!p)return p0(r,(x,T)=>y2(t,p,r,x,T,a)),r;if(p.scope_!==t)return r;if(!p.modified_)return g0(t,p.base_,!0),p.base_;if(!p.finalized_){p.finalized_=!0,p.scope_.unfinalizedDrafts_--;const x=p.copy_;let T=x,b=!1;p.type_===3&&(T=new Set(x),x.clear(),b=!0),p0(T,(l,L)=>y2(t,p,x,l,L,a,b)),g0(t,x,!1),a&&t.patches_&&Gd("Patches").generatePatches_(p,a,t.patches_,t.inversePatches_)}return p.copy_}function y2(t,r,a,p,x,T,b){if(Zd(x)){const l=T&&r&&r.type_!==3&&!Ex(r.assigned_,p)?T.concat(p):void 0,L=m0(t,x,l);if(IC(a,p,L),Zd(L))t.canAutoFreeze_=!1;else return}else b&&a.add(x);if(Jc(x)&&!j0(x)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;m0(t,x),(!r||!r.scope_.parent_)&&typeof p!="symbol"&&Object.prototype.propertyIsEnumerable.call(a,p)&&g0(t,x)}}function g0(t,r,a=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Lb(r,a)}function vA(t,r){const a=Array.isArray(t),p={type_:a?1:0,scope_:r?r.scope_:kC(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let x=p,T=Fb;a&&(x=[p],T=vg);const{revoke:b,proxy:l}=Proxy.revocable(x,T);return p.draft_=l,p.revoke_=b,l}var Fb={get(t,r){if(r===$s)return t;const a=Ed(t);if(!Ex(a,r))return xA(t,a,r);const p=a[r];return t.finalized_||!Jc(p)?p:p===y1(t.base_,r)?(v1(t),t.copy_[r]=zx(p,t)):p},has(t,r){return r in Ed(t)},ownKeys(t){return Reflect.ownKeys(Ed(t))},set(t,r,a){const p=AC(Ed(t),r);if(p!=null&&p.set)return p.set.call(t.draft_,a),!0;if(!t.modified_){const x=y1(Ed(t),r),T=x==null?void 0:x[$s];if(T&&T.base_===a)return t.copy_[r]=a,t.assigned_[r]=!1,!0;if(pA(a,x)&&(a!==void 0||Ex(t.base_,r)))return!0;v1(t),Ax(t)}return t.copy_[r]===a&&(a!==void 0||r in t.copy_)||Number.isNaN(a)&&Number.isNaN(t.copy_[r])||(t.copy_[r]=a,t.assigned_[r]=!0),!0},deleteProperty(t,r){return y1(t.base_,r)!==void 0||r in t.base_?(t.assigned_[r]=!1,v1(t),Ax(t)):delete t.assigned_[r],t.copy_&&delete t.copy_[r],!0},getOwnPropertyDescriptor(t,r){const a=Ed(t),p=Reflect.getOwnPropertyDescriptor(a,r);return p&&{writable:!0,configurable:t.type_!==1||r!=="length",enumerable:p.enumerable,value:a[r]}},defineProperty(){Qa(11)},getPrototypeOf(t){return mp(t.base_)},setPrototypeOf(){Qa(12)}},vg={};p0(Fb,(t,r)=>{vg[t]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}});vg.deleteProperty=function(t,r){return vg.set.call(this,t,r,void 0)};vg.set=function(t,r,a){return Fb.set.call(this,t[0],r,a,t[0])};function y1(t,r){const a=t[$s];return(a?Ed(a):t)[r]}function xA(t,r,a){var x;const p=AC(r,a);return p?"value"in p?p.value:(x=p.get)==null?void 0:x.call(t.draft_):void 0}function AC(t,r){if(!(r in t))return;let a=mp(t);for(;a;){const p=Object.getOwnPropertyDescriptor(a,r);if(p)return p;a=mp(a)}}function Ax(t){t.modified_||(t.modified_=!0,t.parent_&&Ax(t.parent_))}function v1(t){t.copy_||(t.copy_=Mx(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var bA=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,a,p)=>{if(typeof r=="function"&&typeof a!="function"){const T=a;a=r;const b=this;return function(L=T,...$){return b.produce(L,Q=>a.call(this,Q,...$))}}typeof a!="function"&&Qa(6),p!==void 0&&typeof p!="function"&&Qa(7);let x;if(Jc(r)){const T=g2(this),b=zx(r,void 0);let l=!0;try{x=a(b),l=!1}finally{l?Ix(T):kx(T)}return m2(T,p),_2(x,T)}else if(!r||typeof r!="object"){if(x=a(r),x===void 0&&(x=r),x===EC&&(x=void 0),this.autoFreeze_&&Lb(x,!0),p){const T=[],b=[];Gd("Patches").generateReplacementPatches_(r,x,T,b),p(T,b)}return x}else Qa(1,r)},this.produceWithPatches=(r,a)=>{if(typeof r=="function")return(b,...l)=>this.produceWithPatches(b,L=>r(L,...l));let p,x;return[this.produce(r,a,(b,l)=>{p=b,x=l}),p,x]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){Jc(t)||Qa(8),Zd(t)&&(t=wA(t));const r=g2(this),a=zx(t,void 0);return a[$s].isManual_=!0,kx(r),a}finishDraft(t,r){const a=t&&t[$s];(!a||!a.isManual_)&&Qa(9);const{scope_:p}=a;return m2(p,r),_2(void 0,p)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,r){let a;for(a=r.length-1;a>=0;a--){const x=r[a];if(x.path.length===0&&x.op==="replace"){t=x.value;break}}a>-1&&(r=r.slice(a+1));const p=Gd("Patches").applyPatches_;return Zd(t)?p(t,r):this.produce(t,x=>p(x,r))}};function zx(t,r){const a=B0(t)?Gd("MapSet").proxyMap_(t,r):N0(t)?Gd("MapSet").proxySet_(t,r):vA(t,r);return(r?r.scope_:kC()).drafts_.push(a),a}function wA(t){return Zd(t)||Qa(10,t),zC(t)}function zC(t){if(!Jc(t)||j0(t))return t;const r=t[$s];let a;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,a=Mx(t,r.scope_.immer_.useStrictShallowCopy_)}else a=Mx(t,!0);return p0(a,(p,x)=>{IC(a,p,zC(x))}),r&&(r.finalized_=!1),a}var Zs=new bA,RC=Zs.produce;Zs.produceWithPatches.bind(Zs);Zs.setAutoFreeze.bind(Zs);Zs.setUseStrictShallowCopy.bind(Zs);Zs.applyPatches.bind(Zs);Zs.createDraft.bind(Zs);Zs.finishDraft.bind(Zs);function DC(t){return({dispatch:a,getState:p})=>x=>T=>typeof T=="function"?T(a,p,t):x(T)}var SA=DC(),TA=DC,CA=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?f0:f0.apply(null,arguments)};function v2(t,r){function a(...p){if(r){let x=r(...p);if(!x)throw new Error(Nl(0));return{type:t,payload:x.payload,..."meta"in x&&{meta:x.meta},..."error"in x&&{error:x.error}}}return{type:t,payload:p[0]}}return a.toString=()=>`${t}`,a.type=t,a.match=p=>dA(p)&&p.type===t,a}var LC=class Zm extends Array{constructor(...r){super(...r),Object.setPrototypeOf(this,Zm.prototype)}static get[Symbol.species](){return Zm}concat(...r){return super.concat.apply(this,r)}prepend(...r){return r.length===1&&Array.isArray(r[0])?new Zm(...r[0].concat(this)):new Zm(...r.concat(this))}};function x2(t){return Jc(t)?RC(t,()=>{}):t}function b2(t,r,a){if(t.has(r)){let x=t.get(r);return a.update&&(x=a.update(x,r,t),t.set(r,x)),x}if(!a.insert)throw new Error(Nl(10));const p=a.insert(r,t);return t.set(r,p),p}function PA(t){return typeof t=="boolean"}var EA=()=>function(r){const{thunk:a=!0,immutableCheck:p=!0,serializableCheck:x=!0,actionCreatorCheck:T=!0}=r??{};let b=new LC;return a&&(PA(a)?b.push(SA):b.push(TA(a.extraArgument))),b},MA="RTK_autoBatch",FC=t=>r=>{setTimeout(r,t)},IA=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:FC(10),kA=(t={type:"raf"})=>r=>(...a)=>{const p=r(...a);let x=!0,T=!1,b=!1;const l=new Set,L=t.type==="tick"?queueMicrotask:t.type==="raf"?IA:t.type==="callback"?t.queueNotification:FC(t.timeout),$=()=>{b=!1,T&&(T=!1,l.forEach(Q=>Q()))};return Object.assign({},p,{subscribe(Q){const ce=()=>x&&Q(),oe=p.subscribe(ce);return l.add(Q),()=>{oe(),l.delete(Q)}},dispatch(Q){var ce;try{return x=!((ce=Q==null?void 0:Q.meta)!=null&&ce[MA]),T=!x,T&&(b||(b=!0,L($))),p.dispatch(Q)}finally{x=!0}}})},AA=t=>function(a){const{autoBatch:p=!0}=a??{};let x=new LC(t);return p&&x.push(kA(typeof p=="object"?p:void 0)),x};function zA(t){const r=EA(),{reducer:a=void 0,middleware:p,devTools:x=!0,preloadedState:T=void 0,enhancers:b=void 0}=t||{};let l;if(typeof a=="function")l=a;else if(Db(a))l=uA(a);else throw new Error(Nl(1));let L;typeof p=="function"?L=p(r):L=r();let $=f0;x&&($=CA({trace:!1,...typeof x=="object"&&x}));const Q=hA(...L),ce=AA(Q);let oe=typeof b=="function"?b(ce):ce();const Y=$(...oe);return PC(l,T,Y)}function OC(t){const r={},a=[];let p;const x={addCase(T,b){const l=typeof T=="string"?T:T.type;if(!l)throw new Error(Nl(28));if(l in r)throw new Error(Nl(29));return r[l]=b,x},addMatcher(T,b){return a.push({matcher:T,reducer:b}),x},addDefaultCase(T){return p=T,x}};return t(x),[r,a,p]}function RA(t){return typeof t=="function"}function DA(t,r){let[a,p,x]=OC(r),T;if(RA(t))T=()=>x2(t());else{const l=x2(t);T=()=>l}function b(l=T(),L){let $=[a[L.type],...p.filter(({matcher:Q})=>Q(L)).map(({reducer:Q})=>Q)];return $.filter(Q=>!!Q).length===0&&($=[x]),$.reduce((Q,ce)=>{if(ce)if(Zd(Q)){const Y=ce(Q,L);return Y===void 0?Q:Y}else{if(Jc(Q))return RC(Q,oe=>ce(oe,L));{const oe=ce(Q,L);if(oe===void 0){if(Q===null)return Q;throw Error("A case reducer on a non-draftable value must not return undefined")}return oe}}return Q},l)}return b.getInitialState=T,b}var LA=Symbol.for("rtk-slice-createasyncthunk");function FA(t,r){return`${t}/${r}`}function OA({creators:t}={}){var a;const r=(a=t==null?void 0:t.asyncThunk)==null?void 0:a[LA];return function(x){const{name:T,reducerPath:b=T}=x;if(!T)throw new Error(Nl(11));typeof process<"u";const l=(typeof x.reducers=="function"?x.reducers(jA()):x.reducers)||{},L=Object.keys(l),$={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},Q={addCase(ve,Oe){const it=typeof ve=="string"?ve:ve.type;if(!it)throw new Error(Nl(12));if(it in $.sliceCaseReducersByType)throw new Error(Nl(13));return $.sliceCaseReducersByType[it]=Oe,Q},addMatcher(ve,Oe){return $.sliceMatchers.push({matcher:ve,reducer:Oe}),Q},exposeAction(ve,Oe){return $.actionCreators[ve]=Oe,Q},exposeCaseReducer(ve,Oe){return $.sliceCaseReducersByName[ve]=Oe,Q}};L.forEach(ve=>{const Oe=l[ve],it={reducerName:ve,type:FA(T,ve),createNotation:typeof x.reducers=="function"};VA(Oe)?ZA(it,Oe,Q,r):UA(it,Oe,Q)});function ce(){const[ve={},Oe=[],it=void 0]=typeof x.extraReducers=="function"?OC(x.extraReducers):[x.extraReducers],qe={...ve,...$.sliceCaseReducersByType};return DA(x.initialState,we=>{for(let ne in qe)we.addCase(ne,qe[ne]);for(let ne of $.sliceMatchers)we.addMatcher(ne.matcher,ne.reducer);for(let ne of Oe)we.addMatcher(ne.matcher,ne.reducer);it&&we.addDefaultCase(it)})}const oe=ve=>ve,Y=new Map;let Te;function et(ve,Oe){return Te||(Te=ce()),Te(ve,Oe)}function We(){return Te||(Te=ce()),Te.getInitialState()}function he(ve,Oe=!1){function it(we){let ne=we[ve];return typeof ne>"u"&&Oe&&(ne=We()),ne}function qe(we=oe){const ne=b2(Y,Oe,{insert:()=>new WeakMap});return b2(ne,we,{insert:()=>{const ye={};for(const[ke,st]of Object.entries(x.selectors??{}))ye[ke]=BA(st,we,We,Oe);return ye}})}return{reducerPath:ve,getSelectors:qe,get selectors(){return qe(it)},selectSlice:it}}const pe={name:T,reducer:et,actions:$.actionCreators,caseReducers:$.sliceCaseReducersByName,getInitialState:We,...he(b),injectInto(ve,{reducerPath:Oe,...it}={}){const qe=Oe??b;return ve.inject({reducerPath:qe,reducer:et},it),{...pe,...he(qe,!0)}}};return pe}}function BA(t,r,a,p){function x(T,...b){let l=r(T);return typeof l>"u"&&p&&(l=a()),t(l,...b)}return x.unwrapped=t,x}var NA=OA();function jA(){function t(r,a){return{_reducerDefinitionType:"asyncThunk",payloadCreator:r,...a}}return t.withTypes=()=>t,{reducer(r){return Object.assign({[r.name](...a){return r(...a)}}[r.name],{_reducerDefinitionType:"reducer"})},preparedReducer(r,a){return{_reducerDefinitionType:"reducerWithPrepare",prepare:r,reducer:a}},asyncThunk:t}}function UA({type:t,reducerName:r,createNotation:a},p,x){let T,b;if("reducer"in p){if(a&&!$A(p))throw new Error(Nl(17));T=p.reducer,b=p.prepare}else T=p;x.addCase(t,T).exposeCaseReducer(r,T).exposeAction(r,b?v2(t,b):v2(t))}function VA(t){return t._reducerDefinitionType==="asyncThunk"}function $A(t){return t._reducerDefinitionType==="reducerWithPrepare"}function ZA({type:t,reducerName:r},a,p,x){if(!x)throw new Error(Nl(18));const{payloadCreator:T,fulfilled:b,pending:l,rejected:L,settled:$,options:Q}=a,ce=x(t,T,Q);p.exposeAction(r,ce),b&&p.addCase(ce.fulfilled,b),l&&p.addCase(ce.pending,l),L&&p.addCase(ce.rejected,L),$&&p.addMatcher(ce.settled,$),p.exposeCaseReducer(r,{fulfilled:b||vy,pending:l||vy,rejected:L||vy,settled:$||vy})}function vy(){}function Nl(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}const Ul=NA({name:"main",initialState:{isMapInitialized:!1,focusedCountry:null,focusedState:null,menuWidthPx:500},reducers:{setIsMapInitialized:(t,r)=>{t.isMapInitialized=r.payload},setFocusedCountry:(t,r)=>{t.focusedCountry=r.payload},setFocusedState:(t,r)=>{t.focusedState=r.payload},setMenuWidthPx:(t,r)=>{t.menuWidthPx=r.payload}}});var BC={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.2.0/LICENSE.txt
 */(function(t,r){(function(a,p){t.exports=p()})(Md,function(){var a={},p={};function x(b,l,L){if(p[b]=L,b==="index"){var $="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",Q={};return p.shared(Q),p.index(a,Q),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([$],{type:"text/javascript"}))),a}}x("shared",["exports"],function(b){function l(o,n,s,c){return new(s||(s=Promise))(function(f,y){function v(I){try{E(c.next(I))}catch(A){y(A)}}function S(I){try{E(c.throw(I))}catch(A){y(A)}}function E(I){var A;I.done?f(I.value):(A=I.value,A instanceof s?A:new s(function(R){R(A)})).then(v,S)}E((c=c.apply(o,n||[])).next())})}function L(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var $,Q;function ce(){if(Q)return $;function o(n,s){this.x=n,this.y=s}return Q=1,$=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,s){return this.clone()._rotateAround(n,s)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var s=n.x-this.x,c=n.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,s){return Math.atan2(this.x*s-this.y*n,this.x*n+this.y*s)},_matMult:function(n){var s=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var s=Math.cos(n),c=Math.sin(n),f=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=f,this},_rotateAround:function(n,s){var c=Math.cos(n),f=Math.sin(n),y=s.y+f*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-f*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(n){return n instanceof o?n:Array.isArray(n)?new o(n[0],n[1]):n},$}typeof SuppressedError=="function"&&SuppressedError;var oe,Y,Te=L(ce()),et=function(){if(Y)return oe;function o(n,s,c,f){this.cx=3*n,this.bx=3*(c-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=c,this.p2y=f}return Y=1,oe=o,o.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var c=n,f=0;f<8;f++){var y=this.sampleCurveX(c)-n;if(Math.abs(y)<s)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=y/v}var S=0,E=1;for(c=n,f=0;f<20&&(y=this.sampleCurveX(c),!(Math.abs(y-n)<s));f++)n>y?S=c:E=c,c=.5*(E-S)+S;return c},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},oe}(),We=L(et);let he,pe;function ve(){return he==null&&(he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),he}function Oe(){if(pe==null&&(pe=!1,ve())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let c=0;c<5*5;c++){const f=4*c;n.fillStyle=`rgb(${f},${f+1},${f+2})`,n.fillRect(c%5,Math.floor(c/5),1,1)}const s=n.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&s[c]!==c){pe=!0;break}}}return pe||!1}var it,qe=1e-6,we=typeof Float32Array<"u"?Float32Array:Array;function ne(){var o=new we(9);return we!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function ye(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ke(){var o=new we(3);return we!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function st(o,n,s){var c=new we(3);return c[0]=o,c[1]=n,c[2]=s,c}function lt(o,n,s){var c=n[0],f=n[1],y=n[2],v=n[3];return o[0]=s[0]*c+s[4]*f+s[8]*y+s[12]*v,o[1]=s[1]*c+s[5]*f+s[9]*y+s[13]*v,o[2]=s[2]*c+s[6]*f+s[10]*y+s[14]*v,o[3]=s[3]*c+s[7]*f+s[11]*y+s[15]*v,o}function bt(){var o=new we(4);return we!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function tn(){var o=new we(2);return we!=Float32Array&&(o[0]=0,o[1]=0),o}function lr(o,n){var s=new we(2);return s[0]=o,s[1]=n,s}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)}),ke(),it=new we(4),we!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0,it[3]=0),ke(),st(1,0,0),st(0,1,0),bt(),bt(),ne(),tn();const Kt=8192;function Zt(o,n,s){return n*(Kt/(o.tileSize*Math.pow(2,s-o.tileID.overscaledZ)))}function dt(o,n){return(o%n+n)%n}function _t(o,n,s){return o*(1-s)+n*s}function Rt(o){if(o<=0)return 0;if(o>=1)return 1;const n=o*o,s=n*o;return 4*(o<.5?s:3*(o-n)+s-.75)}function wt(o,n,s,c){const f=new We(o,n,s,c);return y=>f.solve(y)}const Dt=wt(.25,.1,.25,1);function Tt(o,n,s){return Math.min(s,Math.max(n,o))}function gn(o,n,s){const c=s-n,f=((o-n)%c+c)%c+n;return f===n?s:f}function nn(o,...n){for(const s of n)for(const c in s)o[c]=s[c];return o}let Pn=1;function mr(o,n,s){const c={};for(const f in o)c[f]=n.call(this,o[f],f,o);return c}function rn(o,n,s){const c={};for(const f in o)n.call(this,o[f],f,o)&&(c[f]=o[f]);return c}function Qt(o){return Array.isArray(o)?o.map(Qt):typeof o=="object"&&o?mr(o,Qt):o}const tr={};function Gt(o){tr[o]||(typeof console<"u"&&console.warn(o),tr[o]=!0)}function on(o,n,s){return(s.y-o.y)*(n.x-o.x)>(n.y-o.y)*(s.x-o.x)}function Kn(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let qt=null;function _n(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ln="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function En(o,n,s,c,f){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(o,{timestamp:0});try{const v=y==null?void 0:y.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const S=v.startsWith("BGR"),E=new Uint8ClampedArray(c*f*4);if(yield y.copyTo(E,function(I,A,R,N,U){const V=4*Math.max(1,0),q=(Math.max(0,R)-R)*N*4+V,J=4*N,ae=Math.max(0,A),Ce=Math.max(0,R);return{rect:{x:ae,y:Ce,width:Math.min(I.width,A+N)-ae,height:Math.min(I.height,R+U)-Ce},layout:[{offset:q,stride:J}]}}(o,n,s,c,f)),S)for(let I=0;I<E.length;I+=4){const A=E[I];E[I]=E[I+2],E[I+2]=A}return E}finally{y.close()}})}let yn,Bn;function Rn(o,n,s,c){return o.addEventListener(n,s,c),{unsubscribe:()=>{o.removeEventListener(n,s,c)}}}function nr(o){return o/Math.PI*180}const zr="AbortError";function Si(){return new Error(zr)}const vr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Rr(o){return vr.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const cr="global-dispatcher";class rr extends Error{constructor(n,s,c,f){super(`AJAXError: ${s} (${n}): ${c}`),this.status=n,this.statusText=s,this.url=c,this.body=f}}const xr=()=>Kn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Bi=function(o,n){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const c=Rr(o.url);if(c)return c(o,n);if(Kn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:cr},n)}if(!(/^file:/.test(s=o.url)||/^file:/.test(xr())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(c,f){return l(this,void 0,void 0,function*(){const y=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:xr(),signal:f.signal});let v,S;c.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{v=yield fetch(y)}catch(I){throw new rr(0,I.message,c.url,new Blob)}if(!v.ok){const I=yield v.blob();throw new rr(v.status,v.statusText,c.url,I)}S=c.type==="arrayBuffer"||c.type==="image"?v.arrayBuffer():c.type==="json"?v.json():v.text();const E=yield S;if(f.signal.aborted)throw Si();return{data:E,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(o,n);if(Kn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:cr},n)}var s;return function(c,f){return new Promise((y,v)=>{var S;const E=new XMLHttpRequest;E.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(E.responseType="arraybuffer");for(const I in c.headers)E.setRequestHeader(I,c.headers[I]);c.type==="json"&&(E.responseType="text",!((S=c.headers)===null||S===void 0)&&S.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=c.credentials==="include",E.onerror=()=>{v(new Error(E.statusText))},E.onload=()=>{if(!f.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(c.type==="json")try{I=JSON.parse(E.response)}catch(A){return void v(A)}y({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});v(new rr(E.status,E.statusText,c.url,I))}},f.signal.addEventListener("abort",()=>{E.abort(),v(Si())}),E.send(c.body)})}(o,n)};function to(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const n=new URL(o),s=window.location;return n.protocol===s.protocol&&n.host===s.host}function Ni(o,n,s){s[o]&&s[o].indexOf(n)!==-1||(s[o]=s[o]||[],s[o].push(n))}function Kr(o,n,s){if(s&&s[o]){const c=s[o].indexOf(n);c!==-1&&s[o].splice(c,1)}}class no{constructor(n,s={}){nn(this,s),this.type=n}}class ji extends no{constructor(n,s={}){super("error",nn({error:n},s))}}class ze{on(n,s){return this._listeners=this._listeners||{},Ni(n,s,this._listeners),{unsubscribe:()=>{this.off(n,s)}}}off(n,s){return Kr(n,s,this._listeners),Kr(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Ni(n,s,this._oneTimeListeners),this):new Promise(c=>this.once(n,c))}fire(n,s){typeof n=="string"&&(n=new no(n,s||{}));const c=n.type;if(this.listens(c)){n.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const S of f)S.call(this,n);const y=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const S of y)Kr(c,S,this._oneTimeListeners),S.call(this,n);const v=this._eventedParent;v&&(nn(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(n))}else n instanceof ji&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var F={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const H=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ee(o,n){const s={};for(const c in o)c!=="ref"&&(s[c]=o[c]);return H.forEach(c=>{c in n&&(s[c]=n[c])}),s}function le(o,n){if(Array.isArray(o)){if(!Array.isArray(n)||o.length!==n.length)return!1;for(let s=0;s<o.length;s++)if(!le(o[s],n[s]))return!1;return!0}if(typeof o=="object"&&o!==null&&n!==null){if(typeof n!="object"||Object.keys(o).length!==Object.keys(n).length)return!1;for(const s in o)if(!le(o[s],n[s]))return!1;return!0}return o===n}function xe(o,n){o.push(n)}function Ie(o,n,s){xe(s,{command:"addSource",args:[o,n[o]]})}function Ue(o,n,s){xe(n,{command:"removeSource",args:[o]}),s[o]=!0}function Me(o,n,s,c){Ue(o,s,c),Ie(o,n,s)}function Xe(o,n,s){let c;for(c in o[s])if(Object.prototype.hasOwnProperty.call(o[s],c)&&c!=="data"&&!le(o[s][c],n[s][c]))return!1;for(c in n[s])if(Object.prototype.hasOwnProperty.call(n[s],c)&&c!=="data"&&!le(o[s][c],n[s][c]))return!1;return!0}function $e(o,n,s,c,f,y){o=o||{},n=n||{};for(const v in o)Object.prototype.hasOwnProperty.call(o,v)&&(le(o[v],n[v])||s.push({command:y,args:[c,v,n[v],f]}));for(const v in n)Object.prototype.hasOwnProperty.call(n,v)&&!Object.prototype.hasOwnProperty.call(o,v)&&(le(o[v],n[v])||s.push({command:y,args:[c,v,n[v],f]}))}function Re(o){return o.id}function rt(o,n){return o[n.id]=n,o}class De{constructor(n,s,c,f){this.message=(n?`${n}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function yt(o,...n){for(const s of n)for(const c in s)o[c]=s[c];return o}class Ft extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Jt{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(n){return new Jt(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Ht={kind:"null"},Ke={kind:"number"},It={kind:"string"},Pt={kind:"boolean"},hn={kind:"color"},Xt={kind:"projectionDefinition"},dn={kind:"object"},Ut={kind:"value"},Sa={kind:"collator"},Nr={kind:"formatted"},jr={kind:"padding"},ur={kind:"resolvedImage"},tu={kind:"variableAnchorOffsetCollection"};function Ui(o,n){return{kind:"array",itemType:o,N:n}}function ir(o){if(o.kind==="array"){const n=ir(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}const Xd=[Ht,Ke,It,Pt,hn,Xt,Nr,dn,Ui(Ut),jr,ur,tu];function Vl(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Vl(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(const s of Xd)if(!Vl(s,n))return null}}return`Expected ${ir(o)} but found ${ir(n)} instead.`}function ol(o,n){return n.some(s=>s.kind===o.kind)}function Ws(o,n){return n.some(s=>s==="null"?o===null:s==="array"?Array.isArray(o):s==="object"?o&&!Array.isArray(o)&&typeof o=="object":s===typeof o)}function xs(o,n){return o.kind==="array"&&n.kind==="array"?o.itemType.kind===n.itemType.kind&&typeof o.N=="number":o.kind===n.kind}const Ch=.96422,Kd=.82521,Yd=4/29,Ta=6/29,Ph=3*Ta*Ta,Jd=Ta*Ta*Ta,Pp=Math.PI/180,Ep=180/Math.PI;function Eh(o){return(o%=360)<0&&(o+=360),o}function sl([o,n,s,c]){let f,y;const v=ru((.2225045*(o=nu(o))+.7168786*(n=nu(n))+.0606169*(s=nu(s)))/1);o===n&&n===s?f=y=v:(f=ru((.4360747*o+.3850649*n+.1430804*s)/Ch),y=ru((.0139322*o+.0971045*n+.7141733*s)/Kd));const S=116*v-16;return[S<0?0:S,500*(f-v),200*(v-y),c]}function nu(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function ru(o){return o>Jd?Math.pow(o,1/3):o/Ph+Yd}function Ca([o,n,s,c]){let f=(o+16)/116,y=isNaN(n)?f:f+n/500,v=isNaN(s)?f:f-s/200;return f=1*Mh(f),y=Ch*Mh(y),v=Kd*Mh(v),[$l(3.1338561*y-1.6168667*f-.4906146*v),$l(-.9787684*y+1.9161415*f+.033454*v),$l(.0719453*y-.2289914*f+1.4052427*v),c]}function $l(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Mh(o){return o>Ta?o*o*o:Ph*(o-Yd)}function Zl(o){return parseInt(o.padEnd(2,o),16)/255}function al(o,n){return Hs(n?o/100:o,0,1)}function Hs(o,n,s){return Math.min(Math.max(n,o),s)}function zo(o){return!o.some(Number.isNaN)}const Mn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Vi(o,n,s){return o+s*(n-o)}function $i(o,n,s){return o.map((c,f)=>Vi(c,n[f],s))}class An{constructor(n,s,c,f=1,y=!0){this.r=n,this.g=s,this.b=c,this.a=f,y||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[n,s,c,f]))}static parse(n){if(n instanceof An)return n;if(typeof n!="string")return;const s=function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=Mn[c];if(f){const[v,S,E]=f;return[v/255,S/255,E/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const v=c.length<6?1:2;let S=1;return[Zl(c.slice(S,S+=v)),Zl(c.slice(S,S+=v)),Zl(c.slice(S,S+=v)),Zl(c.slice(S,S+v)||"ff")]}if(c.startsWith("rgb")){const v=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[S,E,I,A,R,N,U,V,q,J,ae,Ce]=v,de=[A||" ",U||" ",J].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const j=[I,N,q].join(""),K=j==="%%%"?100:j===""?255:0;if(K){const fe=[Hs(+E/K,0,1),Hs(+R/K,0,1),Hs(+V/K,0,1),ae?al(+ae,Ce):1];if(zo(fe))return fe}}return}}const y=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,S,E,I,A,R,N,U,V]=y,q=[E||" ",A||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const J=[+S,Hs(+I,0,100),Hs(+R,0,100),U?al(+U,V):1];if(zo(J))return function([ae,Ce,de,j]){function K(fe){const Ne=(fe+ae/30)%12,Je=Ce*Math.min(de,1-de);return de-Je*Math.max(-1,Math.min(Ne-3,9-Ne,1))}return ae=Eh(ae),Ce/=100,de/=100,[K(0),K(8),K(4),j]}(J)}}}(n);return s?new An(...s,!1):void 0}get rgb(){const{r:n,g:s,b:c,a:f}=this,y=f||1/0;return this.overwriteGetter("rgb",[n/y,s/y,c/y,f])}get hcl(){return this.overwriteGetter("hcl",function(n){const[s,c,f,y]=sl(n),v=Math.sqrt(c*c+f*f);return[Math.round(1e4*v)?Eh(Math.atan2(f,c)*Ep):NaN,v,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",sl(this.rgb))}overwriteGetter(n,s){return Object.defineProperty(this,n,{value:s}),s}toString(){const[n,s,c,f]=this.rgb;return`rgba(${[n,s,c].map(y=>Math.round(255*y)).join(",")},${f})`}static interpolate(n,s,c,f="rgb"){switch(f){case"rgb":{const[y,v,S,E]=$i(n.rgb,s.rgb,c);return new An(y,v,S,E,!1)}case"hcl":{const[y,v,S,E]=n.hcl,[I,A,R,N]=s.hcl;let U,V;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?U=NaN:(U=I,S!==1&&S!==0||(V=A)):(U=y,R!==1&&R!==0||(V=v));else{let de=I-y;I>y&&de>180?de-=360:I<y&&y-I>180&&(de+=360),U=y+c*de}const[q,J,ae,Ce]=function([de,j,K,fe]){return de=isNaN(de)?0:de*Pp,Ca([K,Math.cos(de)*j,Math.sin(de)*j,fe])}([U,V??Vi(v,A,c),Vi(S,R,c),Vi(E,N,c)]);return new An(q,J,ae,Ce,!1)}case"lab":{const[y,v,S,E]=Ca($i(n.lab,s.lab,c));return new An(y,v,S,E,!1)}}}}An.black=new An(0,0,0,1),An.white=new An(1,1,1,1),An.transparent=new An(0,0,0,0),An.red=new An(1,0,0,1);class Gl{constructor(n,s,c){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ql=["bottom","center","top"];class Zi{constructor(n,s,c,f,y,v){this.text=n,this.image=s,this.scale=c,this.fontStack=f,this.textColor=y,this.verticalAlign=v}}class Ir{constructor(n){this.sections=n}static fromString(n){return new Ir([new Zi(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Ir?n:Ir.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Yr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Yr)return n;if(typeof n=="number")return new Yr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const s of n)if(typeof s!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Yr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,c){return new Yr($i(n.values,s.values,c))}}class br{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Ih=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Jr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Jr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let s=0;s<n.length;s+=2){const c=n[s],f=n[s+1];if(typeof c!="string"||!Ih.has(c)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new Jr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,s,c){const f=n.values,y=s.values;if(f.length!==y.length)throw new br(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${s.toString()}`);const v=[];for(let S=0;S<f.length;S+=2){if(f[S]!==y[S])throw new br(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${f[S]}, to[${S}]: ${y[S]}`);v.push(f[S]);const[E,I]=f[S+1],[A,R]=y[S+1];v.push([Vi(E,A,c),Vi(I,R,c)])}return new Jr(v)}}class Ti{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Ti({name:n,available:!1}):null}}class Ii{constructor(n,s,c){this.from=n,this.to=s,this.transition=c}static interpolate(n,s,c){return new Ii(n,s,c)}static parse(n){return n instanceof Ii?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new Ii(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new Ii(n.from,n.to,n.transition):typeof n=="string"?new Ii(n,n,1):void 0}}function Wl(o,n,s,c){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,n,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,n,s,c]:[o,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ro(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ii||o instanceof An||o instanceof Gl||o instanceof Ir||o instanceof Yr||o instanceof Jr||o instanceof Ti)return!0;if(Array.isArray(o)){for(const n of o)if(!Ro(n))return!1;return!0}if(typeof o=="object"){for(const n in o)if(!Ro(o[n]))return!1;return!0}return!1}function Ur(o){if(o===null)return Ht;if(typeof o=="string")return It;if(typeof o=="boolean")return Pt;if(typeof o=="number")return Ke;if(o instanceof An)return hn;if(o instanceof Ii)return Xt;if(o instanceof Gl)return Sa;if(o instanceof Ir)return Nr;if(o instanceof Yr)return jr;if(o instanceof Jr)return tu;if(o instanceof Ti)return ur;if(Array.isArray(o)){const n=o.length;let s;for(const c of o){const f=Ur(c);if(s){if(s===f)continue;s=Ut;break}s=f}return Ui(s||Ut,n)}return dn}function Xs(o){const n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof An||o instanceof Ii||o instanceof Ir||o instanceof Yr||o instanceof Jr||o instanceof Ti?o.toString():JSON.stringify(o)}class ro{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ro(n[1]))return s.error("invalid value");const c=n[1];let f=Ur(c);const y=s.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new ro(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Hl={string:It,number:Ke,boolean:Pt,object:dn};class xo{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let c,f=1;const y=n[0];if(y==="array"){let S,E;if(n.length>2){const I=n[1];if(typeof I!="string"||!(I in Hl)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=Hl[I],f++}else S=Ut;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=n[2],f++}c=Ui(S,E)}else{if(!Hl[y])throw new Error(`Types doesn't contain name = ${y}`);c=Hl[y]}const v=[];for(;f<n.length;f++){const S=s.parse(n[f],f,Ut);if(!S)return null;v.push(S)}return new xo(c,v)}evaluate(n){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(n);if(!Vl(this.type,Ur(c)))return c;if(s===this.args.length-1)throw new br(`Expected value to be of type ${ir(this.type)}, but found ${ir(Ur(c))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const kh={"to-boolean":Pt,"to-color":hn,"to-number":Ke,"to-string":It};class Do{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[0];if(!kh[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&n.length!==2)return s.error("Expected one argument.");const f=kh[c],y=[];for(let v=1;v<n.length;v++){const S=s.parse(n[v],v,Ut);if(!S)return null;y.push(S)}return new Do(f,y)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let s,c;for(const f of this.args){if(s=f.evaluate(n),c=null,s instanceof An)return s;if(typeof s=="string"){const y=n.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Wl(s[0],s[1],s[2],s[3]),!c))return new An(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new br(c||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const c of this.args){s=c.evaluate(n);const f=Yr.parse(s);if(f)return f}throw new br(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const c of this.args){s=c.evaluate(n);const f=Jr.parse(s);if(f)return f}throw new br(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const c of this.args){if(s=c.evaluate(n),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new br(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Ir.fromString(Xs(this.args[0].evaluate(n)));case"resolvedImage":return Ti.fromString(Xs(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return Xs(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const sr=["Unknown","Point","LineString","Polygon"];class iu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?sr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=An.parse(n)),s}}class Sn{constructor(n,s,c=[],f,y=new Jt,v=[]){this.registry=n,this.path=c,this.key=c.map(S=>`[${S}]`).join(""),this.scope=y,this.errors=v,this.expectedType=f,this._isConstant=s}parse(n,s,c,f,y={}){return s?this.concat(s,c,f)._parse(n,y):this._parse(n,y)}_parse(n,s){function c(f,y,v){return v==="assert"?new xo(y,[f]):v==="coerce"?new Do(y,[f]):f}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=n[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[f];if(y){let v=y.parse(n,this);if(!v)return null;if(this.expectedType){const S=this.expectedType,E=v.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||E.kind!=="value")if(S.kind!=="projectionDefinition"||E.kind!=="string"&&E.kind!=="array")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(S.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(S.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(S,E))return null}else v=c(v,S,s.typeAnnotation||"coerce");else v=c(v,S,s.typeAnnotation||"coerce");else v=c(v,S,s.typeAnnotation||"coerce");else v=c(v,S,s.typeAnnotation||"coerce");else v=c(v,S,s.typeAnnotation||"assert")}if(!(v instanceof ro)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const S=new iu;try{v=new ro(v.type,v.evaluate(S))}catch(E){return this.error(E.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,c){const f=typeof n=="number"?this.path.concat(n):this.path,y=c?this.scope.concat(c):this.scope;return new Sn(this.registry,this._isConstant,f,s||null,y,this.errors)}error(n,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ft(c,n))}checkSubtype(n,s){const c=Vl(n,s);return c&&this.error(c),c}}class cn{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let y=1;y<n.length-1;y+=2){const v=n[y];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=s.parse(n[y+1],y+1);if(!S)return null;c.push([v,S])}const f=s.parse(n[n.length-1],n.length-1,s.expectedType,c);return f?new cn(c,f):null}outputDefined(){return this.result.outputDefined()}}class ll{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=n[1];return s.scope.has(c)?new ll(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class In{constructor(n,s,c){this.type=n,this.index=s,this.input=c}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Ke),f=s.parse(n[2],2,Ui(s.expectedType||Ut));return c&&f?new In(f.type.itemType,c,f):null}evaluate(n){const s=this.index.evaluate(n),c=this.input.evaluate(n);if(s<0)throw new br(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new br(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new br(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Yn{constructor(n,s){this.type=Pt,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Ut),f=s.parse(n[2],2,Ut);return c&&f?ol(c.type,[Pt,It,Ke,Ht,Ut])?new Yn(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${ir(c.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!c)return!1;if(!Ws(s,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${ir(Ur(s))} instead.`);if(!Ws(c,["string","array"]))throw new br(`Expected second argument to be of type array or string, but found ${ir(Ur(c))} instead.`);return c.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Tn{constructor(n,s,c){this.type=Ke,this.needle=n,this.haystack=s,this.fromIndex=c}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Ut),f=s.parse(n[2],2,Ut);if(!c||!f)return null;if(!ol(c.type,[Pt,It,Ke,Ht,Ut]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${ir(c.type)} instead`);if(n.length===4){const y=s.parse(n[3],3,Ke);return y?new Tn(c,f,y):null}return new Tn(c,f)}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!Ws(s,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${ir(Ur(s))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(n)),Ws(c,["string"])){const y=c.indexOf(s,f);return y===-1?-1:[...c.slice(0,y)].length}if(Ws(c,["array"]))return c.indexOf(s,f);throw new br(`Expected second argument to be of type array or string, but found ${ir(Ur(c))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Xl{constructor(n,s,c,f,y,v){this.inputType=n,this.type=s,this.input=c,this.cases=f,this.outputs=y,this.otherwise=v}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const y={},v=[];for(let I=2;I<n.length-1;I+=2){let A=n[I];const R=n[I+1];Array.isArray(A)||(A=[A]);const N=s.concat(I);if(A.length===0)return N.error("Expected at least one branch label.");for(const V of A){if(typeof V!="number"&&typeof V!="string")return N.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return N.error("Numeric branch labels must be integer values.");if(c){if(N.checkSubtype(c,Ur(V)))return null}else c=Ur(V);if(y[String(V)]!==void 0)return N.error("Branch labels must be unique.");y[String(V)]=v.length}const U=s.parse(R,I,f);if(!U)return null;f=f||U.type,v.push(U)}const S=s.parse(n[1],1,Ut);if(!S)return null;const E=s.parse(n[n.length-1],n.length-1,f);return E?S.type.kind!=="value"&&s.concat(1).checkSubtype(c,S.type)?null:new Xl(c,f,S,y,v,E):null}evaluate(n){const s=this.input.evaluate(n);return(Ur(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class ou{constructor(n,s,c){this.type=n,this.branches=s,this.otherwise=c}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let v=1;v<n.length-1;v+=2){const S=s.parse(n[v],v,Pt);if(!S)return null;const E=s.parse(n[v+1],v+1,c);if(!E)return null;f.push([S,E]),c=c||E.type}const y=s.parse(n[n.length-1],n.length-1,c);if(!y)return null;if(!c)throw new Error("Can't infer output type");return new ou(c,f,y)}evaluate(n){for(const[s,c]of this.branches)if(s.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,c]of this.branches)n(s),n(c);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class Kl{constructor(n,s,c,f){this.type=n,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Ut),f=s.parse(n[2],2,Ke);if(!c||!f)return null;if(!ol(c.type,[Ui(Ut),It,Ut]))return s.error(`Expected first argument to be of type array or string, but found ${ir(c.type)} instead`);if(n.length===4){const y=s.parse(n[3],3,Ke);return y?new Kl(c.type,c,f,y):null}return new Kl(c.type,c,f)}evaluate(n){const s=this.input.evaluate(n),c=this.beginIndex.evaluate(n);let f;if(this.endIndex&&(f=this.endIndex.evaluate(n)),Ws(s,["string"]))return[...s].slice(c,f).join("");if(Ws(s,["array"]))return s.slice(c,f);throw new br(`Expected first argument to be of type array or string, but found ${ir(Ur(s))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function cl(o,n){const s=o.length-1;let c,f,y=0,v=s,S=0;for(;y<=v;)if(S=Math.floor((y+v)/2),c=o[S],f=o[S+1],c<=n){if(S===s||n<f)return S;y=S+1}else{if(!(c>n))throw new br("Input is not a number.");v=S-1}return 0}class ul{constructor(n,s,c){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[f,y]of c)this.labels.push(f),this.outputs.push(y)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(n[1],1,Ke);if(!c)return null;const f=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let v=1;v<n.length;v+=2){const S=v===1?-1/0:n[v],E=n[v+1],I=v,A=v+1;if(typeof S!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(f.length&&f[f.length-1][0]>=S)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const R=s.parse(E,A,y);if(!R)return null;y=y||R.type,f.push([S,R])}return new ul(y,c,f)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const f=this.input.evaluate(n);if(f<=s[0])return c[0].evaluate(n);const y=s.length;return f>=s[y-1]?c[y-1].evaluate(n):c[cl(s,f)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Mp(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Yl,Ah,Dr=function(){if(Ah)return Yl;function o(n,s,c,f){this.cx=3*n,this.bx=3*(c-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=c,this.p2y=f}return Ah=1,Yl=o,o.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var c=n,f=0;f<8;f++){var y=this.sampleCurveX(c)-n;if(Math.abs(y)<s)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=y/v}var S=0,E=1;for(c=n,f=0;f<20&&(y=this.sampleCurveX(c),!(Math.abs(y-n)<s));f++)n>y?S=c:E=c,c=.5*(E-S)+S;return c},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},Yl}(),ci=Mp(Dr);class kr{constructor(n,s,c,f,y){this.type=n,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[v,S]of y)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(n,s,c,f){let y=0;if(n.name==="exponential")y=Jl(s,n.base,c,f);else if(n.name==="linear")y=Jl(s,1,c,f);else if(n.name==="cubic-bezier"){const v=n.controlPoints;y=new ci(v[0],v[1],v[2],v[3]).solve(Jl(s,1,c,f))}return y}static parse(n,s){let[c,f,y,...v]=n;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const I=f[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:I}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const I=f.slice(1);if(I.length!==4||I.some(A=>typeof A!="number"||A<0||A>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:I}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Ke),!y)return null;const S=[];let E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=hn:s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let I=0;I<v.length;I+=2){const A=v[I],R=v[I+1],N=I+3,U=I+4;if(typeof A!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(S.length&&S[S.length-1][0]>=A)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const V=s.parse(R,U,E);if(!V)return null;E=E||V.type,S.push([A,V])}return xs(E,Ke)||xs(E,Xt)||xs(E,hn)||xs(E,jr)||xs(E,tu)||xs(E,Ui(Ke))?new kr(E,c,f,y,S):s.error(`Type ${ir(E)} is not interpolatable.`)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const f=this.input.evaluate(n);if(f<=s[0])return c[0].evaluate(n);const y=s.length;if(f>=s[y-1])return c[y-1].evaluate(n);const v=cl(s,f),S=kr.interpolationFactor(this.interpolation,f,s[v],s[v+1]),E=c[v].evaluate(n),I=c[v+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Vi(E,I,S);case"color":return An.interpolate(E,I,S);case"padding":return Yr.interpolate(E,I,S);case"variableAnchorOffsetCollection":return Jr.interpolate(E,I,S);case"array":return $i(E,I,S);case"projectionDefinition":return Ii.interpolate(E,I,S)}case"interpolate-hcl":return An.interpolate(E,I,S,"hcl");case"interpolate-lab":return An.interpolate(E,I,S,"lab")}}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Jl(o,n,s,c){const f=c-s,y=o-s;return f===0?0:n===1?y/f:(Math.pow(n,y)-1)/(Math.pow(n,f)-1)}const ki={color:An.interpolate,number:Vi,padding:Yr.interpolate,variableAnchorOffsetCollection:Jr.interpolate,array:$i};class $n{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const y=[];for(const S of n.slice(1)){const E=s.parse(S,1+y.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,y.push(E)}if(!c)throw new Error("No output type");const v=f&&y.some(S=>Vl(f,S.type));return new $n(v?Ut:c,y)}evaluate(n){let s,c=null,f=0;for(const y of this.args)if(f++,c=y.evaluate(n),c&&c instanceof Ti&&!c.available&&(s||(s=c.name),c=null,f===this.args.length&&(c=s)),c!==null)break;return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function su(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Ql(o,n,s,c){return c.compare(n,s)===0}function Ks(o,n,s){const c=o!=="=="&&o!=="!=";return class NC{constructor(y,v,S){this.type=Pt,this.lhs=y,this.rhs=v,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const S=y[0];let E=v.parse(y[1],1,Ut);if(!E)return null;if(!su(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${ir(E.type)}'.`);let I=v.parse(y[2],2,Ut);if(!I)return null;if(!su(S,I.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${ir(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${ir(E.type)}' and '${ir(I.type)}'.`);c&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new xo(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new xo(E.type,[I])));let A=null;if(y.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(A=v.parse(y[3],3,Sa),!A)return null}return new NC(E,I,A)}evaluate(y){const v=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(c&&this.hasUntypedArgument){const E=Ur(v),I=Ur(S);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new br(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=Ur(v),I=Ur(S);if(E.kind!=="string"||I.kind!=="string")return n(y,v,S)}return this.collator?s(y,v,S,this.collator.evaluate(y)):n(y,v,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Qd=Ks("==",function(o,n,s){return n===s},Ql),ec=Ks("!=",function(o,n,s){return n!==s},function(o,n,s,c){return!Ql(0,n,s,c)}),au=Ks("<",function(o,n,s){return n<s},function(o,n,s,c){return c.compare(n,s)<0}),io=Ks(">",function(o,n,s){return n>s},function(o,n,s,c){return c.compare(n,s)>0}),lu=Ks("<=",function(o,n,s){return n<=s},function(o,n,s,c){return c.compare(n,s)<=0}),Ai=Ks(">=",function(o,n,s){return n>=s},function(o,n,s,c){return c.compare(n,s)>=0});class Gi{constructor(n,s,c){this.type=Sa,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Pt);if(!f)return null;const y=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Pt);if(!y)return null;let v=null;return c.locale&&(v=s.parse(c.locale,1,It),!v)?null:new Gi(f,y,v)}evaluate(n){return new Gl(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class tc{constructor(n,s,c,f,y){this.type=It,this.number=n,this.locale=s,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const c=s.parse(n[1],1,Ke);if(!c)return null;const f=n[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=s.parse(f.locale,1,It),!y))return null;let v=null;if(f.currency&&(v=s.parse(f.currency,1,It),!v))return null;let S=null;if(f["min-fraction-digits"]&&(S=s.parse(f["min-fraction-digits"],1,Ke),!S))return null;let E=null;return f["max-fraction-digits"]&&(E=s.parse(f["max-fraction-digits"],1,Ke),!E)?null:new tc(c,y,v,S,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class qi{constructor(n){this.type=Nr,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let y=!1;for(let v=1;v<=n.length-1;++v){const S=n[v];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let E=null;if(S["font-scale"]&&(E=s.parse(S["font-scale"],1,Ke),!E))return null;let I=null;if(S["text-font"]&&(I=s.parse(S["text-font"],1,Ui(It)),!I))return null;let A=null;if(S["text-color"]&&(A=s.parse(S["text-color"],1,hn),!A))return null;let R=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!ql.includes(S["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(R=s.parse(S["vertical-align"],1,It),!R)return null}const N=f[f.length-1];N.scale=E,N.font=I,N.textColor=A,N.verticalAlign=R}else{const E=s.parse(n[v],1,Ut);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new qi(f)}evaluate(n){return new Ir(this.sections.map(s=>{const c=s.content.evaluate(n);return Ur(c)===ur?new Zi("",c,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(n):null):new Zi(Xs(c),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null,s.verticalAlign?s.verticalAlign.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor),s.verticalAlign&&n(s.verticalAlign)}outputDefined(){return!1}}class hl{constructor(n){this.type=ur,this.input=n}static parse(n,s){if(n.length!==2)return s.error("Expected two arguments.");const c=s.parse(n[1],1,It);return c?new hl(c):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),c=Ti.fromString(s);return c&&n.availableImages&&(c.available=n.availableImages.indexOf(s)>-1),c}eachChild(n){n(this.input)}outputDefined(){return!1}}class Pa{constructor(n){this.type=Ke,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=s.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${ir(c.type)} instead.`):new Pa(c):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new br(`Expected value to be of type string or array, but found ${ir(Ur(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Nn=8192;function Ys(o,n){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,n.z);return[Math.round(s*f*Nn),Math.round(c*f*Nn)]}function nc(o,n){const s=Math.pow(2,n.z);return[(f=(o[0]/Nn+n.x)/s,360*f-180),(c=(o[1]/Nn+n.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,f}function rc(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function rs(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function Ip(o,n,s){const c=o[0]-n[0],f=o[1]-n[1],y=o[0]-s[0],v=o[1]-s[1];return c*v-y*f==0&&c*y<=0&&f*v<=0}function ic(o,n,s,c){return(f=[c[0]-s[0],c[1]-s[1]])[0]*(y=[n[0]-o[0],n[1]-o[1]])[1]-f[1]*y[0]!=0&&!(!zh(o,n,s,c)||!zh(s,c,o,n));var f,y}function ef(o,n,s){for(const c of s)for(let f=0;f<c.length-1;++f)if(ic(o,n,c[f],c[f+1]))return!0;return!1}function Ea(o,n,s=!1){let c=!1;for(const S of n)for(let E=0;E<S.length-1;E++){if(Ip(o,S[E],S[E+1]))return s;(y=S[E])[1]>(f=o)[1]!=(v=S[E+1])[1]>f[1]&&f[0]<(v[0]-y[0])*(f[1]-y[1])/(v[1]-y[1])+y[0]&&(c=!c)}var f,y,v;return c}function oc(o,n){for(const s of n)if(Ea(o,s))return!0;return!1}function Ma(o,n){for(const s of o)if(!Ea(s,n))return!1;for(let s=0;s<o.length-1;++s)if(ef(o[s],o[s+1],n))return!1;return!0}function kp(o,n){for(const s of n)if(Ma(o,s))return!0;return!1}function zh(o,n,s,c){const f=c[0]-s[0],y=c[1]-s[1],v=(o[0]-s[0])*y-f*(o[1]-s[1]),S=(n[0]-s[0])*y-f*(n[1]-s[1]);return v>0&&S<0||v<0&&S>0}function cu(o,n,s){const c=[];for(let f=0;f<o.length;f++){const y=[];for(let v=0;v<o[f].length;v++){const S=Ys(o[f][v],s);rc(n,S),y.push(S)}c.push(y)}return c}function uu(o,n,s){const c=[];for(let f=0;f<o.length;f++){const y=cu(o[f],n,s);c.push(y)}return c}function sc(o,n,s,c){if(o[0]<s[0]||o[0]>s[2]){const f=.5*c;let y=o[0]-s[0]>f?-c:s[0]-o[0]>f?c:0;y===0&&(y=o[0]-s[2]>f?-c:s[2]-o[0]>f?c:0),o[0]+=y}rc(n,o)}function hu(o,n,s,c){const f=Math.pow(2,c.z)*Nn,y=[c.x*Nn,c.y*Nn],v=[];for(const S of o)for(const E of S){const I=[E.x+y[0],E.y+y[1]];sc(I,n,s,f),v.push(I)}return v}function Rh(o,n,s,c){const f=Math.pow(2,c.z)*Nn,y=[c.x*Nn,c.y*Nn],v=[];for(const E of o){const I=[];for(const A of E){const R=[A.x+y[0],A.y+y[1]];rc(n,R),I.push(R)}v.push(I)}if(n[2]-n[0]<=f/2){(S=n)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const I of E)sc(I,n,s,f)}var S;return v}class bs{constructor(n,s){this.type=Pt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ro(n[1])){const c=n[1];if(c.type==="FeatureCollection"){const f=[];for(const y of c.features){const{type:v,coordinates:S}=y.geometry;v==="Polygon"&&f.push(S),v==="MultiPolygon"&&f.push(...S)}if(f.length)return new bs(c,{type:"MultiPolygon",coordinates:f})}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new bs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new bs(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(c.type==="Polygon"){const S=cu(c.coordinates,y,v),E=hu(s.geometry(),f,y,v);if(!rs(f,y))return!1;for(const I of E)if(!Ea(I,S))return!1}if(c.type==="MultiPolygon"){const S=uu(c.coordinates,y,v),E=hu(s.geometry(),f,y,v);if(!rs(f,y))return!1;for(const I of E)if(!oc(I,S))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(c.type==="Polygon"){const S=cu(c.coordinates,y,v),E=Rh(s.geometry(),f,y,v);if(!rs(f,y))return!1;for(const I of E)if(!Ma(I,S))return!1}if(c.type==="MultiPolygon"){const S=uu(c.coordinates,y,v),E=Rh(s.geometry(),f,y,v);if(!rs(f,y))return!1;for(const I of E)if(!kp(I,S))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let du=class{constructor(o=[],n=(s,c)=>s<c?-1:s>c?1:0){if(this.data=o,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:n,compare:s}=this,c=n[o];for(;o>0;){const f=o-1>>1,y=n[f];if(s(c,y)>=0)break;n[o]=y,o=f}n[o]=c}_down(o){const{data:n,compare:s}=this,c=this.length>>1,f=n[o];for(;o<c;){let y=1+(o<<1);const v=y+1;if(v<this.length&&s(n[v],n[y])<0&&(y=v),s(n[y],f)>=0)break;n[o]=n[y],o=y}n[o]=f}};function tf(o,n,s=0,c=o.length-1,f=oo){for(;c>s;){if(c-s>600){const E=c-s+1,I=n-s+1,A=Math.log(E),R=.5*Math.exp(2*A/3),N=.5*Math.sqrt(A*R*(E-R)/E)*(I-E/2<0?-1:1);tf(o,n,Math.max(s,Math.floor(n-I*R/E+N)),Math.min(c,Math.floor(n+(E-I)*R/E+N)),f)}const y=o[n];let v=s,S=c;for(Js(o,s,n),f(o[c],y)>0&&Js(o,s,c);v<S;){for(Js(o,v,S),v++,S--;f(o[v],y)<0;)v++;for(;f(o[S],y)>0;)S--}f(o[s],y)===0?Js(o,s,S):(S++,Js(o,S,c)),S<=n&&(s=S+1),n<=S&&(c=S-1)}}function Js(o,n,s){const c=o[n];o[n]=o[s],o[s]=c}function oo(o,n){return o<n?-1:o>n?1:0}function dl(o,n){if(o.length<=1)return[o];const s=[];let c,f;for(const y of o){const v=Dh(y);v!==0&&(y.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(c&&s.push(c),c=[y]):c.push(y))}if(c&&s.push(c),n>1)for(let y=0;y<s.length;y++)s[y].length<=n||(tf(s[y],n,1,s[y].length-1,ac),s[y]=s[y].slice(0,n));return s}function ac(o,n){return n.area-o.area}function Dh(o){let n=0;for(let s,c,f=0,y=o.length,v=y-1;f<y;v=f++)s=o[f],c=o[v],n+=(c.x-s.x)*(s.y+c.y);return n}const fu=1/298.257223563,nf=fu*(2-fu),rf=Math.PI/180;class pu{constructor(n){const s=6378.137*rf*1e3,c=Math.cos(n*rf),f=1/(1-nf*(1-c*c)),y=Math.sqrt(f);this.kx=s*y*c,this.ky=s*y*f*(1-nf)}distance(n,s){const c=this.wrap(n[0]-s[0])*this.kx,f=(n[1]-s[1])*this.ky;return Math.sqrt(c*c+f*f)}pointOnLine(n,s){let c,f,y,v,S=1/0;for(let E=0;E<n.length-1;E++){let I=n[E][0],A=n[E][1],R=this.wrap(n[E+1][0]-I)*this.kx,N=(n[E+1][1]-A)*this.ky,U=0;R===0&&N===0||(U=(this.wrap(s[0]-I)*this.kx*R+(s[1]-A)*this.ky*N)/(R*R+N*N),U>1?(I=n[E+1][0],A=n[E+1][1]):U>0&&(I+=R/this.kx*U,A+=N/this.ky*U)),R=this.wrap(s[0]-I)*this.kx,N=(s[1]-A)*this.ky;const V=R*R+N*N;V<S&&(S=V,c=I,f=A,y=E,v=U)}return{point:[c,f],index:y,t:Math.max(0,Math.min(1,v))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Lh(o,n){return n[0]-o[0]}function mu(o){return o[1]-o[0]+1}function Wi(o,n){return o[1]>=o[0]&&o[1]<n}function Fh(o,n){if(o[0]>o[1])return[null,null];const s=mu(o);if(n){if(s===2)return[o,null];const f=Math.floor(s/2);return[[o[0],o[0]+f],[o[0]+f,o[1]]]}if(s===1)return[o,null];const c=Math.floor(s/2)-1;return[[o[0],o[0]+c],[o[0]+c+1,o[1]]]}function gu(o,n){if(!Wi(n,o.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let c=n[0];c<=n[1];++c)rc(s,o[c]);return s}function lc(o){const n=[1/0,1/0,-1/0,-1/0];for(const s of o)for(const c of s)rc(n,c);return n}function Oh(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function is(o,n,s){if(!Oh(o)||!Oh(n))return NaN;let c=0,f=0;return o[2]<n[0]&&(c=n[0]-o[2]),o[0]>n[2]&&(c=o[0]-n[2]),o[1]>n[3]&&(f=o[1]-n[3]),o[3]<n[1]&&(f=n[1]-o[3]),s.distance([0,0],[c,f])}function os(o,n,s){const c=s.pointOnLine(n,o);return s.distance(o,c.point)}function Dn(o,n,s,c,f){const y=Math.min(os(o,[s,c],f),os(n,[s,c],f)),v=Math.min(os(s,[o,n],f),os(c,[o,n],f));return Math.min(y,v)}function Ap(o,n,s,c,f){if(!Wi(n,o.length)||!Wi(c,s.length))return 1/0;let y=1/0;for(let v=n[0];v<n[1];++v){const S=o[v],E=o[v+1];for(let I=c[0];I<c[1];++I){const A=s[I],R=s[I+1];if(ic(S,E,A,R))return 0;y=Math.min(y,Dn(S,E,A,R,f))}}return y}function zp(o,n,s,c,f){if(!Wi(n,o.length)||!Wi(c,s.length))return NaN;let y=1/0;for(let v=n[0];v<=n[1];++v)for(let S=c[0];S<=c[1];++S)if(y=Math.min(y,f.distance(o[v],s[S])),y===0)return y;return y}function fl(o,n,s){if(Ea(o,n,!0))return 0;let c=1/0;for(const f of n){const y=f[0],v=f[f.length-1];if(y!==v&&(c=Math.min(c,os(o,[v,y],s)),c===0))return c;const S=s.pointOnLine(f,o);if(c=Math.min(c,s.distance(o,S.point)),c===0)return c}return c}function Lo(o,n,s,c){if(!Wi(n,o.length))return NaN;for(let y=n[0];y<=n[1];++y)if(Ea(o[y],s,!0))return 0;let f=1/0;for(let y=n[0];y<n[1];++y){const v=o[y],S=o[y+1];for(const E of s)for(let I=0,A=E.length,R=A-1;I<A;R=I++){const N=E[R],U=E[I];if(ic(v,S,N,U))return 0;f=Math.min(f,Dn(v,S,N,U,c))}}return f}function Bh(o,n){for(const s of o)for(const c of s)if(Ea(c,n,!0))return!0;return!1}function Rp(o,n,s,c=1/0){const f=lc(o),y=lc(n);if(c!==1/0&&is(f,y,s)>=c)return c;if(rs(f,y)){if(Bh(o,n))return 0}else if(Bh(n,o))return 0;let v=1/0;for(const S of o)for(let E=0,I=S.length,A=I-1;E<I;A=E++){const R=S[A],N=S[E];for(const U of n)for(let V=0,q=U.length,J=q-1;V<q;J=V++){const ae=U[J],Ce=U[V];if(ic(R,N,ae,Ce))return 0;v=Math.min(v,Dn(R,N,ae,Ce,s))}}return v}function of(o,n,s,c,f,y){if(!y)return;const v=is(gu(c,y),f,s);v<n&&o.push([v,y,[0,0]])}function _u(o,n,s,c,f,y,v){if(!y||!v)return;const S=is(gu(c,y),gu(f,v),s);S<n&&o.push([S,y,v])}function yu(o,n,s,c,f=1/0){let y=Math.min(c.distance(o[0],s[0][0]),f);if(y===0)return y;const v=new du([[0,[0,o.length-1],[0,0]]],Lh),S=lc(s);for(;v.length>0;){const E=v.pop();if(E[0]>=y)continue;const I=E[1],A=n?50:100;if(mu(I)<=A){if(!Wi(I,o.length))return NaN;if(n){const R=Lo(o,I,s,c);if(isNaN(R)||R===0)return R;y=Math.min(y,R)}else for(let R=I[0];R<=I[1];++R){const N=fl(o[R],s,c);if(y=Math.min(y,N),y===0)return 0}}else{const R=Fh(I,n);of(v,y,c,o,S,R[0]),of(v,y,c,o,S,R[1])}}return y}function vu(o,n,s,c,f,y=1/0){let v=Math.min(y,f.distance(o[0],s[0]));if(v===0)return v;const S=new du([[0,[0,o.length-1],[0,s.length-1]]],Lh);for(;S.length>0;){const E=S.pop();if(E[0]>=v)continue;const I=E[1],A=E[2],R=n?50:100,N=c?50:100;if(mu(I)<=R&&mu(A)<=N){if(!Wi(I,o.length)&&Wi(A,s.length))return NaN;let U;if(n&&c)U=Ap(o,I,s,A,f),v=Math.min(v,U);else if(n&&!c){const V=o.slice(I[0],I[1]+1);for(let q=A[0];q<=A[1];++q)if(U=os(s[q],V,f),v=Math.min(v,U),v===0)return v}else if(!n&&c){const V=s.slice(A[0],A[1]+1);for(let q=I[0];q<=I[1];++q)if(U=os(o[q],V,f),v=Math.min(v,U),v===0)return v}else U=zp(o,I,s,A,f),v=Math.min(v,U)}else{const U=Fh(I,n),V=Fh(A,c);_u(S,v,f,o,s,U[0],V[0]),_u(S,v,f,o,s,U[0],V[1]),_u(S,v,f,o,s,U[1],V[0]),_u(S,v,f,o,s,U[1],V[1])}}return v}function Qs(o){return o.type==="MultiPolygon"?o.coordinates.map(n=>({type:"Polygon",coordinates:n})):o.type==="MultiLineString"?o.coordinates.map(n=>({type:"LineString",coordinates:n})):o.type==="MultiPoint"?o.coordinates.map(n=>({type:"Point",coordinates:n})):[o]}class Ae{constructor(n,s){this.type=Ke,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ro(n[1])){const c=n[1];if(c.type==="FeatureCollection")return new Ae(c,c.features.map(f=>Qs(f.geometry)).flat());if(c.type==="Feature")return new Ae(c,Qs(c.geometry));if("type"in c&&"coordinates"in c)return new Ae(c,Qs(c))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,c){const f=s.geometry(),y=f.flat().map(E=>nc([E.x,E.y],s.canonical));if(f.length===0)return NaN;const v=new pu(y[0][1]);let S=1/0;for(const E of c){switch(E.type){case"Point":S=Math.min(S,vu(y,!1,[E.coordinates],!1,v,S));break;case"LineString":S=Math.min(S,vu(y,!1,E.coordinates,!0,v,S));break;case"Polygon":S=Math.min(S,yu(y,!1,E.coordinates,v,S))}if(S===0)return S}return S}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,c){const f=s.geometry(),y=f.flat().map(E=>nc([E.x,E.y],s.canonical));if(f.length===0)return NaN;const v=new pu(y[0][1]);let S=1/0;for(const E of c){switch(E.type){case"Point":S=Math.min(S,vu(y,!0,[E.coordinates],!1,v,S));break;case"LineString":S=Math.min(S,vu(y,!0,E.coordinates,!0,v,S));break;case"Polygon":S=Math.min(S,yu(y,!0,E.coordinates,v,S))}if(S===0)return S}return S}(n,this.geometries);if(n.geometryType()==="Polygon")return function(s,c){const f=s.geometry();if(f.length===0||f[0].length===0)return NaN;const y=dl(f,0).map(E=>E.map(I=>I.map(A=>nc([A.x,A.y],s.canonical)))),v=new pu(y[0][0][0][1]);let S=1/0;for(const E of c)for(const I of y){switch(E.type){case"Point":S=Math.min(S,yu([E.coordinates],!1,I,v,S));break;case"LineString":S=Math.min(S,yu(E.coordinates,!0,I,v,S));break;case"Polygon":S=Math.min(S,Rp(I,E.coordinates,v,S))}if(S===0)return S}return S}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const nt={"==":Qd,"!=":ec,">":io,"<":au,">=":Ai,"<=":lu,array:xo,at:In,boolean:xo,case:ou,coalesce:$n,collator:Gi,format:qi,image:hl,in:Yn,"index-of":Tn,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:Pa,let:cn,literal:ro,match:Xl,number:xo,"number-format":tc,object:xo,slice:Kl,step:ul,string:xo,"to-boolean":Do,"to-color":Do,"to-number":Do,"to-string":Do,var:ll,within:bs,distance:Ae};class Ve{constructor(n,s,c,f){this.name=n,this.type=s,this._evaluate=c,this.args=f}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,s){const c=n[0],f=Ve.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,S=v.filter(([I])=>!Array.isArray(I)||I.length===n.length-1);let E=null;for(const[I,A]of S){E=new Sn(s.registry,qn,s.path,null,s.scope);const R=[];let N=!1;for(let U=1;U<n.length;U++){const V=n[U],q=Array.isArray(I)?I[U-1]:I.type,J=E.parse(V,1+R.length,q);if(!J){N=!0;break}R.push(J)}if(!N)if(Array.isArray(I)&&I.length!==R.length)E.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let U=0;U<R.length;U++){const V=Array.isArray(I)?I[U]:I.type,q=R[U];E.concat(U+1).checkSubtype(V,q.type)}if(E.errors.length===0)return new Ve(c,y,A,R)}}if(S.length===1)s.errors.push(...E.errors);else{const I=(S.length?S:v).map(([R])=>{return N=R,Array.isArray(N)?`(${N.map(ir).join(", ")})`:`(${ir(N.type)}...)`;var N}).join(" | "),A=[];for(let R=1;R<n.length;R++){const N=s.parse(n[R],1+A.length);if(!N)return null;A.push(ir(N.type))}s.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(n,s){Ve.definitions=s;for(const c in s)n[c]=Ve}}function zt(o,[n,s,c,f]){n=n.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const y=f?f.evaluate(o):1,v=Wl(n,s,c,y);if(v)throw new br(v);return new An(n/255,s/255,c/255,y,!1)}function un(o,n){return o in n}function jn(o,n){const s=n[o];return s===void 0?null:s}function gr(o){return{type:o}}function qn(o){if(o instanceof ll)return qn(o.boundExpression);if(o instanceof Ve&&o.name==="error"||o instanceof Gi||o instanceof bs||o instanceof Ae)return!1;const n=o instanceof Do||o instanceof xo;let s=!0;return o.eachChild(c=>{s=n?s&&qn(c):s&&c instanceof ro}),!!s&&pl(o)&&zi(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function pl(o){if(o instanceof Ve&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof bs||o instanceof Ae)return!1;let n=!0;return o.eachChild(s=>{n&&!pl(s)&&(n=!1)}),n}function cc(o){if(o instanceof Ve&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(s=>{n&&!cc(s)&&(n=!1)}),n}function zi(o,n){if(o instanceof Ve&&n.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!zi(c,n)&&(s=!1)}),s}function uc(o){return{result:"success",value:o}}function ml(o){return{result:"error",value:o}}function Fo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function hc(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function gl(o){return!!o.expression&&o.expression.interpolated}function Bt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function xu(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function sf(o){return o}function dc(o,n){const s=n.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",f=c||!(c||o.property!==void 0),y=o.type||(gl(n)?"exponential":"interval");if(s||n.type==="padding"){const A=s?An.parse:Yr.parse;(o=yt({},o)).stops&&(o.stops=o.stops.map(R=>[R[0],A(R[1])])),o.default=A(o.default?o.default:n.default)}if(o.colorSpace&&(v=o.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var v;let S,E,I;if(y==="exponential")S=fc;else if(y==="interval")S=Lp;else if(y==="categorical"){S=Dp,E=Object.create(null);for(const A of o.stops)E[A[0]]=A[1];I=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);S=ws}if(c){const A={},R=[];for(let V=0;V<o.stops.length;V++){const q=o.stops[V],J=q[0].zoom;A[J]===void 0&&(A[J]={zoom:J,type:o.type,property:o.property,default:o.default,stops:[]},R.push(J)),A[J].stops.push([q[0].value,q[1]])}const N=[];for(const V of R)N.push([A[V].zoom,dc(A[V],n)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:kr.interpolationFactor.bind(void 0,U),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},q)=>fc({stops:N,base:o.base},n,V).evaluate(V,q)}}if(f){const A=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:kr.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map(R=>R[0]),evaluate:({zoom:R})=>S(o,n,R,E,I)}}return{kind:"source",evaluate(A,R){const N=R&&R.properties?R.properties[o.property]:void 0;return N===void 0?Ia(o.default,n.default):S(o,n,N,E,I)}}}function Ia(o,n,s){return o!==void 0?o:n!==void 0?n:s!==void 0?s:void 0}function Dp(o,n,s,c,f){return Ia(typeof s===f?c[s]:void 0,o.default,n.default)}function Lp(o,n,s){if(Bt(s)!=="number")return Ia(o.default,n.default);const c=o.stops.length;if(c===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const f=cl(o.stops.map(y=>y[0]),s);return o.stops[f][1]}function fc(o,n,s){const c=o.base!==void 0?o.base:1;if(Bt(s)!=="number")return Ia(o.default,n.default);const f=o.stops.length;if(f===1||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[f-1][0])return o.stops[f-1][1];const y=cl(o.stops.map(A=>A[0]),s),v=function(A,R,N,U){const V=U-N,q=A-N;return V===0?0:R===1?q/V:(Math.pow(R,q)-1)/(Math.pow(R,V)-1)}(s,c,o.stops[y][0],o.stops[y+1][0]),S=o.stops[y][1],E=o.stops[y+1][1],I=ki[n.type]||sf;return typeof S.evaluate=="function"?{evaluate(...A){const R=S.evaluate.apply(void 0,A),N=E.evaluate.apply(void 0,A);if(R!==void 0&&N!==void 0)return I(R,N,v,o.colorSpace)}}:I(S,E,v,o.colorSpace)}function ws(o,n,s){switch(n.type){case"color":s=An.parse(s);break;case"formatted":s=Ir.fromString(s.toString());break;case"resolvedImage":s=Ti.fromString(s.toString());break;case"padding":s=Yr.parse(s);break;default:Bt(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0)}return Ia(s,o.default,n.default)}Ve.register(nt,{error:[{kind:"error"},[It],(o,[n])=>{throw new br(n.evaluate(o))}],typeof:[It,[Ut],(o,[n])=>ir(Ur(n.evaluate(o)))],"to-rgba":[Ui(Ke,4),[hn],(o,[n])=>{const[s,c,f,y]=n.evaluate(o).rgb;return[255*s,255*c,255*f,y]}],rgb:[hn,[Ke,Ke,Ke],zt],rgba:[hn,[Ke,Ke,Ke,Ke],zt],has:{type:Pt,overloads:[[[It],(o,[n])=>un(n.evaluate(o),o.properties())],[[It,dn],(o,[n,s])=>un(n.evaluate(o),s.evaluate(o))]]},get:{type:Ut,overloads:[[[It],(o,[n])=>jn(n.evaluate(o),o.properties())],[[It,dn],(o,[n,s])=>jn(n.evaluate(o),s.evaluate(o))]]},"feature-state":[Ut,[It],(o,[n])=>jn(n.evaluate(o),o.featureState||{})],properties:[dn,[],o=>o.properties()],"geometry-type":[It,[],o=>o.geometryType()],id:[Ut,[],o=>o.id()],zoom:[Ke,[],o=>o.globals.zoom],"heatmap-density":[Ke,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ke,[],o=>o.globals.lineProgress||0],accumulated:[Ut,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Ke,gr(Ke),(o,n)=>{let s=0;for(const c of n)s+=c.evaluate(o);return s}],"*":[Ke,gr(Ke),(o,n)=>{let s=1;for(const c of n)s*=c.evaluate(o);return s}],"-":{type:Ke,overloads:[[[Ke,Ke],(o,[n,s])=>n.evaluate(o)-s.evaluate(o)],[[Ke],(o,[n])=>-n.evaluate(o)]]},"/":[Ke,[Ke,Ke],(o,[n,s])=>n.evaluate(o)/s.evaluate(o)],"%":[Ke,[Ke,Ke],(o,[n,s])=>n.evaluate(o)%s.evaluate(o)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(o,[n,s])=>Math.pow(n.evaluate(o),s.evaluate(o))],sqrt:[Ke,[Ke],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))],log2:[Ke,[Ke],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[Ke,[Ke],(o,[n])=>Math.sin(n.evaluate(o))],cos:[Ke,[Ke],(o,[n])=>Math.cos(n.evaluate(o))],tan:[Ke,[Ke],(o,[n])=>Math.tan(n.evaluate(o))],asin:[Ke,[Ke],(o,[n])=>Math.asin(n.evaluate(o))],acos:[Ke,[Ke],(o,[n])=>Math.acos(n.evaluate(o))],atan:[Ke,[Ke],(o,[n])=>Math.atan(n.evaluate(o))],min:[Ke,gr(Ke),(o,n)=>Math.min(...n.map(s=>s.evaluate(o)))],max:[Ke,gr(Ke),(o,n)=>Math.max(...n.map(s=>s.evaluate(o)))],abs:[Ke,[Ke],(o,[n])=>Math.abs(n.evaluate(o))],round:[Ke,[Ke],(o,[n])=>{const s=n.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ke,[Ke],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[Ke,[Ke],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[Pt,[It,Ut],(o,[n,s])=>o.properties()[n.value]===s.value],"filter-id-==":[Pt,[Ut],(o,[n])=>o.id()===n.value],"filter-type-==":[Pt,[It],(o,[n])=>o.geometryType()===n.value],"filter-<":[Pt,[It,Ut],(o,[n,s])=>{const c=o.properties()[n.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Pt,[Ut],(o,[n])=>{const s=o.id(),c=n.value;return typeof s==typeof c&&s<c}],"filter->":[Pt,[It,Ut],(o,[n,s])=>{const c=o.properties()[n.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[Pt,[Ut],(o,[n])=>{const s=o.id(),c=n.value;return typeof s==typeof c&&s>c}],"filter-<=":[Pt,[It,Ut],(o,[n,s])=>{const c=o.properties()[n.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Pt,[Ut],(o,[n])=>{const s=o.id(),c=n.value;return typeof s==typeof c&&s<=c}],"filter->=":[Pt,[It,Ut],(o,[n,s])=>{const c=o.properties()[n.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Pt,[Ut],(o,[n])=>{const s=o.id(),c=n.value;return typeof s==typeof c&&s>=c}],"filter-has":[Pt,[Ut],(o,[n])=>n.value in o.properties()],"filter-has-id":[Pt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Pt,[Ui(It)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[Pt,[Ui(Ut)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[Pt,[It,Ui(Ut)],(o,[n,s])=>s.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[Pt,[It,Ui(Ut)],(o,[n,s])=>function(c,f,y,v){for(;y<=v;){const S=y+v>>1;if(f[S]===c)return!0;f[S]>c?v=S-1:y=S+1}return!1}(o.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(o,[n,s])=>n.evaluate(o)&&s.evaluate(o)],[gr(Pt),(o,n)=>{for(const s of n)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(o,[n,s])=>n.evaluate(o)||s.evaluate(o)],[gr(Pt),(o,n)=>{for(const s of n)if(s.evaluate(o))return!0;return!1}]]},"!":[Pt,[Pt],(o,[n])=>!n.evaluate(o)],"is-supported-script":[Pt,[It],(o,[n])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(n.evaluate(o))}],upcase:[It,[It],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[It,[It],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[It,gr(Ut),(o,n)=>n.map(s=>Xs(s.evaluate(o))).join("")],"resolved-locale":[It,[Sa],(o,[n])=>n.evaluate(o).resolvedLocale()]});class _l{constructor(n,s){var c;this.expression=n,this._warningHistory={},this._evaluator=new iu,this._defaultValue=s?(c=s).type==="color"&&xu(c.default)?new An(0,0,0,0):c.type==="color"?An.parse(c.default)||null:c.type==="padding"?Yr.parse(c.default)||null:c.type==="variableAnchorOffsetCollection"?Jr.parse(c.default)||null:c.type==="projectionDefinition"?Ii.parse(c.default)||null:c.default===void 0?null:c.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(n,s,c,f,y,v){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(n,s,c,f,y,v){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new br(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function pc(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in nt}function ss(o,n){const s=new Sn(nt,qn,[],n?function(f){const y={color:hn,string:It,number:Ke,enum:It,boolean:Pt,formatted:Nr,padding:jr,projectionDefinition:Xt,resolvedImage:ur,variableAnchorOffsetCollection:tu};return f.type==="array"?Ui(y[f.value]||Ut,f.length):y[f.type]}(n):void 0),c=s.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?uc(new _l(c,n)):ml(s.errors)}class mc{constructor(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!cc(s.expression)}evaluateWithoutErrorHandling(n,s,c,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,f,y,v)}evaluate(n,s,c,f,y,v){return this._styleExpression.evaluate(n,s,c,f,y,v)}}class bu{constructor(n,s,c,f){this.kind=n,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!cc(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(n,s,c,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,f,y,v)}evaluate(n,s,c,f,y,v){return this._styleExpression.evaluate(n,s,c,f,y,v)}interpolationFactor(n,s,c){return this.interpolationType?kr.interpolationFactor(this.interpolationType,n,s,c):0}}function gc(o,n){const s=ss(o,n);if(s.result==="error")return s;const c=s.value.expression,f=pl(c);if(!f&&!Fo(n))return ml([new Ft("","data expressions not supported")]);const y=zi(c,["zoom"]);if(!y&&!hc(n))return ml([new Ft("","zoom expressions not supported")]);const v=ea(c);return v||y?v instanceof Ft?ml([v]):v instanceof kr&&!gl(n)?ml([new Ft("",'"interpolate" expressions cannot be used with this property')]):uc(v?new bu(f?"camera":"composite",s.value,v.labels,v instanceof kr?v.interpolation:void 0):new mc(f?"constant":"source",s.value)):ml([new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _c{constructor(n,s){this._parameters=n,this._specification=s,yt(this,dc(this._parameters,this._specification))}static deserialize(n){return new _c(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function ea(o){let n=null;if(o instanceof cn)n=ea(o.result);else if(o instanceof $n){for(const s of o.args)if(n=ea(s),n)break}else(o instanceof ul||o instanceof kr)&&o.input instanceof Ve&&o.input.name==="zoom"&&(n=o);return n instanceof Ft||o.eachChild(s=>{const c=ea(s);c instanceof Ft?n=c:!n&&c?n=new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&c&&n!==c&&(n=new Ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Ss(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!Ss(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const yc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wu(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Ss(o)||(o=ta(o));const n=ss(o,yc);if(n.result==="error")throw new Error(n.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,c,f)=>n.value.evaluate(s,c,{},f),needGeometry:af(o)}}function Fp(o,n){return o<n?-1:o>n?1:0}function af(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let n=1;n<o.length;n++)if(af(o[n]))return!0;return!1}function ta(o){if(!o)return!0;const n=o[0];return o.length<=1?n!=="any":n==="=="?ka(o[1],o[2],"=="):n==="!="?Aa(ka(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?ka(o[1],o[2],n):n==="any"?(s=o.slice(1),["any"].concat(s.map(ta))):n==="all"?["all"].concat(o.slice(1).map(ta)):n==="none"?["all"].concat(o.slice(1).map(ta).map(Aa)):n==="in"?vc(o[1],o.slice(2)):n==="!in"?Aa(vc(o[1],o.slice(2))):n==="has"?Nh(o[1]):n!=="!has"||Aa(Nh(o[1]));var s}function ka(o,n,s){switch(o){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,o,n]}}function vc(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",o,["literal",n.sort(Fp)]]:["filter-in-small",o,["literal",n]]}}function Nh(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Aa(o){return["!",o]}function xc(o){const n=typeof o;if(n==="number"||n==="boolean"||n==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let f="[";for(const y of o)f+=`${xc(y)},`;return`${f}]`}const s=Object.keys(o).sort();let c="{";for(let f=0;f<s.length;f++)c+=`${JSON.stringify(s[f])}:${xc(o[s[f]])},`;return`${c}}`}function jh(o){let n="";for(const s of H)n+=`/${xc(o[s])}`;return n}function Tr(o){const n=o.value;return n?[new De(o.key,n,"constants have been deprecated as of v8")]:[]}function Cn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function za(o){if(Array.isArray(o))return o.map(za);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const s in o)n[s]=za(o[s]);return n}return Cn(o)}function bo(o){const n=o.key,s=o.value,c=o.valueSpec||{},f=o.objectElementValidators||{},y=o.style,v=o.styleSpec,S=o.validateSpec;let E=[];const I=Bt(s);if(I!=="object")return[new De(n,s,`object expected, ${I} found`)];for(const A in s){const R=A.split(".")[0],N=c[R]||c["*"];let U;if(f[R])U=f[R];else if(c[R])U=S;else if(f["*"])U=f["*"];else{if(!c["*"]){E.push(new De(n,s[A],`unknown property "${A}"`));continue}U=S}E=E.concat(U({key:(n&&`${n}.`)+A,value:s[A],valueSpec:N,style:y,styleSpec:v,object:s,objectKey:A,validateSpec:S},s))}for(const A in c)f[A]||c[A].required&&c[A].default===void 0&&s[A]===void 0&&E.push(new De(n,s,`missing required property "${A}"`));return E}function Su(o){const n=o.value,s=o.valueSpec,c=o.style,f=o.styleSpec,y=o.key,v=o.arrayElementValidator||o.validateSpec;if(Bt(n)!=="array")return[new De(y,n,`array expected, ${Bt(n)} found`)];if(s.length&&n.length!==s.length)return[new De(y,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new De(y,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let S={type:s.value,values:s.values};f.$version<7&&(S.function=s.function),Bt(s.value)==="object"&&(S=s.value);let E=[];for(let I=0;I<n.length;I++)E=E.concat(v({array:n,arrayIndex:I,value:n[I],valueSpec:S,validateSpec:o.validateSpec,style:c,styleSpec:f,key:`${y}[${I}]`}));return E}function Uh(o){const n=o.key,s=o.value,c=o.valueSpec;let f=Bt(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new De(n,s,`number expected, ${f} found`)]:"minimum"in c&&s<c.minimum?[new De(n,s,`${s} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&s>c.maximum?[new De(n,s,`${s} is greater than the maximum value ${c.maximum}`)]:[]}function Tu(o){const n=o.valueSpec,s=Cn(o.value.type);let c,f,y,v={};const S=s!=="categorical"&&o.value.property===void 0,E=!S,I=Bt(o.value.stops)==="array"&&Bt(o.value.stops[0])==="array"&&Bt(o.value.stops[0][0])==="object",A=bo({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(U){if(s==="identity")return[new De(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const q=U.value;return V=V.concat(Su({key:U.key,value:q,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:R})),Bt(q)==="array"&&q.length===0&&V.push(new De(U.key,q,"array must have at least one stop")),V},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:n,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return s==="identity"&&S&&A.push(new De(o.key,o.value,'missing required property "property"')),s==="identity"||o.value.stops||A.push(new De(o.key,o.value,'missing required property "stops"')),s==="exponential"&&o.valueSpec.expression&&!gl(o.valueSpec)&&A.push(new De(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!Fo(o.valueSpec)?A.push(new De(o.key,o.value,"property functions not supported")):S&&!hc(o.valueSpec)&&A.push(new De(o.key,o.value,"zoom functions not supported"))),s!=="categorical"&&!I||o.value.property!==void 0||A.push(new De(o.key,o.value,'"property" property is required')),A;function R(U){let V=[];const q=U.value,J=U.key;if(Bt(q)!=="array")return[new De(J,q,`array expected, ${Bt(q)} found`)];if(q.length!==2)return[new De(J,q,`array length 2 expected, length ${q.length} found`)];if(I){if(Bt(q[0])!=="object")return[new De(J,q,`object expected, ${Bt(q[0])} found`)];if(q[0].zoom===void 0)return[new De(J,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new De(J,q,"object stop key must have value")];if(y&&y>Cn(q[0].zoom))return[new De(J,q[0].zoom,"stop zoom values must appear in ascending order")];Cn(q[0].zoom)!==y&&(y=Cn(q[0].zoom),f=void 0,v={}),V=V.concat(bo({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Uh,value:N}}))}else V=V.concat(N({key:`${J}[0]`,value:q[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},q));return pc(za(q[1]))?V.concat([new De(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):V.concat(U.validateSpec({key:`${J}[1]`,value:q[1],valueSpec:n,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function N(U,V){const q=Bt(U.value),J=Cn(U.value),ae=U.value!==null?U.value:V;if(c){if(q!==c)return[new De(U.key,ae,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new De(U.key,ae,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&s!=="categorical"){let Ce=`number expected, ${q} found`;return Fo(n)&&s===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(U.key,ae,Ce)]}return s!=="categorical"||q!=="number"||isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&q==="number"&&f!==void 0&&J<f?[new De(U.key,ae,"stop domain values must appear in ascending order")]:(f=J,s==="categorical"&&J in v?[new De(U.key,ae,"stop domain values must be unique")]:(v[J]=!0,[])):[new De(U.key,ae,`integer expected, found ${J}`)]}}function Oo(o){const n=(o.expressionContext==="property"?gc:ss)(za(o.value),o.valueSpec);if(n.result==="error")return n.value.map(c=>new De(`${o.key}${c.key}`,o.value,c.message));const s=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!s.outputDefined())return[new De(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!cc(s))return[new De(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!cc(s))return[new De(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!zi(s,["zoom","feature-state"]))return[new De(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!pl(s))return[new De(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function na(o){const n=o.key,s=o.value,c=o.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(Cn(s))===-1&&f.push(new De(n,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(Cn(s))===-1&&f.push(new De(n,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Bo(o){return Ss(za(o.value))?Oo(yt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):yl(o)}function yl(o){const n=o.value,s=o.key;if(Bt(n)!=="array")return[new De(s,n,`array expected, ${Bt(n)} found`)];const c=o.styleSpec;let f,y=[];if(n.length<1)return[new De(s,n,"filter array must have at least 1 element")];switch(y=y.concat(na({key:`${s}[0]`,value:n[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Cn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Cn(n[1])==="$type"&&y.push(new De(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new De(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(f=Bt(n[1]),f!=="string"&&y.push(new De(`${s}[1]`,n[1],`string expected, ${f} found`)));for(let v=2;v<n.length;v++)f=Bt(n[v]),Cn(n[1])==="$type"?y=y.concat(na({key:`${s}[${v}]`,value:n[v],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&y.push(new De(`${s}[${v}]`,n[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<n.length;v++)y=y.concat(yl({key:`${s}[${v}]`,value:n[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":f=Bt(n[1]),n.length!==2?y.push(new De(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):f!=="string"&&y.push(new De(`${s}[1]`,n[1],`string expected, ${f} found`))}return y}function Ra(o,n){const s=o.key,c=o.validateSpec,f=o.style,y=o.styleSpec,v=o.value,S=o.objectKey,E=y[`${n}_${o.layerType}`];if(!E)return[];const I=S.match(/^(.*)-transition$/);if(n==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return c({key:s,value:v,valueSpec:y.transition,style:f,styleSpec:y});const A=o.valueSpec||E[S];if(!A)return[new De(s,v,`unknown property "${S}"`)];let R;if(Bt(v)==="string"&&Fo(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(v)))return[new De(s,v,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const N=[];return o.layerType==="symbol"&&(S==="text-field"&&f&&!f.glyphs&&N.push(new De(s,v,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&xu(za(v))&&Cn(v.type)==="identity"&&N.push(new De(s,v,'"text-font" does not support identity functions'))),N.concat(c({key:o.key,value:v,valueSpec:A,style:f,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:S}))}function vl(o){return Ra(o,"paint")}function Da(o){return Ra(o,"layout")}function Vh(o){let n=[];const s=o.value,c=o.key,f=o.style,y=o.styleSpec;s.type||s.ref||n.push(new De(c,s,'either "type" or "ref" is required'));let v=Cn(s.type);const S=Cn(s.ref);if(s.id){const E=Cn(s.id);for(let I=0;I<o.arrayIndex;I++){const A=f.layers[I];Cn(A.id)===E&&n.push(new De(c,s.id,`duplicate layer id "${s.id}", previously used at line ${A.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&n.push(new De(c,s[I],`"${I}" is prohibited for ref layers`))}),f.layers.forEach(I=>{Cn(I.id)===S&&(E=I)}),E?E.ref?n.push(new De(c,s.ref,"ref cannot reference another ref layer")):v=Cn(E.type):n.push(new De(c,s.ref,`ref layer "${S}" not found`))}else if(v!=="background")if(s.source){const E=f.sources&&f.sources[s.source],I=E&&Cn(E.type);E?I==="vector"&&v==="raster"?n.push(new De(c,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"?n.push(new De(c,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?n.push(new De(c,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&v!=="hillshade"?n.push(new De(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&E.lineMetrics||n.push(new De(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new De(c,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new De(c,s.source,`source "${s.source}" not found`))}else n.push(new De(c,s,'missing required property "source"'));return n=n.concat(bo({key:c,value:s,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${c}.type`,value:s.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:s,objectKey:"type"}),filter:Bo,layout:E=>bo({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>Da(yt({layerType:v},I))}}),paint:E=>bo({layer:s,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":I=>vl(yt({layerType:v},I))}})}})),n}function ra(o){const n=o.value,s=o.key,c=Bt(n);return c!=="string"?[new De(s,n,`string expected, ${c} found`)]:[]}const xl={promoteId:function({key:o,value:n}){if(Bt(n)==="string")return ra({key:o,value:n});{const s=[];for(const c in n)s.push(...ra({key:`${o}.${c}`,value:n[c]}));return s}}};function lf(o){const n=o.value,s=o.key,c=o.styleSpec,f=o.style,y=o.validateSpec;if(!n.type)return[new De(s,n,'"type" is required')];const v=Cn(n.type);let S;switch(v){case"vector":case"raster":return S=bo({key:s,value:n,valueSpec:c[`source_${v.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:xl,validateSpec:y}),S;case"raster-dem":return S=function(E){var I;const A=(I=E.sourceName)!==null&&I!==void 0?I:"",R=E.value,N=E.styleSpec,U=N.source_raster_dem,V=E.style;let q=[];const J=Bt(R);if(R===void 0)return q;if(J!=="object")return q.push(new De("source_raster_dem",R,`object expected, ${J} found`)),q;const ae=Cn(R.encoding)==="custom",Ce=["redFactor","greenFactor","blueFactor","baseShift"],de=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const j in R)!ae&&Ce.includes(j)?q.push(new De(j,R[j],`In "${A}": "${j}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):U[j]?q=q.concat(E.validateSpec({key:j,value:R[j],valueSpec:U[j],validateSpec:E.validateSpec,style:V,styleSpec:N})):q.push(new De(j,R[j],`unknown property "${j}"`));return q}({sourceName:s,value:n,style:o.style,styleSpec:c,validateSpec:y}),S;case"geojson":if(S=bo({key:s,value:n,valueSpec:c.source_geojson,style:f,styleSpec:c,validateSpec:y,objectElementValidators:xl}),n.cluster)for(const E in n.clusterProperties){const[I,A]=n.clusterProperties[E],R=typeof I=="string"?[I,["accumulated"],["get",E]]:I;S.push(...Oo({key:`${s}.${E}.map`,value:A,expressionContext:"cluster-map"})),S.push(...Oo({key:`${s}.${E}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return S;case"video":return bo({key:s,value:n,valueSpec:c.source_video,style:f,validateSpec:y,styleSpec:c});case"image":return bo({key:s,value:n,valueSpec:c.source_image,style:f,validateSpec:y,styleSpec:c});case"canvas":return[new De(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return na({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function cf(o){const n=o.value,s=o.styleSpec,c=s.light,f=o.style;let y=[];const v=Bt(n);if(n===void 0)return y;if(v!=="object")return y=y.concat([new De("light",n,`object expected, ${v} found`)]),y;for(const S in n){const E=S.match(/^(.*)-transition$/);y=y.concat(E&&c[E[1]]&&c[E[1]].transition?o.validateSpec({key:S,value:n[S],valueSpec:s.transition,validateSpec:o.validateSpec,style:f,styleSpec:s}):c[S]?o.validateSpec({key:S,value:n[S],valueSpec:c[S],validateSpec:o.validateSpec,style:f,styleSpec:s}):[new De(S,n[S],`unknown property "${S}"`)])}return y}function bc(o){const n=o.value,s=o.styleSpec,c=s.sky,f=o.style,y=Bt(n);if(n===void 0)return[];if(y!=="object")return[new De("sky",n,`object expected, ${y} found`)];let v=[];for(const S in n)v=v.concat(c[S]?o.validateSpec({key:S,value:n[S],valueSpec:c[S],style:f,styleSpec:s}):[new De(S,n[S],`unknown property "${S}"`)]);return v}function bl(o){const n=o.value,s=o.styleSpec,c=s.terrain,f=o.style;let y=[];const v=Bt(n);if(n===void 0)return y;if(v!=="object")return y=y.concat([new De("terrain",n,`object expected, ${v} found`)]),y;for(const S in n)y=y.concat(c[S]?o.validateSpec({key:S,value:n[S],valueSpec:c[S],validateSpec:o.validateSpec,style:f,styleSpec:s}):[new De(S,n[S],`unknown property "${S}"`)]);return y}function $h(o){let n=[];const s=o.value,c=o.key;if(Array.isArray(s)){const f=[],y=[];for(const v in s)s[v].id&&f.includes(s[v].id)&&n.push(new De(c,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),f.push(s[v].id),s[v].url&&y.includes(s[v].url)&&n.push(new De(c,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),y.push(s[v].url),n=n.concat(bo({key:`${c}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return n}return ra({key:c,value:s})}const X={"*":()=>[],array:Su,boolean:function(o){const n=o.value,s=o.key,c=Bt(n);return c!=="boolean"?[new De(s,n,`boolean expected, ${c} found`)]:[]},number:Uh,color:function(o){const n=o.key,s=o.value,c=Bt(s);return c!=="string"?[new De(n,s,`color expected, ${c} found`)]:An.parse(String(s))?[]:[new De(n,s,`color expected, "${s}" found`)]},constants:Tr,enum:na,filter:Bo,function:Tu,layer:Vh,object:bo,source:lf,light:cf,sky:bc,terrain:bl,projection:function(o){const n=o.value,s=o.styleSpec,c=s.projection,f=o.style,y=Bt(n);if(n===void 0)return[];if(y!=="object")return[new De("projection",n,`object expected, ${y} found`)];let v=[];for(const S in n)v=v.concat(c[S]?o.validateSpec({key:S,value:n[S],valueSpec:c[S],style:f,styleSpec:s}):[new De(S,n[S],`unknown property "${S}"`)]);return v},projectionDefinition:function(o){const n=o.key;let s=o.value;s=s instanceof String?s.valueOf():s;const c=Bt(s);return c!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(s)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(s)?["array","string"].includes(c)?[]:[new De(n,s,`projection expected, invalid type "${c}" found`)]:[new De(n,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:ra,formatted:function(o){return ra(o).length===0?[]:Oo(o)},resolvedImage:function(o){return ra(o).length===0?[]:Oo(o)},padding:function(o){const n=o.key,s=o.value;if(Bt(s)==="array"){if(s.length<1||s.length>4)return[new De(n,s,`padding requires 1 to 4 values; ${s.length} values found`)];const c={type:"number"};let f=[];for(let y=0;y<s.length;y++)f=f.concat(o.validateSpec({key:`${n}[${y}]`,value:s[y],validateSpec:o.validateSpec,valueSpec:c}));return f}return Uh({key:n,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const n=o.key,s=o.value,c=Bt(s),f=o.styleSpec;if(c!=="array"||s.length<1||s.length%2!=0)return[new De(n,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let v=0;v<s.length;v+=2)y=y.concat(na({key:`${n}[${v}]`,value:s[v],valueSpec:f.layout_symbol["text-anchor"]})),y=y.concat(Su({key:`${n}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:f}));return y},sprite:$h};function so(o){const n=o.value,s=o.valueSpec,c=o.styleSpec;return o.validateSpec=so,s.expression&&xu(Cn(n))?Tu(o):s.expression&&pc(za(n))?Oo(o):s.type&&X[s.type]?X[s.type](o):bo(yt({},o,{valueSpec:s.type?c[s.type]:s}))}function Ts(o){const n=o.value,s=o.key,c=ra(o);return c.length||(n.indexOf("{fontstack}")===-1&&c.push(new De(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&c.push(new De(s,n,'"glyphs" url must include a "{range}" token'))),c}function Ln(o,n=F){let s=[];return s=s.concat(so({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,validateSpec:so,objectElementValidators:{glyphs:Ts,"*":()=>[]}})),o.constants&&(s=s.concat(Tr({key:"constants",value:o.constants}))),Zh(s)}function en(o){return function(n){return o({...n,validateSpec:so})}}function Zh(o){return[].concat(o).sort((n,s)=>n.line-s.line)}function as(o){return function(...n){return Zh(o.apply(this,n))}}Ln.source=as(en(lf)),Ln.sprite=as(en($h)),Ln.glyphs=as(en(Ts)),Ln.light=as(en(cf)),Ln.sky=as(en(bc)),Ln.terrain=as(en(bl)),Ln.layer=as(en(Vh)),Ln.filter=as(en(Bo)),Ln.paintProperty=as(en(vl)),Ln.layoutProperty=as(en(Da));const wl=Ln,No=wl.light,uf=wl.sky,Gh=wl.paintProperty,Op=wl.layoutProperty;function Cu(o,n){let s=!1;if(n&&n.length)for(const c of n)o.fire(new ji(new Error(c.message))),s=!0;return s}class wc{constructor(n,s,c){const f=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const v=new Int32Array(this.arrayBuffer);n=v[0],this.d=(s=v[1])+2*(c=v[2]);for(let E=0;E<this.d*this.d;E++){const I=v[3+E],A=v[3+E+1];f.push(I===A?null:v.subarray(I,A))}const S=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],S),this.bboxes=v.subarray(S),this.insert=this._insertReadonly}else{this.d=s+2*c;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=c,this.scale=s/n,this.uid=0;const y=c/s*n;this.min=-y,this.max=n+y}insert(n,s,c,f,y){this._forEachCell(s,c,f,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,s,c,f,y,v){this.cells[y].push(v)}query(n,s,c,f,y){const v=this.min,S=this.max;if(n<=v&&s<=v&&S<=c&&S<=f&&!y)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(n,s,c,f,this._queryCell,E,{},y),E}}_queryCell(n,s,c,f,y,v,S,E){const I=this.cells[y];if(I!==null){const A=this.keys,R=this.bboxes;for(let N=0;N<I.length;N++){const U=I[N];if(S[U]===void 0){const V=4*U;(E?E(R[V+0],R[V+1],R[V+2],R[V+3]):n<=R[V+2]&&s<=R[V+3]&&c>=R[V+0]&&f>=R[V+1])?(S[U]=!0,v.push(A[U])):S[U]=!1}}}}_forEachCell(n,s,c,f,y,v,S,E){const I=this._convertToCellCoord(n),A=this._convertToCellCoord(s),R=this._convertToCellCoord(c),N=this._convertToCellCoord(f);for(let U=I;U<=R;U++)for(let V=A;V<=N;V++){const q=this.d*V+U;if((!E||E(this._convertFromCellCoord(U),this._convertFromCellCoord(V),this._convertFromCellCoord(U+1),this._convertFromCellCoord(V+1)))&&y.call(this,n,s,c,f,q,v,S,E))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,s=3+this.cells.length+1+1;let c=0;for(let v=0;v<this.cells.length;v++)c+=this.cells[v].length;const f=new Int32Array(s+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let y=s;for(let v=0;v<n.length;v++){const S=n[v];f[3+v]=y,f.set(S,y),y+=S.length}return f[3+n.length]=y,f.set(this.keys,y),y+=this.keys.length,f[3+n.length+1]=y,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer}static serialize(n,s){const c=n.toArrayBuffer();return s&&s.push(c),{buffer:c}}static deserialize(n){return new wc(n.buffer)}}const Lr={};function St(o,n,s={}){if(Lr[o])throw new Error(`${o} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:o,writeable:!1}),Lr[o]={klass:n,omit:s.omit||[],shallow:s.shallow||[]}}St("Object",Object),St("TransferableGridIndex",wc),St("Color",An),St("Error",Error),St("AJAXError",rr),St("ResolvedImage",Ti),St("StylePropertyFunction",_c),St("StyleExpression",_l,{omit:["_evaluator"]}),St("ZoomDependentExpression",bu),St("ZoomConstantExpression",mc),St("CompoundExpression",Ve,{omit:["_evaluate"]});for(const o in nt)nt[o]._classRegistryKey||St(`Expression_${o}`,nt[o]);function Sl(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function qh(o){return o.$name||o.constructor._classRegistryKey}function hf(o){return!function(n){if(n===null||typeof n!="object")return!1;const s=qh(n);return!(!s||s==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Sl(o)||_n(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function ia(o,n){if(hf(o))return(Sl(o)||_n(o))&&n&&n.push(o),ArrayBuffer.isView(o)&&n&&n.push(o.buffer),o instanceof ImageData&&n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const y=[];for(const v of o)y.push(ia(v,n));return y}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const s=qh(o);if(!s)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Lr[s])throw new Error(`${s} is not registered.`);const{klass:c}=Lr[s],f=c.serialize?c.serialize(o,n):{};if(c.serialize){if(n&&f===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in o){if(!o.hasOwnProperty(y)||Lr[s].omit.indexOf(y)>=0)continue;const v=o[y];f[y]=Lr[s].shallow.indexOf(y)>=0?v:ia(v,n)}o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(f.$name=s),f}function ao(o){if(hf(o))return o;if(Array.isArray(o))return o.map(ao);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const n=qh(o)||"Object";if(!Lr[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:s}=Lr[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const f of Object.keys(o)){if(f==="$name")continue;const y=o[f];c[f]=Lr[n].shallow.indexOf(f)>=0?y:ao(y)}return c}class Pu{constructor(){this.first=!0}update(n,s){const c=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=c,!0))}}const fn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Eu(o){for(const n of o)if(lo(n.charCodeAt(0)))return!0;return!1}function df(o){for(const n of o)if(!Wh(n.charCodeAt(0)))return!1;return!0}function Mu(o){const n=o.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(n.join("|"),"u")}const oa=Mu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Wh(o){return!oa.test(String.fromCodePoint(o))}const Hh=Mu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function lo(o){return!(o!==746&&o!==747&&(o<4352||!(fn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||fn["CJK Compatibility"](o)||fn["CJK Strokes"](o)||!(!fn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||fn["Enclosed CJK Letters and Months"](o)||fn["Ideographic Description Characters"](o)||fn.Kanbun(o)||fn.Katakana(o)&&o!==12540||!(!fn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!fn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||fn["Vertical Forms"](o)||fn["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||Hh.test(String.fromCodePoint(o)))))}function Xh(o){return!(lo(o)||function(n){return!!(fn["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||fn["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||fn["Letterlike Symbols"](n)||fn["Number Forms"](n)||fn["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||fn["Control Pictures"](n)&&n!==9251||fn["Optical Character Recognition"](n)||fn["Enclosed Alphanumerics"](n)||fn["Geometric Shapes"](n)||fn["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||fn["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||fn["CJK Symbols and Punctuation"](n)||fn.Katakana(n)||fn["Private Use Area"](n)||fn["CJK Compatibility Forms"](n)||fn["Small Form Variants"](n)||fn["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}const Bp=Mu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Kh(o){return Bp.test(String.fromCodePoint(o))}function ff(o,n){return!(!n&&Kh(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||fn.Khmer(o))}function pf(o){for(const n of o)if(Kh(n.charCodeAt(0)))return!0;return!1}const Cs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Cs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,n){return l(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const s=o.pluginURL,c=new Promise(y=>{this.loadScriptResolve=y});n(s);const f=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([c,f]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:s};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class hr{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pu,this.transition={})}isSupportedScript(n){return function(s,c){for(const f of s)if(!ff(f.charCodeAt(0),c))return!1;return!0}(n,Cs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),c=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Sc{constructor(n,s){this.property=n,this.value=s,this.expression=function(c,f){if(xu(c))return new _c(c,f);if(pc(c)){const y=gc(c,f);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=c;return f.type==="color"&&typeof c=="string"?y=An.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?y=Jr.parse(c):f.type==="projectionDefinition"&&typeof c=="string"&&(y=Ii.parse(c)):y=Yr.parse(c),{kind:"constant",evaluate:()=>y}}}(s===void 0?n.specification.default:s,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,c){return this.property.possiblyEvaluate(this,n,s,c)}}class Iu{constructor(n){this.property=n,this.value=new Sc(n,void 0)}transitioned(n,s){return new La(this.property,this.value,s,nn({},n.transition,this.transition),n.now)}untransitioned(){return new La(this.property,this.value,null,{},0)}}class Tc{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Qt(this._values[n].value.value)}setValue(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Iu(this._values[n].property)),this._values[n].value=new Sc(this._values[n].property,s===null?void 0:Qt(s))}getTransition(n){return Qt(this._values[n].transition)}setTransition(n,s){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Iu(this._values[n].property)),this._values[n].transition=Qt(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c);const f=this.getTransition(s);f!==void 0&&(n[`${s}-transition`]=f)}return n}transitioned(n,s){const c=new sa(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(n,s._values[f]);return c}untransitioned(){const n=new sa(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class La{constructor(n,s,c,f,y){this.property=n,this.value=s,this.begin=y+f.delay||0,this.end=this.begin+f.duration||0,n.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(n,s,c){const f=n.now||0,y=this.value.possiblyEvaluate(n,s,c),v=this.prior;if(v){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return v.possiblyEvaluate(n,s,c);{const S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(n,s,c),y,Rt(S))}}return y}}class sa{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,c){const f=new ku(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(n,s,c);return f}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Np{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return Qt(this._values[n].value)}setValue(n,s){this._values[n]=new Sc(this._values[n].property,s===null?void 0:Qt(s))}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c)}return n}possiblyEvaluate(n,s,c){const f=new ku(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(n,s,c);return f}}class co{constructor(n,s,c){this.property=n,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,c,f){return this.property.evaluate(this.value,this.parameters,n,s,c,f)}}class ku{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Et{constructor(n){this.specification=n}possiblyEvaluate(n,s){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(s)}interpolate(n,s,c){const f=ki[this.specification.type];return f?f(n,s,c):n}}class Vt{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,c,f){return new co(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},c,f)}:n.expression,s)}interpolate(n,s,c){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new co(this,{kind:"constant",value:void 0},n.parameters);const f=ki[this.specification.type];if(f){const y=f(n.value.value,s.value.value,c);return new co(this,{kind:"constant",value:y},n.parameters)}return n}evaluate(n,s,c,f,y,v){return n.kind==="constant"?n.value:n.evaluate(s,c,f,y,v)}}class jo extends Vt{possiblyEvaluate(n,s,c,f){if(n.value===void 0)return new co(this,{kind:"constant",value:void 0},s);if(n.expression.kind==="constant"){const y=n.expression.evaluate(s,null,{},c,f),v=n.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,S=this._calculate(v,v,v,s);return new co(this,{kind:"constant",value:S},s)}if(n.expression.kind==="camera"){const y=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new co(this,{kind:"constant",value:y},s)}return new co(this,n.expression,s)}evaluate(n,s,c,f,y,v){if(n.kind==="source"){const S=n.evaluate(s,c,f,y,v);return this._calculate(S,S,S,s)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},c,f),n.evaluate({zoom:Math.floor(s.zoom)},c,f),n.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):n.value}_calculate(n,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:c,to:s}}interpolate(n){return n}}class Ri{constructor(n){this.specification=n}possiblyEvaluate(n,s,c,f){if(n.value!==void 0){if(n.expression.kind==="constant"){const y=n.expression.evaluate(s,null,{},c,f);return this._calculate(y,y,y,s)}return this._calculate(n.expression.evaluate(new hr(Math.floor(s.zoom-1),s)),n.expression.evaluate(new hr(Math.floor(s.zoom),s)),n.expression.evaluate(new hr(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:c,to:s}}interpolate(n){return n}}class Yh{constructor(n){this.specification=n}possiblyEvaluate(n,s,c,f){return!!n.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Di{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const c=n[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Sc(c,void 0),y=this.defaultTransitionablePropertyValues[s]=new Iu(c);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}St("DataDrivenProperty",Vt),St("DataConstantProperty",Et),St("CrossFadedDataDrivenProperty",jo),St("CrossFadedProperty",Ri),St("ColorRampProperty",Yh);const Jh="-transition";class Hi extends ze{constructor(n,s){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),s.layout&&(this._unevaluatedLayout=new Np(s.layout)),s.paint)){this._transitionablePaint=new Tc(s.paint);for(const c in n.paint)this.setPaintProperty(c,n.paint[c],{validate:!1});for(const c in n.layout)this.setLayoutProperty(c,n.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ku(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s,c={}){s!=null&&this._validate(Op,`layers.${this.id}.layout.${n}`,n,s,c)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,s):this.visibility=s)}getPaintProperty(n){return n.endsWith(Jh)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,c={}){if(s!=null&&this._validate(Gh,`layers.${this.id}.paint.${n}`,n,s,c))return!1;if(n.endsWith(Jh))return this._transitionablePaint.setTransition(n.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[n],y=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),S=f.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const E=this._transitionablePaint._values[n].value;return E.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(n,S,E)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,s,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),rn(n,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(n,s,c,f,y={}){return(!y||y.validate!==!1)&&Cu(this,n.call(wl,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:F,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof co&&Fo(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const aa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Uo{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wr(o,n=1){let s=0,c=0;return{members:o.map(f=>{const y=aa[f.type].BYTES_PER_ELEMENT,v=s=mf(s,Math.max(n,y)),S=f.components||1;return c=Math.max(c,y),s+=y*S,{name:f.name,type:f.type,components:S,offset:v}}),size:mf(s,Math.max(c,n)),alignment:n}}function mf(o,n){return Math.ceil(o/n)*n}class Fa extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const f=2*n;return this.int16[f+0]=s,this.int16[f+1]=c,n}}Fa.prototype.bytesPerElement=4,St("StructArrayLayout2i4",Fa);class Vr extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,c)}emplace(n,s,c,f){const y=3*n;return this.int16[y+0]=s,this.int16[y+1]=c,this.int16[y+2]=f,n}}Vr.prototype.bytesPerElement=6,St("StructArrayLayout3i6",Vr);class Cc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,s,c,f)}emplace(n,s,c,f,y){const v=4*n;return this.int16[v+0]=s,this.int16[v+1]=c,this.int16[v+2]=f,this.int16[v+3]=y,n}}Cc.prototype.bytesPerElement=8,St("StructArrayLayout4i8",Cc);class ls extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,c,f,y,v)}emplace(n,s,c,f,y,v,S){const E=6*n;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+3]=y,this.int16[E+4]=v,this.int16[E+5]=S,n}}ls.prototype.bytesPerElement=12,St("StructArrayLayout2i4i12",ls);class uo extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,c,f,y,v)}emplace(n,s,c,f,y,v,S){const E=4*n,I=8*n;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=y,this.uint8[I+6]=v,this.uint8[I+7]=S,n}}uo.prototype.bytesPerElement=8,St("StructArrayLayout2i4ub8",uo);class Ps extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const f=2*n;return this.float32[f+0]=s,this.float32[f+1]=c,n}}Ps.prototype.bytesPerElement=8,St("StructArrayLayout2f8",Ps);class Oa extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v,S,E,I,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,s,c,f,y,v,S,E,I,A)}emplace(n,s,c,f,y,v,S,E,I,A,R){const N=10*n;return this.uint16[N+0]=s,this.uint16[N+1]=c,this.uint16[N+2]=f,this.uint16[N+3]=y,this.uint16[N+4]=v,this.uint16[N+5]=S,this.uint16[N+6]=E,this.uint16[N+7]=I,this.uint16[N+8]=A,this.uint16[N+9]=R,n}}Oa.prototype.bytesPerElement=20,St("StructArrayLayout10ui20",Oa);class Vo extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v,S,E,I,A,R,N){const U=this.length;return this.resize(U+1),this.emplace(U,n,s,c,f,y,v,S,E,I,A,R,N)}emplace(n,s,c,f,y,v,S,E,I,A,R,N,U){const V=12*n;return this.int16[V+0]=s,this.int16[V+1]=c,this.int16[V+2]=f,this.int16[V+3]=y,this.uint16[V+4]=v,this.uint16[V+5]=S,this.uint16[V+6]=E,this.uint16[V+7]=I,this.int16[V+8]=A,this.int16[V+9]=R,this.int16[V+10]=N,this.int16[V+11]=U,n}}Vo.prototype.bytesPerElement=24,St("StructArrayLayout4i4ui4i24",Vo);class Au extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,c)}emplace(n,s,c,f){const y=3*n;return this.float32[y+0]=s,this.float32[y+1]=c,this.float32[y+2]=f,n}}Au.prototype.bytesPerElement=12,St("StructArrayLayout3f12",Au);class $r extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}$r.prototype.bytesPerElement=4,St("StructArrayLayout1ul4",$r);class Es extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v,S,E,I){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,c,f,y,v,S,E,I)}emplace(n,s,c,f,y,v,S,E,I,A){const R=10*n,N=5*n;return this.int16[R+0]=s,this.int16[R+1]=c,this.int16[R+2]=f,this.int16[R+3]=y,this.int16[R+4]=v,this.int16[R+5]=S,this.uint32[N+3]=E,this.uint16[R+8]=I,this.uint16[R+9]=A,n}}Es.prototype.bytesPerElement=20,St("StructArrayLayout6i1ul2ui20",Es);class Qh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,c,f,y,v)}emplace(n,s,c,f,y,v,S){const E=6*n;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+3]=y,this.int16[E+4]=v,this.int16[E+5]=S,n}}Qh.prototype.bytesPerElement=12,St("StructArrayLayout2i2i2i12",Qh);class zu extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,n,s,c,f,y)}emplace(n,s,c,f,y,v){const S=4*n,E=8*n;return this.float32[S+0]=s,this.float32[S+1]=c,this.float32[S+2]=f,this.int16[E+6]=y,this.int16[E+7]=v,n}}zu.prototype.bytesPerElement=16,St("StructArrayLayout2f1f2i16",zu);class Ba extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,c,f,y,v)}emplace(n,s,c,f,y,v,S){const E=16*n,I=4*n,A=8*n;return this.uint8[E+0]=s,this.uint8[E+1]=c,this.float32[I+1]=f,this.float32[I+2]=y,this.int16[A+6]=v,this.int16[A+7]=S,n}}Ba.prototype.bytesPerElement=16,St("StructArrayLayout2ub2f2i16",Ba);class Tl extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,c)}emplace(n,s,c,f){const y=3*n;return this.uint16[y+0]=s,this.uint16[y+1]=c,this.uint16[y+2]=f,n}}Tl.prototype.bytesPerElement=6,St("StructArrayLayout3ui6",Tl);class ed extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae)}emplace(n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae,Ce){const de=24*n,j=12*n,K=48*n;return this.int16[de+0]=s,this.int16[de+1]=c,this.uint16[de+2]=f,this.uint16[de+3]=y,this.uint32[j+2]=v,this.uint32[j+3]=S,this.uint32[j+4]=E,this.uint16[de+10]=I,this.uint16[de+11]=A,this.uint16[de+12]=R,this.float32[j+7]=N,this.float32[j+8]=U,this.uint8[K+36]=V,this.uint8[K+37]=q,this.uint8[K+38]=J,this.uint32[j+10]=ae,this.int16[de+22]=Ce,n}}ed.prototype.bytesPerElement=48,St("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ed);class la extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae,Ce,de,j,K,fe,Ne,Je,Fe,Ge,ft,at){const pt=this.length;return this.resize(pt+1),this.emplace(pt,n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae,Ce,de,j,K,fe,Ne,Je,Fe,Ge,ft,at)}emplace(n,s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae,Ce,de,j,K,fe,Ne,Je,Fe,Ge,ft,at,pt){const Qe=32*n,Ct=16*n;return this.int16[Qe+0]=s,this.int16[Qe+1]=c,this.int16[Qe+2]=f,this.int16[Qe+3]=y,this.int16[Qe+4]=v,this.int16[Qe+5]=S,this.int16[Qe+6]=E,this.int16[Qe+7]=I,this.uint16[Qe+8]=A,this.uint16[Qe+9]=R,this.uint16[Qe+10]=N,this.uint16[Qe+11]=U,this.uint16[Qe+12]=V,this.uint16[Qe+13]=q,this.uint16[Qe+14]=J,this.uint16[Qe+15]=ae,this.uint16[Qe+16]=Ce,this.uint16[Qe+17]=de,this.uint16[Qe+18]=j,this.uint16[Qe+19]=K,this.uint16[Qe+20]=fe,this.uint16[Qe+21]=Ne,this.uint16[Qe+22]=Je,this.uint32[Ct+12]=Fe,this.float32[Ct+13]=Ge,this.float32[Ct+14]=ft,this.uint16[Qe+30]=at,this.uint16[Qe+31]=pt,n}}la.prototype.bytesPerElement=64,St("StructArrayLayout8i15ui1ul2f2ui64",la);class Pc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}Pc.prototype.bytesPerElement=4,St("StructArrayLayout1f4",Pc);class g extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,c)}emplace(n,s,c,f){const y=3*n;return this.uint16[6*n+0]=s,this.float32[y+1]=c,this.float32[y+2]=f,n}}g.prototype.bytesPerElement=12,St("StructArrayLayout1ui2f12",g);class e extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,c)}emplace(n,s,c,f){const y=4*n;return this.uint32[2*n+0]=s,this.uint16[y+2]=c,this.uint16[y+3]=f,n}}e.prototype.bytesPerElement=8,St("StructArrayLayout1ul2ui8",e);class i extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const f=2*n;return this.uint16[f+0]=s,this.uint16[f+1]=c,n}}i.prototype.bytesPerElement=4,St("StructArrayLayout2ui4",i);class u extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}u.prototype.bytesPerElement=2,St("StructArrayLayout1ui2",u);class d extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,s,c,f)}emplace(n,s,c,f,y){const v=4*n;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,this.float32[v+3]=y,n}}d.prototype.bytesPerElement=16,St("StructArrayLayout4f16",d);class _ extends Uo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Te(this.anchorPointX,this.anchorPointY)}}_.prototype.size=20;class w extends Es{get(n){return new _(this,n)}}St("CollisionBoxArray",w);class P extends Uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}P.prototype.size=48;class M extends ed{get(n){return new P(this,n)}}St("PlacedSymbolArray",M);class k extends Uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}k.prototype.size=64;class D extends la{get(n){return new k(this,n)}}St("SymbolInstanceArray",D);class O extends Pc{getoffsetX(n){return this.float32[1*n+0]}}St("GlyphOffsetArray",O);class B extends Vr{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}St("SymbolLineVertexArray",B);class G extends Uo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}G.prototype.size=12;class W extends g{get(n){return new G(this,n)}}St("TextAnchorOffsetArray",W);class ie extends Uo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ie.prototype.size=8;class re extends e{get(n){return new ie(this,n)}}St("FeatureIndexArray",re);class se extends Fa{}class ue extends Fa{}class me extends Fa{}class ge extends ls{}class be extends uo{}class Pe extends Ps{}class Se extends Oa{}class Be extends Vo{}class je extends Au{}class He extends $r{}class Ye extends Qh{}class Ze extends Ba{}class tt extends Tl{}class mt extends i{}const ot=wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mt}=ot;class Ot{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,s,c,f){const y=this.segments[this.segments.length-1];return n>Ot.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${Ot.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ot.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+n>Ot.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f?this.createNewSegment(s,c,f):y}createNewSegment(n,s,c){const f={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(f.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(n,s,c){return this.prepareSegment(0,n,s,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,c,f){return new Ot([{vertexOffset:n,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}function Fn(o,n){return 256*(o=Tt(Math.floor(o),0,255))+Tt(Math.floor(n),0,255)}Ot.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St("SegmentVector",Ot);const ar=wr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var vn,_r,Jn,zn={exports:{}},Wn={exports:{}},Qr={exports:{}},Hn=function(){if(Jn)return zn.exports;Jn=1;var o=(vn||(vn=1,Wn.exports=function(s,c){var f,y,v,S,E,I,A,R;for(y=s.length-(f=3&s.length),v=c,E=3432918353,I=461845907,R=0;R<y;)A=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,v=27492+(65535&(S=5*(65535&(v=(v^=A=(65535&(A=(A=(65535&A)*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(A=0,f){case 3:A^=(255&s.charCodeAt(R+2))<<16;case 2:A^=(255&s.charCodeAt(R+1))<<8;case 1:v^=A=(65535&(A=(A=(65535&(A^=255&s.charCodeAt(R)))*E+(((A>>>16)*E&65535)<<16)&4294967295)<<15|A>>>17))*I+(((A>>>16)*I&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Wn.exports),n=(_r||(_r=1,Qr.exports=function(s,c){for(var f,y=s.length,v=c^y,S=0;y>=4;)f=1540483477*(65535&(f=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:v^=(255&s.charCodeAt(S+2))<<16;case 2:v^=(255&s.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Qr.exports);return zn.exports=o,zn.exports.murmur3=o,zn.exports.murmur2=n,zn.exports}(),dr=L(Hn);class ei{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,c,f){this.ids.push(Ms(n)),this.positions.push(s,c,f)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Ms(n);let c=0,f=this.ids.length-1;for(;c<f;){const v=c+f>>1;this.ids[v]>=s?f=v:c=v+1}const y=[];for(;this.ids[c]===s;)y.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return y}static serialize(n,s){const c=new Float64Array(n.ids),f=new Uint32Array(n.positions);return wo(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(n){const s=new ei;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function Ms(o){const n=+o;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:dr(String(o))}function wo(o,n,s,c){for(;s<c;){const f=o[s+c>>1];let y=s-1,v=c+1;for(;;){do y++;while(o[y]<f);do v--;while(o[v]>f);if(y>=v)break;$o(o,y,v),$o(n,3*y,3*v),$o(n,3*y+1,3*v+1),$o(n,3*y+2,3*v+2)}v-s<c-v?(wo(o,n,s,v),s=v+1):(wo(o,n,v+1,c),c=v)}}function $o(o,n,s){const c=o[n];o[n]=o[s],o[s]=c}St("FeaturePositionMap",ei);class Xi{constructor(n,s){this.gl=n.gl,this.location=s}}class ca extends Xi{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Na extends Xi{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Is extends Xi{constructor(n,s){super(n,s),this.current=An.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const ti=new Float32Array(16);function cs(o){return[Fn(255*o.r,255*o.g),Fn(255*o.b,255*o.a)]}class ui{constructor(n,s,c){this.value=n,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(n,s,c){n.set(c.constantOr(this.value))}getBinding(n,s,c){return this.type==="color"?new Is(n,s):new ca(n,s)}}class Zo{constructor(n,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr}setUniform(n,s,c,f){const y=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&n.set(y)}getBinding(n,s,c){return c.substr(0,9)==="u_pattern"?new Na(n,s):new ca(n,s)}}class or{constructor(n,s,c,f){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(n,s,c,f,y){const v=this.paintVertexArray.length,S=this.expression.evaluate(new hr(0),s,{},f,[],y);this.paintVertexArray.resize(n),this._setPaintValue(v,n,S)}updatePaintArray(n,s,c,f){const y=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(n,s,y)}_setPaintValue(n,s,c){if(this.type==="color"){const f=cs(c);for(let y=n;y<s;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=n;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xn{constructor(n,s,c,f,y,v){this.expression=n,this.uniformNames=s.map(S=>`u_${S}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(S=>({name:`a_${S}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,s,c,f,y){const v=this.expression.evaluate(new hr(this.zoom),s,{},f,[],y),S=this.expression.evaluate(new hr(this.zoom+1),s,{},f,[],y),E=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(E,n,v,S)}updatePaintArray(n,s,c,f){const y=this.expression.evaluate({zoom:this.zoom},c,f),v=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(n,s,y,v)}_setPaintValue(n,s,c,f){if(this.type==="color"){const y=cs(c),v=cs(f);for(let S=n;S<s;S++)this.paintVertexArray.emplace(S,y[0],y[1],v[0],v[1])}else{for(let y=n;y<s;y++)this.paintVertexArray.emplace(y,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=Tt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);n.set(f)}getBinding(n,s,c){return new ca(n,s)}}class ni{constructor(n,s,c,f,y,v){this.expression=n,this.type=s,this.useIntegerZoom=c,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(n,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(f,n,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(n,s,c,f,y){this._setPaintValues(n,s,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(n,s,c,f){if(!f||!c)return;const{min:y,mid:v,max:S}=c,E=f[y],I=f[v],A=f[S];if(E&&I&&A)for(let R=n;R<s;R++)this.zoomInPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,ar.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,ar.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ri{constructor(n,s,c){this.binders={},this._buffers=[];const f=[];for(const y in n.paint._values){if(!c(y))continue;const v=n.paint.get(y);if(!(v instanceof co&&Fo(v.property.specification)))continue;const S=gf(y,n.type),E=v.value,I=v.property.specification.type,A=v.property.useIntegerZoom,R=v.property.specification["property-type"],N=R==="cross-faded"||R==="cross-faded-data-driven";if(E.kind==="constant")this.binders[y]=N?new Zo(E.value,S):new ui(E.value,S,I),f.push(`/u_${y}`);else if(E.kind==="source"||N){const U=td(y,I,"source");this.binders[y]=N?new ni(E,I,A,s,U,n.id):new or(E,S,I,U),f.push(`/a_${y}`)}else{const U=td(y,I,"composite");this.binders[y]=new Xn(E,S,I,A,s,U),f.push(`/z_${y}`)}}this.cacheKey=f.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof or||s instanceof Xn?s.maxValue:0}populatePaintArrays(n,s,c,f,y){for(const v in this.binders){const S=this.binders[v];(S instanceof or||S instanceof Xn||S instanceof ni)&&S.populatePaintArray(n,s,c,f,y)}}setConstantPatternPositions(n,s){for(const c in this.binders){const f=this.binders[c];f instanceof Zo&&f.setConstantPatternPositions(n,s)}}updatePaintArrays(n,s,c,f,y){let v=!1;for(const S in n){const E=s.getPositions(S);for(const I of E){const A=c.feature(I.index);for(const R in this.binders){const N=this.binders[R];if((N instanceof or||N instanceof Xn||N instanceof ni)&&N.expression.isStateDependent===!0){const U=f.paint.get(R);N.expression=U.value,N.updatePaintArray(I.start,I.end,A,n[S],y),v=!0}}}}return v}defines(){const n=[];for(const s in this.binders){const c=this.binders[s];(c instanceof ui||c instanceof Zo)&&n.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof or||c instanceof Xn)for(let f=0;f<c.paintVertexAttributes.length;f++)n.push(c.paintVertexAttributes[f].name);else if(c instanceof ni)for(let f=0;f<ar.members.length;f++)n.push(ar.members[f].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ui||c instanceof Zo||c instanceof Xn)for(const f of c.uniformNames)n.push(f)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const c=[];for(const f in this.binders){const y=this.binders[f];if(y instanceof ui||y instanceof Zo||y instanceof Xn){for(const v of y.uniformNames)if(s[v]){const S=y.getBinding(n,s[v],v);c.push({name:v,property:f,binding:S})}}}return c}setUniforms(n,s,c,f){for(const{name:y,property:v,binding:S}of s)this.binders[v].setUniform(S,f,c.get(v),y)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(n&&c instanceof ni){const f=n.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof or||c instanceof Xn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(n){for(const s in this.binders){const c=this.binders[s];(c instanceof or||c instanceof Xn||c instanceof ni)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof or||s instanceof Xn||s instanceof ni)&&s.destroy()}}}class ja{constructor(n,s,c=()=>!0){this.programConfigurations={};for(const f of n)this.programConfigurations[f.id]=new ri(f,s,c);this.needsUpload=!1,this._featureMap=new ei,this._bufferOffset=0}populatePaintArrays(n,s,c,f,y,v){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(n,s,f,y,v);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,c,f){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,s,y,f)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function gf(o,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}function td(o,n,s){const c={color:{source:Ps,composite:d},number:{source:Pc,composite:Ps}},f=function(y){return{"line-pattern":{source:Se,composite:Se},"fill-pattern":{source:Se,composite:Se},"fill-extrusion-pattern":{source:Se,composite:Se}}[y]}(o);return f&&f[s]||c[n][s]}St("ConstantBinder",ui),St("CrossFadedConstantBinder",Zo),St("SourceExpressionBinder",or),St("CrossFadedCompositeBinder",ni),St("CompositeExpressionBinder",Xn),St("ProgramConfiguration",ri,{omit:["_buffers"]}),St("ProgramConfigurationSet",ja);const nd=Math.pow(2,14)-1,rd=-nd-1;function ua(o){const n=Kt/o.extent,s=o.loadGeometry();for(let c=0;c<s.length;c++){const f=s[c];for(let y=0;y<f.length;y++){const v=f[y],S=Math.round(v.x*n),E=Math.round(v.y*n);v.x=Tt(S,rd,nd),v.y=Tt(E,rd,nd),(S<v.x||S>v.x+1||E<v.y||E>v.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function fr(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?ua(o):[]}}const So=-32768;function _f(o,n,s,c,f){o.emplaceBack(So+8*n+c,So+8*s+f)}class Ru{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ue,this.indexArray=new tt,this.segments=new Ot,this.programConfigurations=new ja(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c){const f=this.layers[0],y=[];let v=null,S=!1,E=f.type==="heatmap";if(f.type==="circle"){const A=f;v=A.layout.get("circle-sort-key"),S=!v.isConstant(),E=E||A.paint.get("circle-pitch-alignment")==="map"}const I=E?s.subdivisionGranularity.circle:1;for(const{feature:A,id:R,index:N,sourceLayerIndex:U}of n){const V=this.layers[0]._featureFilter.needGeometry,q=fr(A,V);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),q,c))continue;const J=S?v.evaluate(q,{},c):void 0,ae={id:R,properties:A.properties,type:A.type,sourceLayerIndex:U,index:N,geometry:V?q.geometry:ua(A),patterns:{},sortKey:J};y.push(ae)}S&&y.sort((A,R)=>A.sortKey-R.sortKey);for(const A of y){const{geometry:R,index:N,sourceLayerIndex:U}=A,V=n[N].feature;this.addFeature(A,R,N,c,I),s.featureIndex.insert(V,R,N,U,this.index)}}update(n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Mt),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,c,f,y=1){let v;switch(y){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const S=v.length;for(const E of s)for(const I of E){const A=I.x,R=I.y;if(A<0||A>=Kt||R<0||R>=Kt)continue;const N=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,n.sortKey),U=N.vertexLength;for(let V=0;V<S;V++)for(let q=0;q<S;q++)_f(this.layoutVertexArray,A,R,v[q],v[V]);for(let V=0;V<S-1;V++)for(let q=0;q<S-1;q++){const J=U+V*S+q,ae=U+(V+1)*S+q;this.indexArray.emplaceBack(J,ae+1,J+1),this.indexArray.emplaceBack(J,ae,ae+1)}N.vertexLength+=S*S,N.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},f)}}function Ua(o,n){for(let s=0;s<o.length;s++)if(Mc(n,o[s]))return!0;for(let s=0;s<n.length;s++)if(Mc(o,n[s]))return!0;return!!jp(o,n)}function Va(o,n,s){return!!Mc(o,n)||!!Cl(n,o,s)}function Ec(o,n){if(o.length===1)return zg(n,o[0]);for(let s=0;s<n.length;s++){const c=n[s];for(let f=0;f<c.length;f++)if(Mc(o,c[f]))return!0}for(let s=0;s<o.length;s++)if(zg(n,o[s]))return!0;for(let s=0;s<n.length;s++)if(jp(o,n[s]))return!0;return!1}function kg(o,n,s){if(o.length>1){if(jp(o,n))return!0;for(let c=0;c<n.length;c++)if(Cl(n[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Cl(o[c],n,s))return!0;return!1}function jp(o,n){if(o.length===0||n.length===0)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],f=o[s+1];for(let y=0;y<n.length-1;y++)if(Ag(c,f,n[y],n[y+1]))return!0}return!1}function Ag(o,n,s,c){return on(o,s,c)!==on(n,s,c)&&on(o,n,s)!==on(o,n,c)}function Cl(o,n,s){const c=s*s;if(n.length===1)return o.distSqr(n[0])<c;for(let f=1;f<n.length;f++)if(Du(o,n[f-1],n[f])<c)return!0;return!1}function Du(o,n,s){const c=n.distSqr(s);if(c===0)return o.distSqr(n);const f=((o.x-n.x)*(s.x-n.x)+(o.y-n.y)*(s.y-n.y))/c;return o.distSqr(f<0?n:f>1?s:s.sub(n)._mult(f)._add(n))}function zg(o,n){let s,c,f,y=!1;for(let v=0;v<o.length;v++){s=o[v];for(let S=0,E=s.length-1;S<s.length;E=S++)c=s[S],f=s[E],c.y>n.y!=f.y>n.y&&n.x<(f.x-c.x)*(n.y-c.y)/(f.y-c.y)+c.x&&(y=!y)}return y}function Mc(o,n){let s=!1;for(let c=0,f=o.length-1;c<o.length;f=c++){const y=o[c],v=o[f];y.y>n.y!=v.y>n.y&&n.x<(v.x-y.x)*(n.y-y.y)/(v.y-y.y)+y.x&&(s=!s)}return s}function Rg(o,n,s){const c=s[0],f=s[2];if(o.x<c.x&&n.x<c.x||o.x>f.x&&n.x>f.x||o.y<c.y&&n.y<c.y||o.y>f.y&&n.y>f.y)return!1;const y=on(o,n,s[0]);return y!==on(o,n,s[1])||y!==on(o,n,s[2])||y!==on(o,n,s[3])}function Pl(o,n,s){const c=n.paint.get(o).value;return c.kind==="constant"?c.value:s.programConfigurations.get(n.id).getMaxValue(o)}function id(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ic(o,n,s,c,f){if(!n[0]&&!n[1])return o;const y=Te.convert(n)._mult(f);s==="viewport"&&y._rotate(-c);const v=[];for(let S=0;S<o.length;S++)v.push(o[S].sub(y));return v}let yf,od;St("CircleBucket",Ru,{omit:["layers"]});var Z0={get paint(){return od=od||new Di({"circle-radius":new Vt(F.paint_circle["circle-radius"]),"circle-color":new Vt(F.paint_circle["circle-color"]),"circle-blur":new Vt(F.paint_circle["circle-blur"]),"circle-opacity":new Vt(F.paint_circle["circle-opacity"]),"circle-translate":new Et(F.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(F.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(F.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(F.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(F.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(F.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(F.paint_circle["circle-stroke-opacity"])})},get layout(){return yf=yf||new Di({"circle-sort-key":new Vt(F.layout_circle["circle-sort-key"])})}};class Dg extends Hi{constructor(n){super(n,Z0)}createBucket(n){return new Ru(n)}queryRadius(n){const s=n;return Pl("circle-radius",this,s)+Pl("circle-stroke-width",this,s)+id(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:c,geometry:f,transform:y,pixelsToTileUnits:v,pixelPosMatrix:S}){const E=Ic(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,v),I=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c),A=this.paint.get("circle-pitch-alignment")==="map",R=A?E:function(U,V){return U.map(q=>sd(q,V))}(E,S),N=A?I*v:I;for(const U of f)for(const V of U){const q=A?V:sd(V,S);let J=N;const ae=lt([],[V.x,V.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=ae[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=y.cameraToCenterDistance/ae[3]),Va(R,q,J))return!0}return!1}}function sd(o,n){const s=lt([],[o.x,o.y,0,1],n);return new Te(s[0]/s[3],s[1]/s[3])}class Up extends Ru{}let vf;St("HeatmapBucket",Up,{omit:["layers"]});var G0={get paint(){return vf=vf||new Di({"heatmap-radius":new Vt(F.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(F.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(F.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yh(F.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(F.paint_heatmap["heatmap-opacity"])})}};function xf(o,{width:n,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==n*s*c)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${n*s*c}`)}else f=new Uint8Array(n*s*c);return o.width=n,o.height=s,o.data=f,o}function ha(o,{width:n,height:s},c){if(n===o.width&&s===o.height)return;const f=xf({},{width:n,height:s},c);bf(o,f,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,n),height:Math.min(o.height,s)},c),o.width=n,o.height=s,o.data=f.data}function bf(o,n,s,c,f,y){if(f.width===0||f.height===0)return n;if(f.width>o.width||f.height>o.height||s.x>o.width-f.width||s.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>n.width||f.height>n.height||c.x>n.width-f.width||c.y>n.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,S=n.data;if(v===S)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<f.height;E++){const I=((s.y+E)*o.width+s.x)*y,A=((c.y+E)*n.width+c.x)*y;for(let R=0;R<f.width*y;R++)S[A+R]=v[I+R]}return n}class Lu{constructor(n,s){xf(this,n,1,s)}resize(n){ha(this,n,1)}clone(){return new Lu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,f,y){bf(n,s,c,f,y,1)}}class Go{constructor(n,s){xf(this,n,4,s)}resize(n){ha(this,n,4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,f,y){bf(n,s,c,f,y,4)}}function Vp(o){const n={},s=o.resolution||256,c=o.clips?o.clips.length:1,f=o.image||new Go({width:s,height:c});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(v,S,E)=>{n[o.evaluationKey]=E;const I=o.expression.evaluate(n);f.data[v+S+0]=Math.floor(255*I.r/I.a),f.data[v+S+1]=Math.floor(255*I.g/I.a),f.data[v+S+2]=Math.floor(255*I.b/I.a),f.data[v+S+3]=Math.floor(255*I.a)};if(o.clips)for(let v=0,S=0;v<c;++v,S+=4*s)for(let E=0,I=0;E<s;E++,I+=4){const A=E/(s-1),{start:R,end:N}=o.clips[v];y(S,I,R*(1-A)+N*A)}else for(let v=0,S=0;v<s;v++,S+=4)y(0,S,v/(s-1));return f}St("AlphaImage",Lu),St("RGBAImage",Go);const $p="big-fb";class q0 extends Hi{createBucket(n){return new Up(n)}constructor(n){super(n,G0),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has($p)&&this.heatmapFbos.delete($p)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let da;var Zp={get paint(){return da=da||new Di({"hillshade-illumination-direction":new Et(F.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(F.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(F.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(F.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(F.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(F.paint_hillshade["hillshade-accent-color"])})}};class Gp extends Hi{constructor(n){super(n,Zp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qp=wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:wf}=qp;function El(o,n,s){const c=s.patternDependencies;let f=!1;for(const y of n){const v=y.paint.get(`${o}-pattern`);v.isConstant()||(f=!0);const S=v.constantOr(null);S&&(f=!0,c[S.to]=!0,c[S.from]=!0)}return f}function Yt(o,n,s,c,f){const y=f.patternDependencies;for(const v of n){const S=v.paint.get(`${o}-pattern`).value;if(S.kind!=="constant"){let E=S.evaluate({zoom:c-1},s,{},f.availableImages),I=S.evaluate({zoom:c},s,{},f.availableImages),A=S.evaluate({zoom:c+1},s,{},f.availableImages);E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,y[E]=!0,y[I]=!0,y[A]=!0,s.patterns[v.id]={min:E,mid:I,max:A}}}return s}function ad(o,n,s,c,f){let y;if(f===function(v,S,E,I){let A=0;for(let R=S,N=E-I;R<E;R+=I)A+=(v[N]-v[R])*(v[R+1]+v[N+1]),N=R;return A}(o,n,s,c)>0)for(let v=n;v<s;v+=c)y=Ou(v/c|0,o[v],o[v+1],y);else for(let v=s-c;v>=n;v-=c)y=Ou(v/c|0,o[v],o[v+1],y);return y&&hi(y,y.next)&&(Bu(y),y=y.next),y}function $a(o,n){if(!o)return o;n||(n=o);let s,c=o;do if(s=!1,c.steiner||!hi(c,c.next)&&Qn(c.prev,c,c.next)!==0)c=c.next;else{if(Bu(c),c=n=c.prev,c===c.next)break;s=!0}while(s||c!==n);return n}function ks(o,n,s,c,f,y,v){if(!o)return;!v&&y&&function(E,I,A,R){let N=E;do N.z===0&&(N.z=Hp(N.x,N.y,I,A,R)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==E);N.prevZ.nextZ=null,N.prevZ=null,function(U){let V,q=1;do{let J,ae=U;U=null;let Ce=null;for(V=0;ae;){V++;let de=ae,j=0;for(let fe=0;fe<q&&(j++,de=de.nextZ,de);fe++);let K=q;for(;j>0||K>0&&de;)j!==0&&(K===0||!de||ae.z<=de.z)?(J=ae,ae=ae.nextZ,j--):(J=de,de=de.nextZ,K--),Ce?Ce.nextZ=J:U=J,J.prevZ=Ce,Ce=J;ae=de}Ce.nextZ=null,q*=2}while(V>1)}(N)}(o,c,f,y);let S=o;for(;o.prev!==o.next;){const E=o.prev,I=o.next;if(y?Wp(o,c,f,y):W0(o))n.push(E.i,o.i,I.i),Bu(o),o=I.next,S=I.next;else if((o=I)===S){v?v===1?ks(o=Lg($a(o),n),n,s,c,f,y,2):v===2&&Ki(o,n,s,c,f,y):ks($a(o),n,s,c,f,y,1);break}}}function W0(o){const n=o.prev,s=o,c=o.next;if(Qn(n,s,c)>=0)return!1;const f=n.x,y=s.x,v=c.x,S=n.y,E=s.y,I=c.y,A=Math.min(f,y,v),R=Math.min(S,E,I),N=Math.max(f,y,v),U=Math.max(S,E,I);let V=c.next;for(;V!==n;){if(V.x>=A&&V.x<=N&&V.y>=R&&V.y<=U&&ld(f,S,y,E,v,I,V.x,V.y)&&Qn(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Wp(o,n,s,c){const f=o.prev,y=o,v=o.next;if(Qn(f,y,v)>=0)return!1;const S=f.x,E=y.x,I=v.x,A=f.y,R=y.y,N=v.y,U=Math.min(S,E,I),V=Math.min(A,R,N),q=Math.max(S,E,I),J=Math.max(A,R,N),ae=Hp(U,V,n,s,c),Ce=Hp(q,J,n,s,c);let de=o.prevZ,j=o.nextZ;for(;de&&de.z>=ae&&j&&j.z<=Ce;){if(de.x>=U&&de.x<=q&&de.y>=V&&de.y<=J&&de!==f&&de!==v&&ld(S,A,E,R,I,N,de.x,de.y)&&Qn(de.prev,de,de.next)>=0||(de=de.prevZ,j.x>=U&&j.x<=q&&j.y>=V&&j.y<=J&&j!==f&&j!==v&&ld(S,A,E,R,I,N,j.x,j.y)&&Qn(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;de&&de.z>=ae;){if(de.x>=U&&de.x<=q&&de.y>=V&&de.y<=J&&de!==f&&de!==v&&ld(S,A,E,R,I,N,de.x,de.y)&&Qn(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;j&&j.z<=Ce;){if(j.x>=U&&j.x<=q&&j.y>=V&&j.y<=J&&j!==f&&j!==v&&ld(S,A,E,R,I,N,j.x,j.y)&&Qn(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function Lg(o,n){let s=o;do{const c=s.prev,f=s.next.next;!hi(c,f)&&Sf(c,s,s.next,f)&&cd(c,f)&&cd(f,c)&&(n.push(c.i,s.i,f.i),Bu(s),Bu(s.next),s=o=f),s=s.next}while(s!==o);return $a(s)}function Ki(o,n,s,c,f,y){let v=o;do{let S=v.next.next;for(;S!==v.prev;){if(v.i!==S.i&&K0(v,S)){let E=Ng(v,S);return v=$a(v,v.next),E=$a(E,E.next),ks(v,n,s,c,f,y,0),void ks(E,n,s,c,f,y,0)}S=S.next}v=v.next}while(v!==o)}function H0(o,n){let s=o.x-n.x;return s===0&&(s=o.y-n.y,s===0)&&(s=(o.next.y-o.y)/(o.next.x-o.x)-(n.next.y-n.y)/(n.next.x-n.x)),s}function X0(o,n){const s=function(f,y){let v=y;const S=f.x,E=f.y;let I,A=-1/0;if(hi(f,v))return v;do{if(hi(f,v.next))return v.next;if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){const q=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(q<=S&&q>A&&(A=q,I=v.x<v.next.x?v:v.next,q===S))return I}v=v.next}while(v!==y);if(!I)return null;const R=I,N=I.x,U=I.y;let V=1/0;v=I;do{if(S>=v.x&&v.x>=N&&S!==v.x&&Bg(E<U?S:A,E,N,U,E<U?A:S,E,v.x,v.y)){const q=Math.abs(E-v.y)/(S-v.x);cd(v,f)&&(q<V||q===V&&(v.x>I.x||v.x===I.x&&Fg(I,v)))&&(I=v,V=q)}v=v.next}while(v!==R);return I}(o,n);if(!s)return n;const c=Ng(s,o);return $a(c,c.next),$a(s,s.next)}function Fg(o,n){return Qn(o.prev,o,n.prev)<0&&Qn(n.next,o,o.next)<0}function Hp(o,n,s,c,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-c)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Og(o){let n=o,s=o;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==o);return s}function Bg(o,n,s,c,f,y,v,S){return(f-v)*(n-S)>=(o-v)*(y-S)&&(o-v)*(c-S)>=(s-v)*(n-S)&&(s-v)*(y-S)>=(f-v)*(c-S)}function ld(o,n,s,c,f,y,v,S){return!(o===v&&n===S)&&Bg(o,n,s,c,f,y,v,S)}function K0(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(s,c){let f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Sf(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(o,n)&&(cd(o,n)&&cd(n,o)&&function(s,c){let f=s,y=!1;const v=(s.x+c.x)/2,S=(s.y+c.y)/2;do f.y>S!=f.next.y>S&&f.next.y!==f.y&&v<(f.next.x-f.x)*(S-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==s);return y}(o,n)&&(Qn(o.prev,o,n.prev)||Qn(o,n.prev,n))||hi(o,n)&&Qn(o.prev,o,o.next)>0&&Qn(n.prev,n,n.next)>0)}function Qn(o,n,s){return(n.y-o.y)*(s.x-n.x)-(n.x-o.x)*(s.y-n.y)}function hi(o,n){return o.x===n.x&&o.y===n.y}function Sf(o,n,s,c){const f=Fu(Qn(o,n,s)),y=Fu(Qn(o,n,c)),v=Fu(Qn(s,c,o)),S=Fu(Qn(s,c,n));return f!==y&&v!==S||!(f!==0||!Tf(o,s,n))||!(y!==0||!Tf(o,c,n))||!(v!==0||!Tf(s,o,c))||!(S!==0||!Tf(s,n,c))}function Tf(o,n,s){return n.x<=Math.max(o.x,s.x)&&n.x>=Math.min(o.x,s.x)&&n.y<=Math.max(o.y,s.y)&&n.y>=Math.min(o.y,s.y)}function Fu(o){return o>0?1:o<0?-1:0}function cd(o,n){return Qn(o.prev,o,o.next)<0?Qn(o,n,o.next)>=0&&Qn(o,o.prev,n)>=0:Qn(o,n,o.prev)<0||Qn(o,o.next,n)<0}function Ng(o,n){const s=Cf(o.i,o.x,o.y),c=Cf(n.i,n.x,n.y),f=o.next,y=n.prev;return o.next=n,n.prev=o,s.next=f,f.prev=s,c.next=s,s.prev=c,y.next=c,c.prev=y,c}function Ou(o,n,s,c){const f=Cf(o,n,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Bu(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Cf(o,n,s){return{i:o,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Nu{constructor(n,s){if(s>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=s}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class Pf{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}Pf.noSubdivision=new Pf({fill:new Nu(0,0),line:new Nu(0,0),tile:new Nu(0,0),stencil:new Nu(0,0),circle:1}),St("SubdivisionGranularityExpression",Nu),St("SubdivisionGranularitySetting",Pf);const ju=-32768,ud=32767;class jg{constructor(n,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Kt/n,this._canonical=s}_getKey(n,s){return(n+=32768)<<16|(s+=32768)<<0}_vertexToIndex(n,s){if(n<-32768||s<-32768||n>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const c=0|Math.round(n),f=0|Math.round(s),y=this._getKey(c,f);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,v),this._vertexBuffer.push(c,f),v}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(f,y){const v=[];for(let S=0;S<y.length;S+=3){const E=y[S],I=y[S+1],A=y[S+2],R=f[2*E],N=f[2*E+1];(f[2*I]-R)*(f[2*A+1]-N)-(f[2*I+1]-N)*(f[2*A]-R)>0?(v.push(E),v.push(A),v.push(I)):(v.push(E),v.push(I),v.push(A))}return v}(this._vertexBuffer,n);const s=[],c=n.length;for(let f=0;f<c;f+=3){const y=[n[f+0],n[f+1],n[f+2]],v=[this._vertexBuffer[2*n[f+0]+0],this._vertexBuffer[2*n[f+0]+1],this._vertexBuffer[2*n[f+1]+0],this._vertexBuffer[2*n[f+1]+1],this._vertexBuffer[2*n[f+2]+0],this._vertexBuffer[2*n[f+2]+1]];let S=1/0,E=1/0,I=-1/0,A=-1/0;for(let q=0;q<3;q++){const J=v[2*q],ae=v[2*q+1];S=Math.min(S,J),I=Math.max(I,J),E=Math.min(E,ae),A=Math.max(A,ae)}if(S===I||E===A)continue;const R=Math.floor(S/this._granularityCellSize),N=Math.ceil(I/this._granularityCellSize),U=Math.floor(E/this._granularityCellSize),V=Math.ceil(A/this._granularityCellSize);if(R!==N||U!==V)for(let q=U;q<V;q++){const J=this._scanlineGenerateVertexRingForCellRow(q,v,y);Kp(this._vertexBuffer,J,s)}else s.push(...y)}return s}_scanlineGenerateVertexRingForCellRow(n,s,c){const f=n*this._granularityCellSize,y=f+this._granularityCellSize,v=[];for(let S=0;S<3;S++){const E=s[2*S],I=s[2*S+1],A=s[2*(S+1)%6],R=s[(2*(S+1)+1)%6],N=s[2*(S+2)%6],U=s[(2*(S+2)+1)%6],V=A-E,q=R-I,J=V===0,ae=q===0,Ce=(f-I)/q,de=(y-I)/q,j=Math.min(Ce,de),K=Math.max(Ce,de);if(!ae&&(j>=1||K<=0)||ae&&(I<f||I>y)){R>=f&&R<=y&&v.push(c[(S+1)%3]);continue}!ae&&j>0&&v.push(this._vertexToIndex(E+V*j,I+q*j));const fe=E+V*Math.max(j,0),Ne=E+V*Math.min(K,1);J||this._generateIntraEdgeVertices(v,E,I,A,R,fe,Ne),!ae&&K<1&&v.push(this._vertexToIndex(E+V*K,I+q*K)),(ae||R>=f&&R<=y)&&v.push(c[(S+1)%3]),!ae&&(R<=f||R>=y)&&this._generateInterEdgeVertices(v,E,I,A,R,N,U,Ne,f,y)}return v}_generateIntraEdgeVertices(n,s,c,f,y,v,S){const E=f-s,I=y-c,A=I===0,R=A?Math.min(s,f):Math.min(v,S),N=A?Math.max(s,f):Math.max(v,S),U=Math.floor(R/this._granularityCellSize)+1,V=Math.ceil(N/this._granularityCellSize)-1;if(A?s<f:v<S)for(let q=U;q<=V;q++){const J=q*this._granularityCellSize;n.push(this._vertexToIndex(J,c+I*(J-s)/E))}else for(let q=V;q>=U;q--){const J=q*this._granularityCellSize;n.push(this._vertexToIndex(J,c+I*(J-s)/E))}}_generateInterEdgeVertices(n,s,c,f,y,v,S,E,I,A){const R=y-c,N=v-f,U=S-y,V=(I-y)/U,q=(A-y)/U,J=Math.min(V,q),ae=Math.max(V,q),Ce=f+N*J;let de=Math.floor(Math.min(Ce,E)/this._granularityCellSize)+1,j=Math.ceil(Math.max(Ce,E)/this._granularityCellSize)-1,K=E<Ce;const fe=U===0;if(fe&&(S===I||S===A))return;if(fe||J>=1||ae<=0){const Je=c-S,Fe=v+(s-v)*Math.min((I-S)/Je,(A-S)/Je);de=Math.floor(Math.min(Fe,E)/this._granularityCellSize)+1,j=Math.ceil(Math.max(Fe,E)/this._granularityCellSize)-1,K=E<Fe}const Ne=R>0?A:I;if(K)for(let Je=de;Je<=j;Je++)n.push(this._vertexToIndex(Je*this._granularityCellSize,Ne));else for(let Je=j;Je>=de;Je--)n.push(this._vertexToIndex(Je*this._granularityCellSize,Ne))}_generateOutline(n){const s=[];for(const c of n){const f=kc(c,this._granularity,!0),y=this._pointArrayToIndices(f),v=[];for(let S=1;S<y.length;S++)v.push(y[S-1]),v.push(y[S]);s.push(v)}return s}_handlePoles(n){let s=!1,c=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(s||c)&&this._fillPoles(n,s,c)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let s=0;s<n.length;s+=2){const c=n[s+1];c===ju&&(n[s+1]=-32767),c===ud&&(n[s+1]=32766)}}_generatePoleQuad(n,s,c,f,y,v){f>y!=(v===ju)?(n.push(s),n.push(c),n.push(this._vertexToIndex(f,v)),n.push(c),n.push(this._vertexToIndex(y,v)),n.push(this._vertexToIndex(f,v))):(n.push(c),n.push(s),n.push(this._vertexToIndex(f,v)),n.push(this._vertexToIndex(y,v)),n.push(c),n.push(this._vertexToIndex(f,v)))}_fillPoles(n,s,c){const f=this._vertexBuffer,y=Kt,v=n.length;for(let S=2;S<v;S+=3){const E=n[S-2],I=n[S-1],A=n[S],R=f[2*E],N=f[2*E+1],U=f[2*I],V=f[2*I+1],q=f[2*A],J=f[2*A+1];s&&(N===0&&V===0&&this._generatePoleQuad(n,E,I,R,U,ju),V===0&&J===0&&this._generatePoleQuad(n,I,A,U,q,ju),J===0&&N===0&&this._generatePoleQuad(n,A,E,q,R,ju)),c&&(N===y&&V===y&&this._generatePoleQuad(n,E,I,R,U,ud),V===y&&J===y&&this._generatePoleQuad(n,I,A,U,q,ud),J===y&&N===y&&this._generatePoleQuad(n,A,E,q,R,ud))}}_initializeVertices(n){for(let s=0;s<n.length;s+=2)this._vertexToIndex(n[s],n[s+1])}subdividePolygonInternal(n,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:c,holeIndices:f}=function(S){const E=[],I=[];for(const A of S)if(A.length!==0){A!==S[0]&&E.push(I.length/2);for(let R=0;R<A.length;R++)I.push(A[R].x),I.push(A[R].y)}return{flattened:I,holeIndices:E}}(n);let y;this._initializeVertices(c);try{const S=function(I,A,R=2){const N=A&&A.length,U=N?A[0]*R:I.length;let V=ad(I,0,U,R,!0);const q=[];if(!V||V.next===V.prev)return q;let J,ae,Ce;if(N&&(V=function(de,j,K,fe){const Ne=[];for(let Je=0,Fe=j.length;Je<Fe;Je++){const Ge=ad(de,j[Je]*fe,Je<Fe-1?j[Je+1]*fe:de.length,fe,!1);Ge===Ge.next&&(Ge.steiner=!0),Ne.push(Og(Ge))}Ne.sort(H0);for(let Je=0;Je<Ne.length;Je++)K=X0(Ne[Je],K);return K}(I,A,V,R)),I.length>80*R){J=1/0,ae=1/0;let de=-1/0,j=-1/0;for(let K=R;K<U;K+=R){const fe=I[K],Ne=I[K+1];fe<J&&(J=fe),Ne<ae&&(ae=Ne),fe>de&&(de=fe),Ne>j&&(j=Ne)}Ce=Math.max(de-J,j-ae),Ce=Ce!==0?32767/Ce:0}return ks(V,q,R,J,ae,Ce,0),q}(c,f),E=this._convertIndices(c,S);y=this._subdivideTrianglesScanline(E)}catch(S){console.error(S)}let v=[];return s&&(v=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:v}}_convertIndices(n,s){const c=[];for(let f=0;f<s.length;f++)c.push(this._vertexToIndex(n[2*s[f]],n[2*s[f]+1]));return c}_pointArrayToIndices(n){const s=[];for(let c=0;c<n.length;c++){const f=n[c];s.push(this._vertexToIndex(f.x,f.y))}return s}}function Xp(o,n,s,c=!0){return new jg(s,n).subdividePolygonInternal(o,c)}function kc(o,n,s=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const c=o[0],f=o[o.length-1],y=s&&(c.x!==f.x||c.y!==f.y);if(n<2)return y?[...o,o[0]]:[...o];const v=Math.floor(Kt/n),S=[];S.push(new Te(o[0].x,o[0].y));const E=o.length,I=y?E:E-1;for(let A=0;A<I;A++){const R=o[A],N=A<E-1?o[A+1]:o[0],U=R.x,V=R.y,q=N.x,J=N.y,ae=U!==q,Ce=V!==J;if(!ae&&!Ce)continue;const de=q-U,j=J-V,K=Math.abs(de),fe=Math.abs(j);let Ne=U,Je=V;for(;;){const Ge=de>0?(Math.floor(Ne/v)+1)*v:(Math.ceil(Ne/v)-1)*v,ft=j>0?(Math.floor(Je/v)+1)*v:(Math.ceil(Je/v)-1)*v,at=Math.abs(Ne-Ge),pt=Math.abs(Je-ft),Qe=Math.abs(Ne-q),Ct=Math.abs(Je-J),$t=ae?at/K:Number.POSITIVE_INFINITY,Nt=Ce?pt/fe:Number.POSITIVE_INFINITY;if((Qe<=at||!ae)&&(Ct<=pt||!Ce))break;if($t<Nt&&ae||!Ce){Ne=Ge,Je+=j*$t;const At=new Te(Ne,Math.round(Je));S[S.length-1].x===At.x&&S[S.length-1].y===At.y||S.push(At)}else{Ne+=de*Nt,Je=ft;const At=new Te(Math.round(Ne),Je);S[S.length-1].x===At.x&&S[S.length-1].y===At.y||S.push(At)}}const Fe=new Te(q,J);S[S.length-1].x===Fe.x&&S[S.length-1].y===Fe.y||S.push(Fe)}return S}function Kp(o,n,s){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,f=o[2*n[0]];for(let E=1;E<n.length;E++){const I=o[2*n[E]];I<f&&(f=I,c=E)}const y=n.length;let v=c,S=(v+1)%y;for(;;){const E=v-1>=0?v-1:y-1,I=(S+1)%y,A=o[2*n[E]],R=o[2*n[I]],N=o[2*n[v]],U=o[2*n[v]+1],V=o[2*n[S]+1];let q=!1;if(A<R)q=!0;else if(A>R)q=!1;else{const J=V-U,ae=-(o[2*n[S]]-N),Ce=U<V?1:-1;((A-N)*J+(o[2*n[E]+1]-U)*ae)*Ce>((R-N)*J+(o[2*n[I]+1]-U)*ae)*Ce&&(q=!0)}if(q){const J=n[E],ae=n[v],Ce=n[S];J!==ae&&J!==Ce&&ae!==Ce&&s.push(Ce,ae,J),v--,v<0&&(v=y-1)}else{const J=n[I],ae=n[v],Ce=n[S];J!==ae&&J!==Ce&&ae!==Ce&&s.push(Ce,ae,J),S++,S>=y&&(S=0)}if(E===I)break}}function Yp(o,n,s,c,f,y,v,S,E){const I=f.length/2,A=v&&S&&E;if(I<Ot.MAX_VERTEX_ARRAY_LENGTH){const R=n.prepareSegment(I,s,c),N=R.vertexLength;for(let q=0;q<y.length;q+=3)c.emplaceBack(N+y[q],N+y[q+1],N+y[q+2]);let U,V;R.vertexLength+=I,R.primitiveLength+=y.length/3,A&&(V=v.prepareSegment(I,s,S),U=V.vertexLength,V.vertexLength+=I);for(let q=0;q<f.length;q+=2)o(f[q],f[q+1]);if(A)for(let q=0;q<E.length;q++){const J=E[q];for(let ae=1;ae<J.length;ae+=2)S.emplaceBack(U+J[ae-1],U+J[ae]);V.primitiveLength+=J.length/2}}else(function(R,N,U,V,q,J){const ae=[];for(let fe=0;fe<V.length/2;fe++)ae.push(-1);const Ce={count:0};let de=0,j=R.getOrCreateLatestSegment(N,U),K=j.vertexLength;for(let fe=2;fe<q.length;fe+=3){const Ne=q[fe-2],Je=q[fe-1],Fe=q[fe];let Ge=ae[Ne]<de,ft=ae[Je]<de,at=ae[Fe]<de;j.vertexLength+((Ge?1:0)+(ft?1:0)+(at?1:0))>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=R.createNewSegment(N,U),de=Ce.count,Ge=!0,ft=!0,at=!0,K=0);const pt=Za(ae,V,J,Ce,Ne,Ge,j),Qe=Za(ae,V,J,Ce,Je,ft,j),Ct=Za(ae,V,J,Ce,Fe,at,j);U.emplaceBack(K+pt-de,K+Qe-de,K+Ct-de),j.primitiveLength++}})(n,s,c,f,y,o),A&&function(R,N,U,V,q,J){const ae=[];for(let fe=0;fe<V.length/2;fe++)ae.push(-1);const Ce={count:0};let de=0,j=R.getOrCreateLatestSegment(N,U),K=j.vertexLength;for(let fe=0;fe<q.length;fe++){const Ne=q[fe];for(let Je=1;Je<q[fe].length;Je+=2){const Fe=Ne[Je-1],Ge=Ne[Je];let ft=ae[Fe]<de,at=ae[Ge]<de;j.vertexLength+((ft?1:0)+(at?1:0))>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=R.createNewSegment(N,U),de=Ce.count,ft=!0,at=!0,K=0);const pt=Za(ae,V,J,Ce,Fe,ft,j),Qe=Za(ae,V,J,Ce,Ge,at,j);U.emplaceBack(K+pt-de,K+Qe-de),j.primitiveLength++}}}(v,s,S,f,E,o),n.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function Za(o,n,s,c,f,y,v){if(y){const S=c.count;return s(n[2*f],n[2*f+1]),o[f]=c.count,c.count++,v.vertexLength++,S}return o[f]}class hd{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new me,this.indexArray=new tt,this.indexArray2=new mt,this.programConfigurations=new ja(n.layers,n.zoom),this.segments=new Ot,this.segments2=new Ot,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c){this.hasPattern=El("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),y=!f.isConstant(),v=[];for(const{feature:S,id:E,index:I,sourceLayerIndex:A}of n){const R=this.layers[0]._featureFilter.needGeometry,N=fr(S,R);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),N,c))continue;const U=y?f.evaluate(N,{},c,s.availableImages):void 0,V={id:E,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:R?N.geometry:ua(S),patterns:{},sortKey:U};v.push(V)}y&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const R=Yt("fill",this.layers,S,this.zoom,s);this.patternFeatures.push(R)}else this.addFeature(S,E,I,c,{},s.subdivisionGranularity);s.featureIndex.insert(n[I].feature,E,I,A,this.index)}}update(n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c)}addFeatures(n,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,wf),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,c,f,y,v){for(const S of dl(s,500)){const E=Xp(S,f,v.fill.getGranularityForZoomLevel(f.z)),I=this.layoutVertexArray;Yp((A,R)=>{I.emplaceBack(A,R)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,y,f)}}let Jp,Qp;St("FillBucket",hd,{omit:["layers","patternFeatures"]});var Ef={get paint(){return Qp=Qp||new Di({"fill-antialias":new Et(F.paint_fill["fill-antialias"]),"fill-opacity":new Vt(F.paint_fill["fill-opacity"]),"fill-color":new Vt(F.paint_fill["fill-color"]),"fill-outline-color":new Vt(F.paint_fill["fill-outline-color"]),"fill-translate":new Et(F.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(F.paint_fill["fill-translate-anchor"]),"fill-pattern":new jo(F.paint_fill["fill-pattern"])})},get layout(){return Jp=Jp||new Di({"fill-sort-key":new Vt(F.layout_fill["fill-sort-key"])})}};class Ug extends Hi{constructor(n){super(n,Ef)}recalculate(n,s){super.recalculate(n,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new hd(n)}queryRadius(){return id(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:s,transform:c,pixelsToTileUnits:f}){return Ec(Ic(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,f),s)}isTileClipped(){return!0}}const fa=wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ac=wr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Y0}=fa;var Mf,Vg,em,$g,tm,Zg,Gg,If={};function qg(){if(Vg)return Mf;Vg=1;var o=ce();function n(f,y,v,S,E){this.properties={},this.extent=v,this.type=0,this._pbf=f,this._geometry=-1,this._keys=S,this._values=E,f.readFields(s,this,y)}function s(f,y,v){f==1?y.id=v.readVarint():f==2?function(S,E){for(var I=S.readVarint()+S.pos;S.pos<I;){var A=E._keys[S.readVarint()],R=E._values[S.readVarint()];E.properties[A]=R}}(v,y):f==3?y.type=v.readVarint():f==4&&(y._geometry=v.pos)}function c(f){for(var y,v,S=0,E=0,I=f.length,A=I-1;E<I;A=E++)S+=((v=f[A]).x-(y=f[E]).x)*(y.y+v.y);return S}return Mf=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var y,v=f.readVarint()+f.pos,S=1,E=0,I=0,A=0,R=[];f.pos<v;){if(E<=0){var N=f.readVarint();S=7&N,E=N>>3}if(E--,S===1||S===2)I+=f.readSVarint(),A+=f.readSVarint(),S===1&&(y&&R.push(y),y=[]),y.push(new o(I,A));else{if(S!==7)throw new Error("unknown command "+S);y&&y.push(y[0].clone())}}return y&&R.push(y),R},n.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var y=f.readVarint()+f.pos,v=1,S=0,E=0,I=0,A=1/0,R=-1/0,N=1/0,U=-1/0;f.pos<y;){if(S<=0){var V=f.readVarint();v=7&V,S=V>>3}if(S--,v===1||v===2)(E+=f.readSVarint())<A&&(A=E),E>R&&(R=E),(I+=f.readSVarint())<N&&(N=I),I>U&&(U=I);else if(v!==7)throw new Error("unknown command "+v)}return[A,N,R,U]},n.prototype.toGeoJSON=function(f,y,v){var S,E,I=this.extent*Math.pow(2,v),A=this.extent*f,R=this.extent*y,N=this.loadGeometry(),U=n.types[this.type];function V(ae){for(var Ce=0;Ce<ae.length;Ce++){var de=ae[Ce];ae[Ce]=[360*(de.x+A)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+R)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(S=0;S<N.length;S++)q[S]=N[S][0];V(N=q);break;case 2:for(S=0;S<N.length;S++)V(N[S]);break;case 3:for(N=function(ae){var Ce=ae.length;if(Ce<=1)return[ae];for(var de,j,K=[],fe=0;fe<Ce;fe++){var Ne=c(ae[fe]);Ne!==0&&(j===void 0&&(j=Ne<0),j===Ne<0?(de&&K.push(de),de=[ae[fe]]):de.push(ae[fe]))}return de&&K.push(de),K}(N),S=0;S<N.length;S++)for(E=0;E<N[S].length;E++)V(N[S][E])}N.length===1?N=N[0]:U="Multi"+U;var J={type:"Feature",geometry:{type:U,coordinates:N},properties:this.properties};return"id"in this&&(J.id=this.id),J},Mf}function Wg(){if($g)return em;$g=1;var o=qg();function n(c,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(s,this,f),this.length=this._features.length}function s(c,f,y){c===15?f.version=y.readVarint():c===1?f.name=y.readString():c===5?f.extent=y.readVarint():c===2?f._features.push(y.pos):c===3?f._keys.push(y.readString()):c===4&&f._values.push(function(v){for(var S=null,E=v.readVarint()+v.pos;v.pos<E;){var I=v.readVarint()>>3;S=I===1?v.readString():I===2?v.readFloat():I===3?v.readDouble():I===4?v.readVarint64():I===5?v.readVarint():I===6?v.readSVarint():I===7?v.readBoolean():null}return S}(y))}return em=n,n.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var f=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,f,this.extent,this._keys,this._values)},em}function Hg(){return Gg||(Gg=1,If.VectorTile=function(){if(Zg)return tm;Zg=1;var o=Wg();function n(s,c,f){if(s===3){var y=new o(f,f.readVarint()+f.pos);y.length&&(c[y.name]=y)}}return tm=function(s,c){this.layers=s.readFields(n,{},c)},tm}(),If.VectorTileFeature=qg(),If.VectorTileLayer=Wg()),If}var dd=L(Hg());const Xg=dd.VectorTileFeature.types,kf=Math.pow(2,13);function Uu(o,n,s,c,f,y,v,S){o.emplaceBack(n,s,2*Math.floor(c*kf)+v,f*kf*2,y*kf*2,Math.round(S))}class nm{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.centroidVertexArray=new se,this.indexArray=new tt,this.programConfigurations=new ja(n.layers,n.zoom),this.segments=new Ot,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c){this.features=[],this.hasPattern=El("fill-extrusion",this.layers,s);for(const{feature:f,id:y,index:v,sourceLayerIndex:S}of n){const E=this.layers[0]._featureFilter.needGeometry,I=fr(f,E);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),I,c))continue;const A={id:y,sourceLayerIndex:S,index:v,geometry:E?I.geometry:ua(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Yt("fill-extrusion",this.layers,A,this.zoom,s)):this.addFeature(A,A.geometry,v,c,{},s.subdivisionGranularity),s.featureIndex.insert(f,A.geometry,v,S,this.index,!0)}}addFeatures(n,s,c){for(const f of this.features){const{geometry:y}=f;this.addFeature(f,y,f.index,s,c,n.subdivisionGranularity)}}update(n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Y0),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Ac.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,s,c,f,y,v){for(const S of dl(s,500)){const E={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(E,f,n,S,v);const A=this.layoutVertexArray.length-I,R=Math.floor(E.x/E.sampleCount),N=Math.floor(E.y/E.sampleCount);for(let U=0;U<A;U++)this.centroidVertexArray.emplaceBack(R,N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,y,f)}processPolygon(n,s,c,f,y){if(f.length<1||rm(f[0]))return;for(const R of f)R.length!==0&&J0(n,R);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=y.fill.getGranularityForZoomLevel(s.z),E=Xg[c.type]==="Polygon";for(const R of f){if(R.length===0||rm(R))continue;const N=kc(R,S,E);this._generateSideFaces(N,v)}if(!E)return;const I=Xp(f,s,S,!1),A=this.layoutVertexArray;Yp((R,N)=>{Uu(A,R,N,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(n,s){let c=0;for(let f=1;f<n.length;f++){const y=n[f],v=n[f-1];if(Q0(y,v))continue;s.segment.vertexLength+4>Ot.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=y.sub(v)._perp()._unit(),E=v.dist(y);c+E>32768&&(c=0),Uu(this.layoutVertexArray,y.x,y.y,S.x,S.y,0,0,c),Uu(this.layoutVertexArray,y.x,y.y,S.x,S.y,0,1,c),c+=E,Uu(this.layoutVertexArray,v.x,v.y,S.x,S.y,0,0,c),Uu(this.layoutVertexArray,v.x,v.y,S.x,S.y,0,1,c);const I=s.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function J0(o,n){for(let s=0;s<n.length;s++){const c=n[s];s===n.length-1&&n[0].x===c.x&&n[0].y===c.y||(o.x+=c.x,o.y+=c.y,o.sampleCount++)}}function Q0(o,n){return o.x===n.x&&(o.x<0||o.x>Kt)||o.y===n.y&&(o.y<0||o.y>Kt)}function rm(o){return o.every(n=>n.x<0)||o.every(n=>n.x>Kt)||o.every(n=>n.y<0)||o.every(n=>n.y>Kt)}let Kg;St("FillExtrusionBucket",nm,{omit:["layers","features"]});var ev={get paint(){return Kg=Kg||new Di({"fill-extrusion-opacity":new Et(F["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(F["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(F["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(F["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jo(F["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(F["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(F["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(F["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class tv extends Hi{constructor(n){super(n,ev)}createBucket(n){return new nm(n)}queryRadius(){return id(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:c,geometry:f,transform:y,pixelsToTileUnits:v,pixelPosMatrix:S}){const E=Ic(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,v),I=this.paint.get("fill-extrusion-height").evaluate(s,c),A=this.paint.get("fill-extrusion-base").evaluate(s,c),R=function(U,V,q){const J=[];for(const ae of U){const Ce=[ae.x,ae.y,0,1];lt(Ce,Ce,V),J.push(new Te(Ce[0]/Ce[3],Ce[1]/Ce[3]))}return J}(E,S),N=function(U,V,q,J){const ae=[],Ce=[],de=J[8]*V,j=J[9]*V,K=J[10]*V,fe=J[11]*V,Ne=J[8]*q,Je=J[9]*q,Fe=J[10]*q,Ge=J[11]*q;for(const ft of U){const at=[],pt=[];for(const Qe of ft){const Ct=Qe.x,$t=Qe.y,Nt=J[0]*Ct+J[4]*$t+J[12],At=J[1]*Ct+J[5]*$t+J[13],xn=J[2]*Ct+J[6]*$t+J[14],Pr=J[3]*Ct+J[7]*$t+J[15],qr=xn+K,gi=Pr+fe,Ho=Nt+Ne,mo=At+Je,_i=xn+Fe,Sr=Pr+Ge,Er=new Te((Nt+de)/gi,(At+j)/gi);Er.z=qr/gi,at.push(Er);const yi=new Te(Ho/Sr,mo/Sr);yi.z=_i/Sr,pt.push(yi)}ae.push(at),Ce.push(pt)}return[ae,Ce]}(f,A,I,S);return function(U,V,q){let J=1/0;Ec(q,V)&&(J=Yg(q,V[0]));for(let ae=0;ae<V.length;ae++){const Ce=V[ae],de=U[ae];for(let j=0;j<Ce.length-1;j++){const K=Ce[j],fe=[K,Ce[j+1],de[j+1],de[j],K];Ua(q,fe)&&(J=Math.min(J,Yg(q,fe)))}}return J!==1/0&&J}(N[0],N[1],R)}}function fd(o,n){return o.x*n.x+o.y*n.y}function Yg(o,n){if(o.length===1){let s=0;const c=n[s++];let f;for(;!f||c.equals(f);)if(f=n[s++],!f)return 1/0;for(;s<n.length;s++){const y=n[s],v=o[0],S=f.sub(c),E=y.sub(c),I=v.sub(c),A=fd(S,S),R=fd(S,E),N=fd(E,E),U=fd(I,S),V=fd(I,E),q=A*N-R*R,J=(N*U-R*V)/q,ae=(A*V-R*U)/q,Ce=c.z*(1-J-ae)+f.z*J+y.z*ae;if(isFinite(Ce))return Ce}return 1/0}{let s=1/0;for(const c of n)s=Math.min(s,c.z);return s}}const nv=wr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:us}=nv,rv=wr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:iv}=rv,ov=dd.VectorTileFeature.types,Jg=Math.cos(Math.PI/180*37.5),Qg=Math.pow(2,14)/.5;class im{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new be,this.layoutVertexArray2=new Pe,this.indexArray=new tt,this.programConfigurations=new ja(n.layers,n.zoom),this.segments=new Ot,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c){this.hasPattern=El("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),y=!f.isConstant(),v=[];for(const{feature:S,id:E,index:I,sourceLayerIndex:A}of n){const R=this.layers[0]._featureFilter.needGeometry,N=fr(S,R);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),N,c))continue;const U=y?f.evaluate(N,{},c):void 0,V={id:E,properties:S.properties,type:S.type,sourceLayerIndex:A,index:I,geometry:R?N.geometry:ua(S),patterns:{},sortKey:U};v.push(V)}y&&v.sort((S,E)=>S.sortKey-E.sortKey);for(const S of v){const{geometry:E,index:I,sourceLayerIndex:A}=S;if(this.hasPattern){const R=Yt("line",this.layers,S,this.zoom,s);this.patternFeatures.push(R)}else this.addFeature(S,E,I,c,{},s.subdivisionGranularity);s.featureIndex.insert(n[I].feature,E,I,A,this.index)}}update(n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c)}addFeatures(n,s,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,c,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,iv)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,us),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,c,f,y,v){const S=this.layers[0].layout,E=S.get("line-join").evaluate(n,{}),I=S.get("line-cap"),A=S.get("line-miter-limit"),R=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const N of s)this.addLine(N,n,E,I,A,R,f,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,y,f)}addLine(n,s,c,f,y,v,S,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=kc(n,S?E.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<n.length-1;de++)this.totalDistance+=n[de].dist(n[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=ov[s.type]==="Polygon";let A=n.length;for(;A>=2&&n[A-1].equals(n[A-2]);)A--;let R=0;for(;R<A-1&&n[R].equals(n[R+1]);)R++;if(A<(I?3:2))return;c==="bevel"&&(y=1.05);const N=this.overscaling<=16?15*Kt/(512*this.overscaling):0,U=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,q,J,ae,Ce;this.e1=this.e2=-1,I&&(V=n[A-2],Ce=n[R].sub(V)._unit()._perp());for(let de=R;de<A;de++){if(J=de===A-1?I?n[R+1]:void 0:n[de+1],J&&n[de].equals(J))continue;Ce&&(ae=Ce),V&&(q=V),V=n[de],Ce=J?J.sub(V)._unit()._perp():ae,ae=ae||Ce;let j=ae.add(Ce);j.x===0&&j.y===0||j._unit();const K=ae.x*Ce.x+ae.y*Ce.y,fe=j.x*Ce.x+j.y*Ce.y,Ne=fe!==0?1/fe:1/0,Je=2*Math.sqrt(2-2*fe),Fe=fe<Jg&&q&&J,Ge=ae.x*Ce.y-ae.y*Ce.x>0;if(Fe&&de>R){const pt=V.dist(q);if(pt>2*N){const Qe=V.sub(V.sub(q)._mult(N/pt)._round());this.updateDistance(q,Qe),this.addCurrentVertex(Qe,ae,0,0,U),q=Qe}}const ft=q&&J;let at=ft?c:I?"butt":f;if(ft&&at==="round"&&(Ne<v?at="miter":Ne<=2&&(at="fakeround")),at==="miter"&&Ne>y&&(at="bevel"),at==="bevel"&&(Ne>2&&(at="flipbevel"),Ne<y&&(at="miter")),q&&this.updateDistance(q,V),at==="miter")j._mult(Ne),this.addCurrentVertex(V,j,0,0,U);else if(at==="flipbevel"){if(Ne>100)j=Ce.mult(-1);else{const pt=Ne*ae.add(Ce).mag()/ae.sub(Ce).mag();j._perp()._mult(pt*(Ge?-1:1))}this.addCurrentVertex(V,j,0,0,U),this.addCurrentVertex(V,j.mult(-1),0,0,U)}else if(at==="bevel"||at==="fakeround"){const pt=-Math.sqrt(Ne*Ne-1),Qe=Ge?pt:0,Ct=Ge?0:pt;if(q&&this.addCurrentVertex(V,ae,Qe,Ct,U),at==="fakeround"){const $t=Math.round(180*Je/Math.PI/20);for(let Nt=1;Nt<$t;Nt++){let At=Nt/$t;if(At!==.5){const Pr=At-.5;At+=At*Pr*(At-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*Pr*Pr+(.848013+K*(.215638*K-1.06021)))}const xn=Ce.sub(ae)._mult(At)._add(ae)._unit()._mult(Ge?-1:1);this.addHalfVertex(V,xn.x,xn.y,!1,Ge,0,U)}}J&&this.addCurrentVertex(V,Ce,-Qe,-Ct,U)}else if(at==="butt")this.addCurrentVertex(V,j,0,0,U);else if(at==="square"){const pt=q?1:-1;this.addCurrentVertex(V,j,pt,pt,U)}else at==="round"&&(q&&(this.addCurrentVertex(V,ae,0,0,U),this.addCurrentVertex(V,ae,1,1,U,!0)),J&&(this.addCurrentVertex(V,Ce,-1,-1,U,!0),this.addCurrentVertex(V,Ce,0,0,U)));if(Fe&&de<A-1){const pt=V.dist(J);if(pt>2*N){const Qe=V.add(J.sub(V)._mult(N/pt)._round());this.updateDistance(V,Qe),this.addCurrentVertex(Qe,Ce,0,0,U),V=Qe}}}}addCurrentVertex(n,s,c,f,y,v=!1){const S=s.y*f-s.x,E=-s.y-s.x*f;this.addHalfVertex(n,s.x+s.y*c,s.y-s.x*c,v,!1,c,y),this.addHalfVertex(n,S,E,v,!0,-f,y),this.distance>Qg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,s,c,f,y,v))}addHalfVertex({x:n,y:s},c,f,y,v,S,E){const I=.5*(this.lineClips?this.scaledDistance*(Qg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(y?1:0),(s<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),E.primitiveLength++),v?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}let e_,t_;St("LineBucket",im,{omit:["layers","patternFeatures"]});var Af={get paint(){return t_=t_||new Di({"line-opacity":new Vt(F.paint_line["line-opacity"]),"line-color":new Vt(F.paint_line["line-color"]),"line-translate":new Et(F.paint_line["line-translate"]),"line-translate-anchor":new Et(F.paint_line["line-translate-anchor"]),"line-width":new Vt(F.paint_line["line-width"]),"line-gap-width":new Vt(F.paint_line["line-gap-width"]),"line-offset":new Vt(F.paint_line["line-offset"]),"line-blur":new Vt(F.paint_line["line-blur"]),"line-dasharray":new Ri(F.paint_line["line-dasharray"]),"line-pattern":new jo(F.paint_line["line-pattern"]),"line-gradient":new Yh(F.paint_line["line-gradient"])})},get layout(){return e_=e_||new Di({"line-cap":new Et(F.layout_line["line-cap"]),"line-join":new Vt(F.layout_line["line-join"]),"line-miter-limit":new Et(F.layout_line["line-miter-limit"]),"line-round-limit":new Et(F.layout_line["line-round-limit"]),"line-sort-key":new Vt(F.layout_line["line-sort-key"])})}};class sv extends Vt{possiblyEvaluate(n,s){return s=new hr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,c,f){return s=nn({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,c,f)}}let zf;class av extends Hi{constructor(n){super(n,Af),this.gradientVersion=0,zf||(zf=new sv(Af.paint.properties["line-width"].specification),zf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(c){return c._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,s){super.recalculate(n,s),this.paint._values["line-floorwidth"]=zf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new im(n)}queryRadius(n){const s=n,c=n_(Pl("line-width",this,s),Pl("line-gap-width",this,s)),f=Pl("line-offset",this,s);return c/2+Math.abs(f)+id(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:s,featureState:c,geometry:f,transform:y,pixelsToTileUnits:v}){const S=Ic(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,v),E=v/2*n_(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),I=this.paint.get("line-offset").evaluate(s,c);return I&&(f=function(A,R){const N=[];for(let U=0;U<A.length;U++){const V=A[U],q=[];for(let J=0;J<V.length;J++){const ae=V[J-1],Ce=V[J],de=V[J+1],j=J===0?new Te(0,0):Ce.sub(ae)._unit()._perp(),K=J===V.length-1?new Te(0,0):de.sub(Ce)._unit()._perp(),fe=j._add(K)._unit(),Ne=fe.x*K.x+fe.y*K.y;Ne!==0&&fe._mult(1/Ne),q.push(fe._mult(R)._add(Ce))}N.push(q)}return N}(f,I*v)),function(A,R,N){for(let U=0;U<R.length;U++){const V=R[U];if(A.length>=3){for(let q=0;q<V.length;q++)if(Mc(A,V[q]))return!0}if(kg(A,V,N))return!0}return!1}(S,f,E)}isTileClipped(){return!0}}function n_(o,n){return n>0?n+2*o:o}const lv=wr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cv=wr([{name:"a_projected_pos",components:3,type:"Float32"}],4);wr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uv=wr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);wr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const r_=wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hv=wr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function dv(o,n,s){return o.sections.forEach(c=>{c.text=function(f,y,v){const S=y.layout.get("text-transform").evaluate(v,{});return S==="uppercase"?f=f.toLocaleUpperCase():S==="lowercase"&&(f=f.toLocaleLowerCase()),Cs.applyArabicShaping&&(f=Cs.applyArabicShaping(f)),f}(c.text,n,s)}),o}wr([{name:"triangle",components:3,type:"Uint16"}]),wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wr([{type:"Float32",name:"offsetX"}]),wr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const pd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var i_,om,o_,ii=24,sm={};function fv(){return i_||(i_=1,sm.read=function(o,n,s,c,f){var y,v,S=8*f-c-1,E=(1<<S)-1,I=E>>1,A=-7,R=s?f-1:0,N=s?-1:1,U=o[n+R];for(R+=N,y=U&(1<<-A)-1,U>>=-A,A+=S;A>0;y=256*y+o[n+R],R+=N,A-=8);for(v=y&(1<<-A)-1,y>>=-A,A+=c;A>0;v=256*v+o[n+R],R+=N,A-=8);if(y===0)y=1-I;else{if(y===E)return v?NaN:1/0*(U?-1:1);v+=Math.pow(2,c),y-=I}return(U?-1:1)*v*Math.pow(2,y-c)},sm.write=function(o,n,s,c,f,y){var v,S,E,I=8*y-f-1,A=(1<<I)-1,R=A>>1,N=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=c?0:y-1,V=c?1:-1,q=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(S=isNaN(n)?1:0,v=A):(v=Math.floor(Math.log(n)/Math.LN2),n*(E=Math.pow(2,-v))<1&&(v--,E*=2),(n+=v+R>=1?N/E:N*Math.pow(2,1-R))*E>=2&&(v++,E/=2),v+R>=A?(S=0,v=A):v+R>=1?(S=(n*E-1)*Math.pow(2,f),v+=R):(S=n*Math.pow(2,R-1)*Math.pow(2,f),v=0));f>=8;o[s+U]=255&S,U+=V,S/=256,f-=8);for(v=v<<f|S,I+=f;I>0;o[s+U]=255&v,U+=V,v/=256,I-=8);o[s+U-V]|=128*q}),sm}function s_(){if(o_)return om;o_=1,om=n;var o=fv();function n(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var s=4294967296,c=1/s,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function y(j){return j.type===n.Bytes?j.readVarint()+j.pos:j.pos+1}function v(j,K,fe){return fe?4294967296*K+(j>>>0):4294967296*(K>>>0)+(j>>>0)}function S(j,K,fe){var Ne=K<=16383?1:K<=2097151?2:K<=268435455?3:Math.floor(Math.log(K)/(7*Math.LN2));fe.realloc(Ne);for(var Je=fe.pos-1;Je>=j;Je--)fe.buf[Je+Ne]=fe.buf[Je]}function E(j,K){for(var fe=0;fe<j.length;fe++)K.writeVarint(j[fe])}function I(j,K){for(var fe=0;fe<j.length;fe++)K.writeSVarint(j[fe])}function A(j,K){for(var fe=0;fe<j.length;fe++)K.writeFloat(j[fe])}function R(j,K){for(var fe=0;fe<j.length;fe++)K.writeDouble(j[fe])}function N(j,K){for(var fe=0;fe<j.length;fe++)K.writeBoolean(j[fe])}function U(j,K){for(var fe=0;fe<j.length;fe++)K.writeFixed32(j[fe])}function V(j,K){for(var fe=0;fe<j.length;fe++)K.writeSFixed32(j[fe])}function q(j,K){for(var fe=0;fe<j.length;fe++)K.writeFixed64(j[fe])}function J(j,K){for(var fe=0;fe<j.length;fe++)K.writeSFixed64(j[fe])}function ae(j,K){return(j[K]|j[K+1]<<8|j[K+2]<<16)+16777216*j[K+3]}function Ce(j,K,fe){j[fe]=K,j[fe+1]=K>>>8,j[fe+2]=K>>>16,j[fe+3]=K>>>24}function de(j,K){return(j[K]|j[K+1]<<8|j[K+2]<<16)+(j[K+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(j,K,fe){for(fe=fe||this.length;this.pos<fe;){var Ne=this.readVarint(),Je=Ne>>3,Fe=this.pos;this.type=7&Ne,j(Je,K,this),this.pos===Fe&&this.skip(Ne)}return K},readMessage:function(j,K){return this.readFields(j,K,this.readVarint()+this.pos)},readFixed32:function(){var j=ae(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=de(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*s;return this.pos+=8,j},readSFixed64:function(){var j=ae(this.buf,this.pos)+de(this.buf,this.pos+4)*s;return this.pos+=8,j},readFloat:function(){var j=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var K,fe,Ne=this.buf;return K=127&(fe=Ne[this.pos++]),fe<128?K:(K|=(127&(fe=Ne[this.pos++]))<<7,fe<128?K:(K|=(127&(fe=Ne[this.pos++]))<<14,fe<128?K:(K|=(127&(fe=Ne[this.pos++]))<<21,fe<128?K:function(Je,Fe,Ge){var ft,at,pt=Ge.buf;if(ft=(112&(at=pt[Ge.pos++]))>>4,at<128||(ft|=(127&(at=pt[Ge.pos++]))<<3,at<128)||(ft|=(127&(at=pt[Ge.pos++]))<<10,at<128)||(ft|=(127&(at=pt[Ge.pos++]))<<17,at<128)||(ft|=(127&(at=pt[Ge.pos++]))<<24,at<128)||(ft|=(1&(at=pt[Ge.pos++]))<<31,at<128))return v(Je,ft,Fe);throw new Error("Expected varint not more than 10 bytes")}(K|=(15&(fe=Ne[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,K=this.pos;return this.pos=j,j-K>=12&&f?function(fe,Ne,Je){return f.decode(fe.subarray(Ne,Je))}(this.buf,K,j):function(fe,Ne,Je){for(var Fe="",Ge=Ne;Ge<Je;){var ft,at,pt,Qe=fe[Ge],Ct=null,$t=Qe>239?4:Qe>223?3:Qe>191?2:1;if(Ge+$t>Je)break;$t===1?Qe<128&&(Ct=Qe):$t===2?(192&(ft=fe[Ge+1]))==128&&(Ct=(31&Qe)<<6|63&ft)<=127&&(Ct=null):$t===3?(at=fe[Ge+2],(192&(ft=fe[Ge+1]))==128&&(192&at)==128&&((Ct=(15&Qe)<<12|(63&ft)<<6|63&at)<=2047||Ct>=55296&&Ct<=57343)&&(Ct=null)):$t===4&&(at=fe[Ge+2],pt=fe[Ge+3],(192&(ft=fe[Ge+1]))==128&&(192&at)==128&&(192&pt)==128&&((Ct=(15&Qe)<<18|(63&ft)<<12|(63&at)<<6|63&pt)<=65535||Ct>=1114112)&&(Ct=null)),Ct===null?(Ct=65533,$t=1):Ct>65535&&(Ct-=65536,Fe+=String.fromCharCode(Ct>>>10&1023|55296),Ct=56320|1023&Ct),Fe+=String.fromCharCode(Ct),Ge+=$t}return Fe}(this.buf,K,j)},readBytes:function(){var j=this.readVarint()+this.pos,K=this.buf.subarray(this.pos,j);return this.pos=j,K},readPackedVarint:function(j,K){if(this.type!==n.Bytes)return j.push(this.readVarint(K));var fe=y(this);for(j=j||[];this.pos<fe;)j.push(this.readVarint(K));return j},readPackedSVarint:function(j){if(this.type!==n.Bytes)return j.push(this.readSVarint());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==n.Bytes)return j.push(this.readBoolean());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==n.Bytes)return j.push(this.readFloat());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==n.Bytes)return j.push(this.readDouble());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==n.Bytes)return j.push(this.readFixed32());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==n.Bytes)return j.push(this.readSFixed32());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==n.Bytes)return j.push(this.readFixed64());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==n.Bytes)return j.push(this.readSFixed64());var K=y(this);for(j=j||[];this.pos<K;)j.push(this.readSFixed64());return j},skip:function(j){var K=7&j;if(K===n.Varint)for(;this.buf[this.pos++]>127;);else if(K===n.Bytes)this.pos=this.readVarint()+this.pos;else if(K===n.Fixed32)this.pos+=4;else{if(K!==n.Fixed64)throw new Error("Unimplemented type: "+K);this.pos+=8}},writeTag:function(j,K){this.writeVarint(j<<3|K)},realloc:function(j){for(var K=this.length||16;K<this.pos+j;)K*=2;if(K!==this.length){var fe=new Uint8Array(K);fe.set(this.buf),this.buf=fe,this.length=K}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),Ce(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),Ce(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),Ce(this.buf,-1&j,this.pos),Ce(this.buf,Math.floor(j*c),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),Ce(this.buf,-1&j,this.pos),Ce(this.buf,Math.floor(j*c),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function(K,fe){var Ne,Je;if(K>=0?(Ne=K%4294967296|0,Je=K/4294967296|0):(Je=~(-K/4294967296),4294967295^(Ne=~(-K%4294967296))?Ne=Ne+1|0:(Ne=0,Je=Je+1|0)),K>=18446744073709552e3||K<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");fe.realloc(10),function(Fe,Ge,ft){ft.buf[ft.pos++]=127&Fe|128,Fe>>>=7,ft.buf[ft.pos++]=127&Fe|128,Fe>>>=7,ft.buf[ft.pos++]=127&Fe|128,Fe>>>=7,ft.buf[ft.pos++]=127&Fe|128,ft.buf[ft.pos]=127&(Fe>>>=7)}(Ne,0,fe),function(Fe,Ge){var ft=(7&Fe)<<4;Ge.buf[Ge.pos++]|=ft|((Fe>>>=3)?128:0),Fe&&(Ge.buf[Ge.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ge.buf[Ge.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ge.buf[Ge.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ge.buf[Ge.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ge.buf[Ge.pos++]=127&Fe)))))}(Je,fe)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var K=this.pos;this.pos=function(Ne,Je,Fe){for(var Ge,ft,at=0;at<Je.length;at++){if((Ge=Je.charCodeAt(at))>55295&&Ge<57344){if(!ft){Ge>56319||at+1===Je.length?(Ne[Fe++]=239,Ne[Fe++]=191,Ne[Fe++]=189):ft=Ge;continue}if(Ge<56320){Ne[Fe++]=239,Ne[Fe++]=191,Ne[Fe++]=189,ft=Ge;continue}Ge=ft-55296<<10|Ge-56320|65536,ft=null}else ft&&(Ne[Fe++]=239,Ne[Fe++]=191,Ne[Fe++]=189,ft=null);Ge<128?Ne[Fe++]=Ge:(Ge<2048?Ne[Fe++]=Ge>>6|192:(Ge<65536?Ne[Fe++]=Ge>>12|224:(Ne[Fe++]=Ge>>18|240,Ne[Fe++]=Ge>>12&63|128),Ne[Fe++]=Ge>>6&63|128),Ne[Fe++]=63&Ge|128)}return Fe}(this.buf,j,this.pos);var fe=this.pos-K;fe>=128&&S(K,fe,this),this.pos=K-1,this.writeVarint(fe),this.pos+=fe},writeFloat:function(j){this.realloc(4),o.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),o.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var K=j.length;this.writeVarint(K),this.realloc(K);for(var fe=0;fe<K;fe++)this.buf[this.pos++]=j[fe]},writeRawMessage:function(j,K){this.pos++;var fe=this.pos;j(K,this);var Ne=this.pos-fe;Ne>=128&&S(fe,Ne,this),this.pos=fe-1,this.writeVarint(Ne),this.pos+=Ne},writeMessage:function(j,K,fe){this.writeTag(j,n.Bytes),this.writeRawMessage(K,fe)},writePackedVarint:function(j,K){K.length&&this.writeMessage(j,E,K)},writePackedSVarint:function(j,K){K.length&&this.writeMessage(j,I,K)},writePackedBoolean:function(j,K){K.length&&this.writeMessage(j,N,K)},writePackedFloat:function(j,K){K.length&&this.writeMessage(j,A,K)},writePackedDouble:function(j,K){K.length&&this.writeMessage(j,R,K)},writePackedFixed32:function(j,K){K.length&&this.writeMessage(j,U,K)},writePackedSFixed32:function(j,K){K.length&&this.writeMessage(j,V,K)},writePackedFixed64:function(j,K){K.length&&this.writeMessage(j,q,K)},writePackedSFixed64:function(j,K){K.length&&this.writeMessage(j,J,K)},writeBytesField:function(j,K){this.writeTag(j,n.Bytes),this.writeBytes(K)},writeFixed32Field:function(j,K){this.writeTag(j,n.Fixed32),this.writeFixed32(K)},writeSFixed32Field:function(j,K){this.writeTag(j,n.Fixed32),this.writeSFixed32(K)},writeFixed64Field:function(j,K){this.writeTag(j,n.Fixed64),this.writeFixed64(K)},writeSFixed64Field:function(j,K){this.writeTag(j,n.Fixed64),this.writeSFixed64(K)},writeVarintField:function(j,K){this.writeTag(j,n.Varint),this.writeVarint(K)},writeSVarintField:function(j,K){this.writeTag(j,n.Varint),this.writeSVarint(K)},writeStringField:function(j,K){this.writeTag(j,n.Bytes),this.writeString(K)},writeFloatField:function(j,K){this.writeTag(j,n.Fixed32),this.writeFloat(K)},writeDoubleField:function(j,K){this.writeTag(j,n.Fixed64),this.writeDouble(K)},writeBooleanField:function(j,K){this.writeVarintField(j,!!K)}},om}var am=L(s_());const lm=3;function cm(o,n,s){o===1&&s.readMessage(a_,n)}function a_(o,n,s){if(o===3){const{id:c,bitmap:f,width:y,height:v,left:S,top:E,advance:I}=s.readMessage(pv,{});n.push({id:c,bitmap:new Lu({width:y+2*lm,height:v+2*lm},f),metrics:{width:y,height:v,left:S,top:E,advance:I}})}}function pv(o,n,s){o===1?n.id=s.readVarint():o===2?n.bitmap=s.readBytes():o===3?n.width=s.readVarint():o===4?n.height=s.readVarint():o===5?n.left=s.readSVarint():o===6?n.top=s.readSVarint():o===7&&(n.advance=s.readVarint())}const mv=lm;function l_(o){let n=0,s=0;for(const v of o)n+=v.w*v.h,s=Math.max(s,v.w);o.sort((v,S)=>S.h-v.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let f=0,y=0;for(const v of o)for(let S=c.length-1;S>=0;S--){const E=c[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,y=Math.max(y,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===E.w&&v.h===E.h){const I=c.pop();S<c.length&&(c[S]=I)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(c.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:f,h:y,fill:n/(f*y)||0}}const ho=1;class um{constructor(n,{pixelRatio:s,version:c,stretchX:f,stretchY:y,content:v,textFitWidth:S,textFitHeight:E}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=f,this.stretchY=y,this.content=v,this.version=c,this.textFitWidth=S,this.textFitHeight=E}get tl(){return[this.paddedRect.x+ho,this.paddedRect.y+ho]}get br(){return[this.paddedRect.x+this.paddedRect.w-ho,this.paddedRect.y+this.paddedRect.h-ho]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ho)/this.pixelRatio,(this.paddedRect.h-2*ho)/this.pixelRatio]}}class c_{constructor(n,s){const c={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,c,y),this.addImages(s,f,y);const{w:v,h:S}=l_(y),E=new Go({width:v||1,height:S||1});for(const I in n){const A=n[I],R=c[I].paddedRect;Go.copy(A.data,E,{x:0,y:0},{x:R.x+ho,y:R.y+ho},A.data)}for(const I in s){const A=s[I],R=f[I].paddedRect,N=R.x+ho,U=R.y+ho,V=A.data.width,q=A.data.height;Go.copy(A.data,E,{x:0,y:0},{x:N,y:U},A.data),Go.copy(A.data,E,{x:0,y:q-1},{x:N,y:U-1},{width:V,height:1}),Go.copy(A.data,E,{x:0,y:0},{x:N,y:U+q},{width:V,height:1}),Go.copy(A.data,E,{x:V-1,y:0},{x:N-1,y:U},{width:1,height:q}),Go.copy(A.data,E,{x:0,y:0},{x:N+V,y:U},{width:1,height:q})}this.image=E,this.iconPositions=c,this.patternPositions=f}addImages(n,s,c){for(const f in n){const y=n[f],v={x:0,y:0,w:y.data.width+2*ho,h:y.data.height+2*ho};c.push(v),s[f]=new um(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(n,s){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in n.updatedImages)this.patchUpdatedImage(this.iconPositions[c],n.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],n.getImage(c),s)}patchUpdatedImage(n,s,c){if(!n||!s||n.version===s.version)return;n.version=s.version;const[f,y]=n.tl;c.update(s.data,void 0,{x:f,y})}}var Ml;St("ImagePosition",um),St("ImageAtlas",c_),b.ag=void 0,(Ml=b.ag||(b.ag={}))[Ml.none=0]="none",Ml[Ml.horizontal=1]="horizontal",Ml[Ml.vertical=2]="vertical",Ml[Ml.horizontalOnly=3]="horizontalOnly";const Rf=-17;class Vu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,s,c){const f=new Vu;return f.scale=n||1,f.fontStack=s,f.verticalAlign=c||"bottom",f}static forImage(n,s){const c=new Vu;return c.imageName=n,c.verticalAlign=s||"bottom",c}}class $u{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const c=new $u;for(let f=0;f<n.sections.length;f++){const y=n.sections[f];y.image?c.addImageSection(y):c.addTextSection(y,s)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let s="";for(let c=0;c<n.length;c++){const f=n.charCodeAt(c+1)||null,y=n.charCodeAt(c-1)||null;s+=f&&Xh(f)&&!pd[n[c+1]]||y&&Xh(y)&&!pd[n[c-1]]||!pd[n[c]]?n[c]:pd[n[c]]}return s}(this.text)}trim(){let n=0;for(let c=0;c<this.text.length&&Df[this.text.charCodeAt(c)];c++)n++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&Df[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const c=new $u;return c.text=this.text.substring(n,s),c.sectionIndex=this.sectionIndex.slice(n,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}getMaxImageSize(n){let s=0,c=0;for(let f=0;f<this.length();f++){const y=this.getSection(f);if(y.imageName){const v=n[y.imageName];if(!v)continue;const S=v.displaySize;s=Math.max(s,S[0]),c=Math.max(c,S[1])}}return{maxImageWidth:s,maxImageHeight:c}}addTextSection(n,s){this.text+=n.text,this.sections.push(Vu.forText(n.scale,n.fontStack||s,n.verticalAlign));const c=this.sections.length-1;for(let f=0;f<n.text.length;++f)this.sectionIndex.push(c)}addImageSection(n){const s=n.image?n.image.name:"";if(s.length===0)return void Gt("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Vu.forImage(s,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zc(o,n,s,c,f,y,v,S,E,I,A,R,N,U,V){const q=$u.fromFeature(o,f);let J;R===b.ag.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:Ce}=Cs;if(ae&&q.sections.length===1){J=[];const K=ae(q.toString(),hm(q,I,y,n,c,U));for(const fe of K){const Ne=new $u;Ne.text=fe,Ne.sections=q.sections;for(let Je=0;Je<fe.length;Je++)Ne.sectionIndex.push(0);J.push(Ne)}}else if(Ce){J=[];const K=Ce(q.text,q.sectionIndex,hm(q,I,y,n,c,U));for(const fe of K){const Ne=new $u;Ne.text=fe[0],Ne.sectionIndex=fe[1],Ne.sections=q.sections,J.push(Ne)}}else J=function(K,fe){const Ne=[],Je=K.text;let Fe=0;for(const Ge of fe)Ne.push(K.substring(Fe,Ge)),Fe=Ge;return Fe<Je.length&&Ne.push(K.substring(Fe,Je.length)),Ne}(q,hm(q,I,y,n,c,U));const de=[],j={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(K,fe,Ne,Je,Fe,Ge,ft,at,pt,Qe,Ct,$t){let Nt=0,At=0,xn=0,Pr=0;const qr=at==="right"?1:at==="left"?0:.5,gi=ii/$t;let Ho=0;for(const Sr of Fe){Sr.trim();const Er=Sr.getMaxScale(),yi={positionedGlyphs:[],lineOffset:0};K.positionedLines[Ho]=yi;const vi=yi.positionedGlyphs;let Yi=0;if(!Sr.length()){At+=Ge,++Ho;continue}const Xo=vv(Je,Sr,gi);for(let Ji=0;Ji<Sr.length();Ji++){const Wr=Sr.getSection(Ji),fi=Sr.getSectionIndex(Ji),pi=Sr.getCharCode(Ji),Hr=xv(pt,Ct,pi);let pr;if(Wr.imageName){if(K.iconsInText=!0,Wr.scale=Wr.scale*gi,pr=wv(Wr,Hr,Er,Xo,Je),!pr)continue;Yi=Math.max(Yi,pr.imageOffset)}else if(pr=bv(Wr,pi,Hr,Xo,fe,Ne),!pr)continue;const{rect:zs,metrics:Ku,baselineOffset:Rs}=pr;vi.push({glyph:pi,imageName:Wr.imageName,x:Nt,y:At+Rs+Rf,vertical:Hr,scale:Wr.scale,fontStack:Wr.fontStack,sectionIndex:fi,metrics:Ku,rect:zs}),Hr?(K.verticalizable=!0,Nt+=(Wr.imageName?Ku.advance:ii)*Wr.scale+Qe):Nt+=Ku.advance*Wr.scale+Qe}vi.length!==0&&(xn=Math.max(Nt-Qe,xn),Sv(vi,0,vi.length-1,qr)),Nt=0,yi.lineOffset=Math.max(Yi,(Er-1)*ii);const di=Ge*Er+Yi;At+=di,Pr=Math.max(di,Pr),++Ho}const{horizontalAlign:mo,verticalAlign:_i}=dm(ft);(function(Sr,Er,yi,vi,Yi,Xo,di,Ji,Wr){const fi=(Er-yi)*Yi;let pi=0;pi=Xo!==di?-Ji*vi-Rf:-vi*Wr*di+.5*di;for(const Hr of Sr)for(const pr of Hr.positionedGlyphs)pr.x+=fi,pr.y+=pi})(K.positionedLines,qr,mo,_i,xn,Pr,Ge,At,Fe.length),K.top+=-_i*At,K.bottom=K.top+At,K.left+=-mo*xn,K.right=K.left+xn}(j,n,s,c,J,v,S,E,R,I,N,V),!function(K){for(const fe of K)if(fe.positionedGlyphs.length!==0)return!1;return!0}(de)&&j}const Df={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_v={40:!0};function u_(o,n,s,c,f,y){if(n.imageName){const v=c[n.imageName];return v?v.displaySize[0]*n.scale*ii/y+f:0}{const v=s[n.fontStack],S=v&&v[o];return S?S.metrics.advance*n.scale+f:0}}function h_(o,n,s,c){const f=Math.pow(o-n,2);return c?o<n?f/2:2*f:f+Math.abs(s)*s}function yv(o,n,s){let c=0;return o===10&&(c-=1e4),s&&(c+=150),o!==40&&o!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function d_(o,n,s,c,f,y){let v=null,S=h_(n,s,f,y);for(const E of c){const I=h_(n-E.x,s,f,y)+E.badness;I<=S&&(v=E,S=I)}return{index:o,x:n,priorBreak:v,badness:S}}function f_(o){return o?f_(o.priorBreak).concat(o.index):[]}function hm(o,n,s,c,f,y){if(!o)return[];const v=[],S=function(R,N,U,V,q,J){let ae=0;for(let Ce=0;Ce<R.length();Ce++){const de=R.getSection(Ce);ae+=u_(R.getCharCode(Ce),de,V,q,N,J)}return ae/Math.max(1,Math.ceil(ae/U))}(o,n,s,c,f,y),E=o.text.indexOf("")>=0;let I=0;for(let R=0;R<o.length();R++){const N=o.getSection(R),U=o.getCharCode(R);if(Df[U]||(I+=u_(U,N,c,f,n,y)),R<o.length()-1){const V=!((A=U)<11904)&&(!!fn["CJK Compatibility Forms"](A)||!!fn["CJK Compatibility"](A)||!!fn["CJK Strokes"](A)||!!fn["CJK Symbols and Punctuation"](A)||!!fn["Enclosed CJK Letters and Months"](A)||!!fn["Halfwidth and Fullwidth Forms"](A)||!!fn["Ideographic Description Characters"](A)||!!fn["Vertical Forms"](A)||Hh.test(String.fromCodePoint(A)));(gv[U]||V||N.imageName||R!==o.length()-2&&_v[o.getCharCode(R+1)])&&v.push(d_(R+1,I,S,v,yv(U,o.getCharCode(R+1),V&&E),!1))}}var A;return f_(d_(o.length(),I,S,v,0,!0))}function dm(o){let n=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function vv(o,n,s){const c=n.getMaxScale()*ii,{maxImageWidth:f,maxImageHeight:y}=n.getMaxImageSize(o),v=Math.max(c,y*s);return{verticalLineContentWidth:Math.max(c,f*s),horizontalLineContentHeight:v}}function p_(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function xv(o,n,s){return!(o===b.ag.horizontal||!n&&!lo(s)||n&&(Df[s]||(c=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(c)))));var c}function bv(o,n,s,c,f,y){const v=y[o.fontStack],S=function(I,A,R,N){if(I&&I.rect)return I;const U=A[R.fontStack],V=U&&U[N];return V?{rect:null,metrics:V.metrics}:null}(v&&v[n],f,o,n);if(S===null)return null;let E;if(s)E=c.verticalLineContentWidth-o.scale*ii;else{const I=p_(o.verticalAlign);E=(c.horizontalLineContentHeight-o.scale*ii)*I}return{rect:S.rect,metrics:S.metrics,baselineOffset:E}}function wv(o,n,s,c,f){const y=f[o.imageName];if(!y)return null;const v=y.paddedRect,S=y.displaySize,E={width:S[0],height:S[1],left:ho,top:-3,advance:n?S[1]:S[0]};let I;if(n)I=c.verticalLineContentWidth-S[1]*o.scale;else{const A=p_(o.verticalAlign);I=(c.horizontalLineContentHeight-S[1]*o.scale)*A}return{rect:v,metrics:E,baselineOffset:I,imageOffset:(n?S[0]:S[1])*o.scale-ii*s}}function Sv(o,n,s,c){if(c===0)return;const f=o[s],y=(o[s].x+f.metrics.advance*f.scale)*c;for(let v=n;v<=s;v++)o[v].x-=y}function m_(o,n,s){const{horizontalAlign:c,verticalAlign:f}=dm(s),y=n[0]-o.displaySize[0]*c,v=n[1]-o.displaySize[1]*f;return{image:o,top:v,bottom:v+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function fm(o){var n,s;let c=o.left,f=o.top,y=o.right-c,v=o.bottom-f;const S=(n=o.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",E=(s=o.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",I=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(E==="proportional"){if(S==="stretchOnly"&&y/v<I||S==="proportional"){const A=Math.ceil(v*I);c*=A/y,y=A}}else if(S==="proportional"&&E==="stretchOnly"&&I!==0&&y/v>I){const A=Math.ceil(y/I);f*=A/v,v=A}return{x1:c,y1:f,x2:c+y,y2:f+v}}function g_(o,n,s,c,f,y){const v=o.image;let S;if(v.content){const J=v.content,ae=v.pixelRatio||1;S=[J[0]/ae,J[1]/ae,v.displaySize[0]-J[2]/ae,v.displaySize[1]-J[3]/ae]}const E=n.left*y,I=n.right*y;let A,R,N,U;s==="width"||s==="both"?(U=f[0]+E-c[3],R=f[0]+I+c[1]):(U=f[0]+(E+I-v.displaySize[0])/2,R=U+v.displaySize[0]);const V=n.top*y,q=n.bottom*y;return s==="height"||s==="both"?(A=f[1]+V-c[0],N=f[1]+q+c[2]):(A=f[1]+(V+q-v.displaySize[1])/2,N=A+v.displaySize[1]),{image:v,top:A,right:R,bottom:N,left:U,collisionPadding:S}}const md=255,pa=128,Il=md*pa;function gd(o,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new hr(o+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let y=0;for(;y<c.length&&c[y]<=o;)y++;y=Math.max(0,y-1);let v=y;for(;v<c.length&&c[v]<o+1;)v++;v=Math.min(c.length-1,v);const S=c[y],E=c[v];return s.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:S,maxZoom:E,minSize:s.evaluate(new hr(S)),maxSize:s.evaluate(new hr(E)),interpolationType:f}}}function pm(o,n,s){let c="never";const f=o.get(n);return f?c=f:o.get(s)&&(c="always"),c}const Tv=dd.VectorTileFeature.types,Cv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lf(o,n,s,c,f,y,v,S,E,I,A,R,N){const U=S?Math.min(Il,Math.round(S[0])):0,V=S?Math.min(Il,Math.round(S[1])):0;o.emplaceBack(n,s,Math.round(32*c),Math.round(32*f),y,v,(U<<1)+(E?1:0),V,16*I,16*A,256*R,256*N)}function mm(o,n,s){o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s)}function Pv(o){for(const n of o.sections)if(pf(n.text))return!0;return!1}class gm{constructor(n){this.layoutVertexArray=new Be,this.indexArray=new tt,this.programConfigurations=n,this.segments=new Ot,this.dynamicLayoutVertexArray=new je,this.opacityVertexArray=new He,this.hasVisibleVertices=!1,this.placedSymbolArray=new M}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,lv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,cv.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Cv,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}St("SymbolBuffers",gm);class _m{constructor(n,s,c){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Ot,this.collisionVertexArray=new Ze}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,uv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}St("CollisionBuffers",_m);class Zu{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(v=>v.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gd(this.zoom,s["text-size"]),this.iconSizeData=gd(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),y=c.get("symbol-z-order");this.canOverlap=pm(c,"text-overlap","text-allow-overlap")!=="never"||pm(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(v=>b.ag[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=n.sourceID}createArrays(){this.text=new gm(new ja(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new gm(new ja(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new O,this.lineVertexArray=new B,this.symbolInstances=new D,this.textAnchorOffsets=new W}calculateGlyphDependencies(n,s,c,f,y){for(let v=0;v<n.length;v++)if(s[n.charCodeAt(v)]=!0,(c||f)&&y){const S=pd[n.charAt(v)];S&&(s[S.charCodeAt(0)]=!0)}}populate(n,s,c){const f=this.layers[0],y=f.layout,v=y.get("text-font"),S=y.get("text-field"),E=y.get("icon-image"),I=(S.value.kind!=="constant"||S.value.value instanceof Ir&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),A=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,R=y.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const N=s.iconDependencies,U=s.glyphDependencies,V=s.availableImages,q=new hr(this.zoom);for(const{feature:J,id:ae,index:Ce,sourceLayerIndex:de}of n){const j=f._featureFilter.needGeometry,K=fr(J,j);if(!f._featureFilter.filter(q,K,c))continue;let fe,Ne;if(j||(K.geometry=ua(J)),I){const Fe=f.getValueAndResolveTokens("text-field",K,c,V),Ge=Ir.factory(Fe),ft=this.hasRTLText=this.hasRTLText||Pv(Ge);(!ft||Cs.getRTLTextPluginStatus()==="unavailable"||ft&&Cs.isParsed())&&(fe=dv(Ge,f,K))}if(A){const Fe=f.getValueAndResolveTokens("icon-image",K,c,V);Ne=Fe instanceof Ti?Fe:Ti.fromString(Fe)}if(!fe&&!Ne)continue;const Je=this.sortFeaturesByKey?R.evaluate(K,{},c):void 0;if(this.features.push({id:ae,text:fe,icon:Ne,index:Ce,sourceLayerIndex:de,geometry:K.geometry,properties:J.properties,type:Tv[J.type],sortKey:Je}),Ne&&(N[Ne.name]=!0),fe){const Fe=v.evaluate(K,{},c).join(","),Ge=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ag.vertical)>=0;for(const ft of fe.sections)if(ft.image)N[ft.image.name]=!0;else{const at=Eu(fe.toString()),pt=ft.fontStack||Fe,Qe=U[pt]=U[pt]||{};this.calculateGlyphDependencies(ft.text,Qe,Ge,this.allowVerticalPlacement,at)}}}y.get("symbol-placement")==="line"&&(this.features=function(J){const ae={},Ce={},de=[];let j=0;function K(Fe){de.push(J[Fe]),j++}function fe(Fe,Ge,ft){const at=Ce[Fe];return delete Ce[Fe],Ce[Ge]=at,de[at].geometry[0].pop(),de[at].geometry[0]=de[at].geometry[0].concat(ft[0]),at}function Ne(Fe,Ge,ft){const at=ae[Ge];return delete ae[Ge],ae[Fe]=at,de[at].geometry[0].shift(),de[at].geometry[0]=ft[0].concat(de[at].geometry[0]),at}function Je(Fe,Ge,ft){const at=ft?Ge[0][Ge[0].length-1]:Ge[0][0];return`${Fe}:${at.x}:${at.y}`}for(let Fe=0;Fe<J.length;Fe++){const Ge=J[Fe],ft=Ge.geometry,at=Ge.text?Ge.text.toString():null;if(!at){K(Fe);continue}const pt=Je(at,ft),Qe=Je(at,ft,!0);if(pt in Ce&&Qe in ae&&Ce[pt]!==ae[Qe]){const Ct=Ne(pt,Qe,ft),$t=fe(pt,Qe,de[Ct].geometry);delete ae[pt],delete Ce[Qe],Ce[Je(at,de[$t].geometry,!0)]=$t,de[Ct].geometry=null}else pt in Ce?fe(pt,Qe,ft):Qe in ae?Ne(pt,Qe,ft):(K(Fe),ae[pt]=j-1,Ce[Qe]=j-1)}return de.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ae)=>J.sortKey-ae.sortKey)}update(n,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const c=this.lineVertexArray.length;if(n.segment!==void 0){let f=n.dist(s[n.segment+1]),y=n.dist(s[n.segment]);const v={};for(let S=n.segment+1;S<s.length;S++)v[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:f},S<s.length-1&&(f+=s[S+1].dist(s[S]));for(let S=n.segment||0;S>=0;S--)v[S]={x:s[S].x,y:s[S].y,tileUnitDistanceFromAnchor:y},S>0&&(y+=s[S-1].dist(s[S]));for(let S=0;S<s.length;S++){const E=v[S];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,s,c,f,y,v,S,E,I,A,R,N){const U=n.indexArray,V=n.layoutVertexArray,q=n.segments.prepareSegment(4*s.length,V,U,this.canOverlap?v.sortKey:void 0),J=this.glyphOffsetArray.length,ae=q.vertexLength,Ce=this.allowVerticalPlacement&&S===b.ag.vertical?Math.PI/2:0,de=v.text&&v.text.sections;for(let j=0;j<s.length;j++){const{tl:K,tr:fe,bl:Ne,br:Je,tex:Fe,pixelOffsetTL:Ge,pixelOffsetBR:ft,minFontScaleX:at,minFontScaleY:pt,glyphOffset:Qe,isSDF:Ct,sectionIndex:$t}=s[j],Nt=q.vertexLength,At=Qe[1];Lf(V,E.x,E.y,K.x,At+K.y,Fe.x,Fe.y,c,Ct,Ge.x,Ge.y,at,pt),Lf(V,E.x,E.y,fe.x,At+fe.y,Fe.x+Fe.w,Fe.y,c,Ct,ft.x,Ge.y,at,pt),Lf(V,E.x,E.y,Ne.x,At+Ne.y,Fe.x,Fe.y+Fe.h,c,Ct,Ge.x,ft.y,at,pt),Lf(V,E.x,E.y,Je.x,At+Je.y,Fe.x+Fe.w,Fe.y+Fe.h,c,Ct,ft.x,ft.y,at,pt),mm(n.dynamicLayoutVertexArray,E,Ce),U.emplaceBack(Nt,Nt+2,Nt+1),U.emplaceBack(Nt+1,Nt+2,Nt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),j!==s.length-1&&$t===s[j+1].sectionIndex||n.programConfigurations.populatePaintArrays(V.length,v,v.index,{},N,de&&de[$t])}n.placedSymbolArray.emplaceBack(E.x,E.y,J,this.glyphOffsetArray.length-J,ae,I,A,E.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],S,0,!1,0,R)}_addCollisionDebugVertex(n,s,c,f,y,v){return s.emplaceBack(0,0),n.emplaceBack(c.x,c.y,f,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(n,s,c,f,y,v,S){const E=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=E.vertexLength,A=y.layoutVertexArray,R=y.collisionVertexArray,N=S.anchorX,U=S.anchorY;this._addCollisionDebugVertex(A,R,v,N,U,new Te(n,s)),this._addCollisionDebugVertex(A,R,v,N,U,new Te(c,s)),this._addCollisionDebugVertex(A,R,v,N,U,new Te(c,f)),this._addCollisionDebugVertex(A,R,v,N,U,new Te(n,f)),E.vertexLength+=4;const V=y.indexArray;V.emplaceBack(I,I+1),V.emplaceBack(I+1,I+2),V.emplaceBack(I+2,I+3),V.emplaceBack(I+3,I),E.primitiveLength+=4}addDebugCollisionBoxes(n,s,c,f){for(let y=n;y<s;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _m(Ye,r_.members,mt),this.iconCollisionBox=new _m(Ye,r_.members,mt);for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(n,s,c,f,y,v,S,E,I){const A={};for(let R=s;R<c;R++){const N=n.get(R);A.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},A.textFeatureIndex=N.featureIndex;break}for(let R=f;R<y;R++){const N=n.get(R);A.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},A.verticalTextFeatureIndex=N.featureIndex;break}for(let R=v;R<S;R++){const N=n.get(R);A.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},A.iconFeatureIndex=N.featureIndex;break}for(let R=E;R<I;R++){const N=n.get(R);A.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},A.verticalIconFeatureIndex=N.featureIndex;break}return A}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const c=n.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let y=c.vertexStartIndex;y<f;y+=4)n.indexArray.emplaceBack(y,y+2,y+1),n.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),c=Math.cos(n),f=[],y=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);f.push(0|Math.round(s*E.anchorX+c*E.anchorY)),y.push(E.featureIndex)}return v.sort((S,E)=>f[S]-f[E]||y[E]-y[S]),v}addToSortKeyRanges(n,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,y,v)=>{f>=0&&v.indexOf(f)===y&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let __,y_;St("SymbolBucket",Zu,{omit:["layers","collisionBoxArray","features","compareText"]}),Zu.MAX_GLYPHS=65535,Zu.addDynamicAttributes=mm;var Gu={get paint(){return y_=y_||new Di({"icon-opacity":new Vt(F.paint_symbol["icon-opacity"]),"icon-color":new Vt(F.paint_symbol["icon-color"]),"icon-halo-color":new Vt(F.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(F.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(F.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(F.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(F.paint_symbol["icon-translate-anchor"]),"text-opacity":new Vt(F.paint_symbol["text-opacity"]),"text-color":new Vt(F.paint_symbol["text-color"],{runtimeType:hn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Vt(F.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(F.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(F.paint_symbol["text-halo-blur"]),"text-translate":new Et(F.paint_symbol["text-translate"]),"text-translate-anchor":new Et(F.paint_symbol["text-translate-anchor"])})},get layout(){return __=__||new Di({"symbol-placement":new Et(F.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(F.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(F.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(F.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(F.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Et(F.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Et(F.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Et(F.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(F.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(F.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(F.layout_symbol["icon-size"]),"icon-text-fit":new Et(F.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(F.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(F.layout_symbol["icon-image"]),"icon-rotate":new Vt(F.layout_symbol["icon-rotate"]),"icon-padding":new Vt(F.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(F.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(F.layout_symbol["icon-offset"]),"icon-anchor":new Vt(F.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(F.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(F.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(F.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(F.layout_symbol["text-field"]),"text-font":new Vt(F.layout_symbol["text-font"]),"text-size":new Vt(F.layout_symbol["text-size"]),"text-max-width":new Vt(F.layout_symbol["text-max-width"]),"text-line-height":new Et(F.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(F.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(F.layout_symbol["text-justify"]),"text-radial-offset":new Vt(F.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(F.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Vt(F.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Vt(F.layout_symbol["text-anchor"]),"text-max-angle":new Et(F.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(F.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(F.layout_symbol["text-rotate"]),"text-padding":new Et(F.layout_symbol["text-padding"]),"text-keep-upright":new Et(F.layout_symbol["text-keep-upright"]),"text-transform":new Vt(F.layout_symbol["text-transform"]),"text-offset":new Vt(F.layout_symbol["text-offset"]),"text-allow-overlap":new Et(F.layout_symbol["text-allow-overlap"]),"text-overlap":new Et(F.layout_symbol["text-overlap"]),"text-ignore-placement":new Et(F.layout_symbol["text-ignore-placement"]),"text-optional":new Et(F.layout_symbol["text-optional"])})}};class v_{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Ht,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St("FormatSectionOverride",v_,{omit:["defaultValue"]});class _d extends Hi{constructor(n){super(n,Gu)}recalculate(n,s){if(super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const y of c)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,s,c,f){const y=this.layout.get(n).evaluate(s,{},c,f),v=this._unevaluatedLayout._values[n];return v.isDataDriven()||pc(v.value)||!y?y:function(S,E){return E.replace(/{([^{}]+)}/g,(I,A)=>S&&A in S?String(S[A]):"")}(s.properties,y)}createBucket(n){return new Zu(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Gu.paint.overridableProperties){if(!_d.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),c=new v_(s),f=new _l(c,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new mc("source",f):new bu("composite",f,s.value.zoomStops),this.paint._values[n]=new co(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&_d.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const c=n.get("text-field"),f=Gu.paint.properties[s];let y=!1;const v=S=>{for(const E of S)if(f.overrides&&f.overrides.hasOverride(E))return void(y=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Ir)v(c.value.value.sections);else if(c.value.kind==="source"){const S=I=>{y||(I instanceof ro&&Ur(I.value)===Nr?v(I.value.sections):I instanceof qi?v(I.sections):I.eachChild(S))},E=c.value;E._styleExpression&&S(E._styleExpression.expression)}return y}}let ym;var vm={get paint(){return ym=ym||new Di({"background-color":new Et(F.paint_background["background-color"]),"background-pattern":new Ri(F.paint_background["background-pattern"]),"background-opacity":new Et(F.paint_background["background-opacity"])})}};class x_ extends Hi{constructor(n){super(n,vm)}}let xm;var b_={get paint(){return xm=xm||new Di({"raster-opacity":new Et(F.paint_raster["raster-opacity"]),"raster-hue-rotate":new Et(F.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(F.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(F.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(F.paint_raster["raster-saturation"]),"raster-contrast":new Et(F.paint_raster["raster-contrast"]),"raster-resampling":new Et(F.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(F.paint_raster["raster-fade-duration"])})}};class w_ extends Hi{constructor(n){super(n,b_)}}class Ev extends Hi{constructor(n){super(n,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Mv{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Iv={once:!0},qu=63710088e-1;class As{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new As(gn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,c=this.lat*s,f=n.lat*s,y=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((n.lng-this.lng)*s);return qu*Math.acos(Math.min(y,1))}static convert(n){if(n instanceof As)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new As(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new As(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const S_=2*Math.PI*qu;function T_(o){return S_*Math.cos(o*Math.PI/180)}function Ff(o){return(180+o)/360}function bm(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function C_(o,n){return o/T_(n)}function wm(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function P_(o,n){return o*T_(wm(n))}class yd{constructor(n,s,c=0){this.x=+n,this.y=+s,this.z=+c}static fromLngLat(n,s=0){const c=As.convert(n);return new yd(Ff(c.lng),bm(c.lat),C_(s,c.lat))}toLngLat(){return new As(360*this.x-180,wm(this.y))}toAltitude(){return P_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/S_*(n=wm(this.y),1/Math.cos(n*Math.PI/180));var n}}function E_(o,n,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,n*c-2*Math.PI*6378137/2]}class Sm{constructor(n,s,c){if(!function(f,y,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||y<0||y>=Math.pow(2,f))}(n,s,c))throw new Error(`x=${s}, y=${c}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=s,this.y=c,this.key=Wu(0,n,n,s,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s,c){const f=(v=this.y,S=this.z,E=E_(256*(y=this.x),256*(v=Math.pow(2,S)-v-1),S),I=E_(256*(y+1),256*(v+1),S),E[0]+","+E[1]+","+I[0]+","+I[1]);var y,v,S,E,I;const A=function(R,N,U){let V,q="";for(let J=R;J>0;J--)V=1<<J-1,q+=(N&V?1:0)+(U&V?2:0);return q}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,f)}isChildOf(n){const s=this.z-n.z;return s>0&&n.x===this.x>>s&&n.y===this.y>>s}getTilePoint(n){const s=Math.pow(2,this.z);return new Te((n.x*s-this.x)*Kt,(n.y*s-this.y)*Kt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class M_{constructor(n,s){this.wrap=n,this.canonical=s,this.key=Wu(n,s.z,s.z,s.x,s.y)}}class qo{constructor(n,s,c,f,y){if(this.terrainRttPosMatrix32f=null,n<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${c}`);this.overscaledZ=n,this.wrap=s,this.canonical=new Sm(c,+f,+y),this.key=Wu(s,n,c,f,y)}clone(){return new qo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-n;return n>this.canonical.z?new qo(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qo(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?Wu(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):Wu(this.wrap*+s,n,n,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new qo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new qo(s,this.wrap,s,c,f),new qo(s,this.wrap,s,c+1,f),new qo(s,this.wrap,s,c,f+1),new qo(s,this.wrap,s,c+1,f+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new qo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new qo(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new M_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new yd(n.x-this.wrap,n.y))}}function Wu(o,n,s,c,f){(o*=2)<0&&(o=-1*o-1);const y=1<<s;return(y*y*o+y*f+c).toString(36)+s.toString(36)+n.toString(36)}St("CanonicalTileID",Sm),St("OverscaledTileID",qo,{omit:["terrainRttPosMatrix32f"]});class I_{constructor(n,s,c,f=1,y=1,v=1,S=0){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void Gt(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const E=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=y,this.blueFactor=v,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<E;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(E,I)]=this.data[this._idx(E-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,E)]=this.data[this._idx(I,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<E;I++)for(let A=0;A<E;A++){const R=this.get(I,A);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(n,s){const c=new Uint8Array(this.data.buffer),f=4*this._idx(n,s);return this.unpack(c[f],c[f+1],c[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}unpack(n,s,c){return n*this.redFactor+s*this.greenFactor+c*this.blueFactor-this.baseShift}getPixels(){return new Go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,s,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,y=s*this.dim+this.dim,v=c*this.dim,S=c*this.dim+this.dim;switch(s){case-1:f=y-1;break;case 1:y=f+1}switch(c){case-1:v=S-1;break;case 1:S=v+1}const E=-s*this.dim,I=-c*this.dim;for(let A=v;A<S;A++)for(let R=f;R<y;R++)this.data[this._idx(R,A)]=n.data[this._idx(R+E,A+I)]}}St("DEMData",I_);class k_{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const c=n[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class A_{constructor(n,s,c,f,y){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=c,n._y=f,this.properties=n.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(n[s]=this[s]);return n}}class hs{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new wc(Kt,16,0),this.grid3D=new wc(Kt,16,0),this.featureIndexArray=new re,this.promoteId=s}insert(n,s,c,f,y,v){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,y);const E=v?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const A=s[I],R=[1/0,1/0,-1/0,-1/0];for(let N=0;N<A.length;N++){const U=A[N];R[0]=Math.min(R[0],U.x),R[1]=Math.min(R[1],U.y),R[2]=Math.max(R[2],U.x),R[3]=Math.max(R[3],U.y)}R[0]<Kt&&R[1]<Kt&&R[2]>=0&&R[3]>=0&&E.insert(S,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new dd.VectorTile(new am(this.rawTileData)).layers,this.sourceLayerCoder=new k_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,s,c,f){this.loadVTLayers();const y=n.params,v=Kt/n.tileSize/n.scale,S=wu(y.filter),E=n.queryGeometry,I=n.queryPadding*v,A=R_(E),R=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),N=R_(n.cameraQueryGeometry),U=this.grid3D.query(N.minX-I,N.minY-I,N.maxX+I,N.maxY+I,(J,ae,Ce,de)=>function(j,K,fe,Ne,Je){for(const Ge of j)if(K<=Ge.x&&fe<=Ge.y&&Ne>=Ge.x&&Je>=Ge.y)return!0;const Fe=[new Te(K,fe),new Te(K,Je),new Te(Ne,Je),new Te(Ne,fe)];if(j.length>2){for(const Ge of Fe)if(Mc(j,Ge))return!0}for(let Ge=0;Ge<j.length-1;Ge++)if(Rg(j[Ge],j[Ge+1],Fe))return!0;return!1}(n.cameraQueryGeometry,J-I,ae-I,Ce+I,de+I));for(const J of U)R.push(J);R.sort(Rc);const V={};let q;for(let J=0;J<R.length;J++){const ae=R[J];if(ae===q)continue;q=ae;const Ce=this.featureIndexArray.get(ae);let de=null;this.loadMatchingFeature(V,Ce.bucketIndex,Ce.sourceLayerIndex,Ce.featureIndex,S,y.layers,y.availableImages,s,c,f,(j,K,fe)=>(de||(de=ua(j)),K.queryIntersectsFeature({queryGeometry:E,feature:j,featureState:fe,geometry:de,zoom:this.z,transform:n.transform,pixelsToTileUnits:v,pixelPosMatrix:n.pixelPosMatrix})))}return V}loadMatchingFeature(n,s,c,f,y,v,S,E,I,A,R){const N=this.bucketLayerIDs[s];if(v&&!N.some(J=>v.has(J)))return;const U=this.sourceLayerCoder.decode(c),V=this.vtLayers[U].feature(f);if(y.needGeometry){const J=fr(V,!0);if(!y.filter(new hr(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!y.filter(new hr(this.tileID.overscaledZ),V))return;const q=this.getId(V,U);for(let J=0;J<N.length;J++){const ae=N[J];if(v&&!v.has(ae))continue;const Ce=E[ae];if(!Ce)continue;let de={};q&&A&&(de=A.getState(Ce.sourceLayer||"_geojsonTileLayer",q));const j=nn({},I[ae]);j.paint=z_(j.paint,Ce.paint,V,de,S),j.layout=z_(j.layout,Ce.layout,V,de,S);const K=!R||R(V,Ce,de);if(!K)continue;const fe=new A_(V,this.z,this.x,this.y,q);fe.layer=j;let Ne=n[ae];Ne===void 0&&(Ne=n[ae]=[]),Ne.push({featureIndex:f,feature:fe,intersectionZ:K})}}lookupSymbolFeatures(n,s,c,f,y,v,S,E){const I={};this.loadVTLayers();const A=wu(y);for(const R of n)this.loadMatchingFeature(I,c,f,R,A,v,S,E,s);return I}hasLayer(n){for(const s of this.bucketLayerIDs)for(const c of s)if(n===c)return!0;return!1}getId(n,s){var c;let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((c=n.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(f=Number(n.properties.cluster_id))),f}}function z_(o,n,s,c,f){return mr(o,(y,v)=>{const S=n instanceof ku?n.get(v):null;return S&&S.evaluate?S.evaluate(s,c,f):S})}function R_(o){let n=1/0,s=1/0,c=-1/0,f=-1/0;for(const y of o)n=Math.min(n,y.x),s=Math.min(s,y.y),c=Math.max(c,y.x),f=Math.max(f,y.y);return{minX:n,minY:s,maxX:c,maxY:f}}function Rc(o,n){return n-o}function pn(o,n,s,c,f){const y=[];for(let v=0;v<o.length;v++){const S=o[v];let E;for(let I=0;I<S.length-1;I++){let A=S[I],R=S[I+1];A.x<n&&R.x<n||(A.x<n?A=new Te(n,A.y+(n-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x<n&&(R=new Te(n,A.y+(n-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y<s&&R.y<s||(A.y<s?A=new Te(A.x+(s-A.y)/(R.y-A.y)*(R.x-A.x),s)._round():R.y<s&&(R=new Te(A.x+(s-A.y)/(R.y-A.y)*(R.x-A.x),s)._round()),A.x>=c&&R.x>=c||(A.x>=c?A=new Te(c,A.y+(c-A.x)/(R.x-A.x)*(R.y-A.y))._round():R.x>=c&&(R=new Te(c,A.y+(c-A.x)/(R.x-A.x)*(R.y-A.y))._round()),A.y>=f&&R.y>=f||(A.y>=f?A=new Te(A.x+(f-A.y)/(R.y-A.y)*(R.x-A.x),f)._round():R.y>=f&&(R=new Te(A.x+(f-A.y)/(R.y-A.y)*(R.x-A.x),f)._round()),E&&A.equals(E[E.length-1])||(E=[A],y.push(E)),E.push(R)))))}}return y}St("FeatureIndex",hs,{omit:["rawTileData","sourceLayerCoder"]});class kl extends Te{constructor(n,s,c,f){super(n,s),this.angle=c,f!==void 0&&(this.segment=f)}clone(){return new kl(this.x,this.y,this.angle,this.segment)}}function fo(o,n,s,c,f){if(n.segment===void 0||s===0)return!0;let y=n,v=n.segment+1,S=0;for(;S>-s/2;){if(v--,v<0)return!1;S-=o[v].dist(y),y=o[v]}S+=o[v].dist(o[v+1]),v++;const E=[];let I=0;for(;S<s/2;){const A=o[v],R=o[v+1];if(!R)return!1;let N=o[v-1].angleTo(A)-A.angleTo(R);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:N}),I+=N;S-E[0].distance>c;)I-=E.shift().angleDelta;if(I>f)return!1;v++,S+=A.dist(R)}return!0}function Zr(o){let n=0;for(let s=0;s<o.length-1;s++)n+=o[s].dist(o[s+1]);return n}function D_(o,n,s){return o?.6*n*s:0}function Ga(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function kv(o,n,s,c,f,y){const v=D_(s,f,y),S=Ga(s,c)*y;let E=0;const I=Zr(o)/2;for(let A=0;A<o.length-1;A++){const R=o[A],N=o[A+1],U=R.dist(N);if(E+U>I){const V=(I-E)/U,q=ki.number(R.x,N.x,V),J=ki.number(R.y,N.y,V),ae=new kl(q,J,N.angleTo(R),A);return ae._round(),!v||fo(o,ae,S,v,n)?ae:void 0}E+=U}}function Av(o,n,s,c,f,y,v,S,E){const I=D_(c,y,v),A=Ga(c,f),R=A*v,N=o[0].x===0||o[0].x===E||o[0].y===0||o[0].y===E;return n-R<n/4&&(n=R+n/4),L_(o,N?n/2*S%n:(A/2+2*y)*v*S%n,n,I,s,R,N,!1,E)}function L_(o,n,s,c,f,y,v,S,E){const I=y/2,A=Zr(o);let R=0,N=n-s,U=[];for(let V=0;V<o.length-1;V++){const q=o[V],J=o[V+1],ae=q.dist(J),Ce=J.angleTo(q);for(;N+s<R+ae;){N+=s;const de=(N-R)/ae,j=ki.number(q.x,J.x,de),K=ki.number(q.y,J.y,de);if(j>=0&&j<E&&K>=0&&K<E&&N-I>=0&&N+I<=A){const fe=new kl(j,K,Ce,V);fe._round(),c&&!fo(o,fe,y,c,f)||U.push(fe)}}R+=ae}return S||U.length||v||(U=L_(o,R/2,s,c,f,y,v,!0,E)),U}St("Anchor",kl);const vd=ho;function F_(o,n,s,c){const f=[],y=o.image,v=y.pixelRatio,S=y.paddedRect.w-2*vd,E=y.paddedRect.h-2*vd;let I={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const A=y.stretchX||[[0,S]],R=y.stretchY||[[0,E]],N=(Qe,Ct)=>Qe+Ct[1]-Ct[0],U=A.reduce(N,0),V=R.reduce(N,0),q=S-U,J=E-V;let ae=0,Ce=U,de=0,j=V,K=0,fe=q,Ne=0,Je=J;if(y.content&&c){const Qe=y.content,Ct=Qe[2]-Qe[0],$t=Qe[3]-Qe[1];(y.textFitWidth||y.textFitHeight)&&(I=fm(o)),ae=Hu(A,0,Qe[0]),de=Hu(R,0,Qe[1]),Ce=Hu(A,Qe[0],Qe[2]),j=Hu(R,Qe[1],Qe[3]),K=Qe[0]-ae,Ne=Qe[1]-de,fe=Ct-Ce,Je=$t-j}const Fe=I.x1,Ge=I.y1,ft=I.x2-Fe,at=I.y2-Ge,pt=(Qe,Ct,$t,Nt)=>{const At=ds(Qe.stretch-ae,Ce,ft,Fe),xn=xd(Qe.fixed-K,fe,Qe.stretch,U),Pr=ds(Ct.stretch-de,j,at,Ge),qr=xd(Ct.fixed-Ne,Je,Ct.stretch,V),gi=ds($t.stretch-ae,Ce,ft,Fe),Ho=xd($t.fixed-K,fe,$t.stretch,U),mo=ds(Nt.stretch-de,j,at,Ge),_i=xd(Nt.fixed-Ne,Je,Nt.stretch,V),Sr=new Te(At,Pr),Er=new Te(gi,Pr),yi=new Te(gi,mo),vi=new Te(At,mo),Yi=new Te(xn/v,qr/v),Xo=new Te(Ho/v,_i/v),di=n*Math.PI/180;if(di){const fi=Math.sin(di),pi=Math.cos(di),Hr=[pi,-fi,fi,pi];Sr._matMult(Hr),Er._matMult(Hr),vi._matMult(Hr),yi._matMult(Hr)}const Ji=Qe.stretch+Qe.fixed,Wr=Ct.stretch+Ct.fixed;return{tl:Sr,tr:Er,bl:vi,br:yi,tex:{x:y.paddedRect.x+vd+Ji,y:y.paddedRect.y+vd+Wr,w:$t.stretch+$t.fixed-Ji,h:Nt.stretch+Nt.fixed-Wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yi,pixelOffsetBR:Xo,minFontScaleX:fe/v/ft,minFontScaleY:Je/v/at,isSDF:s}};if(c&&(y.stretchX||y.stretchY)){const Qe=O_(A,q,U),Ct=O_(R,J,V);for(let $t=0;$t<Qe.length-1;$t++){const Nt=Qe[$t],At=Qe[$t+1];for(let xn=0;xn<Ct.length-1;xn++)f.push(pt(Nt,Ct[xn],At,Ct[xn+1]))}}else f.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:E+1}));return f}function Hu(o,n,s){let c=0;for(const f of o)c+=Math.max(n,Math.min(s,f[1]))-Math.max(n,Math.min(s,f[0]));return c}function O_(o,n,s){const c=[{fixed:-1,stretch:0}];for(const[f,y]of o){const v=c[c.length-1];c.push({fixed:f-v.stretch,stretch:v.stretch}),c.push({fixed:f-v.stretch,stretch:v.stretch+(y-f)})}return c.push({fixed:n+vd,stretch:s}),c}function ds(o,n,s,c){return o/n*s+c}function xd(o,n,s,c){return o-n*s/c}class Dc{constructor(n,s,c,f,y,v,S,E,I,A){var R;if(this.boxStartIndex=n.length,I){let N=v.top,U=v.bottom;const V=v.collisionPadding;V&&(N-=V[1],U+=V[3]);let q=U-N;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const N=!((R=v.image)===null||R===void 0)&&R.content&&(v.image.textFitWidth||v.image.textFitHeight)?fm(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};N.y1=N.y1*S-E[0],N.y2=N.y2*S+E[2],N.x1=N.x1*S-E[3],N.x2=N.x2*S+E[1];const U=v.collisionPadding;if(U&&(N.x1-=U[0]*S,N.y1-=U[1]*S,N.x2+=U[2]*S,N.y2+=U[3]*S),A){const V=new Te(N.x1,N.y1),q=new Te(N.x2,N.y1),J=new Te(N.x1,N.y2),ae=new Te(N.x2,N.y2),Ce=A*Math.PI/180;V._rotate(Ce),q._rotate(Ce),J._rotate(Ce),ae._rotate(Ce),N.x1=Math.min(V.x,q.x,J.x,ae.x),N.x2=Math.max(V.x,q.x,J.x,ae.x),N.y1=Math.min(V.y,q.y,J.y,ae.y),N.y2=Math.max(V.y,q.y,J.y,ae.y)}n.emplaceBack(s.x,s.y,N.x1,N.y1,N.x2,N.y2,c,f,y)}this.boxEndIndex=n.length}}class Fr{constructor(n=[],s=(c,f)=>c<f?-1:c>f?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:c}=this,f=s[n];for(;n>0;){const y=n-1>>1,v=s[y];if(c(f,v)>=0)break;s[n]=v,n=y}s[n]=f}_down(n){const{data:s,compare:c}=this,f=this.length>>1,y=s[n];for(;n<f;){let v=1+(n<<1);const S=v+1;if(S<this.length&&c(s[S],s[v])<0&&(v=S),c(s[v],y)>=0)break;s[n]=s[v],n=v}s[n]=y}}function Gr(o,n=1,s=!1){let c=1/0,f=1/0,y=-1/0,v=-1/0;const S=o[0];for(let U=0;U<S.length;U++){const V=S[U];(!U||V.x<c)&&(c=V.x),(!U||V.y<f)&&(f=V.y),(!U||V.x>y)&&(y=V.x),(!U||V.y>v)&&(v=V.y)}const E=Math.min(y-c,v-f);let I=E/2;const A=new Fr([],B_);if(E===0)return new Te(c,f);for(let U=c;U<y;U+=E)for(let V=f;V<v;V+=E)A.push(new Xu(U+I,V+I,I,o));let R=function(U){let V=0,q=0,J=0;const ae=U[0];for(let Ce=0,de=ae.length,j=de-1;Ce<de;j=Ce++){const K=ae[Ce],fe=ae[j],Ne=K.x*fe.y-fe.x*K.y;q+=(K.x+fe.x)*Ne,J+=(K.y+fe.y)*Ne,V+=3*Ne}return new Xu(q/V,J/V,0,U)}(o),N=A.length;for(;A.length;){const U=A.pop();(U.d>R.d||!R.d)&&(R=U,s&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-R.d<=n||(I=U.h/2,A.push(new Xu(U.p.x-I,U.p.y-I,I,o)),A.push(new Xu(U.p.x+I,U.p.y-I,I,o)),A.push(new Xu(U.p.x-I,U.p.y+I,I,o)),A.push(new Xu(U.p.x+I,U.p.y+I,I,o)),N+=4)}return s&&(console.log(`num probes: ${N}`),console.log(`best distance: ${R.d}`)),R.p}function B_(o,n){return n.max-o.max}function Xu(o,n,s,c){this.p=new Te(o,n),this.h=s,this.d=function(f,y){let v=!1,S=1/0;for(let E=0;E<y.length;E++){const I=y[E];for(let A=0,R=I.length,N=R-1;A<R;N=A++){const U=I[A],V=I[N];U.y>f.y!=V.y>f.y&&f.x<(V.x-U.x)*(f.y-U.y)/(V.y-U.y)+U.x&&(v=!v),S=Math.min(S,Du(f,U,V))}}return(v?1:-1)*Math.sqrt(S)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}var Ci;b.ax=void 0,(Ci=b.ax||(b.ax={}))[Ci.center=1]="center",Ci[Ci.left=2]="left",Ci[Ci.right=3]="right",Ci[Ci.top=4]="top",Ci[Ci.bottom=5]="bottom",Ci[Ci["top-left"]=6]="top-left",Ci[Ci["top-right"]=7]="top-right",Ci[Ci["bottom-left"]=8]="bottom-left",Ci[Ci["bottom-right"]=9]="bottom-right";const Al=7,Tm=Number.POSITIVE_INFINITY;function N_(o,n){return n[1]!==Tm?function(s,c,f){let y=0,v=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":v=f-Al;break;case"bottom-right":case"bottom-left":case"bottom":v=-f+Al}switch(s){case"top-right":case"bottom-right":case"right":y=-c;break;case"top-left":case"bottom-left":case"left":y=c}return[y,v]}(o,n[0],n[1]):function(s,c){let f=0,y=0;c<0&&(c=0);const v=c/Math.SQRT2;switch(s){case"top-right":case"top-left":y=v-Al;break;case"bottom-right":case"bottom-left":y=-v+Al;break;case"bottom":y=-c+Al;break;case"top":y=c-Al}switch(s){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=c;break;case"right":f=-c}return[f,y]}(o,n[0])}function j_(o,n,s){var c;const f=o.layout,y=(c=f.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(n,{},s);if(y){const S=y.values,E=[];for(let I=0;I<S.length;I+=2){const A=E[I]=S[I],R=S[I+1].map(N=>N*ii);A.startsWith("top")?R[1]-=Al:A.startsWith("bottom")&&(R[1]+=Al),E[I+1]=R}return new Jr(E)}const v=f.get("text-variable-anchor");if(v){let S;S=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(n,{},s)*ii,Tm]:f.get("text-offset").evaluate(n,{},s).map(I=>I*ii);const E=[];for(const I of v)E.push(I,N_(I,S));return new Jr(E)}return null}function Of(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bd(o,n,s,c,f,y,v,S,E,I,A,R){let N=y.textMaxSize.evaluate(n,{});N===void 0&&(N=v);const U=o.layers[0].layout,V=U.get("icon-offset").evaluate(n,{},A),q=U_(s.horizontal),J=v/24,ae=o.tilePixelRatio*J,Ce=o.tilePixelRatio*N/24,de=o.tilePixelRatio*S,j=o.tilePixelRatio*U.get("symbol-spacing"),K=U.get("text-padding")*o.tilePixelRatio,fe=function($t,Nt,At,xn=1){const Pr=$t.get("icon-padding").evaluate(Nt,{},At),qr=Pr&&Pr.values;return[qr[0]*xn,qr[1]*xn,qr[2]*xn,qr[3]*xn]}(U,n,A,o.tilePixelRatio),Ne=U.get("text-max-angle")/180*Math.PI,Je=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Fe=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ge=U.get("symbol-placement"),ft=j/2,at=U.get("icon-text-fit");let pt;c&&at!=="none"&&(o.allowVerticalPlacement&&s.vertical&&(pt=g_(c,s.vertical,at,U.get("icon-text-fit-padding"),V,J)),q&&(c=g_(c,q,at,U.get("icon-text-fit-padding"),V,J)));const Qe=A?R.line.getGranularityForZoomLevel(A.z):1,Ct=($t,Nt)=>{Nt.x<0||Nt.x>=Kt||Nt.y<0||Nt.y>=Kt||function(At,xn,Pr,qr,gi,Ho,mo,_i,Sr,Er,yi,vi,Yi,Xo,di,Ji,Wr,fi,pi,Hr,pr,zs,Ku,Rs,zv){const Yu=At.addToLineVertexArray(xn,Pr);let Lc,Ju,Qu,eh,q_=0,W_=0,H_=0,X_=0,Em=-1,Mm=-1;const qa={};let K_=dr("");if(At.allowVerticalPlacement&&qr.vertical){const xi=_i.layout.get("text-rotate").evaluate(pr,{},Rs)+90;Qu=new Dc(Sr,xn,Er,yi,vi,qr.vertical,Yi,Xo,di,xi),mo&&(eh=new Dc(Sr,xn,Er,yi,vi,mo,Wr,fi,di,xi))}if(gi){const xi=_i.layout.get("icon-rotate").evaluate(pr,{}),Ko=_i.layout.get("icon-text-fit")!=="none",Fc=F_(gi,xi,Ku,Ko),Ls=mo?F_(mo,xi,Ku,Ko):void 0;Ju=new Dc(Sr,xn,Er,yi,vi,gi,Wr,fi,!1,xi),q_=4*Fc.length;const Oc=At.iconSizeData;let fs=null;Oc.kind==="source"?(fs=[pa*_i.layout.get("icon-size").evaluate(pr,{})],fs[0]>Il&&Gt(`${At.layerIds[0]}: Value for "icon-size" is >= ${md}. Reduce your "icon-size".`)):Oc.kind==="composite"&&(fs=[pa*zs.compositeIconSizes[0].evaluate(pr,{},Rs),pa*zs.compositeIconSizes[1].evaluate(pr,{},Rs)],(fs[0]>Il||fs[1]>Il)&&Gt(`${At.layerIds[0]}: Value for "icon-size" is >= ${md}. Reduce your "icon-size".`)),At.addSymbols(At.icon,Fc,fs,Hr,pi,pr,b.ag.none,xn,Yu.lineStartIndex,Yu.lineLength,-1,Rs),Em=At.icon.placedSymbolArray.length-1,Ls&&(W_=4*Ls.length,At.addSymbols(At.icon,Ls,fs,Hr,pi,pr,b.ag.vertical,xn,Yu.lineStartIndex,Yu.lineLength,-1,Rs),Mm=At.icon.placedSymbolArray.length-1)}const Y_=Object.keys(qr.horizontal);for(const xi of Y_){const Ko=qr.horizontal[xi];if(!Lc){K_=dr(Ko.text);const Ls=_i.layout.get("text-rotate").evaluate(pr,{},Rs);Lc=new Dc(Sr,xn,Er,yi,vi,Ko,Yi,Xo,di,Ls)}const Fc=Ko.positionedLines.length===1;if(H_+=Bf(At,xn,Ko,Ho,_i,di,pr,Ji,Yu,qr.vertical?b.ag.horizontal:b.ag.horizontalOnly,Fc?Y_:[xi],qa,Em,zs,Rs),Fc)break}qr.vertical&&(X_+=Bf(At,xn,qr.vertical,Ho,_i,di,pr,Ji,Yu,b.ag.vertical,["vertical"],qa,Mm,zs,Rs));const Rv=Lc?Lc.boxStartIndex:At.collisionBoxArray.length,Dv=Lc?Lc.boxEndIndex:At.collisionBoxArray.length,Lv=Qu?Qu.boxStartIndex:At.collisionBoxArray.length,Im=Qu?Qu.boxEndIndex:At.collisionBoxArray.length,J_=Ju?Ju.boxStartIndex:At.collisionBoxArray.length,Q_=Ju?Ju.boxEndIndex:At.collisionBoxArray.length,Fv=eh?eh.boxStartIndex:At.collisionBoxArray.length,Ov=eh?eh.boxEndIndex:At.collisionBoxArray.length;let Ds=-1;const th=(xi,Ko)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,Ko):Ko;Ds=th(Lc,Ds),Ds=th(Qu,Ds),Ds=th(Ju,Ds),Ds=th(eh,Ds);const ey=Ds>-1?1:0;ey&&(Ds*=zv/ii),At.glyphOffsetArray.length>=Zu.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),pr.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,pr.sortKey);const Bv=j_(_i,pr,Rs),[Nv,Co]=function(xi,Ko){const Fc=xi.length,Ls=Ko==null?void 0:Ko.values;if((Ls==null?void 0:Ls.length)>0)for(let Oc=0;Oc<Ls.length;Oc+=2){const fs=Ls[Oc+1];xi.emplaceBack(b.ax[Ls[Oc]],fs[0],fs[1])}return[Fc,xi.length]}(At.textAnchorOffsets,Bv);At.symbolInstances.emplaceBack(xn.x,xn.y,qa.right>=0?qa.right:-1,qa.center>=0?qa.center:-1,qa.left>=0?qa.left:-1,qa.vertical||-1,Em,Mm,K_,Rv,Dv,Lv,Im,J_,Q_,Fv,Ov,Er,H_,X_,q_,W_,ey,0,Yi,Ds,Nv,Co)}(o,Nt,$t,s,c,f,pt,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,ae,[K,K,K,K],Je,E,de,fe,Fe,V,n,y,I,A,v)};if(Ge==="line")for(const $t of pn(n.geometry,0,0,Kt,Kt)){const Nt=kc($t,Qe),At=Av(Nt,j,Ne,s.vertical||q,c,24,Ce,o.overscaling,Kt);for(const xn of At)q&&V_(o,q.text,ft,xn)||Ct(Nt,xn)}else if(Ge==="line-center"){for(const $t of n.geometry)if($t.length>1){const Nt=kc($t,Qe),At=kv(Nt,Ne,s.vertical||q,c,24,Ce);At&&Ct(Nt,At)}}else if(n.type==="Polygon")for(const $t of dl(n.geometry,0)){const Nt=Gr($t,16);Ct(kc($t[0],Qe,!0),new kl(Nt.x,Nt.y,0))}else if(n.type==="LineString")for(const $t of n.geometry){const Nt=kc($t,Qe);Ct(Nt,new kl(Nt[0].x,Nt[0].y,0))}else if(n.type==="Point")for(const $t of n.geometry)for(const Nt of $t)Ct([Nt],new kl(Nt.x,Nt.y,0))}function Bf(o,n,s,c,f,y,v,S,E,I,A,R,N,U,V){const q=function(Ce,de,j,K,fe,Ne,Je,Fe){const Ge=K.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,ft=[];for(const at of de.positionedLines)for(const pt of at.positionedGlyphs){if(!pt.rect)continue;const Qe=pt.rect||{};let Ct=mv+1,$t=!0,Nt=1,At=0;const xn=(fe||Fe)&&pt.vertical,Pr=pt.metrics.advance*pt.scale/2;if(Fe&&de.verticalizable&&(At=at.lineOffset/2-(pt.imageName?-(ii-pt.metrics.width*pt.scale)/2:(pt.scale-1)*ii)),pt.imageName){const fi=Je[pt.imageName];$t=fi.sdf,Nt=fi.pixelRatio,Ct=ho/Nt}const qr=fe?[pt.x+Pr,pt.y]:[0,0];let gi=fe?[0,0]:[pt.x+Pr+j[0],pt.y+j[1]-At],Ho=[0,0];xn&&(Ho=gi,gi=[0,0]);const mo=pt.metrics.isDoubleResolution?2:1,_i=(pt.metrics.left-Ct)*pt.scale-Pr+gi[0],Sr=(-pt.metrics.top-Ct)*pt.scale+gi[1],Er=_i+Qe.w/mo*pt.scale/Nt,yi=Sr+Qe.h/mo*pt.scale/Nt,vi=new Te(_i,Sr),Yi=new Te(Er,Sr),Xo=new Te(_i,yi),di=new Te(Er,yi);if(xn){const fi=new Te(-Pr,Pr-Rf),pi=-Math.PI/2,Hr=ii/2-Pr,pr=new Te(5-Rf-Hr,-(pt.imageName?Hr:0)),zs=new Te(...Ho);vi._rotateAround(pi,fi)._add(pr)._add(zs),Yi._rotateAround(pi,fi)._add(pr)._add(zs),Xo._rotateAround(pi,fi)._add(pr)._add(zs),di._rotateAround(pi,fi)._add(pr)._add(zs)}if(Ge){const fi=Math.sin(Ge),pi=Math.cos(Ge),Hr=[pi,-fi,fi,pi];vi._matMult(Hr),Yi._matMult(Hr),Xo._matMult(Hr),di._matMult(Hr)}const Ji=new Te(0,0),Wr=new Te(0,0);ft.push({tl:vi,tr:Yi,bl:Xo,br:di,tex:Qe,writingMode:de.writingMode,glyphOffset:qr,sectionIndex:pt.sectionIndex,isSDF:$t,pixelOffsetTL:Ji,pixelOffsetBR:Wr,minFontScaleX:0,minFontScaleY:0})}return ft}(0,s,S,f,y,v,c,o.allowVerticalPlacement),J=o.textSizeData;let ae=null;J.kind==="source"?(ae=[pa*f.layout.get("text-size").evaluate(v,{})],ae[0]>Il&&Gt(`${o.layerIds[0]}: Value for "text-size" is >= ${md}. Reduce your "text-size".`)):J.kind==="composite"&&(ae=[pa*U.compositeTextSizes[0].evaluate(v,{},V),pa*U.compositeTextSizes[1].evaluate(v,{},V)],(ae[0]>Il||ae[1]>Il)&&Gt(`${o.layerIds[0]}: Value for "text-size" is >= ${md}. Reduce your "text-size".`)),o.addSymbols(o.text,q,ae,S,y,v,I,n,E.lineStartIndex,E.lineLength,N,V);for(const Ce of A)R[Ce]=o.text.placedSymbolArray.length-1;return 4*q.length}function U_(o){for(const n in o)return o[n];return null}function V_(o,n,s,c){const f=o.compareText;if(n in f){const y=f[n];for(let v=y.length-1;v>=0;v--)if(c.dist(y[v])<s)return!0}else f[n]=[];return f[n].push(c),!1}const wd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class po{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=c>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=wd[15&c];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(n,2,1),[S]=new Uint32Array(n,4,1);return new po(S,v,y,n)}constructor(n,s=64,c=Float64Array,f){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const y=wd.indexOf(this.ArrayType),v=2*n*this.ArrayType.BYTES_PER_ELEMENT,S=n*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${c}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+S+E,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+E),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+S+E,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=n,this.coords[this._pos++]=s,c}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return zl(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:S}=this,E=[0,y.length-1,0],I=[];for(;E.length;){const A=E.pop()||0,R=E.pop()||0,N=E.pop()||0;if(R-N<=S){for(let J=N;J<=R;J++){const ae=v[2*J],Ce=v[2*J+1];ae>=n&&ae<=c&&Ce>=s&&Ce<=f&&I.push(y[J])}continue}const U=N+R>>1,V=v[2*U],q=v[2*U+1];V>=n&&V<=c&&q>=s&&q<=f&&I.push(y[U]),(A===0?n<=V:s<=q)&&(E.push(N),E.push(U-1),E.push(1-A)),(A===0?c>=V:f>=q)&&(E.push(U+1),E.push(R),E.push(1-A))}return I}within(n,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:v}=this,S=[0,f.length-1,0],E=[],I=c*c;for(;S.length;){const A=S.pop()||0,R=S.pop()||0,N=S.pop()||0;if(R-N<=v){for(let J=N;J<=R;J++)Z_(y[2*J],y[2*J+1],n,s)<=I&&E.push(f[J]);continue}const U=N+R>>1,V=y[2*U],q=y[2*U+1];Z_(V,q,n,s)<=I&&E.push(f[U]),(A===0?n-c<=V:s-c<=q)&&(S.push(N),S.push(U-1),S.push(1-A)),(A===0?n+c>=V:s+c>=q)&&(S.push(U+1),S.push(R),S.push(1-A))}return E}}function zl(o,n,s,c,f,y){if(f-c<=s)return;const v=c+f>>1;$_(o,n,v,c,f,y),zl(o,n,s,c,v-1,1-y),zl(o,n,s,v+1,f,1-y)}function $_(o,n,s,c,f,y){for(;f>c;){if(f-c>600){const I=f-c+1,A=s-c+1,R=Math.log(I),N=.5*Math.exp(2*R/3),U=.5*Math.sqrt(R*N*(I-N)/I)*(A-I/2<0?-1:1);$_(o,n,s,Math.max(c,Math.floor(s-A*N/I+U)),Math.min(f,Math.floor(s+(I-A)*N/I+U)),y)}const v=n[2*s+y];let S=c,E=f;for(Sd(o,n,c,s),n[2*f+y]>v&&Sd(o,n,c,f);S<E;){for(Sd(o,n,S,E),S++,E--;n[2*S+y]<v;)S++;for(;n[2*E+y]>v;)E--}n[2*c+y]===v?Sd(o,n,c,E):(E++,Sd(o,n,E,f)),E<=s&&(c=E+1),s<=E&&(f=E-1)}}function Sd(o,n,s,c){Cm(o,s,c),Cm(n,2*s,2*c),Cm(n,2*s+1,2*c+1)}function Cm(o,n,s){const c=o[n];o[n]=o[s],o[s]=c}function Z_(o,n,s,c){const f=o-s,y=n-c;return f*f+y*y}var Pm;b.cg=void 0,(Pm=b.cg||(b.cg={})).create="create",Pm.load="load",Pm.fullLoad="fullLoad";let Td=null,Wo=[];const mn=1e3/60,Nf="loadTime",To="fullLoadTime",G_={mark(o){performance.mark(o)},frame(o){const n=o;Td!=null&&Wo.push(n-Td),Td=n},clearMetrics(){Td=null,Wo=[],performance.clearMeasures(Nf),performance.clearMeasures(To);for(const o in b.cg)performance.clearMarks(b.cg[o])},getPerformanceMetrics(){performance.measure(Nf,b.cg.create,b.cg.load),performance.measure(To,b.cg.create,b.cg.fullLoad);const o=performance.getEntriesByName(Nf)[0].duration,n=performance.getEntriesByName(To)[0].duration,s=Wo.length,c=1/(Wo.reduce((y,v)=>y+v,0)/s/1e3),f=Wo.filter(y=>y>mn).reduce((y,v)=>y+(v-mn)/mn,0);return{loadTime:o,fullLoadTime:n,fps:c,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};b.$=yd,b.A=we,b.B=ki,b.C=hr,b.D=Et,b.E=ze,b.F=uf,b.G=function(o){if(qt==null){const n=o.navigator?o.navigator.userAgent:null;qt=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return qt},b.H=class{constructor(o,n){this.target=o,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Mv(()=>this.process()),this.subscription=Rn(this.target,"message",s=>this.receive(s),!1),this.globalScope=Kn(self)?o:window}registerMessageHandler(o,n){this.messageHandlers[o]=n}sendAsync(o,n){return new Promise((s,c)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=n?Rn(n.signal,"abort",()=>{y==null||y.unsubscribe(),delete this.resolveRejects[f];const E={id:f,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},Iv):null;this.resolveRejects[f]={resolve:E=>{y==null||y.unsubscribe(),s(E)},reject:E=>{y==null||y.unsubscribe(),c(E)}};const v=[],S=Object.assign(Object.assign({},o),{id:f,sourceMapId:this.mapId,origin:location.origin,data:ia(o.data,v)});this.target.postMessage(S,{transfer:v})})}receive(o){const n=o.data,s=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[s];const c=this.abortControllers[s];return delete this.abortControllers[s],void(c&&c.abort())}if(Kn(self)||n.mustQueue)return this.tasks[s]=n,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,n)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),n=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(o,n)}processTask(o,n){return l(this,void 0,void 0,function*(){if(n.type==="<response>"){const f=this.resolveRejects[o];return delete this.resolveRejects[o],f?void(n.error?f.reject(ao(n.error)):f.resolve(ao(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=ao(n.data),c=new AbortController;this.abortControllers[o]=c;try{const f=yield this.messageHandlers[n.type](n.sourceMapId,s,c);this.completeTask(o,null,f)}catch(f){this.completeTask(o,f)}})}completeTask(o,n,s){const c=[];delete this.abortControllers[o];const f={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?ia(n):null,data:ia(s,c)};this.target.postMessage(f,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.I=um,b.J=cr,b.K=function(){var o=new we(16);return we!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},b.L=function(o,n,s){var c,f,y,v,S,E,I,A,R,N,U,V,q=s[0],J=s[1],ae=s[2];return n===o?(o[12]=n[0]*q+n[4]*J+n[8]*ae+n[12],o[13]=n[1]*q+n[5]*J+n[9]*ae+n[13],o[14]=n[2]*q+n[6]*J+n[10]*ae+n[14],o[15]=n[3]*q+n[7]*J+n[11]*ae+n[15]):(f=n[1],y=n[2],v=n[3],S=n[4],E=n[5],I=n[6],A=n[7],R=n[8],N=n[9],U=n[10],V=n[11],o[0]=c=n[0],o[1]=f,o[2]=y,o[3]=v,o[4]=S,o[5]=E,o[6]=I,o[7]=A,o[8]=R,o[9]=N,o[10]=U,o[11]=V,o[12]=c*q+S*J+R*ae+n[12],o[13]=f*q+E*J+N*ae+n[13],o[14]=y*q+I*J+U*ae+n[14],o[15]=v*q+A*J+V*ae+n[15]),o},b.M=function(o,n,s){var c=s[0],f=s[1],y=s[2];return o[0]=n[0]*c,o[1]=n[1]*c,o[2]=n[2]*c,o[3]=n[3]*c,o[4]=n[4]*f,o[5]=n[5]*f,o[6]=n[6]*f,o[7]=n[7]*f,o[8]=n[8]*y,o[9]=n[9]*y,o[10]=n[10]*y,o[11]=n[11]*y,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},b.N=function(o,n,s){var c=n[0],f=n[1],y=n[2],v=n[3],S=n[4],E=n[5],I=n[6],A=n[7],R=n[8],N=n[9],U=n[10],V=n[11],q=n[12],J=n[13],ae=n[14],Ce=n[15],de=s[0],j=s[1],K=s[2],fe=s[3];return o[0]=de*c+j*S+K*R+fe*q,o[1]=de*f+j*E+K*N+fe*J,o[2]=de*y+j*I+K*U+fe*ae,o[3]=de*v+j*A+K*V+fe*Ce,o[4]=(de=s[4])*c+(j=s[5])*S+(K=s[6])*R+(fe=s[7])*q,o[5]=de*f+j*E+K*N+fe*J,o[6]=de*y+j*I+K*U+fe*ae,o[7]=de*v+j*A+K*V+fe*Ce,o[8]=(de=s[8])*c+(j=s[9])*S+(K=s[10])*R+(fe=s[11])*q,o[9]=de*f+j*E+K*N+fe*J,o[10]=de*y+j*I+K*U+fe*ae,o[11]=de*v+j*A+K*V+fe*Ce,o[12]=(de=s[12])*c+(j=s[13])*S+(K=s[14])*R+(fe=s[15])*q,o[13]=de*f+j*E+K*N+fe*J,o[14]=de*y+j*I+K*U+fe*ae,o[15]=de*v+j*A+K*V+fe*Ce,o},b.O=function(o,n){const s={};for(let c=0;c<n.length;c++){const f=n[c];f in o&&(s[f]=o[f])}return s},b.P=Te,b.Q=As,b.R=Go,b.S=bm,b.T=Tc,b.U=Ff,b.V=ve,b.W=Oe,b.X=En,b.Y=qo,b.Z=Kt,b._=l,b.a=vr,b.a$=function(){const o=new Float32Array(16);return ye(o),o},b.a0=Sm,b.a1=o=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(s=>{n.onloadstart=()=>{s(n)};for(const c of o){const f=window.document.createElement("source");to(c)||(n.crossOrigin="Anonymous"),f.src=c,n.appendChild(f)}})},b.a2=De,b.a3=function(){return Pn++},b.a4=w,b.a5=Zu,b.a6=wu,b.a7=fr,b.a8=A_,b.a9=function(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,y)=>{const v=f||y;return n[c]=!v||v.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n},b.aA=dm,b.aB=po,b.aC=wr,b.aD=Pf,b.aE=se,b.aF=Ot,b.aG=tt,b.aH=function(o){return Math.pow(2,o)},b.aI=85.051129,b.aJ=C_,b.aK=gn,b.aL=nr,b.aM=P_,b.aN=function(o,n,s){return o[0]=n[0]*s,o[1]=n[1]*s,o[2]=n[2]*s,o},b.aO=function(o,n,s){return o[0]=n[0]+s[0],o[1]=n[1]+s[1],o[2]=n[2]+s[2],o},b.aP=function(o){var n=new we(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n},b.aQ=function(o,n,s){return o[0]=n[0]*s[0],o[1]=n[1]*s[1],o[2]=n[2]*s[2],o[3]=n[3]*s[3],o},b.aR=function(o,n,s){return o[0]=n[0]-s[0],o[1]=n[1]-s[1],o[2]=n[2]-s[2],o},b.aS=function(o,n){var s=n[0],c=n[1],f=n[2],y=s*s+c*c+f*f;return y>0&&(y=1/Math.sqrt(y)),o[0]=n[0]*y,o[1]=n[1]*y,o[2]=n[2]*y,o},b.aT=function(o,n,s){var c=n[0],f=n[1],y=n[2],v=s[0],S=s[1],E=s[2];return o[0]=f*E-y*S,o[1]=y*v-c*E,o[2]=c*S-f*v,o},b.aU=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]},b.aV=M_,b.aW=Wu,b.aX=function(o,n,s,c,f){var y,v=1/Math.tan(n/2);return o[0]=v/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,f!=null&&f!==1/0?(o[10]=(f+c)*(y=1/(c-f)),o[14]=2*f*c*y):(o[10]=-1,o[14]=-2*c),o},b.aY=function(o){var n=new we(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},b.aZ=function(o,n,s){var c=Math.sin(s),f=Math.cos(s),y=n[0],v=n[1],S=n[2],E=n[3],I=n[4],A=n[5],R=n[6],N=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=y*f+I*c,o[1]=v*f+A*c,o[2]=S*f+R*c,o[3]=E*f+N*c,o[4]=I*f-y*c,o[5]=A*f-v*c,o[6]=R*f-S*c,o[7]=N*f-E*c,o},b.a_=function(o,n,s){var c=Math.sin(s),f=Math.cos(s),y=n[4],v=n[5],S=n[6],E=n[7],I=n[8],A=n[9],R=n[10],N=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=y*f+I*c,o[5]=v*f+A*c,o[6]=S*f+R*c,o[7]=E*f+N*c,o[8]=I*f-y*c,o[9]=A*f-v*c,o[10]=R*f-S*c,o[11]=N*f-E*c,o},b.aa=function(o){return Math.log(o)/Math.LN2},b.ab=function(o){var n=o[0],s=o[1];return n*n+s*s},b.ac=function(o){return o*Math.PI/180},b.ad=Tt,b.ae=function(o,n){const s=[];for(const c in o)c in n||s.push(c);return s},b.af=function(o,n){let s=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:f,minZoom:y,maxZoom:v}=o,S=f?Tt(kr.interpolationFactor(f,n,y,v),0,1):0;o.kind==="camera"?c=ki.number(o.minSize,o.maxSize,S):s=S}return{uSizeT:s,uSize:c}},b.ah=function(o,{uSize:n,uSizeT:s},{lowerSize:c,upperSize:f}){return o.kind==="source"?c/pa:o.kind==="composite"?ki.number(c/pa,f/pa,s):n},b.ai=function(o,n){var s=n[0],c=n[1],f=n[2],y=n[3],v=n[4],S=n[5],E=n[6],I=n[7],A=n[8],R=n[9],N=n[10],U=n[11],V=n[12],q=n[13],J=n[14],ae=n[15],Ce=s*S-c*v,de=s*E-f*v,j=s*I-y*v,K=c*E-f*S,fe=c*I-y*S,Ne=f*I-y*E,Je=A*q-R*V,Fe=A*J-N*V,Ge=A*ae-U*V,ft=R*J-N*q,at=R*ae-U*q,pt=N*ae-U*J,Qe=Ce*pt-de*at+j*ft+K*Ge-fe*Fe+Ne*Je;return Qe?(o[0]=(S*pt-E*at+I*ft)*(Qe=1/Qe),o[1]=(f*at-c*pt-y*ft)*Qe,o[2]=(q*Ne-J*fe+ae*K)*Qe,o[3]=(N*fe-R*Ne-U*K)*Qe,o[4]=(E*Ge-v*pt-I*Fe)*Qe,o[5]=(s*pt-f*Ge+y*Fe)*Qe,o[6]=(J*j-V*Ne-ae*de)*Qe,o[7]=(A*Ne-N*j+U*de)*Qe,o[8]=(v*at-S*Ge+I*Je)*Qe,o[9]=(c*Ge-s*at-y*Je)*Qe,o[10]=(V*fe-q*j+ae*Ce)*Qe,o[11]=(R*j-A*fe-U*Ce)*Qe,o[12]=(S*Fe-v*ft-E*Je)*Qe,o[13]=(s*ft-c*Fe+f*Je)*Qe,o[14]=(q*de-V*K-J*Ce)*Qe,o[15]=(A*K-R*de+N*Ce)*Qe,o):null},b.aj=tn,b.ak=function(o){return Math.hypot(o[0],o[1])},b.al=function(o){return o[0]=0,o[1]=0,o},b.am=function(o,n,s){return o[0]=n[0]*s,o[1]=n[1]*s,o},b.an=mm,b.ao=lt,b.ap=function(o,n,s,c){const f=n.y-o.y,y=n.x-o.x,v=c.y-s.y,S=c.x-s.x,E=v*y-S*f;if(E===0)return null;const I=(S*(o.y-s.y)-v*(o.x-s.x))/E;return new Te(o.x+I*y,o.y+I*f)},b.aq=pn,b.ar=Ua,b.as=ye,b.at=function(o){let n=1/0,s=1/0,c=-1/0,f=-1/0;for(const y of o)n=Math.min(n,y.x),s=Math.min(s,y.y),c=Math.max(c,y.x),f=Math.max(f,y.y);return[n,s,c,f]},b.au=ii,b.av=Zt,b.aw=function(o,n,s,c,f=!1){if(!s[0]&&!s[1])return[0,0];const y=f?c==="map"?-o.bearingInRadians:0:c==="viewport"?o.bearingInRadians:0;if(y){const v=Math.sin(y),S=Math.cos(y);s=[s[0]*S-s[1]*v,s[0]*v+s[1]*S]}return[f?s[0]:Zt(n,s[0],o.zoom),f?s[1]:Zt(n,s[1],o.zoom)]},b.ay=pm,b.az=Of,b.b=_n,b.b$=o=>o.type==="circle",b.b0=function(){const o=new Float64Array(16);return ye(o),o},b.b1=function(){return new Float64Array(16)},b.b2=function(o,n,s){const c=new Float64Array(4);return function(f,y,v,S){var E=.5*Math.PI/180;y*=E,v*=E,S*=E;var I=Math.sin(y),A=Math.cos(y),R=Math.sin(v),N=Math.cos(v),U=Math.sin(S),V=Math.cos(S);f[0]=I*N*V-A*R*U,f[1]=A*R*V+I*N*U,f[2]=A*N*U-I*R*V,f[3]=A*N*V+I*R*U}(c,o,n-90,s),c},b.b3=function(o,n,s,c){var f,y,v,S,E,I=n[0],A=n[1],R=n[2],N=n[3],U=s[0],V=s[1],q=s[2],J=s[3];return(y=I*U+A*V+R*q+N*J)<0&&(y=-y,U=-U,V=-V,q=-q,J=-J),1-y>qe?(f=Math.acos(y),v=Math.sin(f),S=Math.sin((1-c)*f)/v,E=Math.sin(c*f)/v):(S=1-c,E=c),o[0]=S*I+E*U,o[1]=S*A+E*V,o[2]=S*R+E*q,o[3]=S*N+E*J,o},b.b4=function(o){const n=new Float64Array(9);var s,c,f,y,v,S,E,I,A,R,N,U,V,q,J,ae,Ce,de;R=(f=(c=o)[0])*(E=f+f),N=(y=c[1])*E,V=(v=c[2])*E,q=v*(I=y+y),ae=(S=c[3])*E,Ce=S*I,de=S*(A=v+v),(s=n)[0]=1-(U=y*I)-(J=v*A),s[3]=N-de,s[6]=V+Ce,s[1]=N+de,s[4]=1-R-J,s[7]=q-ae,s[2]=V-Ce,s[5]=q+ae,s[8]=1-R-U;const j=nr(-Math.asin(Tt(n[2],-1,1)));let K,fe;return Math.hypot(n[5],n[8])<.001?(K=0,fe=-nr(Math.atan2(n[3],n[4]))):(K=nr(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),fe=nr(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:K,pitch:j+90,bearing:fe}},b.b5=function(o,n){return o.roll==n.roll&&o.pitch==n.pitch&&o.bearing==n.bearing},b.b6=An,b.b7=ca,b.b8=ju,b.b9=ud,b.bA=function(o){const n=[],s=o.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},b.bB=function o(n,s){if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(let c=0;c<n.length;c++)if(!o(n[c],s[c]))return!1;return!0}if(typeof n=="object"&&n!==null&&s!==null){if(typeof s!="object"||Object.keys(n).length!==Object.keys(s).length)return!1;for(const c in n)if(!o(n[c],s[c]))return!1;return!0}return n===s},b.bC=mr,b.bD=rn,b.bE=class extends Xi{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},b.bF=Is,b.bG=class extends Xi{constructor(o,n){super(o,n),this.current=ti}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},b.bH=Na,b.bI=class extends Xi{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},b.bJ=class extends Xi{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},b.bK=ne,b.bL=function(o,n){var s=Math.sin(n),c=Math.cos(n);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},b.bM=function(o,n,s){var c=n[0],f=n[1],y=n[2];return o[0]=c*s[0]+f*s[3]+y*s[6],o[1]=c*s[1]+f*s[4]+y*s[7],o[2]=c*s[2]+f*s[5]+y*s[8],o},b.bN=function(o,n,s,c,f,y,v){var S=1/(n-s),E=1/(c-f),I=1/(y-v);return o[0]=-2*S,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(n+s)*S,o[13]=(f+c)*E,o[14]=(v+y)*I,o[15]=1,o},b.bO=class extends zu{},b.bP=hv,b.bQ=class extends Tl{},b.bR=$p,b.bS=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},b.bT=Vp,b.bU=function(o,n,s){var c=n[0],f=n[1],y=n[2],v=s[3]*c+s[7]*f+s[11]*y+s[15];return o[0]=(s[0]*c+s[4]*f+s[8]*y+s[12])/(v=v||1),o[1]=(s[1]*c+s[5]*f+s[9]*y+s[13])/v,o[2]=(s[2]*c+s[6]*f+s[10]*y+s[14])/v,o},b.bV=class extends Cc{},b.bW=class extends u{},b.bX=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]&&o[4]===n[4]&&o[5]===n[5]&&o[6]===n[6]&&o[7]===n[7]&&o[8]===n[8]&&o[9]===n[9]&&o[10]===n[10]&&o[11]===n[11]&&o[12]===n[12]&&o[13]===n[13]&&o[14]===n[14]&&o[15]===n[15]},b.bY=function(o,n){var s=o[0],c=o[1],f=o[2],y=o[3],v=o[4],S=o[5],E=o[6],I=o[7],A=o[8],R=o[9],N=o[10],U=o[11],V=o[12],q=o[13],J=o[14],ae=o[15],Ce=n[0],de=n[1],j=n[2],K=n[3],fe=n[4],Ne=n[5],Je=n[6],Fe=n[7],Ge=n[8],ft=n[9],at=n[10],pt=n[11],Qe=n[12],Ct=n[13],$t=n[14],Nt=n[15];return Math.abs(s-Ce)<=qe*Math.max(1,Math.abs(s),Math.abs(Ce))&&Math.abs(c-de)<=qe*Math.max(1,Math.abs(c),Math.abs(de))&&Math.abs(f-j)<=qe*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(y-K)<=qe*Math.max(1,Math.abs(y),Math.abs(K))&&Math.abs(v-fe)<=qe*Math.max(1,Math.abs(v),Math.abs(fe))&&Math.abs(S-Ne)<=qe*Math.max(1,Math.abs(S),Math.abs(Ne))&&Math.abs(E-Je)<=qe*Math.max(1,Math.abs(E),Math.abs(Je))&&Math.abs(I-Fe)<=qe*Math.max(1,Math.abs(I),Math.abs(Fe))&&Math.abs(A-Ge)<=qe*Math.max(1,Math.abs(A),Math.abs(Ge))&&Math.abs(R-ft)<=qe*Math.max(1,Math.abs(R),Math.abs(ft))&&Math.abs(N-at)<=qe*Math.max(1,Math.abs(N),Math.abs(at))&&Math.abs(U-pt)<=qe*Math.max(1,Math.abs(U),Math.abs(pt))&&Math.abs(V-Qe)<=qe*Math.max(1,Math.abs(V),Math.abs(Qe))&&Math.abs(q-Ct)<=qe*Math.max(1,Math.abs(q),Math.abs(Ct))&&Math.abs(J-$t)<=qe*Math.max(1,Math.abs(J),Math.abs($t))&&Math.abs(ae-Nt)<=qe*Math.max(1,Math.abs(ae),Math.abs(Nt))},b.bZ=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},b.b_=o=>o.type==="symbol",b.ba=Nu,b.bb=_t,b.bc=Rt,b.bd=Ii,b.be=function(o,n,s,c,f){return _t(c,f,Tt((o-n)/(s-n),0,1))},b.bf=dt,b.bg=function(){return new Float64Array(4)},b.bh=function(){return new Float64Array(3)},b.bi=function(o,n,s,c){var f=[],y=[];return f[0]=n[0]-s[0],f[1]=n[1]-s[1],f[2]=n[2]-s[2],y[0]=f[0]*Math.cos(c)-f[1]*Math.sin(c),y[1]=f[0]*Math.sin(c)+f[1]*Math.cos(c),y[2]=f[2],o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bj=function(o,n,s,c){var f=[],y=[];return f[0]=n[0]-s[0],f[1]=n[1]-s[1],f[2]=n[2]-s[2],y[0]=f[0],y[1]=f[1]*Math.cos(c)-f[2]*Math.sin(c),y[2]=f[1]*Math.sin(c)+f[2]*Math.cos(c),o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bk=function(o,n,s,c){var f=[],y=[];return f[0]=n[0]-s[0],f[1]=n[1]-s[1],f[2]=n[2]-s[2],y[0]=f[2]*Math.sin(c)+f[0]*Math.cos(c),y[1]=f[1],y[2]=f[2]*Math.cos(c)-f[0]*Math.sin(c),o[0]=y[0]+s[0],o[1]=y[1]+s[1],o[2]=y[2]+s[2],o},b.bl=function(o,n,s){var c=Math.sin(s),f=Math.cos(s),y=n[0],v=n[1],S=n[2],E=n[3],I=n[8],A=n[9],R=n[10],N=n[11];return n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=y*f-I*c,o[1]=v*f-A*c,o[2]=S*f-R*c,o[3]=E*f-N*c,o[8]=y*c+I*f,o[9]=v*c+A*f,o[10]=S*c+R*f,o[11]=E*c+N*f,o},b.bm=function(o,n){const s=dt(o,360),c=dt(n,360),f=c-s,y=c>s?f-360:f+360;return Math.abs(f)<Math.abs(y)?f:y},b.bn=function(o){return o[0]=0,o[1]=0,o[2]=0,o},b.bo=function(o,n,s,c){const f=Math.sqrt(o*o+n*n),y=Math.sqrt(s*s+c*c);o/=f,n/=f,s/=y,c/=y;const v=Math.acos(o*s+n*c);return-n*s+o*c>0?v:-v},b.bp=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+o[3]},b.bq=qu,b.br=function(o,n){const s=dt(o,2*Math.PI),c=dt(n,2*Math.PI);return Math.min(Math.abs(s-c),Math.abs(s-c+2*Math.PI),Math.abs(s-c-2*Math.PI))},b.bs=function(o){return Math.hypot(o[0],o[1],o[2])},b.bt=function(){const o={},n=F.$version;for(const s in F.$root){const c=F.$root[s];if(c.required){let f=null;f=s==="version"?n:c.type==="array"?[]:{},f!=null&&(o[s]=f)}}return o},b.bu=Pu,b.bv=xr,b.bw=function(o){o=o.slice();const n=Object.create(null);for(let s=0;s<o.length;s++)n[o[s].id]=o[s];for(let s=0;s<o.length;s++)"ref"in o[s]&&(o[s]=ee(o[s],n[o[s].ref]));return o},b.bx=function(o){if(o.type==="custom")return new Ev(o);switch(o.type){case"background":return new x_(o);case"circle":return new Dg(o);case"fill":return new Ug(o);case"fill-extrusion":return new tv(o);case"heatmap":return new q0(o);case"hillshade":return new Gp(o);case"line":return new av(o);case"raster":return new w_(o);case"symbol":return new _d(o)}},b.by=Qt,b.bz=function(o,n){if(!o)return[{command:"setStyle",args:[n]}];let s=[];try{if(!le(o.version,n.version))return[{command:"setStyle",args:[n]}];le(o.center,n.center)||s.push({command:"setCenter",args:[n.center]}),le(o.centerAltitude,n.centerAltitude)||s.push({command:"setCenterAltitude",args:[n.centerAltitude]}),le(o.zoom,n.zoom)||s.push({command:"setZoom",args:[n.zoom]}),le(o.bearing,n.bearing)||s.push({command:"setBearing",args:[n.bearing]}),le(o.pitch,n.pitch)||s.push({command:"setPitch",args:[n.pitch]}),le(o.roll,n.roll)||s.push({command:"setRoll",args:[n.roll]}),le(o.sprite,n.sprite)||s.push({command:"setSprite",args:[n.sprite]}),le(o.glyphs,n.glyphs)||s.push({command:"setGlyphs",args:[n.glyphs]}),le(o.transition,n.transition)||s.push({command:"setTransition",args:[n.transition]}),le(o.light,n.light)||s.push({command:"setLight",args:[n.light]}),le(o.terrain,n.terrain)||s.push({command:"setTerrain",args:[n.terrain]}),le(o.sky,n.sky)||s.push({command:"setSky",args:[n.sky]}),le(o.projection,n.projection)||s.push({command:"setProjection",args:[n.projection]});const c={},f=[];(function(v,S,E,I){let A;for(A in S=S||{},v=v||{})Object.prototype.hasOwnProperty.call(v,A)&&(Object.prototype.hasOwnProperty.call(S,A)||Ue(A,E,I));for(A in S)Object.prototype.hasOwnProperty.call(S,A)&&(Object.prototype.hasOwnProperty.call(v,A)?le(v[A],S[A])||(v[A].type==="geojson"&&S[A].type==="geojson"&&Xe(v,S,A)?xe(E,{command:"setGeoJSONSourceData",args:[A,S[A].data]}):Me(A,S,E,I)):Ie(A,S,E))})(o.sources,n.sources,f,c);const y=[];o.layers&&o.layers.forEach(v=>{"source"in v&&c[v.source]?s.push({command:"removeLayer",args:[v.id]}):y.push(v)}),s=s.concat(f),function(v,S,E){S=S||[];const I=(v=v||[]).map(Re),A=S.map(Re),R=v.reduce(rt,{}),N=S.reduce(rt,{}),U=I.slice(),V=Object.create(null);let q,J,ae,Ce,de;for(let j=0,K=0;j<I.length;j++)q=I[j],Object.prototype.hasOwnProperty.call(N,q)?K++:(xe(E,{command:"removeLayer",args:[q]}),U.splice(U.indexOf(q,K),1));for(let j=0,K=0;j<A.length;j++)q=A[A.length-1-j],U[U.length-1-j]!==q&&(Object.prototype.hasOwnProperty.call(R,q)?(xe(E,{command:"removeLayer",args:[q]}),U.splice(U.lastIndexOf(q,U.length-K),1)):K++,Ce=U[U.length-j],xe(E,{command:"addLayer",args:[N[q],Ce]}),U.splice(U.length-j,0,q),V[q]=!0);for(let j=0;j<A.length;j++)if(q=A[j],J=R[q],ae=N[q],!V[q]&&!le(J,ae))if(le(J.source,ae.source)&&le(J["source-layer"],ae["source-layer"])&&le(J.type,ae.type)){for(de in $e(J.layout,ae.layout,E,q,null,"setLayoutProperty"),$e(J.paint,ae.paint,E,q,null,"setPaintProperty"),le(J.filter,ae.filter)||xe(E,{command:"setFilter",args:[q,ae.filter]}),le(J.minzoom,ae.minzoom)&&le(J.maxzoom,ae.maxzoom)||xe(E,{command:"setLayerZoomRange",args:[q,ae.minzoom,ae.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?$e(J[de],ae[de],E,q,de.slice(6),"setPaintProperty"):le(J[de],ae[de])||xe(E,{command:"setLayerProperty",args:[q,de,ae[de]]}));for(de in ae)Object.prototype.hasOwnProperty.call(ae,de)&&!Object.prototype.hasOwnProperty.call(J,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?$e(J[de],ae[de],E,q,de.slice(6),"setPaintProperty"):le(J[de],ae[de])||xe(E,{command:"setLayerProperty",args:[q,de,ae[de]]}))}else xe(E,{command:"removeLayer",args:[q]}),Ce=U[U.lastIndexOf(q)+1],xe(E,{command:"addLayer",args:[ae,Ce]})}(y,n.layers,s)}catch(c){console.warn("Unable to compute style diff:",c),s=[{command:"setStyle",args:[n]}]}return s},b.c=Si,b.c0=o=>o.type==="heatmap",b.c1=o=>o.type==="line",b.c2=o=>o.type==="fill",b.c3=o=>o.type==="fill-extrusion",b.c4=o=>o.type==="hillshade",b.c5=o=>o.type==="raster",b.c6=o=>o.type==="background",b.c7=o=>o.type==="custom",b.c8=wt,b.c9=function(o,n,s){const c=lr(n.x-s.x,n.y-s.y),f=lr(o.x-s.x,o.y-s.y);var y,v;return nr(Math.atan2(c[0]*f[1]-c[1]*f[0],(y=c)[0]*(v=f)[0]+y[1]*v[1]))},b.cA=ce,b.cB=Hg,b.cC=s_,b.cD=ss,b.cE=Cs,b.ca=Dt,b.cb=function(o,n,s){var c=n[0],f=n[1];return o[0]=s[0]*c+s[4]*f+s[12],o[1]=s[1]*c+s[5]*f+s[13],o},b.cc=function(o,n){const{x:s,y:c}=yd.fromLngLat(n);return!(o<0||o>25||c<0||c>=1||s<0||s>=1)},b.cd=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},b.ce=class extends Vr{},b.cf=G_,b.ch=function(o){return o.message===zr},b.ci=rr,b.cj=function(o,n){vr.REGISTERED_PROTOCOLS[o]=n},b.ck=function(o){delete vr.REGISTERED_PROTOCOLS[o]},b.cl=function(o,n){const s={};for(let f=0;f<o.length;f++){const y=n&&n[o[f].id]||jh(o[f]);n&&(n[o[f].id]=y);let v=s[y];v||(v=s[y]=[]),v.push(o[f])}const c=[];for(const f in s)c.push(s[f]);return c},b.cm=St,b.cn=k_,b.co=hs,b.cp=c_,b.cq=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=Kt/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const n=o.bucket.layers[0],s=n.layout,c=n._unevaluatedLayout._values,f={layoutIconSize:c["icon-size"].possiblyEvaluate(new hr(o.bucket.zoom+1),o.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new hr(o.bucket.zoom+1),o.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new hr(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=o.bucket.textSizeData;f.compositeTextSizes=[c["text-size"].possiblyEvaluate(new hr(I),o.canonical),c["text-size"].possiblyEvaluate(new hr(A),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=o.bucket.iconSizeData;f.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new hr(I),o.canonical),c["icon-size"].possiblyEvaluate(new hr(A),o.canonical)]}const y=s.get("text-line-height")*ii,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",S=s.get("text-keep-upright"),E=s.get("text-size");for(const I of o.bucket.features){const A=s.get("text-font").evaluate(I,{},o.canonical).join(","),R=E.evaluate(I,{},o.canonical),N=f.layoutTextSize.evaluate(I,{},o.canonical),U=f.layoutIconSize.evaluate(I,{},o.canonical),V={horizontal:{},vertical:void 0},q=I.text;let J,ae=[0,0];if(q){const j=q.toString(),K=s.get("text-letter-spacing").evaluate(I,{},o.canonical)*ii,fe=df(j)?K:0,Ne=s.get("text-anchor").evaluate(I,{},o.canonical),Je=j_(n,I,o.canonical);if(!Je){const at=s.get("text-radial-offset").evaluate(I,{},o.canonical);ae=at?N_(Ne,[at*ii,Tm]):s.get("text-offset").evaluate(I,{},o.canonical).map(pt=>pt*ii)}let Fe=v?"center":s.get("text-justify").evaluate(I,{},o.canonical);const Ge=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(I,{},o.canonical)*ii:1/0,ft=()=>{o.bucket.allowVerticalPlacement&&Eu(j)&&(V.vertical=zc(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Ge,y,Ne,"left",fe,ae,b.ag.vertical,!0,N,R))};if(!v&&Je){const at=new Set;if(Fe==="auto")for(let Qe=0;Qe<Je.values.length;Qe+=2)at.add(Of(Je.values[Qe]));else at.add(Fe);let pt=!1;for(const Qe of at)if(!V.horizontal[Qe])if(pt)V.horizontal[Qe]=V.horizontal[0];else{const Ct=zc(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Ge,y,"center",Qe,fe,ae,b.ag.horizontal,!1,N,R);Ct&&(V.horizontal[Qe]=Ct,pt=Ct.positionedLines.length===1)}ft()}else{Fe==="auto"&&(Fe=Of(Ne));const at=zc(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Ge,y,Ne,Fe,fe,ae,b.ag.horizontal,!1,N,R);at&&(V.horizontal[Fe]=at),ft(),Eu(j)&&v&&S&&(V.vertical=zc(q,o.glyphMap,o.glyphPositions,o.imagePositions,A,Ge,y,Ne,Fe,fe,ae,b.ag.vertical,!1,N,R))}}let Ce=!1;if(I.icon&&I.icon.name){const j=o.imageMap[I.icon.name];j&&(J=m_(o.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},o.canonical),s.get("icon-anchor").evaluate(I,{},o.canonical)),Ce=!!j.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=Ce:o.bucket.sdfIcons!==Ce&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==o.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const de=U_(V.horizontal)||V.vertical;o.bucket.iconsInText=!!de&&de.iconsInText,(de||J)&&bd(o.bucket,I,V,J,o.imageMap,f,N,U,ae,Ce,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},b.cr=im,b.cs=hd,b.ct=nm,b.cu=dd,b.cv=am,b.cw=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},b.cx=function(o,n,s,c,f){return l(this,void 0,void 0,function*(){if(Oe())try{return yield En(o,n,s,c,f)}catch{}return function(y,v,S,E,I){const A=y.width,R=y.height;yn&&Bn||(yn=new OffscreenCanvas(A,R),Bn=yn.getContext("2d",{willReadFrequently:!0})),yn.width=A,yn.height=R,Bn.drawImage(y,0,0,A,R);const N=Bn.getImageData(v,S,E,I);return Bn.clearRect(0,0,A,R),N.data}(o,n,s,c,f)})},b.cy=I_,b.cz=L,b.d=to,b.e=nn,b.f=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(n)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.g=Rr,b.h=o=>new Promise((n,s)=>{const c=new Image;c.onload=()=>{n(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=ln})},c.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(o)],{type:"image/png"});c.src=o.byteLength?URL.createObjectURL(f):ln}),b.i=Kn,b.j=(o,n)=>Bi(nn(o,{type:"json"}),n),b.k=ji,b.l=no,b.m=Bi,b.n=(o,n)=>Bi(nn(o,{type:"arrayBuffer"}),n),b.o=function(o){return new am(o).readFields(cm,[])},b.p=l_,b.q=Lu,b.r=Di,b.s=Rn,b.t=No,b.u=fn,b.v=F,b.w=Gt,b.x=Cu,b.y=wl,b.z=function([o,n,s]){return n+=90,n*=Math.PI/180,s*=Math.PI/180,{x:o*Math.cos(n)*Math.sin(s),y:o*Math.sin(n)*Math.sin(s),z:o*Math.cos(s)}}}),x("worker",["./shared"],function(b){class l{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,H){for(const le of F){this._layerConfigs[le.id]=le;const xe=this._layers[le.id]=b.bx(le);xe._featureFilter=b.a6(xe.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of H)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ee=b.cl(Object.values(this._layerConfigs),this.keyCache);for(const le of ee){const xe=le.map(Re=>this._layers[Re.id]),Ie=xe[0];if(Ie.visibility==="none")continue;const Ue=Ie.source||"";let Me=this.familiesBySource[Ue];Me||(Me=this.familiesBySource[Ue]={});const Xe=Ie.sourceLayer||"_geojsonTileLayer";let $e=Me[Xe];$e||($e=Me[Xe]=[]),$e.push(xe)}}}class L{constructor(F){const H={},ee=[];for(const Ue in F){const Me=F[Ue],Xe=H[Ue]={};for(const $e in Me){const Re=Me[+$e];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const rt={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};ee.push(rt),Xe[$e]={rect:rt,metrics:Re.metrics}}}const{w:le,h:xe}=b.p(ee),Ie=new b.q({width:le||1,height:xe||1});for(const Ue in F){const Me=F[Ue];for(const Xe in Me){const $e=Me[+Xe];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Re=H[Ue][Xe].rect;b.q.copy($e.bitmap,Ie,{x:0,y:0},{x:Re.x+1,y:Re.y+1},$e.bitmap)}}this.image=Ie,this.positions=H}}b.cm("GlyphAtlas",L);class ${constructor(F){this.tileID=new b.Y(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,H,ee,le,xe){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new b.a4;const Ie=new b.cn(Object.keys(F.layers).sort()),Ue=new b.co(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Me={},Xe={featureIndex:Ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee,subdivisionGranularity:xe},$e=H.familiesBySource[this.source];for(const Xt in $e){const dn=F.layers[Xt];if(!dn)continue;dn.version===1&&b.w(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ut=Ie.encode(Xt),Sa=[];for(let Nr=0;Nr<dn.length;Nr++){const jr=dn.feature(Nr),ur=Ue.getId(jr,Xt);Sa.push({feature:jr,id:ur,index:Nr,sourceLayerIndex:Ut})}for(const Nr of $e[Xt]){const jr=Nr[0];jr.source!==this.source&&b.w(`layer.source = ${jr.source} does not equal this.source = ${this.source}`),jr.minzoom&&this.zoom<Math.floor(jr.minzoom)||jr.maxzoom&&this.zoom>=jr.maxzoom||jr.visibility!=="none"&&(Q(Nr,this.zoom,ee),(Me[jr.id]=jr.createBucket({index:Ue.bucketLayerIDs.length,layers:Nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ut,sourceID:this.source})).populate(Sa,Xe,this.tileID.canonical),Ue.bucketLayerIDs.push(Nr.map(ur=>ur.id)))}}const Re=b.bC(Xe.glyphDependencies,Xt=>Object.keys(Xt).map(Number));this.inFlightDependencies.forEach(Xt=>Xt==null?void 0:Xt.abort()),this.inFlightDependencies=[];let rt=Promise.resolve({});if(Object.keys(Re).length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),rt=le.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},Xt)}const De=Object.keys(Xe.iconDependencies);let yt=Promise.resolve({});if(De.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),yt=le.sendAsync({type:"GI",data:{icons:De,source:this.source,tileID:this.tileID,type:"icons"}},Xt)}const Ft=Object.keys(Xe.patternDependencies);let Jt=Promise.resolve({});if(Ft.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),Jt=le.sendAsync({type:"GI",data:{icons:Ft,source:this.source,tileID:this.tileID,type:"patterns"}},Xt)}const[Ht,Ke,It]=yield Promise.all([rt,yt,Jt]),Pt=new L(Ht),hn=new b.cp(Ke,It);for(const Xt in Me){const dn=Me[Xt];dn instanceof b.a5?(Q(dn.layers,this.zoom,ee),b.cq({bucket:dn,glyphMap:Ht,glyphPositions:Pt.positions,imageMap:Ke,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Xe.subdivisionGranularity})):dn.hasPattern&&(dn instanceof b.cr||dn instanceof b.cs||dn instanceof b.ct)&&(Q(dn.layers,this.zoom,ee),dn.addFeatures(Xe,this.tileID.canonical,hn.patternPositions))}return this.status="done",{buckets:Object.values(Me).filter(Xt=>!Xt.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pt.image,imageAtlas:hn,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?Ke:null,glyphPositions:this.returnDependencies?Pt.positions:null}})}}function Q(ze,F,H){const ee=new b.C(F);for(const le of ze)le.recalculate(ee,H)}class ce{constructor(F,H,ee){this.actor=F,this.layerIndex=H,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,H){return b._(this,void 0,void 0,function*(){const ee=yield b.n(F.request,H);try{return{vectorTile:new b.cu.VectorTile(new b.cv(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(le){const xe=new Uint8Array(ee.data);let Ie=`Unable to parse the tile at ${F.request.url}, `;throw Ie+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(Ie)}})}loadTile(F){return b._(this,void 0,void 0,function*(){const H=F.uid,ee=!!(F&&F.request&&F.request.collectResourceTiming)&&new b.cw(F.request),le=new $(F);this.loading[H]=le;const xe=new AbortController;le.abort=xe;try{const Ie=yield this.loadVectorTile(F,xe);if(delete this.loading[H],!Ie)return null;const Ue=Ie.rawData,Me={};Ie.expires&&(Me.expires=Ie.expires),Ie.cacheControl&&(Me.cacheControl=Ie.cacheControl);const Xe={};if(ee){const Re=ee.finish();Re&&(Xe.resourceTiming=JSON.parse(JSON.stringify(Re)))}le.vectorTile=Ie.vectorTile;const $e=le.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);this.loaded[H]=le,this.fetching[H]={rawTileData:Ue,cacheControl:Me,resourceTiming:Xe};try{const Re=yield $e;return b.e({rawTileData:Ue.slice(0)},Re,Me,Xe)}finally{delete this.fetching[H]}}catch(Ie){throw delete this.loading[H],le.status="done",this.loaded[H]=le,Ie}})}reloadTile(F){return b._(this,void 0,void 0,function*(){const H=F.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[H];if(ee.showCollisionBoxes=F.showCollisionBoxes,ee.status==="parsing"){const le=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);let xe;if(this.fetching[H]){const{rawTileData:Ie,cacheControl:Ue,resourceTiming:Me}=this.fetching[H];delete this.fetching[H],xe=b.e({rawTileData:Ie.slice(0)},le,Ue,Me)}else xe=le;return xe}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity)})}abortTile(F){return b._(this,void 0,void 0,function*(){const H=this.loading,ee=F.uid;H&&H[ee]&&H[ee].abort&&(H[ee].abort.abort(),delete H[ee])})}removeTile(F){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class oe{constructor(){this.loaded={}}loadTile(F){return b._(this,void 0,void 0,function*(){const{uid:H,encoding:ee,rawImageData:le,redFactor:xe,greenFactor:Ie,blueFactor:Ue,baseShift:Me}=F,Xe=le.width+2,$e=le.height+2,Re=b.b(le)?new b.R({width:Xe,height:$e},yield b.cx(le,-1,-1,Xe,$e)):le,rt=new b.cy(H,Re,ee,xe,Ie,Ue,Me);return this.loaded=this.loaded||{},this.loaded[H]=rt,rt})}removeTile(F){const H=this.loaded,ee=F.uid;H&&H[ee]&&delete H[ee]}}var Y,Te,et=function(){if(Te)return Y;function ze(H,ee){if(H.length!==0){F(H[0],ee);for(var le=1;le<H.length;le++)F(H[le],!ee)}}function F(H,ee){for(var le=0,xe=0,Ie=0,Ue=H.length,Me=Ue-1;Ie<Ue;Me=Ie++){var Xe=(H[Ie][0]-H[Me][0])*(H[Me][1]+H[Ie][1]),$e=le+Xe;xe+=Math.abs(le)>=Math.abs(Xe)?le-$e+Xe:Xe-$e+le,le=$e}le+xe>=0!=!!ee&&H.reverse()}return Te=1,Y=function H(ee,le){var xe,Ie=ee&&ee.type;if(Ie==="FeatureCollection")for(xe=0;xe<ee.features.length;xe++)H(ee.features[xe],le);else if(Ie==="GeometryCollection")for(xe=0;xe<ee.geometries.length;xe++)H(ee.geometries[xe],le);else if(Ie==="Feature")H(ee.geometry,le);else if(Ie==="Polygon")ze(ee.coordinates,le);else if(Ie==="MultiPolygon")for(xe=0;xe<ee.coordinates.length;xe++)ze(ee.coordinates[xe],le);return ee}}(),We=b.cz(et);const he=b.cu.VectorTileFeature.prototype.toGeoJSON;class pe{constructor(F){this._feature=F,this.extent=b.Z,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const H of this._feature.geometry)F.push([new b.P(H[0],H[1])]);return F}{const F=[];for(const H of this._feature.geometry){const ee=[];for(const le of H)ee.push(new b.P(le[0],le[1]));F.push(ee)}return F}}toGeoJSON(F,H,ee){return he.call(this,F,H,ee)}}class ve{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.Z,this.length=F.length,this._features=F}feature(F){return new pe(this._features[F])}}var Oe,it,qe,we={exports:{}},ne=function(){if(qe)return we.exports;qe=1;var ze=b.cC(),F=function(){if(it)return Oe;it=1;var $e=b.cA(),Re=b.cB().VectorTileFeature;function rt(yt,Ft){this.options=Ft||{},this.features=yt,this.length=yt.length}function De(yt,Ft){this.id=typeof yt.id=="number"?yt.id:void 0,this.type=yt.type,this.rawGeometry=yt.type===1?[yt.geometry]:yt.geometry,this.properties=yt.tags,this.extent=Ft||4096}return Oe=rt,rt.prototype.feature=function(yt){return new De(this.features[yt],this.options.extent)},De.prototype.loadGeometry=function(){var yt=this.rawGeometry;this.geometry=[];for(var Ft=0;Ft<yt.length;Ft++){for(var Jt=yt[Ft],Ht=[],Ke=0;Ke<Jt.length;Ke++)Ht.push(new $e(Jt[Ke][0],Jt[Ke][1]));this.geometry.push(Ht)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yt=this.geometry,Ft=1/0,Jt=-1/0,Ht=1/0,Ke=-1/0,It=0;It<yt.length;It++)for(var Pt=yt[It],hn=0;hn<Pt.length;hn++){var Xt=Pt[hn];Ft=Math.min(Ft,Xt.x),Jt=Math.max(Jt,Xt.x),Ht=Math.min(Ht,Xt.y),Ke=Math.max(Ke,Xt.y)}return[Ft,Ht,Jt,Ke]},De.prototype.toGeoJSON=Re.prototype.toGeoJSON,Oe}();function H($e){var Re=new ze;return function(rt,De){for(var yt in rt.layers)De.writeMessage(3,ee,rt.layers[yt])}($e,Re),Re.finish()}function ee($e,Re){var rt;Re.writeVarintField(15,$e.version||1),Re.writeStringField(1,$e.name||""),Re.writeVarintField(5,$e.extent||4096);var De={keys:[],values:[],keycache:{},valuecache:{}};for(rt=0;rt<$e.length;rt++)De.feature=$e.feature(rt),Re.writeMessage(2,le,De);var yt=De.keys;for(rt=0;rt<yt.length;rt++)Re.writeStringField(3,yt[rt]);var Ft=De.values;for(rt=0;rt<Ft.length;rt++)Re.writeMessage(4,Xe,Ft[rt])}function le($e,Re){var rt=$e.feature;rt.id!==void 0&&Re.writeVarintField(1,rt.id),Re.writeMessage(2,xe,$e),Re.writeVarintField(3,rt.type),Re.writeMessage(4,Me,rt)}function xe($e,Re){var rt=$e.feature,De=$e.keys,yt=$e.values,Ft=$e.keycache,Jt=$e.valuecache;for(var Ht in rt.properties){var Ke=rt.properties[Ht],It=Ft[Ht];if(Ke!==null){It===void 0&&(De.push(Ht),Ft[Ht]=It=De.length-1),Re.writeVarint(It);var Pt=typeof Ke;Pt!=="string"&&Pt!=="boolean"&&Pt!=="number"&&(Ke=JSON.stringify(Ke));var hn=Pt+":"+Ke,Xt=Jt[hn];Xt===void 0&&(yt.push(Ke),Jt[hn]=Xt=yt.length-1),Re.writeVarint(Xt)}}}function Ie($e,Re){return(Re<<3)+(7&$e)}function Ue($e){return $e<<1^$e>>31}function Me($e,Re){for(var rt=$e.loadGeometry(),De=$e.type,yt=0,Ft=0,Jt=rt.length,Ht=0;Ht<Jt;Ht++){var Ke=rt[Ht],It=1;De===1&&(It=Ke.length),Re.writeVarint(Ie(1,It));for(var Pt=De===3?Ke.length-1:Ke.length,hn=0;hn<Pt;hn++){hn===1&&De!==1&&Re.writeVarint(Ie(2,Pt-1));var Xt=Ke[hn].x-yt,dn=Ke[hn].y-Ft;Re.writeVarint(Ue(Xt)),Re.writeVarint(Ue(dn)),yt+=Xt,Ft+=dn}De===3&&Re.writeVarint(Ie(7,1))}}function Xe($e,Re){var rt=typeof $e;rt==="string"?Re.writeStringField(1,$e):rt==="boolean"?Re.writeBooleanField(7,$e):rt==="number"&&($e%1!=0?Re.writeDoubleField(3,$e):$e<0?Re.writeSVarintField(6,$e):Re.writeVarintField(5,$e))}return we.exports=H,we.exports.fromVectorTileJs=H,we.exports.fromGeojsonVt=function($e,Re){Re=Re||{};var rt={};for(var De in $e)rt[De]=new F($e[De].features,Re),rt[De].name=De,rt[De].version=Re.version,rt[De].extent=Re.extent;return H({layers:rt})},we.exports.GeoJSONWrapper=F,we.exports}(),ye=b.cz(ne);const ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},st=Math.fround||(lt=new Float32Array(1),ze=>(lt[0]=+ze,lt[0]));var lt;const bt=3,tn=5,lr=6;class Kt{constructor(F){this.options=Object.assign(Object.create(ke),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:H,minZoom:ee,maxZoom:le}=this.options;H&&console.time("total time");const xe=`prepare ${F.length} points`;H&&console.time(xe),this.points=F;const Ie=[];for(let Me=0;Me<F.length;Me++){const Xe=F[Me];if(!Xe.geometry)continue;const[$e,Re]=Xe.geometry.coordinates,rt=st(_t($e)),De=st(Rt(Re));Ie.push(rt,De,1/0,Me,-1,1),this.options.reduce&&Ie.push(0)}let Ue=this.trees[le+1]=this._createTree(Ie);H&&console.timeEnd(xe);for(let Me=le;Me>=ee;Me--){const Xe=+Date.now();Ue=this.trees[Me]=this._createTree(this._cluster(Ue,Me)),H&&console.log("z%d: %d clusters in %dms",Me,Ue.numItems,+Date.now()-Xe)}return H&&console.timeEnd("total time"),this}getClusters(F,H){let ee=((F[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,F[1]));let xe=F[2]===180?180:((F[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)ee=-180,xe=180;else if(ee>xe){const Re=this.getClusters([ee,le,180,Ie],H),rt=this.getClusters([-180,le,xe,Ie],H);return Re.concat(rt)}const Ue=this.trees[this._limitZoom(H)],Me=Ue.range(_t(ee),Rt(Ie),_t(xe),Rt(le)),Xe=Ue.data,$e=[];for(const Re of Me){const rt=this.stride*Re;$e.push(Xe[rt+tn]>1?Zt(Xe,rt,this.clusterProps):this.points[Xe[rt+bt]])}return $e}getChildren(F){const H=this._getOriginId(F),ee=this._getOriginZoom(F),le="No cluster with the specified id.",xe=this.trees[ee];if(!xe)throw new Error(le);const Ie=xe.data;if(H*this.stride>=Ie.length)throw new Error(le);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Me=xe.within(Ie[H*this.stride],Ie[H*this.stride+1],Ue),Xe=[];for(const $e of Me){const Re=$e*this.stride;Ie[Re+4]===F&&Xe.push(Ie[Re+tn]>1?Zt(Ie,Re,this.clusterProps):this.points[Ie[Re+bt]])}if(Xe.length===0)throw new Error(le);return Xe}getLeaves(F,H,ee){const le=[];return this._appendLeaves(le,F,H=H||10,ee=ee||0,0),le}getTile(F,H,ee){const le=this.trees[this._limitZoom(F)],xe=Math.pow(2,F),{extent:Ie,radius:Ue}=this.options,Me=Ue/Ie,Xe=(ee-Me)/xe,$e=(ee+1+Me)/xe,Re={features:[]};return this._addTileFeatures(le.range((H-Me)/xe,Xe,(H+1+Me)/xe,$e),le.data,H,ee,xe,Re),H===0&&this._addTileFeatures(le.range(1-Me/xe,Xe,1,$e),le.data,xe,ee,xe,Re),H===xe-1&&this._addTileFeatures(le.range(0,Xe,Me/xe,$e),le.data,-1,ee,xe,Re),Re.features.length?Re:null}getClusterExpansionZoom(F){let H=this._getOriginZoom(F)-1;for(;H<=this.options.maxZoom;){const ee=this.getChildren(F);if(H++,ee.length!==1)break;F=ee[0].properties.cluster_id}return H}_appendLeaves(F,H,ee,le,xe){const Ie=this.getChildren(H);for(const Ue of Ie){const Me=Ue.properties;if(Me&&Me.cluster?xe+Me.point_count<=le?xe+=Me.point_count:xe=this._appendLeaves(F,Me.cluster_id,ee,le,xe):xe<le?xe++:F.push(Ue),F.length===ee)break}return xe}_createTree(F){const H=new b.aB(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<F.length;ee+=this.stride)H.add(F[ee],F[ee+1]);return H.finish(),H.data=F,H}_addTileFeatures(F,H,ee,le,xe,Ie){for(const Ue of F){const Me=Ue*this.stride,Xe=H[Me+tn]>1;let $e,Re,rt;if(Xe)$e=dt(H,Me,this.clusterProps),Re=H[Me],rt=H[Me+1];else{const Ft=this.points[H[Me+bt]];$e=Ft.properties;const[Jt,Ht]=Ft.geometry.coordinates;Re=_t(Jt),rt=Rt(Ht)}const De={type:1,geometry:[[Math.round(this.options.extent*(Re*xe-ee)),Math.round(this.options.extent*(rt*xe-le))]],tags:$e};let yt;yt=Xe||this.options.generateId?H[Me+bt]:this.points[H[Me+bt]].id,yt!==void 0&&(De.id=yt),Ie.features.push(De)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,H){const{radius:ee,extent:le,reduce:xe,minPoints:Ie}=this.options,Ue=ee/(le*Math.pow(2,H)),Me=F.data,Xe=[],$e=this.stride;for(let Re=0;Re<Me.length;Re+=$e){if(Me[Re+2]<=H)continue;Me[Re+2]=H;const rt=Me[Re],De=Me[Re+1],yt=F.within(Me[Re],Me[Re+1],Ue),Ft=Me[Re+tn];let Jt=Ft;for(const Ht of yt){const Ke=Ht*$e;Me[Ke+2]>H&&(Jt+=Me[Ke+tn])}if(Jt>Ft&&Jt>=Ie){let Ht,Ke=rt*Ft,It=De*Ft,Pt=-1;const hn=((Re/$e|0)<<5)+(H+1)+this.points.length;for(const Xt of yt){const dn=Xt*$e;if(Me[dn+2]<=H)continue;Me[dn+2]=H;const Ut=Me[dn+tn];Ke+=Me[dn]*Ut,It+=Me[dn+1]*Ut,Me[dn+4]=hn,xe&&(Ht||(Ht=this._map(Me,Re,!0),Pt=this.clusterProps.length,this.clusterProps.push(Ht)),xe(Ht,this._map(Me,dn)))}Me[Re+4]=hn,Xe.push(Ke/Jt,It/Jt,1/0,hn,-1,Jt),xe&&Xe.push(Pt)}else{for(let Ht=0;Ht<$e;Ht++)Xe.push(Me[Re+Ht]);if(Jt>1)for(const Ht of yt){const Ke=Ht*$e;if(!(Me[Ke+2]<=H)){Me[Ke+2]=H;for(let It=0;It<$e;It++)Xe.push(Me[Ke+It])}}}}return Xe}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,H,ee){if(F[H+tn]>1){const Ie=this.clusterProps[F[H+lr]];return ee?Object.assign({},Ie):Ie}const le=this.points[F[H+bt]].properties,xe=this.options.map(le);return ee&&xe===le?Object.assign({},xe):xe}}function Zt(ze,F,H){return{type:"Feature",id:ze[F+bt],properties:dt(ze,F,H),geometry:{type:"Point",coordinates:[(ee=ze[F],360*(ee-.5)),wt(ze[F+1])]}};var ee}function dt(ze,F,H){const ee=ze[F+tn],le=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,xe=ze[F+lr],Ie=xe===-1?{}:Object.assign({},H[xe]);return Object.assign(Ie,{cluster:!0,cluster_id:ze[F+bt],point_count:ee,point_count_abbreviated:le})}function _t(ze){return ze/360+.5}function Rt(ze){const F=Math.sin(ze*Math.PI/180),H=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return H<0?0:H>1?1:H}function wt(ze){const F=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Dt(ze,F,H,ee){let le=ee;const xe=F+(H-F>>1);let Ie,Ue=H-F;const Me=ze[F],Xe=ze[F+1],$e=ze[H],Re=ze[H+1];for(let rt=F+3;rt<H;rt+=3){const De=Tt(ze[rt],ze[rt+1],Me,Xe,$e,Re);if(De>le)Ie=rt,le=De;else if(De===le){const yt=Math.abs(rt-xe);yt<Ue&&(Ie=rt,Ue=yt)}}le>ee&&(Ie-F>3&&Dt(ze,F,Ie,ee),ze[Ie+2]=le,H-Ie>3&&Dt(ze,Ie,H,ee))}function Tt(ze,F,H,ee,le,xe){let Ie=le-H,Ue=xe-ee;if(Ie!==0||Ue!==0){const Me=((ze-H)*Ie+(F-ee)*Ue)/(Ie*Ie+Ue*Ue);Me>1?(H=le,ee=xe):Me>0&&(H+=Ie*Me,ee+=Ue*Me)}return Ie=ze-H,Ue=F-ee,Ie*Ie+Ue*Ue}function gn(ze,F,H,ee){const le={id:ze??null,type:F,geometry:H,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(F==="Point"||F==="MultiPoint"||F==="LineString")nn(le,H);else if(F==="Polygon")nn(le,H[0]);else if(F==="MultiLineString")for(const xe of H)nn(le,xe);else if(F==="MultiPolygon")for(const xe of H)nn(le,xe[0]);return le}function nn(ze,F){for(let H=0;H<F.length;H+=3)ze.minX=Math.min(ze.minX,F[H]),ze.minY=Math.min(ze.minY,F[H+1]),ze.maxX=Math.max(ze.maxX,F[H]),ze.maxY=Math.max(ze.maxY,F[H+1])}function Pn(ze,F,H,ee){if(!F.geometry)return;const le=F.geometry.coordinates;if(le&&le.length===0)return;const xe=F.geometry.type,Ie=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let Ue=[],Me=F.id;if(H.promoteId?Me=F.properties[H.promoteId]:H.generateId&&(Me=ee||0),xe==="Point")mr(le,Ue);else if(xe==="MultiPoint")for(const Xe of le)mr(Xe,Ue);else if(xe==="LineString")rn(le,Ue,Ie,!1);else if(xe==="MultiLineString"){if(H.lineMetrics){for(const Xe of le)Ue=[],rn(Xe,Ue,Ie,!1),ze.push(gn(Me,"LineString",Ue,F.properties));return}Qt(le,Ue,Ie,!1)}else if(xe==="Polygon")Qt(le,Ue,Ie,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Xe of F.geometry.geometries)Pn(ze,{id:Me,geometry:Xe,properties:F.properties},H,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of le){const $e=[];Qt(Xe,$e,Ie,!0),Ue.push($e)}}ze.push(gn(Me,xe,Ue,F.properties))}function mr(ze,F){F.push(tr(ze[0]),Gt(ze[1]),0)}function rn(ze,F,H,ee){let le,xe,Ie=0;for(let Me=0;Me<ze.length;Me++){const Xe=tr(ze[Me][0]),$e=Gt(ze[Me][1]);F.push(Xe,$e,0),Me>0&&(Ie+=ee?(le*$e-Xe*xe)/2:Math.sqrt(Math.pow(Xe-le,2)+Math.pow($e-xe,2))),le=Xe,xe=$e}const Ue=F.length-3;F[2]=1,Dt(F,0,Ue,H),F[Ue+2]=1,F.size=Math.abs(Ie),F.start=0,F.end=F.size}function Qt(ze,F,H,ee){for(let le=0;le<ze.length;le++){const xe=[];rn(ze[le],xe,H,ee),F.push(xe)}}function tr(ze){return ze/360+.5}function Gt(ze){const F=Math.sin(ze*Math.PI/180),H=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return H<0?0:H>1?1:H}function on(ze,F,H,ee,le,xe,Ie,Ue){if(ee/=F,xe>=(H/=F)&&Ie<ee)return ze;if(Ie<H||xe>=ee)return null;const Me=[];for(const Xe of ze){const $e=Xe.geometry;let Re=Xe.type;const rt=le===0?Xe.minX:Xe.minY,De=le===0?Xe.maxX:Xe.maxY;if(rt>=H&&De<ee){Me.push(Xe);continue}if(De<H||rt>=ee)continue;let yt=[];if(Re==="Point"||Re==="MultiPoint")Kn($e,yt,H,ee,le);else if(Re==="LineString")qt($e,yt,H,ee,le,!1,Ue.lineMetrics);else if(Re==="MultiLineString")ln($e,yt,H,ee,le,!1);else if(Re==="Polygon")ln($e,yt,H,ee,le,!0);else if(Re==="MultiPolygon")for(const Ft of $e){const Jt=[];ln(Ft,Jt,H,ee,le,!0),Jt.length&&yt.push(Jt)}if(yt.length){if(Ue.lineMetrics&&Re==="LineString"){for(const Ft of yt)Me.push(gn(Xe.id,Re,Ft,Xe.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(yt.length===1?(Re="LineString",yt=yt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=yt.length===3?"Point":"MultiPoint"),Me.push(gn(Xe.id,Re,yt,Xe.tags))}}return Me.length?Me:null}function Kn(ze,F,H,ee,le){for(let xe=0;xe<ze.length;xe+=3){const Ie=ze[xe+le];Ie>=H&&Ie<=ee&&En(F,ze[xe],ze[xe+1],ze[xe+2])}}function qt(ze,F,H,ee,le,xe,Ie){let Ue=_n(ze);const Me=le===0?yn:Bn;let Xe,$e,Re=ze.start;for(let Jt=0;Jt<ze.length-3;Jt+=3){const Ht=ze[Jt],Ke=ze[Jt+1],It=ze[Jt+2],Pt=ze[Jt+3],hn=ze[Jt+4],Xt=le===0?Ht:Ke,dn=le===0?Pt:hn;let Ut=!1;Ie&&(Xe=Math.sqrt(Math.pow(Ht-Pt,2)+Math.pow(Ke-hn,2))),Xt<H?dn>H&&($e=Me(Ue,Ht,Ke,Pt,hn,H),Ie&&(Ue.start=Re+Xe*$e)):Xt>ee?dn<ee&&($e=Me(Ue,Ht,Ke,Pt,hn,ee),Ie&&(Ue.start=Re+Xe*$e)):En(Ue,Ht,Ke,It),dn<H&&Xt>=H&&($e=Me(Ue,Ht,Ke,Pt,hn,H),Ut=!0),dn>ee&&Xt<=ee&&($e=Me(Ue,Ht,Ke,Pt,hn,ee),Ut=!0),!xe&&Ut&&(Ie&&(Ue.end=Re+Xe*$e),F.push(Ue),Ue=_n(ze)),Ie&&(Re+=Xe)}let rt=ze.length-3;const De=ze[rt],yt=ze[rt+1],Ft=le===0?De:yt;Ft>=H&&Ft<=ee&&En(Ue,De,yt,ze[rt+2]),rt=Ue.length-3,xe&&rt>=3&&(Ue[rt]!==Ue[0]||Ue[rt+1]!==Ue[1])&&En(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&F.push(Ue)}function _n(ze){const F=[];return F.size=ze.size,F.start=ze.start,F.end=ze.end,F}function ln(ze,F,H,ee,le,xe){for(const Ie of ze)qt(Ie,F,H,ee,le,xe,!1)}function En(ze,F,H,ee){ze.push(F,H,ee)}function yn(ze,F,H,ee,le,xe){const Ie=(xe-F)/(ee-F);return En(ze,xe,H+(le-H)*Ie,1),Ie}function Bn(ze,F,H,ee,le,xe){const Ie=(xe-H)/(le-H);return En(ze,F+(ee-F)*Ie,xe,1),Ie}function Rn(ze,F){const H=[];for(let ee=0;ee<ze.length;ee++){const le=ze[ee],xe=le.type;let Ie;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ie=nr(le.geometry,F);else if(xe==="MultiLineString"||xe==="Polygon"){Ie=[];for(const Ue of le.geometry)Ie.push(nr(Ue,F))}else if(xe==="MultiPolygon"){Ie=[];for(const Ue of le.geometry){const Me=[];for(const Xe of Ue)Me.push(nr(Xe,F));Ie.push(Me)}}H.push(gn(le.id,xe,Ie,le.tags))}return H}function nr(ze,F){const H=[];H.size=ze.size,ze.start!==void 0&&(H.start=ze.start,H.end=ze.end);for(let ee=0;ee<ze.length;ee+=3)H.push(ze[ee]+F,ze[ee+1],ze[ee+2]);return H}function zr(ze,F){if(ze.transformed)return ze;const H=1<<ze.z,ee=ze.x,le=ze.y;for(const xe of ze.features){const Ie=xe.geometry,Ue=xe.type;if(xe.geometry=[],Ue===1)for(let Me=0;Me<Ie.length;Me+=2)xe.geometry.push(Si(Ie[Me],Ie[Me+1],F,H,ee,le));else for(let Me=0;Me<Ie.length;Me++){const Xe=[];for(let $e=0;$e<Ie[Me].length;$e+=2)Xe.push(Si(Ie[Me][$e],Ie[Me][$e+1],F,H,ee,le));xe.geometry.push(Xe)}}return ze.transformed=!0,ze}function Si(ze,F,H,ee,le,xe){return[Math.round(H*(ze*ee-le)),Math.round(H*(F*ee-xe))]}function vr(ze,F,H,ee,le){const xe=F===le.maxZoom?0:le.tolerance/((1<<F)*le.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:ze.length,source:null,x:H,y:ee,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of ze)Rr(Ie,Ue,xe,le);return Ie}function Rr(ze,F,H,ee){const le=F.geometry,xe=F.type,Ie=[];if(ze.minX=Math.min(ze.minX,F.minX),ze.minY=Math.min(ze.minY,F.minY),ze.maxX=Math.max(ze.maxX,F.maxX),ze.maxY=Math.max(ze.maxY,F.maxY),xe==="Point"||xe==="MultiPoint")for(let Ue=0;Ue<le.length;Ue+=3)Ie.push(le[Ue],le[Ue+1]),ze.numPoints++,ze.numSimplified++;else if(xe==="LineString")cr(Ie,le,ze,H,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Ue=0;Ue<le.length;Ue++)cr(Ie,le[Ue],ze,H,xe==="Polygon",Ue===0);else if(xe==="MultiPolygon")for(let Ue=0;Ue<le.length;Ue++){const Me=le[Ue];for(let Xe=0;Xe<Me.length;Xe++)cr(Ie,Me[Xe],ze,H,!0,Xe===0)}if(Ie.length){let Ue=F.tags||null;if(xe==="LineString"&&ee.lineMetrics){Ue={};for(const Xe in F.tags)Ue[Xe]=F.tags[Xe];Ue.mapbox_clip_start=le.start/le.size,Ue.mapbox_clip_end=le.end/le.size}const Me={geometry:Ie,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Ue};F.id!==null&&(Me.id=F.id),ze.features.push(Me)}}function cr(ze,F,H,ee,le,xe){const Ie=ee*ee;if(ee>0&&F.size<(le?Ie:ee))return void(H.numPoints+=F.length/3);const Ue=[];for(let Me=0;Me<F.length;Me+=3)(ee===0||F[Me+2]>Ie)&&(H.numSimplified++,Ue.push(F[Me],F[Me+1])),H.numPoints++;le&&function(Me,Xe){let $e=0;for(let Re=0,rt=Me.length,De=rt-2;Re<rt;De=Re,Re+=2)$e+=(Me[Re]-Me[De])*(Me[Re+1]+Me[De+1]);if($e>0===Xe)for(let Re=0,rt=Me.length;Re<rt/2;Re+=2){const De=Me[Re],yt=Me[Re+1];Me[Re]=Me[rt-2-Re],Me[Re+1]=Me[rt-1-Re],Me[rt-2-Re]=De,Me[rt-1-Re]=yt}}(Ue,xe),ze.push(Ue)}const rr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xr{constructor(F,H){const ee=(H=this.options=function(xe,Ie){for(const Ue in Ie)xe[Ue]=Ie[Ue];return xe}(Object.create(rr),H)).debug;if(ee&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(xe,Ie){const Ue=[];if(xe.type==="FeatureCollection")for(let Me=0;Me<xe.features.length;Me++)Pn(Ue,xe.features[Me],Ie,Me);else Pn(Ue,xe.type==="Feature"?xe:{geometry:xe},Ie);return Ue}(F,H);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(xe,Ie){const Ue=Ie.buffer/Ie.extent;let Me=xe;const Xe=on(xe,1,-1-Ue,Ue,0,-1,2,Ie),$e=on(xe,1,1-Ue,2+Ue,0,-1,2,Ie);return(Xe||$e)&&(Me=on(xe,1,-Ue,1+Ue,0,-1,2,Ie)||[],Xe&&(Me=Rn(Xe,1).concat(Me)),$e&&(Me=Me.concat(Rn($e,-1)))),Me}(le,H),le.length&&this.splitTile(le,0,0,0),ee&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(F,H,ee,le,xe,Ie,Ue){const Me=[F,H,ee,le],Xe=this.options,$e=Xe.debug;for(;Me.length;){le=Me.pop(),ee=Me.pop(),H=Me.pop(),F=Me.pop();const Re=1<<H,rt=Bi(H,ee,le);let De=this.tiles[rt];if(!De&&($e>1&&console.time("creation"),De=this.tiles[rt]=vr(F,H,ee,le,Xe),this.tileCoords.push({z:H,x:ee,y:le}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,ee,le,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));const Ut=`z${H}`;this.stats[Ut]=(this.stats[Ut]||0)+1,this.total++}if(De.source=F,xe==null){if(H===Xe.indexMaxZoom||De.numPoints<=Xe.indexMaxPoints)continue}else{if(H===Xe.maxZoom||H===xe)continue;if(xe!=null){const Ut=xe-H;if(ee!==Ie>>Ut||le!==Ue>>Ut)continue}}if(De.source=null,F.length===0)continue;$e>1&&console.time("clipping");const yt=.5*Xe.buffer/Xe.extent,Ft=.5-yt,Jt=.5+yt,Ht=1+yt;let Ke=null,It=null,Pt=null,hn=null,Xt=on(F,Re,ee-yt,ee+Jt,0,De.minX,De.maxX,Xe),dn=on(F,Re,ee+Ft,ee+Ht,0,De.minX,De.maxX,Xe);F=null,Xt&&(Ke=on(Xt,Re,le-yt,le+Jt,1,De.minY,De.maxY,Xe),It=on(Xt,Re,le+Ft,le+Ht,1,De.minY,De.maxY,Xe),Xt=null),dn&&(Pt=on(dn,Re,le-yt,le+Jt,1,De.minY,De.maxY,Xe),hn=on(dn,Re,le+Ft,le+Ht,1,De.minY,De.maxY,Xe),dn=null),$e>1&&console.timeEnd("clipping"),Me.push(Ke||[],H+1,2*ee,2*le),Me.push(It||[],H+1,2*ee,2*le+1),Me.push(Pt||[],H+1,2*ee+1,2*le),Me.push(hn||[],H+1,2*ee+1,2*le+1)}}getTile(F,H,ee){F=+F,H=+H,ee=+ee;const le=this.options,{extent:xe,debug:Ie}=le;if(F<0||F>24)return null;const Ue=1<<F,Me=Bi(F,H=H+Ue&Ue-1,ee);if(this.tiles[Me])return zr(this.tiles[Me],xe);Ie>1&&console.log("drilling down to z%d-%d-%d",F,H,ee);let Xe,$e=F,Re=H,rt=ee;for(;!Xe&&$e>0;)$e--,Re>>=1,rt>>=1,Xe=this.tiles[Bi($e,Re,rt)];return Xe&&Xe.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",$e,Re,rt),console.time("drilling down")),this.splitTile(Xe.source,$e,Re,rt,F,H,ee),Ie>1&&console.timeEnd("drilling down"),this.tiles[Me]?zr(this.tiles[Me],xe):null):null}}function Bi(ze,F,H){return 32*((1<<ze)*H+F)+ze}function to(ze,F){return F?ze.properties[F]:ze.id}function Ni(ze,F){if(ze==null)return!0;if(ze.type==="Feature")return to(ze,F)!=null;if(ze.type==="FeatureCollection"){const H=new Set;for(const ee of ze.features){const le=to(ee,F);if(le==null||H.has(le))return!1;H.add(le)}return!0}return!1}function Kr(ze,F){const H=new Map;if(ze!=null)if(ze.type==="Feature")H.set(to(ze,F),ze);else for(const ee of ze.features)H.set(to(ee,F),ee);return H}class no extends ce{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,H){return b._(this,void 0,void 0,function*(){const ee=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!le)return null;const xe=new ve(le.features);let Ie=ye(xe);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:xe,rawData:Ie.buffer}})}loadData(F){return b._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const ee=!!(F&&F.request&&F.request.collectResourceTiming)&&new b.cw(F.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest),this._geoJSONIndex=F.cluster?new Kt(function({superclusterOptions:Ie,clusterProperties:Ue}){if(!Ue||!Ie)return Ie;const Me={},Xe={},$e={accumulated:null,zoom:0},Re={properties:null},rt=Object.keys(Ue);for(const De of rt){const[yt,Ft]=Ue[De],Jt=b.cD(Ft),Ht=b.cD(typeof yt=="string"?[yt,["accumulated"],["get",De]]:yt);Me[De]=Jt.value,Xe[De]=Ht.value}return Ie.map=De=>{Re.properties=De;const yt={};for(const Ft of rt)yt[Ft]=Me[Ft].evaluate($e,Re);return yt},Ie.reduce=(De,yt)=>{Re.properties=yt;for(const Ft of rt)$e.accumulated=De[Ft],De[Ft]=Xe[Ft].evaluate($e,Re)},Ie}(F)).load((yield this._pendingData).features):(le=yield this._pendingData,new xr(le,F.geojsonVtOptions)),this.loaded={};const xe={};if(ee){const Ie=ee.finish();Ie&&(xe.resourceTiming={},xe.resourceTiming[F.source]=JSON.parse(JSON.stringify(Ie)))}return xe}catch(xe){if(delete this._pendingRequest,b.ch(xe))return{abandoned:!0};throw xe}var le})}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(F){const H=this.loaded;return H&&H[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,H){return b._(this,void 0,void 0,function*(){let ee=yield this.loadGeoJSON(F,H);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(We(ee,!0),F.filter){const le=b.cD(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(Ie=>le.value.evaluate({zoom:0},Ie))}}return ee})}loadGeoJSON(F,H){return b._(this,void 0,void 0,function*(){const{promoteId:ee}=F;if(F.request){const le=yield b.j(F.request,H);return this._dataUpdateable=Ni(le.data,ee)?Kr(le.data,ee):void 0,le.data}if(typeof F.data=="string")try{const le=JSON.parse(F.data);return this._dataUpdateable=Ni(le,ee)?Kr(le,ee):void 0,le}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(le,xe,Ie){var Ue,Me,Xe,$e;if(xe.removeAll&&le.clear(),xe.remove)for(const Re of xe.remove)le.delete(Re);if(xe.add)for(const Re of xe.add){const rt=to(Re,Ie);rt!=null&&le.set(rt,Re)}if(xe.update)for(const Re of xe.update){let rt=le.get(Re.id);if(rt==null)continue;const De=!Re.removeAllProperties&&(((Ue=Re.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((Me=Re.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0);if((Re.newGeometry||Re.removeAllProperties||De)&&(rt=Object.assign({},rt),le.set(Re.id,rt),De&&(rt.properties=Object.assign({},rt.properties))),Re.newGeometry&&(rt.geometry=Re.newGeometry),Re.removeAllProperties)rt.properties={};else if(((Xe=Re.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0)for(const yt of Re.removeProperties)Object.prototype.hasOwnProperty.call(rt.properties,yt)&&delete rt.properties[yt];if((($e=Re.addOrUpdateProperties)===null||$e===void 0?void 0:$e.length)>0)for(const{key:yt,value:Ft}of Re.addOrUpdateProperties)rt.properties[yt]=Ft}}(this._dataUpdateable,F.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class ji{constructor(F){this.self=F,this.actor=new b.H(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,ee)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=ee},this.self.addProtocol=b.cj,this.self.removeProtocol=b.ck,this.self.registerRTLTextPlugin=H=>{b.cE.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,ee)=>this._getDEMWorkerSource(H,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(H,ee)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(H,ee)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(H,ee)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(H,ee)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("GD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).getData()),this.actor.registerMessageHandler("LT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(H,ee)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][ee.type]||!this.workerSources[H][ee.type][ee.source])return;const le=this.workerSources[H][ee.type][ee.source];delete this.workerSources[H][ee.type][ee.source],le.removeSource!==void 0&&le.removeSource(ee)})),this.actor.registerMessageHandler("RM",H=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,ee)=>b._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(H,ee)=>this._syncRTLPluginState(H,ee)),this.actor.registerMessageHandler("IS",(H,ee)=>b._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(H,ee)=>this._setImages(H,ee)),this.actor.registerMessageHandler("UL",(H,ee)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(H,ee)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(ee)}))}_setImages(F,H){return b._(this,void 0,void 0,function*(){this.availableImages[F]=H;for(const ee in this.workerSources[F]){const le=this.workerSources[F][ee];for(const xe in le)le[xe].availableImages=H}})}_syncRTLPluginState(F,H){return b._(this,void 0,void 0,function*(){return yield b.cE.syncState(H,this.self.importScripts)})}_getAvailableImages(F){let H=this.availableImages[F];return H||(H=[]),H}_getLayerIndex(F){let H=this.layerIndexes[F];return H||(H=this.layerIndexes[F]=new l),H}_getWorkerSource(F,H,ee){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][H]||(this.workerSources[F][H]={}),!this.workerSources[F][H][ee]){const le={sendAsync:(xe,Ie)=>(xe.targetMapId=F,this.actor.sendAsync(xe,Ie))};switch(H){case"vector":this.workerSources[F][H][ee]=new ce(le,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][H][ee]=new no(le,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][H][ee]=new this.externalWorkerSourceTypes[H](le,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][H][ee]}_getDEMWorkerSource(F,H){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][H]||(this.demWorkerSources[F][H]=new oe),this.demWorkerSources[F][H]}}return b.i(self)&&(self.worker=new ji(self)),ji}),x("index",["exports","./shared"],function(b,l){var L="5.2.0";function $(){var g=new l.A(4);return l.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let Q,ce;const oe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,i){const u=requestAnimationFrame(_=>{d(),e(_)}),{unsubscribe:d}=l.s(g.signal,"abort",()=>{d(),cancelAnimationFrame(u),i(l.c())},!1)},frameAsync(g){return new Promise((e,i)=>{this.frame(g,e,i)})},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,i.drawImage(g,0,0,g.width,g.height),i},resolveURL:g=>(Q||(Q=document.createElement("a")),Q.href=g,Q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ce==null&&(ce=matchMedia("(prefers-reduced-motion: reduce)")),ce.matches)}};class Y{static testProp(e){if(!Y.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in Y.docStyle)return e[i];return e[0]}static create(e,i,u){const d=window.document.createElement(e);return i!==void 0&&(d.className=i),u&&u.appendChild(d),d}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(e,i){e.style[Y.transformProp]=i}static addEventListener(e,i,u,d={}){e.addEventListener(i,u,"passive"in d?d:d.capture)}static removeEventListener(e,i,u,d={}){e.removeEventListener(i,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,u){const d=i.boundingClientRect;return new l.P((u.clientX-d.left)/i.x-e.clientLeft,(u.clientY-d.top)/i.y-e.clientTop)}static mousePos(e,i){const u=Y.getScale(e);return Y.getPoint(e,u,i)}static touchPos(e,i){const u=[],d=Y.getScale(e);for(let _=0;_<i.length;_++)u.push(Y.getPoint(e,d,i[_]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=i.querySelectorAll("script");for(const d of u)d.remove();return Y.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const u=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const u of i)Y.removeAttributes(u),Y.clean(u)}static removeAttributes(e){for(const{name:i,value:u}of e.attributes)Y.isPossiblyDangerous(i,u)&&e.removeAttribute(i)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const Te={supported:!1,testSupport:function(g){!he&&We&&(pe?ve(g):et=g)}};let et,We,he=!1,pe=!1;function ve(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,We),g.isContextLost())return;Te.supported=!0}catch{}g.deleteTexture(e),he=!0}var Oe;typeof document<"u"&&(We=document.createElement("img"),We.onload=()=>{et&&ve(et),et=null,pe=!0},We.onerror=()=>{he=!0,et=null},We.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let e,i,u,d;g.resetRequestQueue=()=>{e=[],i=0,u=0,d={}},g.addThrottleControl=M=>{const k=u++;return d[k]=M,k},g.removeThrottleControl=M=>{delete d[M],w()},g.getImage=(M,k,D=!0)=>new Promise((O,B)=>{Te.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),l.e(M,{type:"image"}),e.push({abortController:k,requestParameters:M,supportImageRefresh:D,state:"queued",onError:G=>{B(G)},onSuccess:G=>{O(G)}}),w()});const _=M=>l._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:k,supportImageRefresh:D,onError:O,onSuccess:B,abortController:G}=M,W=D===!1&&!l.i(self)&&!l.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((se,ue)=>se&&ue==="accept",!0));i++;const ie=W?P(k,G):l.m(k,G);try{const se=yield ie;delete M.abortController,M.state="completed",se.data instanceof HTMLImageElement||l.b(se.data)?B(se):se.data&&B({data:yield(re=se.data,typeof createImageBitmap=="function"?l.f(re):l.h(re)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete M.abortController,O(se)}finally{i--,w()}var re}),w=()=>{const M=(()=>{for(const k of Object.keys(d))if(d[k]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=i;k<M&&e.length>0;k++){const D=e.shift();D.abortController.signal.aborted?k--:_(D)}},P=(M,k)=>new Promise((D,O)=>{const B=new Image,G=M.url,W=M.credentials;W&&W==="include"?B.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.d(G))&&(B.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{B.src="",O(l.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,D({data:B})},B.onerror=()=>{B.onerror=B.onload=null,k.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=G})}(Oe||(Oe={})),Oe.resetRequestQueue();class it{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function qe(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const i=[];for(const{id:u,url:d}of g){const _=`${u}${d}`;i.indexOf(_)===-1&&(i.push(_),e.push({id:u,url:d}))}}return e}function we(g,e,i){try{const u=new URL(g);return u.pathname+=`${e}${i}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ne{constructor(e,i,u,d){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(i,d)}update(e,i,u){const{width:d,height:_}=e,w=!(this.size&&this.size[0]===d&&this.size[1]===_||u),{context:P}=this,{gl:M}=P;if(this.useMipmap=!!(i&&i.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!i||i.premultiply!==!1)),w)this.size=[d,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.b(e)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,d,_,0,this.format,M.UNSIGNED_BYTE,e.data);else{const{x:k,y:D}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.b(e)?M.texSubImage2D(M.TEXTURE_2D,0,k,D,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,k,D,d,_,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(e,i,u){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),u!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,u||e),this.filter=e),i!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function ye(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class ke extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:u}of this.requestors)u(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const u=i.spriteData;i.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let u=!0;const d=i.data||i.spriteData;return this._validateStretch(i.stretchX,d&&d.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(i.stretchY,d&&d.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(i.content,i)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,i){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||i<d[1])return!1;u=d[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const u=i.spriteData,d=u&&u.width||i.data.width,_=u&&u.height||i.data.height;return!(e[0]<0||d<e[0]||e[1]<0||_<e[1]||e[2]<0||d<e[2]||e[3]<0||_<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==i.data.width||d.data.height!==i.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=d.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,u)=>{let d=!0;if(!this.isLoaded())for(const _ of e)this.images[_]||(d=!1);this.isLoaded()||d?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const u of e){let d=this.getImage(u);d||(this.fire(new l.l("styleimagemissing",{id:u})),d=this.getImage(u)),d?i[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],u=this.getImage(e);if(!u)return null;if(i&&i.position.version===u.version)return i.position;if(i)i.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},_=new l.I(d,u);this.patterns[e]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const _ in this.patterns)e.push(this.patterns[_].bin);const{w:i,h:u}=l.p(e),d=this.atlasImage;d.resize({width:i||1,height:u||1});for(const _ in this.patterns){const{bin:w}=this.patterns[_],P=w.x+1,M=w.y+1,k=this.getImage(_).data,D=k.width,O=k.height;l.R.copy(k,d,{x:0,y:0},{x:P,y:M},{width:D,height:O}),l.R.copy(k,d,{x:0,y:O-1},{x:P,y:M-1},{width:D,height:1}),l.R.copy(k,d,{x:0,y:0},{x:P,y:M+O},{width:D,height:1}),l.R.copy(k,d,{x:D-1,y:0},{x:P-1,y:M},{width:1,height:O}),l.R.copy(k,d,{x:0,y:0},{x:P+D,y:M},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const u=this.getImage(i);u||l.w(`Image with ID: "${i}" was not found`),ye(u)&&this.updateImage(i,u)}}}const st=1e20;function lt(g,e,i,u,d,_,w,P,M){for(let k=e;k<e+u;k++)bt(g,i*_+k,_,d,w,P,M);for(let k=i;k<i+d;k++)bt(g,k*_+e,1,u,w,P,M)}function bt(g,e,i,u,d,_,w){_[0]=0,w[0]=-1e20,w[1]=st,d[0]=g[e];for(let P=1,M=0,k=0;P<u;P++){d[P]=g[e+P*i];const D=P*P;do{const O=_[M];k=(d[P]-d[O]+D-O*O)/(P-O)/2}while(k<=w[M]&&--M>-1);M++,_[M]=P,w[M]=k,w[M+1]=st}for(let P=0,M=0;P<u;P++){for(;w[M+1]<P;)M++;const k=_[M],D=P-k;g[e+P*i]=d[k]+D*D}}class tn{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,function*(){const i=[];for(const _ in e)for(const w of e[_])i.push(this._getAndCacheGlyphsPromise(_,w));const u=yield Promise.all(i),d={};for(const{stack:_,id:w,glyph:P}of u)d[_]||(d[_]={}),d[_][w]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return d})}_getAndCacheGlyphsPromise(e,i){return l._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[i];if(d!==void 0)return{stack:e,id:i,glyph:d};if(d=this._tinySDF(u,e,i),d)return u.glyphs[i]=d,{stack:e,id:i,glyph:d};const _=Math.floor(i/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[_])return{stack:e,id:i,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[_]){const P=tn.loadGlyphRange(e,_,this.url,this.requestManager);u.requests[_]=P}const w=yield u.requests[_];for(const P in w)this._doesCharSupportLocalGlyph(+P)||(u.glyphs[+P]=w[+P]);return u.ranges[_]=!0,{stack:e,id:i,glyph:w[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let _=e.tinySDF;if(!_){let P="400";/bold/i.test(i)?P="900":/medium/i.test(i)?P="500":/light/i.test(i)&&(P="200"),_=e.tinySDF=new tn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:P})}const w=_.draw(String.fromCharCode(u));return{id:u,bitmap:new l.q({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}tn.loadGlyphRange=function(g,e,i,u){return l._(this,void 0,void 0,function*(){const d=256*e,_=d+255,w=u.transformRequest(i.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),P=yield l.n(w,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${_}`);const M={};for(const k of l.o(P.data))M[k.id]=k;return M})},tn.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=i;const P=this.size=g+4*e,M=this._createCanvas(P),k=this.ctx=M.getContext("2d",{willReadFrequently:!0});k.font=`${w} ${_} ${g}px ${d}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),w=Math.ceil(i),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),M=Math.min(this.size-this.buffer,w+Math.ceil(u)),k=P+2*this.buffer,D=M+2*this.buffer,O=Math.max(k*D,0),B=new Uint8ClampedArray(O),G={data:B,width:k,height:D,glyphWidth:P,glyphHeight:M,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(P===0||M===0)return G;const{ctx:W,buffer:ie,gridInner:re,gridOuter:se}=this;W.clearRect(ie,ie,P,M),W.fillText(g,ie,ie+w);const ue=W.getImageData(ie,ie,P,M);se.fill(st,0,O),re.fill(0,0,O);for(let me=0;me<M;me++)for(let ge=0;ge<P;ge++){const be=ue.data[4*(me*P+ge)+3]/255;if(be===0)continue;const Pe=(me+ie)*k+ge+ie;if(be===1)se[Pe]=0,re[Pe]=st;else{const Se=.5-be;se[Pe]=Se>0?Se*Se:0,re[Pe]=Se<0?Se*Se:0}}lt(se,0,0,k,D,k,this.f,this.v,this.z),lt(re,ie,ie,P,M,k,this.f,this.v,this.z);for(let me=0;me<O;me++){const ge=Math.sqrt(se[me])-Math.sqrt(re[me]);B[me]=Math.round(255-255*(ge/this.radius+this.cutoff))}return G}};class lr{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,i){return l.z(e.expression.evaluate(i))}interpolate(e,i,u){return{x:l.B.number(e.x,i.x,u),y:l.B.number(e.y,i.y,u),z:l.B.number(e.z,i.z,u)}}}let Kt;class Zt extends l.E{constructor(e){super(),Kt=Kt||new l.r({anchor:new l.D(l.v.light.anchor),position:new lr,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Kt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(l.t,e,i))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u){return(!u||u.validate!==!1)&&l.x(this,e.call(l.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const dt=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class _t extends l.E{constructor(e){super(),this._transitionable=new l.T(dt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.C(0))}setSky(e,i={}){if(!this._validate(l.F,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u={}){return(u==null?void 0:u.validate)!==!1&&l.x(this,e.call(l.y,l.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Rt{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const u=e.join(",")+String(i);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,i)),this.dashEntry[u]}getDashRanges(e,i,u){const d=[];let _=e.length%2==1?-e[e.length-1]*u:0,w=e[0]*u,P=!0;d.push({left:_,right:w,isDash:P,zeroLength:e[0]===0});let M=e[0];for(let k=1;k<e.length;k++){P=!P;const D=e[k];_=M*u,M+=D,w=M*u,d.push({left:_,right:w,isDash:P,zeroLength:D===0})}return d}addRoundDash(e,i,u){const d=i/2;for(let _=-u;_<=u;_++){const w=this.width*(this.nextRow+u+_);let P=0,M=e[P];for(let k=0;k<this.width;k++){k/M.right>1&&(M=e[++P]);const D=Math.abs(k-M.left),O=Math.abs(k-M.right),B=Math.min(D,O);let G;const W=_/u*(d+1);if(M.isDash){const ie=d-Math.abs(W);G=Math.sqrt(B*B+ie*ie)}else G=d-Math.sqrt(B*B+W*W);this.data[w+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let P=e.length-1;P>=0;--P){const M=e[P],k=e[P+1];M.zeroLength?e.splice(P,1):k&&k.isDash===M.isDash&&(k.left=M.left,e.splice(P,1))}const i=e[0],u=e[e.length-1];i.isDash===u.isDash&&(i.left=u.left-this.width,u.right=i.right+this.width);const d=this.width*this.nextRow;let _=0,w=e[_];for(let P=0;P<this.width;P++){P/w.right>1&&(w=e[++_]);const M=Math.abs(P-w.left),k=Math.abs(P-w.right),D=Math.min(M,k);this.data[d+P]=Math.max(0,Math.min(255,(w.isDash?D:-D)+128))}}addDash(e,i){const u=i?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let P=0;P<e.length;P++)_+=e[P];if(_!==0){const P=this.width/_,M=this.getDashRanges(e,this.width,P);i?this.addRoundDash(M,P,u):this.addRegularDash(M)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:_};return this.nextRow+=d,this.dirty=!0,w}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const wt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wt]}numActive(){return Object.keys(this.active).length}}const Tt=Math.floor(oe.hardwareConcurrency/2);let gn,nn;function Pn(){return gn||(gn=new Dt),gn}Dt.workerCount=l.G(globalThis)?Math.max(Math.min(Tt,3),1):1;class mr{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const u=this.workerPool.acquire(i);for(let d=0;d<u.length;d++){const _=new l.H(u[d],i);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:i}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const u of this.actors)u.registerMessageHandler(e,i)}}function rn(){return nn||(nn=new mr(Pn(),l.J),nn.registerMessageHandler("GR",(g,e,i)=>l.m(e,i))),nn}function Qt(g,e){const i=l.K();return l.L(i,i,[1,1,0]),l.M(i,i,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?l.N(i,i,g.calculatePosMatrix(e.toUnwrapped())):i}function tr(g,e,i,u,d,_){var w;const P=function(O,B,G){if(O)for(const W of O){const ie=B[W];if(ie&&ie.source===G&&ie.type==="fill-extrusion")return!0}else for(const W in B){const ie=B[W];if(ie.source===G&&ie.type==="fill-extrusion")return!0}return!1}((w=d==null?void 0:d.layers)!==null&&w!==void 0?w:null,e,g.id),M=_.maxPitchScaleFactor(),k=g.tilesIn(u,M,P);k.sort(Gt);const D=[];for(const O of k)D.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,i,g._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,_,M,Qt(g.transform,O.tileID))});return function(O,B){for(const G in O)for(const W of O[G])on(W,B);return O}(function(O){const B={},G={};for(const W of O){const ie=W.queryResults,re=W.wrappedTileID,se=G[re]=G[re]||{};for(const ue in ie){const me=ie[ue],ge=se[ue]=se[ue]||{},be=B[ue]=B[ue]||[];for(const Pe of me)ge[Pe.featureIndex]||(ge[Pe.featureIndex]=!0,be.push(Pe))}}return B}(D),g)}function Gt(g,e){const i=g.tileID,u=e.tileID;return i.overscaledZ-u.overscaledZ||i.canonical.y-u.canonical.y||i.wrap-u.wrap||i.canonical.x-u.canonical.x}function on(g,e){const i=g.feature,u=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=u}function Kn(g,e,i){return l._(this,void 0,void 0,function*(){let u=g;if(g.url?u=(yield l.j(e.transformRequest(g.url,"Source"),i)).data:yield oe.frameAsync(i),!u)return null;const d=l.O(l.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(_=>_.id)),d})}class qt{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.Q?new l.Q(e.lng,e.lat):l.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.Q?new l.Q(e.lng,e.lat):l.Q.convert(e),this}extend(e){const i=this._sw,u=this._ne;let d,_;if(e instanceof l.Q)d=e,_=e;else{if(!(e instanceof qt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qt.convert(e)):this.extend(l.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.Q.convert(e)):this;if(d=e._sw,_=e._ne,!d||!_)return this}return i||u?(i.lng=Math.min(d.lng,i.lng),i.lat=Math.min(d.lat,i.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new l.Q(d.lng,d.lat),this._ne=new l.Q(_.lng,_.lat)),this}getCenter(){return new l.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.Q(this.getWest(),this.getNorth())}getSouthEast(){return new l.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=l.Q.convert(e);let d=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof qt?e:e&&new qt(e)}static fromLngLat(e,i=0){const u=360*i/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new qt(new l.Q(e.lng-d,e.lat-u),new l.Q(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new l.Q(this._sw.lng,this._sw.lat),i=new l.Q(this._ne.lng,this._ne.lat);return new qt(e,e.lng>i.lng?new l.Q(i.lng+360,i.lat):i)}}class _n{constructor(e,i,u){this.bounds=qt.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),u=Math.floor(l.U(this.bounds.getWest())*i),d=Math.floor(l.S(this.bounds.getNorth())*i),_=Math.ceil(l.U(this.bounds.getEast())*i),w=Math.ceil(l.S(this.bounds.getSouth())*i);return e.x>=u&&e.x<_&&e.y>=d&&e.y<w}}class ln extends l.E{constructor(e,i,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.O(i,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Kn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new _n(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((_,w)=>{e.reloadPromise={resolve:_,reject:w}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const _=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,_)}catch(_){if(delete e.abortController,e.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class En extends l.E{constructor(e,i,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},i),l.e(this,l.O(i,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Kn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(l.e(this,i),i.bounds&&(this.tileBounds=new _n(i.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new l.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield Oe.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,_=d.gl,w=u.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new ne(d,w,_.RGBA,{useMipmap:!0}),e.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class yn extends En{constructor(e,i,u,d){super(e,i,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield Oe.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=l.b(_)&&l.V()?_:yield this.readImageNow(_),P={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const M=yield e.actor.sendAsync({type:"LDT",data:P});e.dem=M,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.W()){const i=e.width+2,u=e.height+2;try{return new l.R({width:i,height:u},yield l.X(e,-1,-1,i,u))}catch{}}return oe.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,u=Math.pow(2,i.z),d=(i.x-1+u)%u,_=i.x===0?e.wrap-1:e.wrap,w=(i.x+1+u)%u,P=i.x+1===u?e.wrap+1:e.wrap,M={};return M[new l.Y(e.overscaledZ,_,i.z,d,i.y).key]={backfilled:!1},M[new l.Y(e.overscaledZ,P,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(M[new l.Y(e.overscaledZ,_,i.z,d,i.y-1).key]={backfilled:!1},M[new l.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},M[new l.Y(e.overscaledZ,P,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<u&&(M[new l.Y(e.overscaledZ,_,i.z,d,i.y+1).key]={backfilled:!1},M[new l.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},M[new l.Y(e.overscaledZ,P,i.z,w,i.y+1).key]={backfilled:!1}),M}unloadTile(e){return l._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Bn extends l.E{constructor(e,i,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=i.data,this._options=l.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:l.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:l.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.Z/this.tileSize)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return l._(this,void 0,void 0,function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:u}})}_updateWorkerData(e){return l._(this,void 0,void 0,function*(){const i=l.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(oe.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.l("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&l.e(_,{resourceTiming:d}),this.fire(new l.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return l._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:i,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,i==="RT")})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Rn extends l.E{constructor(e,i,u,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=i}load(e){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Oe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new l.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(l.$.fromLngLat);var u;return this.tileID=function(d){let _=1/0,w=1/0,P=-1/0,M=-1/0;for(const B of d)_=Math.min(_,B.x),w=Math.min(w,B.y),P=Math.max(P,B.x),M=Math.max(M,B.y);const k=Math.max(P-_,M-w),D=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),O=Math.pow(2,D);return new l.a0(D,Math.floor((_+P)/2*O),Math.floor((w+M)/2*O))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(d=>this.tileID.getTilePoint(d)._round()),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new ne(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class nr extends Rn{constructor(e,i,u,d){super(e,i,u,d),this.roundZoom=!0,this.type="video",this.options=i}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield l.a1(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new l.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new l.k(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new ne(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class zr extends Rn{constructor(e,i,u,d){super(e,i,u,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(w=>typeof w!="number"))||this.fire(new l.k(new l.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a2(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new l.k(new l.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,u=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(i,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Si={},vr=g=>{switch(g){case"geojson":return Bn;case"image":return Rn;case"raster":return En;case"raster-dem":return yn;case"vector":return ln;case"video":return nr;case"canvas":return zr}return Si[g]},Rr="RTLPluginLoaded";class cr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=rn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,function*(i,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=oe.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(Rr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let rr=null;function xr(){return rr||(rr=new cr),rr}class Bi{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a3(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,_){const w={};if(!_)return w;for(const P of d){const M=P.layerIds.map(k=>_.getLayer(k)).filter(Boolean);if(M.length!==0){P.layers=M,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(k=>M.filter(D=>D.id===k)[0]));for(const k of M)w[k.id]=P}}return w}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof l.a5){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof l.a5&&_.hasRTLText){this.hasRTLText=!0,xr().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(d).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,u,d,_,w,P,M,k,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:w,tileSize:this.tileSize,pixelPosMatrix:D,transform:M,params:P,queryPadding:this.queryPadding*k},e,i,u):{}}querySourceFeatures(e,i){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),_=i&&i.sourceLayer?i.sourceLayer:"",w=d._geojsonTileLayer||d[_];if(!w)return;const P=l.a6(i&&i.filter),{z:M,x:k,y:D}=this.tileID.canonical,O={z:M,x:k,y:D};for(let B=0;B<w.length;B++){const G=w.feature(B);if(P.needGeometry){const re=l.a7(G,!0);if(!P.filter(new l.C(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!P.filter(new l.C(this.tileID.overscaledZ),G))continue;const W=u.getId(G,_),ie=new l.a8(G,M,k,D,W);ie.tile=O,e.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const u=l.a9(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(i)if(this.expirationTime<i)d=!0;else{const _=this.expirationTime-i;_?this.expirationTime=u+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!i.style.hasLayer(d))continue;const _=this.buckets[d],w=_.layers[0].sourceLayer||"_geojsonTileLayer",P=u[w],M=e[w];if(!P||!M||Object.keys(M).length===0)continue;_.update(M,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=i&&i.style&&i.style.getLayer(d);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<oe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=oe.now()+e}setDependencies(e,i){const u={};for(const d of i)u[d]=!0;this.dependencies[e]=u}hasDependency(e,i){for(const u of e){const d=this.dependencies[u];if(d){for(const _ of i)if(d[_])return!0}}return!1}}class to{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:i,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(e,_)},u)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const u=e.wrapped().key,d=i===void 0?0:this.data[u].indexOf(i),_=this.data[u][d];return this.data[u].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||i.push(d);for(const u of i)this.remove(u.value.tileID,u)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,u){const d=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},l.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==d&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const _ in this.state[e][d])u[_]||(this.deletedStates[e][d][_]=null)}else for(const _ in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][_]===null&&delete this.deletedStates[e][d][_]}removeFeatureState(e,i,u){if(this.deletedStates[e]===null)return;const d=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&i!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,i){const u=String(i),d=l.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][i];if(_===null)return{};for(const w in _)delete d[w]}return d}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),l.e(this.state[d][w],this.stateChanges[d][w]),_[w]=this.state[d][w];u[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const w in this.state[d])_[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const P of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][P];_[w]=this.state[d][w]}u[d]=u[d]||{},l.e(u[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,i)}}function Kr(g,e,i){const u=e.intersectsFrustum(g);if(!i)return u;const d=e.intersectsPlane(i);return u===0||d===0?0:u===2&&d===2?2:1}function no(g,e,i,u,d){let _=g;const w=Math.atan(e/i),P=Math.hypot(e,i);return _=g+l.aa(u/P/Math.max(.5,Math.cos(l.ac(d/2)))),_+=1*l.aa(Math.cos(w))/2,_+=l.ad(g-_,-0,0),_}function ji(g,e){const i=(e.roundZoom?Math.round:Math.floor)(g.zoom+l.aa(g.tileSize/e.tileSize));return Math.max(0,i)}function ze(g,e){const i=g.getCameraFrustum(),u=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=l.$.fromLngLat(g.center,g.elevation);d.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const w=g.getCoveringTilesDetailsProvider(),P=w.allowVariableZoom(g,e),M=ji(g,e),k=e.minzoom||0,D=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,O=Math.min(Math.max(0,M),D),B=Math.pow(2,O),G=[B*d.x,B*d.y,0],W=[B*_.x,B*_.y,0],ie=Math.hypot(_.x-d.x,_.y-d.y),re=Math.abs(_.z-d.z),se=Math.hypot(ie,re),ue=be=>({zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),me=[],ge=[];if(g.renderWorldCopies&&w.allowWorldCopies())for(let be=1;be<=3;be++)me.push(ue(-be)),me.push(ue(be));for(me.push(ue(0));me.length>0;){const be=me.pop(),Pe=be.x,Se=be.y;let Be=be.fullyVisible;const je={x:Pe,y:Se,z:be.zoom},He=w.getTileAABB(je,be.wrap,g.elevation,e);if(!Be){const mt=Kr(i,He,u);if(mt===0)continue;Be=mt===2}const Ye=w.distanceToTile2d(d.x,d.y,je,He);let Ze=M;P&&(Ze=(e.calculateTileZoom||no)(g.zoom+l.aa(g.tileSize/e.tileSize),Ye,re,se,g.fov)),Ze=(e.roundZoom?Math.round:Math.floor)(Ze),Ze=Math.max(0,Ze);const tt=Math.min(Ze,D);if(be.wrap=w.getWrap(_,je,be.wrap),be.zoom>=tt){if(be.zoom<k)continue;const mt=O-be.zoom,ot=G[0]-.5-(Pe<<mt),Mt=G[1]-.5-(Se<<mt),Ot=e.reparseOverscaled?Math.max(be.zoom,Ze):be.zoom;ge.push({tileID:new l.Y(be.zoom===D?Ot:be.zoom,be.wrap,be.zoom,Pe,Se),distanceSq:l.ab([W[0]-.5-Pe,W[1]-.5-Se]),tileDistanceToCamera:Math.sqrt(ot*ot+Mt*Mt)})}else for(let mt=0;mt<4;mt++)me.push({zoom:be.zoom+1,x:(Pe<<1)+mt%2,y:(Se<<1)+(mt>>1),wrap:be.wrap,fullyVisible:Be})}return ge.sort((be,Pe)=>be.distanceSq-Pe.distanceSq).map(be=>be.tileID)}class F extends l.E{constructor(e,i,u){super(),this.id=e,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,w,P)=>{const M=new(vr(_.type))(d,_,w,P);if(M.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${M.id}`);return M})(e,i,u,this),this._tiles={},this._cache=new to(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,u){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new l.k(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const u=this._tiles[i];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(H).map(e=>e.key)}getRenderableIds(e){const i=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&i.push(this._tiles[u]);return e?i.sort((u,d)=>{const _=u.tileID,w=d.tileID,P=new l.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),M=new l.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-w.overscaledZ||M.y-P.y||M.x-P.x}).map(u=>u.tileID.key):i.map(u=>u.tileID).sort(H).map(u=>u.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return l._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=i),yield this._loadTile(u,e,i))})}_tileLoaded(e,i,u){e.timeAdded=oe.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let d=0;d<i.length;d++){const _=i[d];if(e.neighboringTiles&&e.neighboringTiles[_]){const w=this.getTileByID(_);u(e,w),u(w,e)}}function u(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let w=_.tileID.canonical.x-d.tileID.canonical.x;const P=_.tileID.canonical.y-d.tileID.canonical.y,M=Math.pow(2,d.tileID.canonical.z),k=_.tileID.key;w===0&&P===0||Math.abs(P)>1||(Math.abs(w)>1&&(Math.abs(w+M)===1?w+=M:Math.abs(w-M)===1&&(w-=M)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,w,P),d.neighboringTiles&&d.neighboringTiles[k]&&(d.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,u,d){for(const _ in this._tiles){let w=this._tiles[_];if(d[_]||!w.hasData()||w.tileID.overscaledZ<=i||w.tileID.overscaledZ>u)continue;let P=w.tileID;for(;w&&w.tileID.overscaledZ>i+1;){const k=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[k.key],w&&w.hasData()&&(P=k)}let M=P;for(;M.overscaledZ>i;)if(M=M.scaledTo(M.overscaledZ-1),e[M.key]||e[M.canonical.key]){d[P.key]=P;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=i?u:null}for(let u=e.overscaledZ-1;u>=i;u--){const d=e.scaledTo(u),_=this._getLoadedTile(d);if(_)return _}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(i*u*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const u={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+i),u[_.tileID.key]=_}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,i,u,d,_,w){const P={},M={},k=Object.keys(e),D=oe.now();for(const O of k){const B=e[O],G=this._tiles[O];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=D)continue;const W=this.findLoadedParent(B,i),ie=this.findLoadedSibling(B),re=W||ie||null;re&&(this._addTile(re.tileID),P[re.tileID.key]=re.tileID),M[O]=B}this._retainLoadedChildren(M,d,u,e);for(const O in P)e[O]||(this._coveredTiles[O]=!0,e[O]=P[O]);if(w){const O={},B={};for(const G of _)this._tiles[G.key].hasData()?O[G.key]=G:B[G.key]=G;for(const G in B){const W=B[G].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(O[W[0].key]=e[W[0].key]=W[0],O[W[1].key]=e[W[1].key]=W[1],O[W[2].key]=e[W[2].key]=W[2],O[W[3].key]=e[W[3].key]=W[3],delete B[G])}for(const G in B){const W=B[G],ie=this.findLoadedParent(W,this._source.minzoom),re=this.findLoadedSibling(W),se=ie||re||null;if(se){O[se.tileID.key]=e[se.tileID.key]=se.tileID;for(const ue in O)O[ue].isChildOf(se.tileID)&&delete O[ue]}}for(const G in this._tiles)O[G]||(this._coveredTiles[G]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new l.Y(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(u=ze(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter(D=>this._source.hasTile(D)))):u=[];const d=ji(e,this._source),_=Math.max(d-F.maxOverzooming,this._source.minzoom),w=Math.max(d+F.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const O of u)if(O.canonical.z>this._source.minzoom){const B=O.scaledTo(O.canonical.z-1);D[B.key]=B;const G=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));D[G.key]=G}u=u.concat(Object.values(D))}const P=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(u,d);ee(this._source.type)&&this._updateCoveredAndRetainedTiles(M,_,w,d,u,i);for(const D in M)this._tiles[D].clearFadeHold();const k=l.ae(this._tiles,M);for(const D of k){const O=this._tiles[D];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var u;const d={},_={},w=Math.max(i-F.maxOverzooming,this._source.minzoom),P=Math.max(i+F.maxUnderzooming,this._source.minzoom),M={};for(const k of e){const D=this._addTile(k);d[k.key]=k,D.hasData()||i<this._source.maxzoom&&(M[k.key]=k)}this._retainLoadedChildren(M,i,P,d);for(const k of e){let D=this._tiles[k.key];if(D.hasData())continue;if(i+1>this._source.maxzoom){const B=k.children(this._source.maxzoom)[0],G=this.getTile(B);if(G&&G.hasData()){d[B.key]=B;continue}}else{const B=k.children(this._source.maxzoom);if(d[B[0].key]&&d[B[1].key]&&d[B[2].key]&&d[B[3].key])continue}let O=D.wasRequested();for(let B=k.overscaledZ-1;B>=w;--B){const G=k.scaledTo(B);if(_[G.key])break;if(_[G.key]=!0,D=this.getTile(G),!D&&O&&(D=this._addTile(G)),D){const W=D.hasData();if((W||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||O)&&(d[G.key]=G),O=D.wasRequested(),W)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}i.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;d=_}for(const _ of i)this._loadedParentTiles[_]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,u=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=u}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const u=i;return i||(i=new Bi(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,u||this._source.fire(new l.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=i.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,u){const d=[],_=this.transform;if(!_)return d;const w=u?_.getCameraQueryGeometry(e):e,P=e.map(W=>_.screenPointToMercatorCoordinate(W,this.terrain)),M=w.map(W=>_.screenPointToMercatorCoordinate(W,this.terrain)),k=this.getIds();let D=1/0,O=1/0,B=-1/0,G=-1/0;for(const W of M)D=Math.min(D,W.x),O=Math.min(O,W.y),B=Math.max(B,W.x),G=Math.max(G,W.y);for(let W=0;W<k.length;W++){const ie=this._tiles[k[W]];if(ie.holdingForFade())continue;const re=ie.tileID,se=Math.pow(2,_.zoom-ie.tileID.overscaledZ),ue=i*ie.queryPadding*l.Z/ie.tileSize/se,me=[re.getTilePoint(new l.$(D,O)),re.getTilePoint(new l.$(B,G))];if(me[0].x-ue<l.Z&&me[0].y-ue<l.Z&&me[1].x+ue>=0&&me[1].y+ue>=0){const ge=P.map(Pe=>re.getTilePoint(Pe)),be=M.map(Pe=>re.getTilePoint(Pe));d.push({tile:ie,tileID:re,queryGeometry:ge,cameraQueryGeometry:be,scale:se})}}return d}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(ee(this._source.type)){const e=oe.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,u){this._state.updateState(e=e||"_geojsonTileLayer",i,u)}removeFeatureState(e,i,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,u)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,u){const d=this._tiles[e];d&&d.setDependencies(i,u)}reloadTilesForDependencies(e,i){for(const u in this._tiles)this._tiles[u].hasDependency(e,i)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,i))}}function H(g,e){const i=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||u-i||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function ee(g){return g==="raster"||g==="image"||g==="video"}F.maxOverzooming=10,F.maxUnderzooming=3;class le{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ad(e,0,1);let i=1,u=this._distances[i];const d=e*this.paddedLength+this.padding;for(;u<d&&i<this._distances.length;)u=this._distances[++i];const _=i-1,w=this._distances[_],P=u-w,M=P>0?(d-w)/P:0;return this.points[_].mult(1-M).add(this.points[i].mult(M))}}function xe(g,e){let i=!0;return g==="always"||g!=="never"&&e!=="never"||(i=!1),i}class Ie{constructor(e,i,u){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(i/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,u,d,_){this._forEachCell(i,u,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(e,i,u,d){this._forEachCell(i-d,u-d,i+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,i,u,d,_,w){this.boxCells[_].push(w)}_insertCircleCell(e,i,u,d,_,w){this.circleCells[_].push(w)}_query(e,i,u,d,_,w,P){if(u<0||e>this.width||d<0||i>this.height)return[];const M=[];if(e<=0&&i<=0&&this.width<=u&&this.height<=d){if(_)return[{key:null,x1:e,y1:i,x2:u,y2:d}];for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const D=this.circles[3*k],O=this.circles[3*k+1],B=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:D-B,y1:O-B,x2:D+B,y2:O+B})}}else this._forEachCell(e,i,u,d,this._queryCell,M,{hitTest:_,overlapMode:w,seenUids:{box:{},circle:{}}},P);return M}query(e,i,u,d){return this._query(e,i,u,d,!1,null)}hitTest(e,i,u,d,_,w){return this._query(e,i,u,d,!0,_,w).length>0}hitTestCircle(e,i,u,d,_){const w=e-u,P=e+u,M=i-u,k=i+u;if(P<0||w>this.width||k<0||M>this.height)return!1;const D=[];return this._forEachCell(w,M,P,k,this._queryCellCircle,D,{hitTest:!0,overlapMode:d,circle:{x:e,y:i,radius:u},seenUids:{box:{},circle:{}}},_),D.length>0}_queryCell(e,i,u,d,_,w,P,M){const{seenUids:k,hitTest:D,overlapMode:O}=P,B=this.boxCells[_];if(B!==null){const W=this.bboxes;for(const ie of B)if(!k.box[ie]){k.box[ie]=!0;const re=4*ie,se=this.boxKeys[ie];if(e<=W[re+2]&&i<=W[re+3]&&u>=W[re+0]&&d>=W[re+1]&&(!M||M(se))&&(!D||!xe(O,se.overlapMode))&&(w.push({key:se,x1:W[re],y1:W[re+1],x2:W[re+2],y2:W[re+3]}),D))return!0}}const G=this.circleCells[_];if(G!==null){const W=this.circles;for(const ie of G)if(!k.circle[ie]){k.circle[ie]=!0;const re=3*ie,se=this.circleKeys[ie];if(this._circleAndRectCollide(W[re],W[re+1],W[re+2],e,i,u,d)&&(!M||M(se))&&(!D||!xe(O,se.overlapMode))){const ue=W[re],me=W[re+1],ge=W[re+2];if(w.push({key:se,x1:ue-ge,y1:me-ge,x2:ue+ge,y2:me+ge}),D)return!0}}}return!1}_queryCellCircle(e,i,u,d,_,w,P,M){const{circle:k,seenUids:D,overlapMode:O}=P,B=this.boxCells[_];if(B!==null){const W=this.bboxes;for(const ie of B)if(!D.box[ie]){D.box[ie]=!0;const re=4*ie,se=this.boxKeys[ie];if(this._circleAndRectCollide(k.x,k.y,k.radius,W[re+0],W[re+1],W[re+2],W[re+3])&&(!M||M(se))&&!xe(O,se.overlapMode))return w.push(!0),!0}}const G=this.circleCells[_];if(G!==null){const W=this.circles;for(const ie of G)if(!D.circle[ie]){D.circle[ie]=!0;const re=3*ie,se=this.circleKeys[ie];if(this._circlesCollide(W[re],W[re+1],W[re+2],k.x,k.y,k.radius)&&(!M||M(se))&&!xe(O,se.overlapMode))return w.push(!0),!0}}}_forEachCell(e,i,u,d,_,w,P,M){const k=this._convertToXCellCoord(e),D=this._convertToYCellCoord(i),O=this._convertToXCellCoord(u),B=this._convertToYCellCoord(d);for(let G=k;G<=O;G++)for(let W=D;W<=B;W++)if(_.call(this,e,i,u,d,this.xCellCount*W+G,w,P,M))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,u,d,_,w){const P=d-e,M=_-i,k=u+w;return k*k>P*P+M*M}_circleAndRectCollide(e,i,u,d,_,w,P){const M=(w-d)/2,k=Math.abs(e-(d+M));if(k>M+u)return!1;const D=(P-_)/2,O=Math.abs(i-(_+D));if(O>D+u)return!1;if(k<=M||O<=D)return!0;const B=k-M,G=O-D;return B*B+G*G<=u*u}}function Ue(g,e,i){const u=l.K();if(!g){const{vecSouth:O,vecEast:B}=Xe(e),G=$();G[0]=B[0],G[1]=B[1],G[2]=O[0],G[3]=O[1],d=G,(D=(w=(_=G)[0])*(k=_[3])-(M=_[2])*(P=_[1]))&&(d[0]=k*(D=1/D),d[1]=-P*D,d[2]=-M*D,d[3]=w*D),u[0]=G[0],u[1]=G[1],u[4]=G[2],u[5]=G[3]}var d,_,w,P,M,k,D;return l.M(u,u,[1/i,1/i,1]),u}function Me(g,e,i,u){if(g){const d=l.K();if(!e){const{vecSouth:_,vecEast:w}=Xe(i);d[0]=w[0],d[1]=w[1],d[4]=_[0],d[5]=_[1]}return l.M(d,d,[u,u,1]),d}return i.pixelsToClipSpaceMatrix}function Xe(g){const e=Math.cos(g.rollInRadians),i=Math.sin(g.rollInRadians),u=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),w=l.aj();w[0]=-d*u*i-_*e,w[1]=-_*u*i+d*e;const P=l.ak(w);P<1e-9?l.al(w):l.am(w,w,1/P);const M=l.aj();M[0]=d*u*e-_*i,M[1]=_*u*e+d*i;const k=l.ak(M);return k<1e-9?l.al(M):l.am(M,M,1/k),{vecEast:M,vecSouth:w}}function $e(g,e,i,u){let d;u?(d=[g,e,u(g,e),1],l.ao(d,d,i)):(d=[g,e,0,1],jr(d,d,i));const _=d[3];return{point:new l.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Re(g,e){return .5+g/e*.5}function rt(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function De(g,e,i,u,d,_,w,P,M,k,D,O,B){const G=i?g.textSizeData:g.iconSizeData,W=l.af(G,e.transform.zoom),ie=[256/e.width*2+1,256/e.height*2+1],re=i?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;re.clear();const se=g.lineVertexArray,ue=i?g.text.placedSymbolArray:g.icon.placedSymbolArray,me=e.transform.width/e.transform.height;let ge=!1;for(let be=0;be<ue.length;be++){const Pe=ue.get(be);if(Pe.hidden||Pe.writingMode===l.ag.vertical&&!ge){Nr(Pe.numGlyphs,re);continue}ge=!1;const Se=new l.P(Pe.anchorX,Pe.anchorY),Be={getElevation:B,pitchedLabelPlaneMatrix:u,lineVertexArray:se,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Se,unwrappedTileID:M,width:k,height:D,translation:O},je=hn(Pe.anchorX,Pe.anchorY,Be);if(!rt(je.point,ie)){Nr(Pe.numGlyphs,re);continue}const He=Re(e.transform.cameraToCenterDistance,je.signedDistanceFromCamera),Ye=l.ah(G,W,Pe),Ze=_?Ye*e.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,M)/He:Ye*He,tt=Jt({projectionContext:Be,pitchedLabelPlaneMatrixInverse:d,symbol:Pe,fontSize:Ze,flip:!1,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:re,aspectRatio:me,rotateToLine:P});ge=tt.useVertical,(tt.notEnoughRoom||ge||tt.needsFlipping&&Jt({projectionContext:Be,pitchedLabelPlaneMatrixInverse:d,symbol:Pe,fontSize:Ze,flip:!0,keepUpright:w,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:re,aspectRatio:me,rotateToLine:P}).notEnoughRoom)&&Nr(Pe.numGlyphs,re)}i?g.text.dynamicLayoutVertexBuffer.updateData(re):g.icon.dynamicLayoutVertexBuffer.updateData(re)}function yt(g,e,i,u,d,_,w,P){const M=_.glyphStartIndex+_.numGlyphs,k=_.lineStartIndex,D=_.lineStartIndex+_.lineLength,O=e.getoffsetX(_.glyphStartIndex),B=e.getoffsetX(M-1),G=Ut(g*O,i,u,d,_.segment,k,D,P,w);if(!G)return null;const W=Ut(g*B,i,u,d,_.segment,k,D,P,w);return W?P.projectionCache.anyProjectionOccluded?null:{first:G,last:W}:null}function Ft(g,e,i,u){return g===l.ag.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*u?{useVertical:!0}:(g===l.ag.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function Jt(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:u,fontSize:d,flip:_,keepUpright:w,glyphOffsetArray:P,dynamicLayoutVertexArray:M,aspectRatio:k,rotateToLine:D}=g,O=d/24,B=u.lineOffsetX*O,G=u.lineOffsetY*O;let W;if(u.numGlyphs>1){const ie=u.glyphStartIndex+u.numGlyphs,re=u.lineStartIndex,se=u.lineStartIndex+u.lineLength,ue=yt(O,P,B,G,_,u,D,e);if(!ue)return{notEnoughRoom:!0};const me=Pt(ue.first.point.x,ue.first.point.y,e,i),ge=Pt(ue.last.point.x,ue.last.point.y,e,i);if(w&&!_){const be=Ft(u.writingMode,me,ge,k);if(be)return be}W=[ue.first];for(let be=u.glyphStartIndex+1;be<ie-1;be++)W.push(Ut(O*P.getoffsetX(be),B,G,_,u.segment,re,se,e,D));W.push(ue.last)}else{if(w&&!_){const re=It(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,se=u.lineStartIndex+u.segment+1,ue=new l.P(e.lineVertexArray.getx(se),e.lineVertexArray.gety(se)),me=It(ue.x,ue.y,e),ge=me.signedDistanceFromCamera>0?me.point:Ht(e.tileAnchorPoint,ue,re,1,e),be=Pt(re.x,re.y,e,i),Pe=Pt(ge.x,ge.y,e,i),Se=Ft(u.writingMode,be,Pe,k);if(Se)return Se}const ie=Ut(O*P.getoffsetX(u.glyphStartIndex),B,G,_,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,D);if(!ie||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[ie]}for(const ie of W)l.an(M,ie.point,ie.angle);return{}}function Ht(g,e,i,u,d){const _=g.add(g.sub(e)._unit()),w=It(_.x,_.y,d).point,P=i.sub(w);return i.add(P._mult(u/P.mag()))}function Ke(g,e,i){const u=e.projectionCache;if(u.projections[g])return u.projections[g];const d=new l.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),_=It(d.x,d.y,e);if(_.signedDistanceFromCamera>0)return u.projections[g]=_.point,u.anyProjectionOccluded=u.anyProjectionOccluded||_.isOccluded,_.point;const w=g-i.direction;return Ht(i.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),d,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function It(g,e,i){const u=g+i.translation[0],d=e+i.translation[1];let _;return i.pitchWithMap?(_=$e(u,d,i.pitchedLabelPlaneMatrix,i.getElevation),_.isOccluded=!1):(_=i.transform.projectTileCoordinates(u,d,i.unwrappedTileID,i.getElevation),_.point.x=(.5*_.point.x+.5)*i.width,_.point.y=(.5*-_.point.y+.5)*i.height),_}function Pt(g,e,i,u){if(i.pitchWithMap){const d=[g,e,0,1];return l.ao(d,d,u),i.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],i.unwrappedTileID,i.getElevation).point}return{x:g/i.width*2-1,y:e/i.height*2-1}}function hn(g,e,i){return i.transform.projectTileCoordinates(g,e,i.unwrappedTileID,i.getElevation)}function Xt(g,e,i){return g._unit()._perp()._mult(e*i)}function dn(g,e,i,u,d,_,w,P,M){if(P.projectionCache.offsets[g])return P.projectionCache.offsets[g];const k=i.add(e);if(g+M.direction<u||g+M.direction>=d)return P.projectionCache.offsets[g]=k,k;const D=Ke(g+M.direction,P,M),O=Xt(D.sub(i),w,M.direction),B=i.add(O),G=D.add(O);return P.projectionCache.offsets[g]=l.ap(_,k,B,G)||k,P.projectionCache.offsets[g]}function Ut(g,e,i,u,d,_,w,P,M){const k=u?g-e:g+e;let D=k>0?1:-1,O=0;u&&(D*=-1,O=Math.PI),D<0&&(O+=Math.PI);let B,G=D>0?_+d:_+d+1;P.projectionCache.cachedAnchorPoint?B=P.projectionCache.cachedAnchorPoint:(B=It(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=B);let W,ie,re=B,se=B,ue=0,me=0;const ge=Math.abs(k),be=[];let Pe;for(;ue+me<=ge;){if(G+=D,G<_||G>=w)return null;ue+=me,se=re,ie=W;const je={absOffsetX:ge,direction:D,distanceFromAnchor:ue,previousVertex:se};if(re=Ke(G,P,je),i===0)be.push(se),Pe=re.sub(se);else{let He;const Ye=re.sub(se);He=Ye.mag()===0?Xt(Ke(G+D,P,je).sub(re),i,D):Xt(Ye,i,D),ie||(ie=se.add(He)),W=dn(G,He,re,_,w,ie,i,P,je),be.push(ie),Pe=W.sub(ie)}me=Pe.mag()}const Se=Pe._mult((ge-ue)/me)._add(ie||se),Be=O+Math.atan2(re.y-se.y,re.x-se.x);return be.push(Se),{point:Se,angle:M?Be:0,path:be}}const Sa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Nr(g,e){for(let i=0;i<g;i++){const u=e.length;e.resize(u+4),e.float32.set(Sa,3*u)}}function jr(g,e,i){const u=e[0],d=e[1];return g[0]=i[0]*u+i[4]*d+i[12],g[1]=i[1]*u+i[5]*d+i[13],g[3]=i[3]*u+i[7]*d+i[15],g}const ur=100;class tu{constructor(e,i=new Ie(e.width+200,e.height+200,25),u=new Ie(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ur,this.screenBottomBoundary=e.height+ur,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,u,d,_,w,P,M,k,D,O,B){const G=this.projectAndGetPerspectiveRatio(e.anchorPointX+M[0],e.anchorPointY+M[1],_,D,B),W=u*G.perspectiveRatio;let ie;if(w||P)ie=this._projectCollisionBox(e,W,d,_,w,P,M,G,D,O,B);else{const Pe=G.x+(O?O.x*W:0),Se=G.y+(O?O.y*W:0);ie={allPointsOccluded:!1,box:[Pe+e.x1*W,Se+e.y1*W,Pe+e.x2*W,Se+e.y2*W]}}const[re,se,ue,me]=ie.box,ge=w?ie.allPointsOccluded:G.isOccluded;let be=ge;return be||(be=G.perspectiveRatio<this.perspectiveRatioCutoff),be||(be=!this.isInsideGrid(re,se,ue,me)),be||i!=="always"&&this.grid.hitTest(re,se,ue,me,i,k)?{box:[re,se,ue,me],placeable:!1,offscreen:!1,occluded:ge}:{box:[re,se,ue,me],placeable:!0,offscreen:this.isOffscreen(re,se,ue,me),occluded:ge}}placeCollisionCircles(e,i,u,d,_,w,P,M,k,D,O,B,G,W){const ie=[],re=new l.P(i.anchorX,i.anchorY),se=this.getPerspectiveRatio(re.x,re.y,w,W),ue=(k?_*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,w)/se:_*se)/l.au,me={getElevation:W,pitchedLabelPlaneMatrix:P,lineVertexArray:u,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:re,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:G},ge=yt(ue,d,i.lineOffsetX*ue,i.lineOffsetY*ue,!1,i,!1,me);let be=!1,Pe=!1,Se=!0;if(ge){const Be=.5*O*se+B,je=new l.P(-100,-100),He=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new le,Ze=ge.first,tt=ge.last;let mt=[];for(let Ot=Ze.path.length-1;Ot>=1;Ot--)mt.push(Ze.path[Ot]);for(let Ot=1;Ot<tt.path.length;Ot++)mt.push(tt.path[Ot]);const ot=2.5*Be;if(k){const Ot=this.projectPathToScreenSpace(mt,me);mt=Ot.some(Fn=>Fn.signedDistanceFromCamera<=0)?[]:Ot.map(Fn=>Fn.point)}let Mt=[];if(mt.length>0){const Ot=mt[0].clone(),Fn=mt[0].clone();for(let ar=1;ar<mt.length;ar++)Ot.x=Math.min(Ot.x,mt[ar].x),Ot.y=Math.min(Ot.y,mt[ar].y),Fn.x=Math.max(Fn.x,mt[ar].x),Fn.y=Math.max(Fn.y,mt[ar].y);Mt=Ot.x>=je.x&&Fn.x<=He.x&&Ot.y>=je.y&&Fn.y<=He.y?[mt]:Fn.x<je.x||Ot.x>He.x||Fn.y<je.y||Ot.y>He.y?[]:l.aq([mt],je.x,je.y,He.x,He.y)}for(const Ot of Mt){Ye.reset(Ot,.25*Be);let Fn=0;Fn=Ye.length<=.5*Be?1:Math.ceil(Ye.paddedLength/ot)+1;for(let ar=0;ar<Fn;ar++){const vn=ar/Math.max(Fn-1,1),_r=Ye.lerp(vn),Jn=_r.x+ur,zn=_r.y+ur;ie.push(Jn,zn,Be,0);const Wn=Jn-Be,Qr=zn-Be,Hn=Jn+Be,dr=zn+Be;if(Se=Se&&this.isOffscreen(Wn,Qr,Hn,dr),Pe=Pe||this.isInsideGrid(Wn,Qr,Hn,dr),e!=="always"&&this.grid.hitTestCircle(Jn,zn,Be,e,D)&&(be=!0,!M))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!M&&be||!Pe||se<this.perspectiveRatioCutoff?[]:ie,offscreen:Se,collisionDetected:be}}projectPathToScreenSpace(e,i){const u=function(d,_){const w=l.K();return l.ai(w,_.pitchedLabelPlaneMatrix),d.map(P=>{const M=$e(P.x,P.y,w,_.getElevation),k=_.transform.projectTileCoordinates(M.point.x,M.point.y,_.unwrappedTileID,_.getElevation);return k.point.x=(.5*k.point.x+.5)*_.width,k.point.y=(.5*-k.point.y+.5)*_.height,k})}(e,i);return function(d){let _=0,w=0,P=0,M=0;for(let k=0;k<d.length;k++)d[k].isOccluded?(P=k+1,M=0):(M++,M>w&&(w=M,_=P));return d.slice(_,_+w)}(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let u=1/0,d=1/0,_=-1/0,w=-1/0;for(const D of e){const O=new l.P(D.x+ur,D.y+ur);u=Math.min(u,O.x),d=Math.min(d,O.y),_=Math.max(_,O.x),w=Math.max(w,O.y),i.push(O)}const P=this.grid.query(u,d,_,w).concat(this.ignoredGrid.query(u,d,_,w)),M={},k={};for(const D of P){const O=D.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const B=[new l.P(D.x1,D.y1),new l.P(D.x2,D.y1),new l.P(D.x2,D.y2),new l.P(D.x1,D.y2)];l.ar(i,B)&&(M[O.bucketInstanceId][O.featureIndex]=!0,k[O.bucketInstanceId]===void 0&&(k[O.bucketInstanceId]=[]),k[O.bucketInstanceId].push(O.featureIndex))}return k}insertCollisionBox(e,i,u,d,_,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,u,d,_,w){const P=u?this.ignoredGrid:this.grid,M={bucketInstanceId:d,featureIndex:_,collisionGroupID:w,overlapMode:i};for(let k=0;k<e.length;k+=4)P.insertCircle(M,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,i,u,d,_){if(_){let w;d?(w=[e,i,d(e,i),1],l.ao(w,w,_)):(w=[e,i,0,1],jr(w,w,_));const P=w[3];return{x:(w[0]/P+1)/2*this.transform.width+ur,y:(-w[1]/P+1)/2*this.transform.height+ur,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}{const w=this.transform.projectTileCoordinates(e,i,u,d);return{x:(w.point.x+1)/2*this.transform.width+ur,y:(1-w.point.y)/2*this.transform.height+ur,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,u,d){const _=this.transform.projectTileCoordinates(e,i,u,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,i,u,d){return u<ur||e>=this.screenRightBoundary||d<ur||i>this.screenBottomBoundary}isInsideGrid(e,i,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=l.as([]);return l.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,u,d,_,w,P,M,k,D,O){let B=1,G=0,W=0,ie=1;const re=e.anchorPointX+P[0],se=e.anchorPointY+P[1];if(w&&!_){const mt=this.projectAndGetPerspectiveRatio(re+1,se,d,k,O),ot=mt.x-M.x,Mt=Math.atan((mt.y-M.y)/ot)+(ot<0?Math.PI:0),Ot=Math.sin(Mt),Fn=Math.cos(Mt);B=Fn,G=Ot,W=-Ot,ie=Fn}else if(!w&&_){const mt=Xe(this.transform);B=mt.vecEast[0],G=mt.vecEast[1],W=mt.vecSouth[0],ie=mt.vecSouth[1]}let ue=M.x,me=M.y,ge=i;_&&(ue=re,me=se,ge=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),ge*=this.transform.getPitchedTextCorrection(re,se,d),D||(ge*=l.ad(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(ue+=B*D.x*ge+W*D.y*ge,me+=G*D.x*ge+ie*D.y*ge);const be=e.x1*ge,Pe=e.x2*ge,Se=(be+Pe)/2,Be=e.y1*ge,je=e.y2*ge,He=(Be+je)/2,Ye=[{offsetX:be,offsetY:Be},{offsetX:Se,offsetY:Be},{offsetX:Pe,offsetY:Be},{offsetX:Pe,offsetY:He},{offsetX:Pe,offsetY:je},{offsetX:Se,offsetY:je},{offsetX:be,offsetY:je},{offsetX:be,offsetY:He}];let Ze=[];for(const{offsetX:mt,offsetY:ot}of Ye)Ze.push(new l.P(ue+B*mt+W*ot,me+G*mt+ie*ot));let tt=!1;if(_){const mt=Ze.map(ot=>this.projectAndGetPerspectiveRatio(ot.x,ot.y,d,k,O));tt=mt.some(ot=>!ot.isOccluded),Ze=mt.map(ot=>new l.P(ot.x,ot.y))}else tt=!0;return{box:l.at(Ze),allPointsOccluded:!tt}}}class Ui{constructor(e,i,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ir{constructor(e,i,u,d,_){this.text=new Ui(e?e.text:null,i,u,_),this.icon=new Ui(e?e.icon:null,i,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xd{constructor(e,i,u){this.text=e,this.icon=i,this.skipFade=u}}class Vl{constructor(e,i,u,d,_){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=_}}class ol{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:u=>u.collisionGroupID===i}}return this.collisionGroups[e]}}function Ws(g,e,i,u,d){const{horizontalAlign:_,verticalAlign:w}=l.aA(g);return new l.P(-(_-.5)*e+u[0]*d,-(w-.5)*i+u[1]*d)}class xs{constructor(e,i,u,d,_){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new tu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ol(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(u,d)=>i.getElevation(e,u,d):null}getBucketParts(e,i,u,d){const _=u.getBucket(i),w=u.latestFeatureIndex;if(!_||!w||i.id!==_.layerIds[0])return;const P=u.collisionBoxArray,M=_.layers[0].layout,k=_.layers[0].paint,D=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),O=u.tileSize/l.Z,B=u.tileID.toUnwrapped(),G=M.get("text-rotation-alignment")==="map",W=l.av(u,1,this.transform.zoom),ie=l.aw(this.collisionIndex.transform,u,k.get("text-translate"),k.get("text-translate-anchor")),re=l.aw(this.collisionIndex.transform,u,k.get("icon-translate"),k.get("icon-translate-anchor")),se=Ue(G,this.transform,W);this.retainedQueryData[_.bucketInstanceId]=new Vl(_.bucketInstanceId,w,_.sourceLayerIndex,_.index,u.tileID);const ue={bucket:_,layout:M,translationText:ie,translationIcon:re,unwrappedTileID:B,pitchedLabelPlaneMatrix:se,scale:D,textPixelRatio:O,holdingForFade:u.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:l.af(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const me of _.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:be,symbolInstanceEnd:Pe}=me;e.push({sortKey:ge,symbolInstanceStart:be,symbolInstanceEnd:Pe,parameters:ue})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(e,i,u,d,_,w,P,M,k,D,O,B,G,W,ie,re,se,ue,me,ge){const be=l.ax[e.textAnchor],Pe=[e.textOffset0,e.textOffset1],Se=Ws(be,u,d,Pe,_),Be=this.collisionIndex.placeCollisionBox(i,B,M,k,D,P,w,re,O.predicate,me,Se,ge);if((!ue||this.collisionIndex.placeCollisionBox(ue,B,M,k,D,P,w,se,O.predicate,me,Se,ge).placeable)&&Be.placeable){let je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(je=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:Pe,width:u,height:d,anchor:be,textBoxScale:_,prevAnchor:je},this.markUsedJustification(W,be,G,ie),W.allowVerticalPlacement&&(this.markUsedOrientation(W,ie,G),this.placedOrientations[G.crossTileID]=ie),{shift:Se,placedGlyphBoxes:Be}}}placeLayerBucketPart(e,i,u){const{bucket:d,layout:_,translationText:w,translationIcon:P,unwrappedTileID:M,pitchedLabelPlaneMatrix:k,textPixelRatio:D,holdingForFade:O,collisionBoxArray:B,partiallyEvaluatedTextSize:G,collisionGroup:W}=e.parameters,ie=_.get("text-optional"),re=_.get("icon-optional"),se=l.ay(_,"text-overlap","text-allow-overlap"),ue=se==="always",me=l.ay(_,"icon-overlap","icon-allow-overlap"),ge=me==="always",be=_.get("text-rotation-alignment")==="map",Pe=_.get("text-pitch-alignment")==="map",Se=_.get("icon-text-fit")!=="none",Be=_.get("symbol-z-order")==="viewport-y",je=ue&&(ge||!d.hasIconData()||re),He=ge&&(ue||!d.hasTextData()||ie);!d.collisionArrays&&B&&d.deserializeCollisionBoxes(B);const Ye=this.retainedQueryData[d.bucketInstanceId].tileID,Ze=this._getTerrainElevationFunc(Ye),tt=this.transform.getFastPathSimpleProjectionMatrix(Ye),mt=(ot,Mt,Ot)=>{var Fn,ar;if(i[ot.crossTileID])return;if(O)return void(this.placements[ot.crossTileID]=new Xd(!1,!1,!1));let vn=!1,_r=!1,Jn=!0,zn=null,Wn={box:null,placeable:!1,offscreen:null,occluded:!1},Qr={placeable:!1},Hn=null,dr=null,ei=null,Ms=0,wo=0,$o=0;Mt.textFeatureIndex?Ms=Mt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(Ms=ot.featureIndex),Mt.verticalTextFeatureIndex&&(wo=Mt.verticalTextFeatureIndex);const Xi=Mt.textBox;if(Xi){const ti=or=>{let Xn=l.ag.horizontal;if(d.allowVerticalPlacement&&!or&&this.prevPlacement){const ni=this.prevPlacement.placedOrientations[ot.crossTileID];ni&&(this.placedOrientations[ot.crossTileID]=ni,Xn=ni,this.markUsedOrientation(d,Xn,ot))}return Xn},cs=(or,Xn)=>{if(d.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&Mt.verticalTextBox){for(const ni of d.writingModes)if(ni===l.ag.vertical?(Wn=Xn(),Qr=Wn):Wn=or(),Wn&&Wn.placeable)break}else Wn=or()},ui=ot.textAnchorOffsetStartIndex,Zo=ot.textAnchorOffsetEndIndex;if(Zo===ui){const or=(Xn,ni)=>{const ri=this.collisionIndex.placeCollisionBox(Xn,se,D,Ye,M,Pe,be,w,W.predicate,Ze,void 0,tt);return ri&&ri.placeable&&(this.markUsedOrientation(d,ni,ot),this.placedOrientations[ot.crossTileID]=ni),ri};cs(()=>or(Xi,l.ag.horizontal),()=>{const Xn=Mt.verticalTextBox;return d.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&Xn?or(Xn,l.ag.vertical):{box:null,offscreen:null}}),ti(Wn&&Wn.placeable)}else{let or=l.ax[(ar=(Fn=this.prevPlacement)===null||Fn===void 0?void 0:Fn.variableOffsets[ot.crossTileID])===null||ar===void 0?void 0:ar.anchor];const Xn=(ri,ja,gf)=>{const td=ri.x2-ri.x1,nd=ri.y2-ri.y1,rd=ot.textBoxScale,ua=Se&&me==="never"?ja:null;let fr=null,So=se==="never"?1:2,_f="never";or&&So++;for(let Ru=0;Ru<So;Ru++){for(let Ua=ui;Ua<Zo;Ua++){const Va=d.textAnchorOffsets.get(Ua);if(or&&Va.textAnchor!==or)continue;const Ec=this.attemptAnchorPlacement(Va,ri,td,nd,rd,be,Pe,D,Ye,M,W,_f,ot,d,gf,w,P,ua,Ze);if(Ec&&(fr=Ec.placedGlyphBoxes,fr&&fr.placeable))return vn=!0,zn=Ec.shift,fr}or?or=null:_f=se}return u&&!fr&&(fr={box:this.collisionIndex.placeCollisionBox(Xi,"always",D,Ye,M,Pe,be,w,W.predicate,Ze,void 0,tt).box,offscreen:!1,placeable:!1,occluded:!1}),fr};cs(()=>Xn(Xi,Mt.iconBox,l.ag.horizontal),()=>{const ri=Mt.verticalTextBox;return d.allowVerticalPlacement&&(!Wn||!Wn.placeable)&&ot.numVerticalGlyphVertices>0&&ri?Xn(ri,Mt.verticalIconBox,l.ag.vertical):{box:null,occluded:!0,offscreen:null}}),Wn&&(vn=Wn.placeable,Jn=Wn.offscreen);const ni=ti(Wn&&Wn.placeable);if(!vn&&this.prevPlacement){const ri=this.prevPlacement.variableOffsets[ot.crossTileID];ri&&(this.variableOffsets[ot.crossTileID]=ri,this.markUsedJustification(d,ri.anchor,ot,ni))}}}if(Hn=Wn,vn=Hn&&Hn.placeable,Jn=Hn&&Hn.offscreen,ot.useRuntimeCollisionCircles){const ti=d.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex),cs=l.ah(d.textSizeData,G,ti),ui=_.get("text-padding");dr=this.collisionIndex.placeCollisionCircles(se,ti,d.lineVertexArray,d.glyphOffsetArray,cs,M,k,u,Pe,W.predicate,ot.collisionCircleDiameter,ui,w,Ze),dr.circles.length&&dr.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),vn=ue||dr.circles.length>0&&!dr.collisionDetected,Jn=Jn&&dr.offscreen}if(Mt.iconFeatureIndex&&($o=Mt.iconFeatureIndex),Mt.iconBox){const ti=cs=>this.collisionIndex.placeCollisionBox(cs,me,D,Ye,M,Pe,be,P,W.predicate,Ze,Se&&zn?zn:void 0,tt);Qr&&Qr.placeable&&Mt.verticalIconBox?(ei=ti(Mt.verticalIconBox),_r=ei.placeable):(ei=ti(Mt.iconBox),_r=ei.placeable),Jn=Jn&&ei.offscreen}const ca=ie||ot.numHorizontalGlyphVertices===0&&ot.numVerticalGlyphVertices===0,Na=re||ot.numIconVertices===0;ca||Na?Na?ca||(_r=_r&&vn):vn=_r&&vn:_r=vn=_r&&vn;const Is=_r&&ei.placeable;if(vn&&Hn.placeable&&this.collisionIndex.insertCollisionBox(Hn.box,se,_.get("text-ignore-placement"),d.bucketInstanceId,Qr&&Qr.placeable&&wo?wo:Ms,W.ID),Is&&this.collisionIndex.insertCollisionBox(ei.box,me,_.get("icon-ignore-placement"),d.bucketInstanceId,$o,W.ID),dr&&vn&&this.collisionIndex.insertCollisionCircles(dr.circles,se,_.get("text-ignore-placement"),d.bucketInstanceId,Ms,W.ID),u&&this.storeCollisionData(d.bucketInstanceId,Ot,Mt,Hn,ei,dr),ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ot.crossTileID]=new Xd((vn||je)&&!(Hn!=null&&Hn.occluded),(_r||He)&&!(ei!=null&&ei.occluded),Jn||d.justReloaded),i[ot.crossTileID]=!0};if(Be){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ot=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Mt=ot.length-1;Mt>=0;--Mt){const Ot=ot[Mt];mt(d.symbolInstances.get(Ot),d.collisionArrays[Ot],Ot)}}else for(let ot=e.symbolInstanceStart;ot<e.symbolInstanceEnd;ot++)mt(d.symbolInstances.get(ot),d.collisionArrays[ot],ot);d.justReloaded=!1}storeCollisionData(e,i,u,d,_,w){if(u.textBox||u.iconBox){let P,M;this.collisionBoxArrays.has(e)?P=this.collisionBoxArrays.get(e):(P=new Map,this.collisionBoxArrays.set(e,P)),P.has(i)?M=P.get(i):(M={text:null,icon:null},P.set(i,M)),u.textBox&&(M.text=d.box),u.iconBox&&(M.icon=_.box)}if(w){let P=this.collisionCircleArrays[e];P===void 0&&(P=this.collisionCircleArrays[e]=[]);for(let M=0;M<w.circles.length;M+=4)P.push(w.circles[M+0]-ur),P.push(w.circles[M+1]-ur),P.push(w.circles[M+2]),P.push(w.collisionDetected?1:0)}}markUsedJustification(e,i,u,d){let _;_=d===l.ag.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.az(i)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const P of w)P>=0&&(e.text.placedSymbolArray.get(P).crossTileID=_>=0&&P!==_?0:u.crossTileID)}markUsedOrientation(e,i,u){const d=i===l.ag.horizontal||i===l.ag.horizontalOnly?i:0,_=i===l.ag.vertical?i:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const P of w)e.text.placedSymbolArray.get(P).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let u=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const d=i?i.symbolFadeChange(e):1,_=i?i.opacities:{},w=i?i.variableOffsets:{},P=i?i.placedOrientations:{};for(const M in this.placements){const k=this.placements[M],D=_[M];D?(this.opacities[M]=new ir(D,d,k.text,k.icon),u=u||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[M]=new ir(null,d,k.text,k.icon,k.skipFade),u=u||k.text||k.icon)}for(const M in _){const k=_[M];if(!this.opacities[M]){const D=new ir(k,d,!1,!1);D.isHidden()||(this.opacities[M]=D,u=u||k.text.placed||k.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in P)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=P[M]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const u={};for(const d of i){const _=d.getBucket(e);_&&d.latestFeatureIndex&&e.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,i,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const _=e.layers[0],w=_.layout,P=new ir(null,0,!1,!1,!0),M=w.get("text-allow-overlap"),k=w.get("icon-allow-overlap"),D=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=w.get("text-rotation-alignment")==="map",B=w.get("text-pitch-alignment")==="map",G=w.get("icon-text-fit")!=="none",W=new ir(null,0,M&&(k||!e.hasIconData()||w.get("icon-optional")),k&&(M||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const ie=(se,ue,me)=>{for(let ge=0;ge<ue/4;ge++)se.opacityVertexArray.emplaceBack(me);se.hasVisibleVertices=se.hasVisibleVertices||me!==sl},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){const ue=e.symbolInstances.get(se),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:ge,crossTileID:be}=ue;let Pe=this.opacities[be];u[be]?Pe=P:Pe||(Pe=W,this.opacities[be]=Pe),u[be]=!0;const Se=ue.numIconVertices>0,Be=this.placedOrientations[ue.crossTileID],je=Be===l.ag.vertical,He=Be===l.ag.horizontal||Be===l.ag.horizontalOnly;if(me>0||ge>0){const Ze=Eh(Pe.text);ie(e.text,me,je?sl:Ze),ie(e.text,ge,He?sl:Ze);const tt=Pe.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(Mt=>{Mt>=0&&(e.text.placedSymbolArray.get(Mt).hidden=tt||je?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=tt||He?1:0);const mt=this.variableOffsets[ue.crossTileID];mt&&this.markUsedJustification(e,mt.anchor,ue,Be);const ot=this.placedOrientations[ue.crossTileID];ot&&(this.markUsedJustification(e,"left",ue,ot),this.markUsedOrientation(e,ot,ue))}if(Se){const Ze=Eh(Pe.icon),tt=!(G&&ue.verticalPlacedIconSymbolIndex&&je);ue.placedIconSymbolIndex>=0&&(ie(e.icon,ue.numIconVertices,tt?Ze:sl),e.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(ie(e.icon,ue.numVerticalIconVertices,tt?sl:Ze),e.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const Ye=re&&re.has(se)?re.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ze=e.collisionArrays[se];if(Ze){let tt=new l.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let mt=!0;if(D){const ot=this.variableOffsets[be];ot?(tt=Ws(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),O&&tt._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):mt=!1}if(Ze.textBox||Ze.verticalTextBox){let ot;Ze.textBox&&(ot=je),Ze.verticalTextBox&&(ot=He),Ch(e.textCollisionBox.collisionVertexArray,Pe.text.placed,!mt||ot,Ye.text,tt.x,tt.y)}}if(Ze.iconBox||Ze.verticalIconBox){const mt=!!(!He&&Ze.verticalIconBox);let ot;Ze.iconBox&&(ot=mt),Ze.verticalIconBox&&(ot=!mt),Ch(e.iconCollisionBox.collisionVertexArray,Pe.icon.placed,ot,Ye.icon,G?tt.x:0,G?tt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const u=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Ch(g,e,i,u,d,_){u&&u.length!==0||(u=[0,0,0,0]);const w=u[0]-ur,P=u[1]-ur,M=u[2]-ur,k=u[3]-ur;g.emplaceBack(e?1:0,i?1:0,d||0,_||0,w,P),g.emplaceBack(e?1:0,i?1:0,d||0,_||0,M,P),g.emplaceBack(e?1:0,i?1:0,d||0,_||0,M,k),g.emplaceBack(e?1:0,i?1:0,d||0,_||0,w,k)}const Kd=Math.pow(2,25),Yd=Math.pow(2,24),Ta=Math.pow(2,17),Ph=Math.pow(2,16),Jd=Math.pow(2,9),Pp=Math.pow(2,8),Ep=Math.pow(2,1);function Eh(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,i=Math.floor(127*g.opacity);return i*Kd+e*Yd+i*Ta+e*Ph+i*Jd+e*Pp+i*Ep+e}const sl=0;class nu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,u,d,_){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(w,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((P,M)=>P.sortKey-M.sortKey));this._currentPartIndex<w.length;)if(i.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,_())return!0;return!1}}class ru{constructor(e,i,u,d,_,w,P,M){this.placement=new xs(e,i,w,P,M),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(e,i,u){const d=oe.now(),_=()=>!this._forceFullPlacement&&oe.now()-d>2;for(;this._currentPlacementIndex>=0;){const w=i[e[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=P)&&(!w.maxzoom||w.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new nu(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ca=512/l.Z/2;class $l{constructor(e,i,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let _=0;_<i.length;_++){const w=i.get(_),P=w.key,M=d.get(P);M?M.push(w):d.set(P,[w])}for(const[_,w]of d){const P={positions:w.map(M=>({x:Math.floor(M.anchorX*Ca),y:Math.floor(M.anchorY*Ca)})),crossTileIDs:w.map(M=>M.crossTileID)};if(P.positions.length>128){const M=new l.aB(P.positions.length,16,Uint16Array);for(const{x:k,y:D}of P.positions)M.add(k,D);M.finish(),delete P.positions,P.index=M}this._symbolsByKey[_]=P}}getScaledCoordinates(e,i){const{x:u,y:d,z:_}=this.tileID.canonical,{x:w,y:P,z:M}=i.canonical,k=Ca/Math.pow(2,M-_),D=(P*l.Z+e.anchorY)*k,O=d*l.Z*Ca;return{x:Math.floor((w*l.Z+e.anchorX)*k-u*l.Z*Ca),y:Math.floor(D-O)}}findMatches(e,i,u){const d=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let _=0;_<e.length;_++){const w=e.get(_);if(w.crossTileID)continue;const P=this._symbolsByKey[w.key];if(!P)continue;const M=this.getScaledCoordinates(w,i);if(P.index){const k=P.index.range(M.x-d,M.y-d,M.x+d,M.y+d).sort();for(const D of k){const O=P.crossTileIDs[D];if(!u[O]){u[O]=!0,w.crossTileID=O;break}}}else if(P.positions)for(let k=0;k<P.positions.length;k++){const D=P.positions[k],O=P.crossTileIDs[k];if(Math.abs(D.x-M.x)<=d&&Math.abs(D.y-M.y)<=d&&!u[O]){u[O]=!0,w.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Mh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const u in this.indexes){const d=this.indexes[u],_={};for(const w in d){const P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+i),_[P.tileID.key]=P}this.indexes[u]=_}this.lng=e}addBucket(e,i,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let _=0;_<i.symbolInstances.length;_++)i.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>e.overscaledZ)for(const P in w){const M=w[P];M.tileID.isChildOf(e)&&M.findMatches(i.symbolInstances,e,d)}else{const P=w[e.scaledTo(Number(_)).key];P&&P.findMatches(i.symbolInstances,e,d)}}for(let _=0;_<i.symbolInstances.length;_++){const w=i.symbolInstances.get(_);w.crossTileID||(w.crossTileID=u.generate(),d[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new $l(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const u of i.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let i=!1;for(const u in this.indexes){const d=this.indexes[u];for(const _ in d)e[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[_]),delete d[_],i=!0)}return i}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new Mh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Zl);let _=!1;const w={};d.handleWrapJump(u);for(const P of i){const M=P.getBucket(e);M&&e.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(P.tileID,M,this.crossTileIDs)&&(_=!0),w[M.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(_=!0),_}pruneUnusedLayers(e){const i={};e.forEach(u=>{i[u]=!0});for(const u in this.layerIndexes)i[u]||delete this.layerIndexes[u]}}var Hs="void main() {fragColor=vec4(1.0);}";const zo={prelude:Mn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Mn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Mn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Mn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Mn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mn(Hs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Mn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Mn(Hs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Mn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Mn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Mn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Mn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Mn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Mn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Mn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Mn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Mn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Mn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Mn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Mn(g,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=_?_.concat(d):d,P={};return{fragmentSource:g=g.replace(i,(M,k,D,O,B)=>(P[B]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${D} ${O} ${B};
#else
uniform ${D} ${O} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${D} ${O} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(i,(M,k,D,O,B)=>{const G=O==="float"?"vec2":"vec4",W=B.match(/color/)?"color":G;return P[B]?k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${D} ${G} a_${B};
out ${D} ${O} ${B};
#else
uniform ${D} ${O} u_${B};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${D} ${O} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${W}(a_${B}, u_${B}_t);
#else
    ${D} ${O} ${B} = u_${B};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${D} ${G} a_${B};
#else
uniform ${D} ${O} u_${B};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${O} ${B} = a_${B};
#else
    ${D} ${O} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${O} ${B} = unpack_mix_${W}(a_${B}, u_${B}_t);
#else
    ${D} ${O} ${B} = u_${B};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Vi{constructor(e,i,u){this.vertexBuffer=e,this.indexBuffer=i,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var $i=l.aC([{name:"a_pos",type:"Int16",components:2}]);const An="#define PROJECTION_MERCATOR",Gl="mercator";class ql{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Gl}get shaderDefine(){return An}get shaderPreludeCode(){return zo.projectionMercator}get vertexShaderPreludeCode(){return zo.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aD.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,u,d,_){if(this._cachedMesh)return this._cachedMesh;const w=new l.aE;w.emplaceBack(0,0),w.emplaceBack(l.Z,0),w.emplaceBack(0,l.Z),w.emplaceBack(l.Z,l.Z);const P=e.createVertexBuffer(w,$i.members),M=l.aF.simpleSegment(0,0,4,2),k=new l.aG;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);const D=e.createIndexBuffer(k);return this._cachedMesh=new Vi(P,D,M),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function Zi(g,e){const i=l.ad(e.lat,-85.051129,l.aI);return new l.P(l.U(e.lng)*g,l.S(i)*g)}function Ir(g,e){return new l.$(e.x/g,e.y/g).toLngLat()}function Yr(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(l.ac(90-g.pitch)),Math.tan(l.ac(89.25-g.pitch)))}function br(g,e){const i=g.canonical,u=e/l.aH(i.z),d=i.x+Math.pow(2,i.z)*g.wrap,_=l.as(new Float64Array(16));return l.L(_,_,[d*u,i.y*u,0]),l.M(_,_,[u/l.Z,u/l.Z,1]),_}function Ih(g,e,i,u,d){const _=l.$.fromLngLat(g,e),w=d*l.aJ(1,g.lat),P=w*Math.cos(l.ac(i)),M=Math.sqrt(w*w-P*P),k=M*Math.sin(l.ac(-u)),D=M*Math.cos(l.ac(-u));return new l.$(_.x+k,_.y+D,_.z+P)}class Jr{constructor(e=0,i=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=u,this.right=d}interpolate(e,i,u){return i.top!=null&&e.top!=null&&(this.top=l.B.number(e.top,i.top,u)),i.bottom!=null&&e.bottom!=null&&(this.bottom=l.B.number(e.bottom,i.bottom,u)),i.left!=null&&e.left!=null&&(this.left=l.B.number(e.left,i.left,u)),i.right!=null&&e.right!=null&&(this.right=l.B.number(e.right,i.right,u)),this}getCenter(e,i){const u=l.ad((this.left+e-this.right)/2,0,e),d=l.ad((this.top+i-this.bottom)/2,0,i);return new l.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ti(g,e){if(!g.renderWorldCopies||g.lngRange)return;const i=e.lng-g.center.lng;e.lng+=i>180?-360:i<-180?360:0}function Ii(g){return Math.max(0,Math.floor(g))}class Wl{constructor(e,i,u,d,_,w){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=d??0,this._maxPitch=_??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ii(this._zoom),this._scale=l.aH(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Jr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ii(this._zoom),this._scale=l.aH(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Jr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=l.aK(e,-180,180)*Math.PI/180;var u,d,_,w,P,M,k,D,O;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=$(),u=this._rotationMatrix,_=-this._bearingInRadians,w=(d=this._rotationMatrix)[0],P=d[1],M=d[2],k=d[3],D=Math.sin(_),O=Math.cos(_),u[0]=w*O+M*D,u[1]=P*O+k*D,u[2]=w*-D+M*O,u[3]=P*-D+k*O)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=l.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aL(this._fovInRadians)}setFov(e){e=l.ad(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ac(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=l.aH(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,u){this._unmodified=!1,this._edgeInsets.interpolate(e,i,u),this._constrain(),this._calcMatrices()}resize(e,i,u=!0){this._width=e,this._height=i,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,l.aI])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let u=e.x,d=e.y,_=e.x,w=e.y;for(const P of i)u=Math.min(u,P.x),d=Math.min(d,P.y),_=Math.max(_,P.x),w=Math.max(w,P.y);return[new l.P(u,d),new l.P(_,d),new l.P(_,w),new l.P(u,w),new l.P(u,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.as(new Float64Array(16));l.M(e,e,[this._width/2,-this._height/2,1]),l.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.as(new Float64Array(16)),l.M(e,e,[1,-1,1]),l.L(e,e,[-1,-1,0]),l.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,u,d){const _=u!==void 0?u:this.bearing,w=d=d!==void 0?d:this.pitch,P=l.$.fromLngLat(e,i),M=-Math.cos(l.ac(w)),k=Math.sin(l.ac(w)),D=k*Math.sin(l.ac(_)),O=-k*Math.cos(l.ac(_));let B=this.elevation;const G=i-B;let W;M*G>=0||Math.abs(M)<.1?(W=1e4,B=i+W*M):W=-G/M;let ie,re,se=l.aM(1,P.y),ue=0;do{if(ue+=1,ue>10)break;re=W/se,ie=new l.$(P.x+D*re,P.y+O*re),se=1/ie.meterInMercatorCoordinateUnits()}while(Math.abs(W-re*se)>1e-12);return{center:ie.toLngLat(),elevation:B,zoom:l.aa(this.height/2/Math.tan(this.fovInRadians/2)/re/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=l.aJ(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/i,d=l.$.fromLngLat(this.center,this.elevation),_=Ih(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const w=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),l.aM(_.z,d.y),this.bearing,this.pitch);this._elevation=w.elevation,this._center=w.center,this.setZoom(w.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.aJ(1,this.center.lat)*this.worldSize;return Ih(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/l.Z,1/i/l.Z]}}class Ro{constructor(e,i){this.min=e,this.max=i,this.center=l.aN([],l.aO([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=l.aP(this.min),d=l.aP(this.max);for(let _=0;_<i.length;_++)u[_]=i[_]?this.min[_]:this.center[_],d[_]=i[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Ro(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let u=0;u<e.planes.length;u++){const d=this.intersectsPlane(e.planes[u]);if(d===0)return 0;d===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],u=e[3];for(let d=0;d<3;d++)e[d]>0?(i+=e[d]*this.min[d],u+=e[d]*this.max[d]):(u+=e[d]*this.min[d],i+=e[d]*this.max[d]);return i>=0?2:u<0?0:1}}class Ur{distanceToTile2d(e,i,u,d){const _=d.distanceX([e,i]),w=d.distanceY([e,i]);return Math.hypot(_,w)}getWrap(e,i,u){return u}getTileAABB(e,i,u,d){var _,w;let P=u,M=u;if(d.terrain){const D=new l.Y(e.z,i,e.z,e.x,e.y),O=d.terrain.getMinMaxElevation(D);P=(_=O.minElevation)!==null&&_!==void 0?_:u,M=(w=O.maxElevation)!==null&&w!==void 0?w:u}const k=1<<e.z;return new Ro([i+e.x/k,e.y/k,P],[i+(e.x+1)/k,(e.y+1)/k,M])}allowVariableZoom(e,i){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=l.ad(78.5-u/2,0,60);return!!i.terrain||e.pitch>d}allowWorldCopies(){return!0}recalculateCache(){}}class Xs{constructor(e,i,u){this.points=e,this.planes=i,this.aabb=u}static fromInvProjectionMatrix(e,i=1,u=0){const d=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const D=1/(k=l.ao([],k,e))[3]/i*d;return l.aQ(k,k,[D,D,1/k[3],D])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const D=l.aR([],_[k[0]],_[k[1]]),O=l.aR([],_[k[2]],_[k[1]]),B=l.aS([],l.aT([],D,O)),G=-l.aU(B,_[k[1]]);return B.concat(G)}),P=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],M=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const k of _)for(let D=0;D<3;D++)P[D]=Math.min(P[D],k[D]),M[D]=Math.max(M[D],k[D]);return new Xs(_,w,new Ro(P,M))}}class ro{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,u,d,_){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Wl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(w,P)=>this.getConstrained(w,P)},e,i,u,d,_),this._coveringTilesDetailsProvider=new Ur}clone(){const e=new ro;return e.apply(this),e}apply(e,i,u){this._helper.apply(e,i,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new l.aV(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new l.P(0,0)),d=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),P=Math.floor(Math.min(u.x,d.x,_.x,w.x)),M=Math.floor(Math.max(u.x,d.x,_.x,w.x)),k=1;for(let D=P-k;D<=M+k;D++)D!==0&&i.push(new l.aV(D,e))}return i}getCameraFrustum(){return Xs.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,i){const u=l.aJ(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(i,u),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),w=l.$.fromLngLat(e),P=new l.$(w.x-(d.x-_.x),w.y-(d.y-_.y));this.setCenter(P==null?void 0:P.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(l.$.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.$.fromLngLat(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const u=i||0,d=[e.x,e.y,0,1],_=[e.x,e.y,1,1];l.ao(d,d,this._pixelMatrixInverse),l.ao(_,_,this._pixelMatrixInverse);const w=d[3],P=_[3],M=d[1]/w,k=_[1]/P,D=d[2]/w,O=_[2]/P,B=D===O?0:(u-D)/(O-D);return new l.$(l.B.number(d[0]/w,_[0]/P,B)/this.worldSize,l.B.number(M,k,B)/this.worldSize,u)}coordinatePoint(e,i=0,u=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,i,1];return l.ao(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Yr(this));return new qt().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-Yr(this)}calculatePosMatrix(e,i=!1,u){var d;const _=(d=e.key)!==null&&d!==void 0?d:l.aW(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),w=i?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(_)){const k=w.get(_);return u?k.f32:k.f64}const P=br(e,this.worldSize);l.N(P,i?this._alignedProjMatrix:this._viewProjMatrix,P);const M={f64:P,f32:new Float32Array(P)};return w.set(_,M),u?M.f32:M.f64}calculateFogMatrix(e){const i=e.key,u=this._fogMatrixCacheF32;if(u.has(i))return u.get(i);const d=br(e,this.worldSize);return l.N(d,this._fogMatrix,d),u.set(i,new Float32Array(d)),u.get(i)}getConstrained(e,i){i=l.ad(+i,this.minZoom,this.maxZoom);const u={center:new l.Q(e.lng,e.lat),zoom:i};let d=this._helper._lngRange;this._helper._renderWorldCopies||d!==null||(d=[-179.9999999999,180-1e-10]);const _=this.tileSize*l.aH(u.zoom);let w=0,P=_,M=0,k=_,D=0,O=0;const{x:B,y:G}=this.size;if(this._helper._latRange){const me=this._helper._latRange;w=l.S(me[1])*_,P=l.S(me[0])*_,P-w<G&&(D=G/(P-w))}d&&(M=l.aK(l.U(d[0])*_,0,_),k=l.aK(l.U(d[1])*_,0,_),k<M&&(k+=_),k-M<B&&(O=B/(k-M)));const{x:W,y:ie}=Zi(_,e);let re,se;const ue=Math.max(O||0,D||0);if(ue){const me=new l.P(O?(k+M)/2:W,D?(P+w)/2:ie);return u.center=Ir(_,me).wrap(),u.zoom+=l.aa(ue),u}if(this._helper._latRange){const me=G/2;ie-me<w&&(se=w+me),ie+me>P&&(se=P-me)}if(d){const me=(M+k)/2;let ge=W;this._helper._renderWorldCopies&&(ge=l.aK(W,me-_/2,me+_/2));const be=B/2;ge-be<M&&(re=M+be),ge+be>k&&(re=k-be)}if(re!==void 0||se!==void 0){const me=new l.P(re??W,se??ie);u.center=Ir(_,me).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,i,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,d)}_calculateNearFarZIfNeeded(e,i,u){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=e-d*this._helper._pixelPerMeter/Math.cos(i),w=d<0?_:e,P=Math.PI/2+this.pitchInRadians,M=l.ac(this.fov)*(Math.abs(Math.cos(l.ac(this.roll)))*this.height+Math.abs(Math.sin(l.ac(this.roll)))*this.width)/this.height*(.5+u.y/this.height),k=Math.sin(M)*w/Math.sin(l.ad(Math.PI-P-M,.01,Math.PI-.01)),D=Yr(this),O=Math.atan(D/this._helper.cameraToCenterDistance),B=l.ac(.75),G=O>B?2*O*(.5+u.y/(2*D)):B,W=Math.sin(G)*w/Math.sin(l.ad(Math.PI-P-G,.01,Math.PI-.01)),ie=Math.min(k,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*ie+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Zi(this.worldSize,this.center),u=i.x,d=i.y;this._helper._pixelPerMeter=l.aJ(1,this.center.lat)*this.worldSize;const _=l.ac(Math.min(this.pitch,89.25)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let P;this._calculateNearFarZIfNeeded(w,_,e),P=new Float64Array(16),l.aX(P,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.ai(this._invProjMatrix,P),P[8]=2*-e.x/this._helper._width,P[9]=2*e.y/this._helper._height,this._projectionMatrix=l.aY(P),l.M(P,P,[1,-1,1]),l.L(P,P,[0,0,-this._helper.cameraToCenterDistance]),l.aZ(P,P,-this.rollInRadians),l.a_(P,P,this.pitchInRadians),l.aZ(P,P,-this.bearingInRadians),l.L(P,P,[-u,-d,0]),this._mercatorMatrix=l.M([],P,[this.worldSize,this.worldSize,this.worldSize]),l.M(P,P,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,P),l.L(P,P,[0,0,-this.elevation]),this._viewProjMatrix=P,this._invViewProjMatrix=l.ai([],P);const M=[0,0,-1,1];l.ao(M,M,this._invViewProjMatrix),this._cameraPosition=[M[0]/M[3],M[1]/M[3],M[2]/M[3]],this._fogMatrix=new Float64Array(16),l.aX(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.aZ(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.a_(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.aZ(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.L(this._fogMatrix,this._fogMatrix,[-u,-d,0]),l.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,P);const k=this._helper._width%2/2,D=this._helper._height%2/2,O=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),G=u-Math.round(u)+O*k+B*D,W=d-Math.round(d)+O*D+B*k,ie=new Float64Array(P);if(l.L(ie,ie,[G>.5?G-1:G,W>.5?W-1:W,0]),this._alignedProjMatrix=ie,P=l.ai(new Float64Array(16),this._pixelMatrix),!P)throw new Error("failed to invert matrix");this._pixelMatrixInverse=P,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.ao(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.aJ(1,this.center.lat)*this.worldSize;return Ih(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const u=l.$.fromLngLat(e),d=[u.x*this.worldSize,u.y*this.worldSize,i,1];return l.ao(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:i,aligned:u,applyTerrainMatrix:d}=e,_=this._helper.getMercatorTileCoordinates(i),w=i?this.calculatePosMatrix(i,u,!0):null;let P;return P=i&&i.terrainRttPosMatrix32f&&d?i.terrainRttPosMatrix32f:w||l.a$(),{mainMatrix:P,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:P}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,u){return 1}transformLightDirection(e){return l.aP(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,u,d){const _=this.calculatePosMatrix(u);let w;d?(w=[e,i,d(e,i),1],l.ao(w,w,_)):(w=[e,i,0,1],jr(w,w,_));const P=w[3];return{point:new l.P(w[0]/P,w[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const u=l.$.fromLngLat(e,i),d=u.meterInMercatorCoordinateUnits(),_=l.b0();return l.L(_,_,[u.x,u.y,u.z]),l.aZ(_,_,Math.PI),l.a_(_,_,Math.PI/2),l.M(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const i=new l.Y(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),d=br(i,this.worldSize);l.N(d,this._viewProjMatrix,d),u.tileMercatorCoords=[0,0,1,1];const _=[l.Z,l.Z,this.worldSize/this._helper.pixelsPerMeter],w=l.b1();return l.M(w,d,_),u.fallbackMatrix=w,u.mainMatrix=w,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Hl(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function xo(g){if(g.useSlerp)if(g.k<1){const e=l.b2(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),i=l.b2(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),u=new Float64Array(4);l.b3(u,e,i,g.k);const d=l.b4(u);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(l.B.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(l.B.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(l.B.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function kh(g,e,i,u,d){const _=d.padding,w=Zi(d.worldSize,i.getNorthWest()),P=Zi(d.worldSize,i.getNorthEast()),M=Zi(d.worldSize,i.getSouthEast()),k=Zi(d.worldSize,i.getSouthWest()),D=l.ac(-u),O=w.rotate(D),B=P.rotate(D),G=M.rotate(D),W=k.rotate(D),ie=new l.P(Math.max(O.x,B.x,W.x,G.x),Math.max(O.y,B.y,W.y,G.y)),re=new l.P(Math.min(O.x,B.x,W.x,G.x),Math.min(O.y,B.y,W.y,G.y)),se=ie.sub(re),ue=(d.width-(_.left+_.right+e.left+e.right))/se.x,me=(d.height-(_.top+_.bottom+e.top+e.bottom))/se.y;if(me<0||ue<0)return void Hl();const ge=Math.min(l.aa(d.scale*Math.min(ue,me)),g.maxZoom),be=l.P.convert(g.offset),Pe=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ac(u)),Se=be.add(Pe).mult(d.scale/l.aH(ge));return{center:Ir(d.worldSize,w.add(M).div(2).sub(Se)),zoom:ge,bearing:u}}class Do{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,u){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,i,u,d,_){return kh(e,i,u,d,_)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(l.Q.convert(i.center))}handleEaseTo(e,i){const u=e.zoom,d=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},P=i.zoom!==void 0,M=!e.isPaddingEqual(i.padding);let k=!1;const D=P?+i.zoom:e.zoom;let O=e.centerPoint.add(i.offsetAsPoint);const B=e.screenPointToLocation(O),{center:G,zoom:W}=e.getConstrained(l.Q.convert(i.center||B),D??u);Ti(e,G);const ie=Zi(e.worldSize,B),re=Zi(e.worldSize,G).sub(ie),se=l.aH(W-u);return k=W!==u,{easeFunc:ue=>{if(k&&e.setZoom(l.B.number(u,W,ue)),l.b5(_,w)||xo({startEulerAngles:_,endEulerAngles:w,tr:e,k:ue,useSlerp:_.roll!=w.roll}),M&&(e.interpolatePadding(d,i.padding,ue),O=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const me=l.aH(e.zoom-u),ge=W>u?Math.min(2,se):Math.max(.5,se),be=Math.pow(ge,1-ue),Pe=Ir(e.worldSize,ie.add(re.mult(ue*be)).mult(me));e.setLocationAtPoint(e.renderWorldCopies?Pe.wrap():Pe,O)}},isZooming:k,elevationCenter:G}}handleFlyTo(e,i){const u=i.zoom!==void 0,d=e.zoom,_=e.getConstrained(l.Q.convert(i.center||i.locationAtOffset),u?+i.zoom:d),w=_.center,P=_.zoom;Ti(e,w);const M=Zi(e.worldSize,i.locationAtOffset),k=Zi(e.worldSize,w).sub(M),D=k.mag(),O=l.aH(P-d);let B;if(i.minZoom!==void 0){const G=Math.min(+i.minZoom,d,P),W=e.getConstrained(w,G).zoom;B=l.aH(W-d)}return{easeFunc:(G,W,ie,re)=>{e.setZoom(G===1?P:d+l.aa(W));const se=G===1?w:Ir(e.worldSize,M.add(k.mult(ie)).mult(W));e.setLocationAtPoint(e.renderWorldCopies?se.wrap():se,re)},scaleOfZoom:O,targetCenter:w,scaleOfMinZoom:B,pixelPathLength:D}}}class sr{constructor(e,i,u){this.blendFunction=e,this.blendColor=i,this.mask=u}}sr.Replace=[1,0],sr.disabled=new sr(sr.Replace,l.b6.transparent,[!1,!1,!1,!1]),sr.unblended=new sr(sr.Replace,l.b6.transparent,[!0,!0,!0,!0]),sr.alphaBlended=new sr([1,771],l.b6.transparent,[!0,!0,!0,!0]);const iu=2305;class Sn{constructor(e,i,u){this.enable=e,this.mode=i,this.frontFace=u}}Sn.disabled=new Sn(!1,1029,iu),Sn.backCCW=new Sn(!0,1029,iu),Sn.frontCCW=new Sn(!0,1028,iu);class cn{constructor(e,i,u){this.func=e,this.mask=i,this.range=u}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const ll=7680;class In{constructor(e,i,u,d,_,w){this.test=e,this.ref=i,this.mask=u,this.fail=d,this.depthFail=_,this.pass=w}}In.disabled=new In({func:519,mask:0},0,0,ll,ll,ll);const Yn=new WeakMap;function Tn(g){var e;if(Yn.has(g))return Yn.get(g);{const i=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Yn.set(g,i),i}}class Xl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,u=i.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const d=new l.aE;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new l.aG;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Vi(i.createVertexBuffer(d,$i.members),i.createIndexBuffer(_),l.aF.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(u.TEXTURE1);const w=u.createTexture();u.bindTexture(u.TEXTURE_2D,w),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Tn(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const u=this._cachedRenderContext.context,d=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:l.b6.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,d.TRIANGLES,cn.disabled,In.disabled,sr.unblended,Sn.disabled,((_,w)=>({u_input:_,u_output_expected:w}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Tn(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Tn(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const ou=l.Z/128;function Kl(g,e){const i=g.granularity!==void 0?Math.max(g.granularity,1):1,u=i+(g.generateBorders?2:0),d=i+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=u+1,w=d+1,P=g.generateBorders?-1:0,M=g.generateBorders||g.extendToNorthPole?-1:0,k=i+(g.generateBorders?1:0),D=i+(g.generateBorders||g.extendToSouthPole?1:0),O=_*w,B=u*d*6,G=_*w>65536;if(G&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=G||e==="32bit",ie=new Int16Array(2*O);let re=0;for(let me=M;me<=D;me++)for(let ge=P;ge<=k;ge++){let be=ge/i*l.Z;ge===-1&&(be=-64),ge===i+1&&(be=l.Z+ou);let Pe=me/i*l.Z;me===-1&&(Pe=g.extendToNorthPole?l.b8:-64),me===i+1&&(Pe=g.extendToSouthPole?l.b9:l.Z+ou),ie[re++]=be,ie[re++]=Pe}const se=W?new Uint32Array(B):new Uint16Array(B);let ue=0;for(let me=0;me<d;me++)for(let ge=0;ge<u;ge++){const be=ge+1+me*_,Pe=ge+(me+1)*_,Se=ge+1+(me+1)*_;se[ue++]=ge+me*_,se[ue++]=Pe,se[ue++]=be,se[ue++]=be,se[ue++]=Pe,se[ue++]=Se}return{vertices:ie.buffer.slice(0),indices:se.buffer.slice(0),uses32bitIndices:W}}const cl=new l.aD({fill:new l.ba(128,2),line:new l.ba(512,0),tile:new l.ba(128,32),stencil:new l.ba(128,1),circle:3});class ul{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zo.projectionGlobe}get vertexShaderPreludeCode(){return zo.projectionMercator.vertexSource}get subdivisionGranularity(){return cl}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Xl(e));const i=l.S(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(i,u),_=oe.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const w=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bb(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bc(w))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,u,d,_){const w=(_==="stencil"?cl.stencil:cl.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:w,generateBorders:u,extendToNorthPole:i.y===0&&d,extendToSouthPole:i.y===(1<<i.z)-1&&d})}_getMesh(e,i){const u=this._getMeshKey(i);if(u in this._tileMeshCache)return this._tileMeshCache[u];const d=function(_,w){const P=Kl(w,"16bit"),M=l.aE.deserialize({arrayBuffer:P.vertices,length:P.vertices.byteLength/2/2}),k=l.aG.deserialize({arrayBuffer:P.indices,length:P.indices.byteLength/2/3});return new Vi(_.createVertexBuffer(M,$i.members),_.createIndexBuffer(k),l.aF.simpleSegment(0,0,M.length,k.length))}(e,i);return this._tileMeshCache[u]=d,d}recalculate(e){}hasTransition(){const e=oe.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Mp=new l.r({type:new l.D(l.v.projection.type)});class Yl extends l.E{constructor(e){super(),this._transitionable=new l.T(Mp),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.C(0)),this._mercatorProjection=new ql,this._verticalPerspectiveProjection=new ul}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bd){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,u,d,_){return this.currentProjection.getMeshFromTileID(e,i,u,d,_)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ah(g){const e=kr(g.worldSize,g.center.lat);return 2*Math.PI*e}function Dr(g,e,i,u,d){const _=1/(1<<d),w=e/l.Z*_+u*_,P=l.bf((g/l.Z*_+i*_)*Math.PI*2+Math.PI,2*Math.PI),M=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,k=Math.cos(M),D=new Float64Array(3);return D[0]=Math.sin(P)*k,D[1]=Math.sin(M),D[2]=Math.cos(P)*k,D}function ci(g){return function(e,i){const u=Math.cos(i),d=new Float64Array(3);return d[0]=Math.sin(e)*u,d[1]=Math.sin(i),d[2]=Math.cos(e)*u,d}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function kr(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Jl(g){const e=Math.asin(g[1])/Math.PI*180,i=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(i>1e-6){const u=g[0]/i,d=Math.acos(g[2]/i),_=(u>0?d:-d)/Math.PI*180;return new l.Q(l.aK(_,-180,180),e)}return new l.Q(0,e)}function ki(g){return Math.cos(g*Math.PI/180)}function $n(g,e){const i=ki(g),u=ki(e);return l.aa(u/i)}function su(g,e){const i=g.rotate(e.bearingInRadians),u=e.zoom+$n(e.center.lat,0),d=l.bb(1/ki(e.center.lat),1/ki(Math.min(Math.abs(e.center.lat),60)),l.be(u,7,3,0,1)),_=360/Ah({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.Q(e.center.lng-i.x*_*d,l.ad(e.center.lat+i.y*_,-85.051129,l.aI))}function Ql(g){const e=.5*g,i=Math.sin(e),u=Math.cos(e);return Math.log(i+u)-Math.log(u-i)}function Ks(g,e,i,u){const d=g.lat+i*u;if(Math.abs(i)>1){const _=(Math.sign(g.lat+i)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,w=Math.abs(g.lat+i)*Math.PI/180,P=Ql(_+u*(w-_)),M=Ql(_),k=Ql(w);return new l.Q(g.lng+e*((P-M)/(k-M)),d)}return new l.Q(g.lng+e*u,d)}class Qd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,u,d){const _=`${e.z}_${e.x}_${e.y}`,w=this._cache.get(_);if(w)return w;const P=this._cachePrevious.get(_);if(P)return this._cache.set(_,P),P;const M=this._aabbFactory(e,i,u,d);return this._cache.set(_,M),this._hadAnyChanges=!0,M}}function ec(g,e,i){const u=g-e;return u<0?-u:Math.max(0,u-i)}function au(g,e,i,u,d){const _=g-i;let w;return w=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(w,ec(e,u,d))}class io{constructor(){this._aabbCache=new Qd(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,u,d){const _=1<<u.z,w=1/_,P=u.x/_,M=u.y/_;let k=2;return k=Math.min(k,au(e,i,P,M,w)),k=Math.min(k,au(e,i,P+.5,-M-w,w)),k=Math.min(k,au(e,i,P+.5,2-M-w,w)),k}getWrap(e,i,u){const d=1<<i.z,_=1/d,w=i.x/d,P=ec(e.x,w,_),M=ec(e.x,w-1,_),k=ec(e.x,w+1,_),D=Math.min(P,M,k);return D===k?1:D===M?-1:0}allowVariableZoom(e,i){return ji(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,u,d){return this._aabbCache.getTileAABB(e,i,u,d)}_computeTileAABB(e,i,u,d){if(e.z<=0)return new Ro([-1,-1,-1],[1,1,1]);if(e.z===1)return new Ro([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const _=[Dr(0,0,e.x,e.y,e.z),Dr(l.Z,0,e.x,e.y,e.z),Dr(l.Z,l.Z,e.x,e.y,e.z),Dr(0,l.Z,e.x,e.y,e.z)],w=[1,1,1],P=[-1,-1,-1];for(const M of _)for(let k=0;k<3;k++)w[k]=Math.min(w[k],M[k]),P[k]=Math.max(P[k],M[k]);if(e.y===0||e.y===(1<<e.z)-1){const M=[0,e.y===0?1:-1,0];for(let k=0;k<3;k++)w[k]=Math.min(w[k],M[k]),P[k]=Math.max(P[k],M[k])}return new Ro(w,P)}}}class lu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bg(),this._projectionMatrix=l.b0(),this._globeViewProjMatrix32f=l.a$(),this._globeViewProjMatrixNoCorrection=l.b0(),this._globeViewProjMatrixNoCorrectionInverted=l.b0(),this._globeProjMatrixInverted=l.b0(),this._cameraPosition=l.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Wl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new io}clone(){const e=new lu;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:u}=e,d=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,u=this.cameraToCenterDistance/e,d=Math.sin(i)*u,_=Math.cos(i)*u+1,w=1/Math.sqrt(d*d+_*_)*1;let P=-d,M=_;const k=Math.sqrt(P*P+M*M);P/=k,M/=k;const D=[0,P,M];return l.bi(D,D,[0,0,0],-this.bearingInRadians),l.bj(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),l.bk(D,D,[0,0,0],this.center.lng*Math.PI/180),l.aN(D,D,.25),[...D,.25*-w]}isLocationOccluded(e){return!this.isSurfacePointVisible(ci(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,d=Math.cos(u),_=[Math.sin(i)*d,Math.sin(u),Math.cos(i)*d],w=[_[2],0,-_[0]],P=[0,0,0];l.aT(P,w,_),l.aS(w,w),l.aS(P,P);const M=[0,0,0];return l.aS(M,[w[0]*e[0]+P[0]*e[1]+_[0]*e[2],w[1]*e[0]+P[1]*e[1]+_[1]*e[2],w[2]*e[0]+P[2]*e[1]+_[2]*e[2]]),M}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,u){const d=function(P,M,k){const D=1/(1<<k.z);return new l.$(P/l.Z*D+k.x*D,M/l.Z*D+k.y*D)}(e,i,u.canonical),_=(w=d.y,[l.bf(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(e,i,u,d){const _=u.canonical,w=Dr(e,i,_.x,_.y,_.z),P=1+(d?d(e,i):0)/l.bq,M=[w[0]*P,w[1]*P,w[2]*P,1];l.ao(M,M,this._globeViewProjMatrixNoCorrection);const k=this._cachedClippingPlane,D=k[0]*w[0]+k[1]*w[1]+k[2]*w[2]+k[3]<0;return{point:new l.P(M[0]/M[3],M[1]/M[3]),signedDistanceFromCamera:M[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=kr(this.worldSize,this.center.lat),i=l.b1(),u=l.b1();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.aX(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;i[8]=2*-d.x/this._helper._width,i[9]=2*d.y/this._helper._height,this._projectionMatrix=l.aY(i),this._globeProjMatrixInverted=l.b1(),l.ai(this._globeProjMatrixInverted,i),l.L(i,i,[0,0,-this.cameraToCenterDistance]),l.aZ(i,i,this.rollInRadians),l.a_(i,i,-this.pitchInRadians),l.aZ(i,i,this.bearingInRadians),l.L(i,i,[0,0,-e]);const _=l.bh();_[0]=e,_[1]=e,_[2]=e,l.a_(u,i,this.center.lat*Math.PI/180),l.bl(u,u,-this.center.lng*Math.PI/180),l.M(u,u,_),this._globeViewProjMatrixNoCorrection=u,l.a_(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bl(i,i,-this.center.lng*Math.PI/180),l.M(i,i,_),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=l.b1(),l.ai(this._globeViewProjMatrixNoCorrectionInverted,u);const w=l.bh();this._cameraPosition=l.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bi(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),l.bj(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),l.bi(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),l.aO(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bj(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),l.bk(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const P=l.aY(this._globeViewProjMatrixNoCorrectionInverted);l.M(P,P,[1,1,-1]),this._cachedFrustum=Xs.fromInvProjectionMatrix(P)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const i=l.b1();return l.as(i),i}getVisibleUnwrappedCoordinates(e){return[new l.aV(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=ci(e);l.aN(u,u,1+i/l.bq);const d=l.bg();return l.ao(d,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,u=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,i),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,i)],d=[];for(const O of u)d.push(this.unprojectScreenPoint(O));let _=0,w=0,P=0,M=0;const k=this.center;for(const O of d){const B=l.bm(k.lng,O.lng),G=l.bm(k.lat,O.lat);B<w&&(w=B),B>_&&(_=B),G<M&&(M=G),G>P&&(P=G)}const D=[k.lng+w,k.lat+M,k.lng+_,k.lat+P];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new qt(D)}getConstrained(e,i){const u=l.ad(e.lat,-85.051129,l.aI),d=l.ad(+i,this.minZoom+$n(0,u),this.maxZoom);return{center:new l.Q(e.lng,u),zoom:d}}calculateCenterFromCameraLngLatAlt(e,i,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,d)}setLocationAtPoint(e,i){const u=ci(this.unprojectScreenPoint(i)),d=ci(e),_=l.bh();l.bn(_);const w=l.bh();l.bk(w,u,_,-this.center.lng*Math.PI/180),l.bj(w,w,_,this.center.lat*Math.PI/180);const P=d[0]*d[0]+d[2]*d[2],M=w[0]*w[0];if(P<M)return;const k=Math.sqrt(P-M),D=-k,O=l.bo(d[0],d[2],w[0],k),B=l.bo(d[0],d[2],w[0],D),G=l.bh();l.bk(G,d,_,-O);const W=l.bo(G[1],G[2],w[1],w[2]),ie=l.bh();l.bk(ie,d,_,-B);const re=l.bo(ie[1],ie[2],w[1],w[2]),se=.5*Math.PI,ue=W>=-se&&W<=se,me=re>=-se&&re<=se;let ge,be;if(ue&&me){const je=this.center.lng*Math.PI/180,He=this.center.lat*Math.PI/180;l.br(O,je)+l.br(W,He)<l.br(B,je)+l.br(re,He)?(ge=O,be=W):(ge=B,be=re)}else if(ue)ge=O,be=W;else{if(!me)return;ge=B,be=re}const Pe=ge/Math.PI*180,Se=be/Math.PI*180,Be=this.center.lat;this.setCenter(new l.Q(Pe,l.ad(Se,-90,90))),this.setZoom(this.zoom+$n(Be,this.center.lat))}locationToScreenPoint(e,i){const u=ci(e);if(i){const d=i.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aN(u,u,1+d/l.bq)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const i=l.bg();return l.ao(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new l.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u)return u}return l.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,i){const u=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,d)}getRayDirectionFromPixel(e){const i=l.bg();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,l.ao(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const u=l.bh();u[0]=i[0]-this._cameraPosition[0],u[1]=i[1]-this._cameraPosition[1],u[2]=i[2]-this._cameraPosition[2];const d=l.bh();return l.aS(d,u),d}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=l.bg();return l.ao(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const u=l.aU(e,i),d=l.bh(),_=l.bh();l.aN(_,i,u),l.aR(d,e,_);const w=1-l.aU(d,d);if(w<0)return null;const P=l.aU(e,e)-1,M=-u+(u<0?1:-1)*Math.sqrt(w),k=P/M,D=M;return{tMin:Math.min(k,D),tMax:Math.max(k,D)}}unprojectScreenPoint(e){const i=this._cameraPosition,u=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(i,u);if(d){const k=l.bh();l.aO(k,i,[u[0]*d.tMin,u[1]*d.tMin,u[2]*d.tMin]);const D=l.bh();return l.aS(D,k),Jl(D)}const _=this._cachedClippingPlane[0]*u[0]+this._cachedClippingPlane[1]*u[1]+this._cachedClippingPlane[2]*u[2],w=-l.bp(this._cachedClippingPlane,i)/_,P=l.bh();if(w>0)l.aO(P,i,[u[0]*w,u[1]*w,u[2]*w]);else{const k=l.bh();l.aO(k,i,[2*u[0],2*u[1],2*u[2]]);const D=l.bp(this._cachedClippingPlane,k);l.aR(P,k,[this._cachedClippingPlane[0]*D,this._cachedClippingPlane[1]*D,this._cachedClippingPlane[2]*D])}const M=l.bh();return l.aS(M,P),Jl(M)}getMatrixForModel(e,i){const u=l.Q.convert(e),d=1/l.bq,_=l.b0();return l.bl(_,_,u.lng/180*Math.PI),l.a_(_,_,-u.lat/180*Math.PI),l.L(_,_,[0,0,1+i/l.bq]),l.a_(_,_,.5*Math.PI),l.M(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new l.Y(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Ai{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Wl({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new ro,this._verticalPerspectiveTransform=new lu}clone(){const e=new Ai;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:i.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bb(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bb(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,u){const d=this._mercatorTransform.getPitchedTextCorrection(e,i,u),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,u);return l.bb(d,_,this._globeness)}projectTileCoordinates(e,i,u,d){return this.currentTransform.projectTileCoordinates(e,i,u,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,d)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=i.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Gi{get useGlobeControls(){return!0}handlePanInertia(e,i){const u=su(e,i);return Math.abs(u.lng-i.center.lng)>180&&(u.lng=i.center.lng+179.5*Math.sign(u.lng-i.center.lng)),{easingCenter:u,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const u=e.around,d=i.screenPointToLocation(u);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const _=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const w=i.zoom-_;if(w===0)return;const P=l.bm(i.center.lng,d.lng),M=P/(Math.abs(P/180)+1),k=l.bm(i.center.lat,d.lat),D=i.getRayDirectionFromPixel(u),O=i.cameraPosition,B=-1*l.aU(O,D),G=l.bh();l.aO(G,O,[D[0]*B,D[1]*B,D[2]*B]);const W=l.bs(G)-1,ie=Math.exp(.5*-Math.max(W-.3,0)),re=kr(i.worldSize,i.center.lat)/Math.min(i.width,i.height),se=l.be(re,.9,.5,1,.25),ue=(1-l.aH(-w))*Math.min(ie,se),me=i.center.lat,ge=i.zoom,be=new l.Q(i.center.lng+M*ue,l.ad(i.center.lat+k*ue,-85.051129,l.aI));i.setLocationAtPoint(d,u);const Pe=i.center,Se=l.be(Math.abs(P),45,85,0,1),Be=l.be(re,.75,.35,0,1),je=Math.pow(Math.max(Se,Be),.25),He=l.bm(Pe.lng,be.lng),Ye=l.bm(Pe.lat,be.lat);i.setCenter(new l.Q(Pe.lng+He*je,Pe.lat+Ye*je).wrap()),i.setZoom(ge+$n(me,i.center.lat))}handleMapControlsPan(e,i,u){if(!e.panDelta)return;const d=i.center.lat,_=i.zoom;i.setCenter(su(e.panDelta,i).wrap()),i.setZoom(_+$n(d,i.center.lat))}cameraForBoxAndBearing(e,i,u,d,_){const w=kh(e,i,u,d,_),P=i.left/_.width*2-1,M=(_.width-i.right)/_.width*2-1,k=i.top/_.height*-2+1,D=(_.height-i.bottom)/_.height*-2+1,O=l.bm(u.getWest(),u.getEast())<0,B=O?u.getEast():u.getWest(),G=O?u.getWest():u.getEast(),W=Math.max(u.getNorth(),u.getSouth()),ie=Math.min(u.getNorth(),u.getSouth()),re=B+.5*l.bm(B,G),se=W+.5*l.bm(W,ie),ue=_.clone();ue.setCenter(w.center),ue.setBearing(w.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(w.zoom);const me=ue.modelViewProjectionMatrix,ge=[ci(u.getNorthWest()),ci(u.getNorthEast()),ci(u.getSouthWest()),ci(u.getSouthEast()),ci(new l.Q(G,se)),ci(new l.Q(B,se)),ci(new l.Q(re,W)),ci(new l.Q(re,ie))],be=ci(w.center);let Pe=Number.POSITIVE_INFINITY;for(const Se of ge)P<0&&(Pe=Gi.getLesserNonNegativeNonNull(Pe,Gi.solveVectorScale(Se,be,me,"x",P))),M>0&&(Pe=Gi.getLesserNonNegativeNonNull(Pe,Gi.solveVectorScale(Se,be,me,"x",M))),k>0&&(Pe=Gi.getLesserNonNegativeNonNull(Pe,Gi.solveVectorScale(Se,be,me,"y",k))),D<0&&(Pe=Gi.getLesserNonNegativeNonNull(Pe,Gi.solveVectorScale(Se,be,me,"y",D)));if(Number.isFinite(Pe)&&Pe!==0)return w.zoom=ue.zoom+l.aa(Pe),w;Hl()}handleJumpToCenterZoom(e,i){const u=e.center.lat,d=e.getConstrained(i.center?l.Q.convert(i.center):e.center,e.zoom).center;e.setCenter(d.wrap());const _=i.zoom!==void 0?+i.zoom:e.zoom+$n(u,d.lat);e.zoom!==_&&e.setZoom(_)}handleEaseTo(e,i){const u=e.zoom,d=e.center,_=e.padding,w={roll:e.roll,pitch:e.pitch,bearing:e.bearing},P={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},M=i.zoom!==void 0,k=!e.isPaddingEqual(i.padding);let D=!1;const O=i.center?l.Q.convert(i.center):d,B=e.getConstrained(O,u).center;Ti(e,B);const G=e.clone();G.setCenter(B),G.setZoom(M?+i.zoom:u+$n(d.lat,O.lat)),G.setBearing(i.bearing);const W=new l.P(l.ad(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),l.ad(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));G.setLocationAtPoint(B,W);const ie=(i.offset&&i.offsetAsPoint.mag())>0?G.center:B,re=M?+i.zoom:u+$n(d.lat,ie.lat),se=u+$n(d.lat,0),ue=re+$n(ie.lat,0),me=l.bm(d.lng,ie.lng),ge=l.bm(d.lat,ie.lat),be=l.aH(ue-se);return D=re!==u,{easeFunc:Pe=>{if(l.b5(w,P)||xo({startEulerAngles:w,endEulerAngles:P,tr:e,k:Pe,useSlerp:w.roll!=P.roll}),k&&e.interpolatePadding(_,i.padding,Pe),i.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const Se=ue>se?Math.min(2,be):Math.max(.5,be),Be=Math.pow(Se,1-Pe),je=Ks(d,me,ge,Pe*Be);e.setCenter(je.wrap())}if(D){const Se=l.B.number(se,ue,Pe)+$n(0,e.center.lat);e.setZoom(Se)}},isZooming:D,elevationCenter:ie}}handleFlyTo(e,i){const u=i.zoom!==void 0,d=e.center,_=e.zoom,w=e.padding,P=!e.isPaddingEqual(i.padding),M=e.getConstrained(l.Q.convert(i.center||i.locationAtOffset),_).center,k=u?+i.zoom:e.zoom+$n(e.center.lat,M.lat),D=e.clone();D.setCenter(M),D.setZoom(k),D.setBearing(i.bearing);const O=new l.P(l.ad(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),l.ad(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(M,O);const B=D.center;Ti(e,B);const G=function(ge,be,Pe){const Se=ci(be),Be=ci(Pe),je=l.aU(Se,Be),He=Math.acos(je),Ye=Ah(ge);return He/(2*Math.PI)*Ye}(e,d,B),W=_+$n(d.lat,0),ie=k+$n(B.lat,0),re=l.aH(ie-W);let se;if(typeof i.minZoom=="number"){const ge=+i.minZoom+$n(B.lat,0),be=Math.min(ge,W,ie)+$n(0,B.lat),Pe=e.getConstrained(B,be).zoom+$n(B.lat,0);se=l.aH(Pe-W)}const ue=l.bm(d.lng,B.lng),me=l.bm(d.lat,B.lat);return{easeFunc:(ge,be,Pe,Se)=>{const Be=Ks(d,ue,me,Pe);P&&e.interpolatePadding(w,i.padding,ge);const je=ge===1?B:Be;e.setCenter(je.wrap());const He=W+l.aa(be);e.setZoom(ge===1?k:He+$n(0,je.lat))},scaleOfZoom:re,targetCenter:B,scaleOfMinZoom:se,pixelPathLength:G}}static solveVectorScale(e,i,u,d,_){const w=d==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],P=[u[3],u[7],u[11],u[15]],M=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],k=e[0]*P[0]+e[1]*P[1]+e[2]*P[2],D=i[0]*w[0]+i[1]*w[1]+i[2]*w[2],O=i[0]*P[0]+i[1]*P[1]+i[2]*P[2];return D+_*k===M+_*O||P[3]*(M-D)+w[3]*(O-k)+M*O==D*k?null:(D+w[3]-_*O-_*P[3])/(D-M-_*O+_*k)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class tc{constructor(e){this._globe=e,this._mercatorCameraHelper=new Do,this._verticalPerspectiveCameraHelper=new Gi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,u){this.currentHelper.handleMapControlsPan(e,i,u)}cameraForBoxAndBearing(e,i,u,d,_){return this.currentHelper.cameraForBoxAndBearing(e,i,u,d,_)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const qi=(g,e)=>l.x(g,e&&e.filter(i=>i.identifier!=="source.canvas")),hl=l.bt();class Pa extends l.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new mr(Pn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new ke,this.imageManager.setEventedParent(this),this.glyphManager=new tn(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Rt(256,512),this.crossTileSymbolIndex=new al,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bu,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.bv()),xr().on(Rr,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const w in this._layers){const P=this._layers[w];P.source===_.id&&this._validateLayer(P)}})}loadURL(e,i={},u){this.fire(new l.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;l.j(d,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,i,u)}).catch(w=>{this._loadStyleRequest=null,w&&!_.signal.aborted&&this.fire(new l.k(w))})}loadJSON(e,i={},u){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,oe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,u)}).catch(()=>{})}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(hl,{validate:!1})}_load(e,i,u){var d,_;const w=i.transformStyle?i.transformStyle(u,e):e;if(!i.validate||!qi(this,l.y(w))){this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Zt(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new _t(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){const e=l.bw(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const u=l.bx(i);u.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=u}}_loadSprite(e,i=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,w,P,M){return l._(this,void 0,void 0,function*(){const k=qe(_),D=P>1?"@2x":"",O={},B={};for(const{id:G,url:W}of k){const ie=w.transformRequest(we(W,D,".json"),"SpriteJSON");O[G]=l.j(ie,M);const re=w.transformRequest(we(W,D,".png"),"SpriteImage");B[G]=Oe.getImage(re,M)}return yield Promise.all([...Object.values(O),...Object.values(B)]),function(G,W){return l._(this,void 0,void 0,function*(){const ie={};for(const re in G){ie[re]={};const se=oe.getImageCanvasContext((yield W[re]).data),ue=(yield G[re]).data;for(const me in ue){const{width:ge,height:be,x:Pe,y:Se,sdf:Be,pixelRatio:je,stretchX:He,stretchY:Ye,content:Ze,textFitWidth:tt,textFitHeight:mt}=ue[me];ie[re][me]={data:null,pixelRatio:je,sdf:Be,stretchX:He,stretchY:Ye,content:Ze,textFitWidth:tt,textFitHeight:mt,spriteData:{width:ge,height:be,x:Pe,y:Se,context:se}}}}return ie})}(O,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const w in _){this._spritesImagesIds[w]=[];const P=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(M=>!(M in _)):[];for(const M of P)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in _[w]){const k=w==="default"?M:`${w}:${M}`;this._spritesImagesIds[w].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,_[w][M],!1):this.imageManager.addImage(k,_[w][M]),i&&(this._changedImages[k]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new l.k(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const u=e.sourceLayer;if(!u)return;const d=i.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.k(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?l.by(u):u);const d=[];for(const _ of e)if(u[_]){const w=i?l.by(u[_]):u[_];d.push(w)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const u of i){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){var e,i,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const w in this._updatedSources){const P=this._updatedSources[w];if(P==="reload")this._reloadSource(w);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];u[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(e,this._availableImages),!_.isHidden(e.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in u){const _=this.sourceCaches[d];!!u[d]!=!!_.used&&_.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var u;this._checkLoaded();const d=this.serialize();if(e=i.transformStyle?i.transformStyle(d,e):e,((u=i.validate)===null||u===void 0||u)&&qi(this,l.y(e)))return!1;(e=l.by(e)).layers=l.bw(e.layers);const _=l.bz(d,e),w=this._getOperationsToPerform(_);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const P of w.operations)P();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":i.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":i.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setSky":i.push(()=>this.setSky.apply(this,d.args));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setTransition":i.push(()=>{});break;default:u.push(d.command)}return{operations:i,unimplemented:u}}addImage(e,i){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(l.y.source,`sources.${e}`,i,null,u))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const d=this.sourceCaches[e]=new F(e,i,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new l.k(new Error(`Layer "${d}" already exists on this map.`)));let _;if(e.type==="custom"){if(qi(this,l.bA(e)))return;_=l.bx(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=l.by(e),e=l.e(e,{source:d})),this._validate(l.y.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;_=l.bx(e),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const w=i?this._order.indexOf(i):this._order.length;if(i&&w===-1)this.fire(new l.k(new Error(`Cannot add layer "${d}" before non-existing layer "${i}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const P=this._removedLayers[d];delete this._removedLayers[d],P.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=i?this._order.indexOf(i):this._order.length;i&&d===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===i&&d.maxzoom===u||(i!=null&&(d.minzoom=i),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!l.bB(d.filter,i))return i==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.y.filter,`layers.${d.id}.filter`,i,null,u)||(d.filter=l.by(i),this._updateLayer(d)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.by(this.getLayer(e).filter)}setLayoutProperty(e,i,u,d={}){this._checkLoaded();const _=this.getLayer(e);_?l.bB(_.getLayoutProperty(i),u)||(_.setLayoutProperty(i,u,d),this._updateLayer(_)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const u=this.getLayer(e);if(u)return u.getLayoutProperty(i);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,u,d={}){this._checkLoaded();const _=this.getLayer(e);_?l.bB(_.getPaintProperty(i),u)||(_.setPaintProperty(i,u,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const u=e.source,d=e.sourceLayer,_=this.sourceCaches[u];if(_===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const w=_.getSource().type;w==="geojson"&&d?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,e.id,i)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const _=d.getSource().type,w=_==="vector"?e.sourceLayer:void 0;_!=="vector"||w?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,e.id,i):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,u=e.sourceLayer,d=this.sourceCaches[i];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bC(this.sourceCaches,_=>_.serialize()),i=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.bD({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:i,terrain:u},_=>_!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=w=>this._layers[w].type==="fill-extrusion",u={},d=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(i(P)){u[P]=w;for(const M of e){const k=M[P];if(k)for(const D of k)d.push(D)}}}d.sort((w,P)=>P.intersectionZ-w.intersectionZ);const _=[];for(let w=this._order.length-1;w>=0;w--){const P=this._order[w];if(i(P))for(let M=d.length-1;M>=0;M--){const k=d[M].feature;if(u[k.layer.id]<w)break;_.push(k),d.pop()}else for(const M of e){const k=M[P];if(k)for(const D of k)_.push(D.feature)}}return _}queryRenderedFeatures(e,i,u){i&&i.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const d={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const k of i.layers){const D=this._layers[k];if(!D)return this.fire(new l.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];d[D.source]=!0}}const _=[];i.availableImages=this._availableImages;const w=this._serializedAllLayers(),P=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,M=Object.assign(Object.assign({},i),{layers:P});for(const k in this.sourceCaches)i.layers&&!d[k]||_.push(tr(this.sourceCaches[k],this._layers,w,e,M,u));return this.placement&&_.push(function(k,D,O,B,G,W,ie){const re={},se=W.queryRenderedSymbols(B),ue=[];for(const me of Object.keys(se).map(Number))ue.push(ie[me]);ue.sort(Gt);for(const me of ue){const ge=me.featureIndex.lookupSymbolFeatures(se[me.bucketInstanceId],D,me.bucketIndex,me.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const be in ge){const Pe=re[be]=re[be]||[],Se=ge[be];Se.sort((Be,je)=>{const He=me.featureSortOrder;if(He){const Ye=He.indexOf(Be.featureIndex);return He.indexOf(je.featureIndex)-Ye}return je.featureIndex-Be.featureIndex});for(const Be of Se)Pe.push(Be)}}return function(me,ge,be){for(const Pe in me)for(const Se of me[Pe])on(Se,be[ge[Pe].source]);return me}(re,k,O)}(this._layers,w,this.sourceCaches,e,M,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(e,i){i&&i.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",i.filter,null,i);const u=this.sourceCaches[e];return u?function(d,_){const w=d.getRenderableIds().map(k=>d.getTileByID(k)),P=[],M={};for(let k=0;k<w.length;k++){const D=w[k],O=D.tileID.canonical.key;M[O]||(M[O]=!0,D.querySourceFeatures(P,_))}return P}(u,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const w in e)if(!l.bB(e[w],u[w])){d=!0;break}if(!d)return;const _={now:oe.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(_)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const w in e)if(!l.bB(e[w],u[w])){d=!0;break}if(!d)return;const _={now:oe.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(_)}_setProjectionInternal(e){const i=function(u){if(Array.isArray(u)){const d=new Yl({type:u});return{projection:d,transform:new Ai,cameraHelper:new tc(d)}}switch(u){case"mercator":return{projection:new ql,transform:new ro,cameraHelper:new Do};case"globe":{const d=new Yl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Ai,cameraHelper:new tc(d)}}case"vertical-perspective":return{projection:new ul,transform:new lu,cameraHelper:new Gi};default:return l.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new ql,transform:new ro,cameraHelper:new Do}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,i,u,d,_={}){return(!_||_.validate!==!1)&&qi(this,e.call(l.y,l.e({key:i,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),xr().off(Rr,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const u=this.sourceCaches[i];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,u,d,_=!1){let w=!1,P=!1;const M={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!M[D.source]){const B=this.sourceCaches[D.source];M[D.source]=B.getRenderableIds(!0).map(G=>B.getTileByID(G)).sort((G,W)=>W.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(W.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(D,M[D.source],e.center.lng);w=w||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(oe.now(),e.zoom))&&(this.pauseablePlacement=new ru(e,this.map.terrain,this._order,_,i,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(oe.now()),P=!0),w&&this.pauseablePlacement.placement.setStale()),P||w)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,M[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(oe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return l._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[i.source];return d&&d.setDependencies(i.tileID.key,i.type,i.icons),u})}getGlyphs(e,i){return l._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(i.stacks),d=this.sourceCaches[i.source];return d&&d.setDependencies(i.tileID.key,i.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(l.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,u={},d){this._checkLoaded();const _=[{id:e,url:i}],w=[...qe(this.stylesheet.sprite),..._];this._validate(l.y.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(_,!0,d))}removeSprite(e){this._checkLoaded();const i=qe(this.stylesheet.sprite);if(i.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;i.splice(i.findIndex(u=>u.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return qe(this.stylesheet.sprite)}setSprite(e,i={},u){this._checkLoaded(),e&&this._validate(l.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Nn=l.aC([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ys{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,u,d,_,w,P,M,k){this.context=e;let D=this.boundPaintVertexBuffers.length!==d.length;for(let O=0;!D&&O<d.length;O++)this.boundPaintVertexBuffers[O]!==d[O]&&(D=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==u||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==k?this.freshBind(i,u,d,_,w,P,M,k):(e.bindVertexArray.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),M&&M.bind(),k&&k.bind())}freshBind(e,i,u,d,_,w,P,M){const k=e.numAttributes,D=this.context,O=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=M,i.enableAttributes(O,e);for(const B of u)B.enableAttributes(O,e);w&&w.enableAttributes(O,e),P&&P.enableAttributes(O,e),M&&M.enableAttributes(O,e),i.bind(),i.setVertexAttribPointers(O,e,_);for(const B of u)B.bind(),B.setVertexAttribPointers(O,e,_);w&&(w.bind(),w.setVertexAttribPointers(O,e,_)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(O,e,_)),M&&(M.bind(),M.setVertexAttribPointers(O,e,_)),D.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const nc=(g,e,i,u,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):l.b6.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:i?i.calculateFogBlendOpacity(u):0,u_horizon_color:i?i.properties.get("horizon-color"):l.b6.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),rc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function rs(g){const e=[];for(let i=0;i<g.length;i++){if(g[i]===null)continue;const u=g[i].split(" ");e.push(u.pop())}return e}class Ip{constructor(e,i,u,d,_,w,P,M){const k=e.gl;this.program=k.createProgram();const D=rs(i.staticAttributes),O=u?u.getBinderAttributes():[],B=D.concat(O),G=zo.prelude.staticUniforms?rs(zo.prelude.staticUniforms):[],W=P.staticUniforms?rs(P.staticUniforms):[],ie=i.staticUniforms?rs(i.staticUniforms):[],re=u?u.getBinderUniforms():[],se=G.concat(W).concat(ie).concat(re),ue=[];for(const je of se)ue.indexOf(je)<0&&ue.push(je);const me=u?u.defines():[];Tn(k)&&me.unshift("#version 300 es"),_&&me.push("#define OVERDRAW_INSPECTOR;"),w&&me.push("#define TERRAIN3D;"),M&&me.push(M);let ge=me.concat(zo.prelude.fragmentSource,P.fragmentSource,i.fragmentSource).join(`
`),be=me.concat(zo.prelude.vertexSource,P.vertexSource,i.vertexSource).join(`
`);Tn(k)||(ge=function(je){return je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ge),be=function(je){return je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(be));const Pe=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Pe,ge),k.compileShader(Pe),!k.getShaderParameter(Pe,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(Pe)}`);k.attachShader(this.program,Pe);const Se=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Se,be),k.compileShader(Se),!k.getShaderParameter(Se,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(Se)}`);k.attachShader(this.program,Se),this.attributes={};const Be={};this.numAttributes=B.length;for(let je=0;je<this.numAttributes;je++)B[je]&&(k.bindAttribLocation(this.program,je,B[je]),this.attributes[B[je]]=je);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(Se),k.deleteShader(Pe);for(let je=0;je<ue.length;je++){const He=ue[je];if(He&&!Be[He]){const Ye=k.getUniformLocation(this.program,He);Ye&&(Be[He]=Ye)}}this.fixedUniforms=d(e,Be),this.terrainUniforms=((je,He)=>({u_depth:new l.bE(je,He.u_depth),u_terrain:new l.bE(je,He.u_terrain),u_terrain_dim:new l.b7(je,He.u_terrain_dim),u_terrain_matrix:new l.bG(je,He.u_terrain_matrix),u_terrain_unpack:new l.bH(je,He.u_terrain_unpack),u_terrain_exaggeration:new l.b7(je,He.u_terrain_exaggeration)}))(e,Be),this.projectionUniforms=((je,He)=>({u_projection_matrix:new l.bG(je,He.u_projection_matrix),u_projection_tile_mercator_coords:new l.bH(je,He.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bH(je,He.u_projection_clipping_plane),u_projection_transition:new l.b7(je,He.u_projection_transition),u_projection_fallback_matrix:new l.bG(je,He.u_projection_fallback_matrix)}))(e,Be),this.binderUniforms=u?u.getUniforms(e,Be):[]}draw(e,i,u,d,_,w,P,M,k,D,O,B,G,W,ie,re,se,ue,me){const ge=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(_),e.setCullFace(w),M){e.activeTexture.set(ge.TEXTURE2),ge.bindTexture(ge.TEXTURE_2D,M.depthTexture),e.activeTexture.set(ge.TEXTURE3),ge.bindTexture(ge.TEXTURE_2D,M.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(M[Pe])}if(k)for(const Pe in k)this.projectionUniforms[rc[Pe]].set(k[Pe]);if(P)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(P[Pe]);re&&re.setUniforms(e,this.binderUniforms,W,{zoom:ie});let be=0;switch(i){case ge.LINES:be=2;break;case ge.TRIANGLES:be=3;break;case ge.LINE_STRIP:be=1}for(const Pe of G.get()){const Se=Pe.vaos||(Pe.vaos={});(Se[D]||(Se[D]=new Ys)).bind(e,this,O,re?re.getPaintVertexBuffers():[],B,Pe.vertexOffset,se,ue,me),ge.drawElements(i,Pe.primitiveLength*be,ge.UNSIGNED_SHORT,Pe.primitiveOffset*be*2)}}}function ic(g,e,i){const u=1/l.av(i,1,e.transform.tileZoom),d=Math.pow(2,i.tileID.overscaledZ),_=i.tileSize*Math.pow(2,e.transform.tileZoom)/d,w=_*(i.tileID.canonical.x+i.tileID.wrap*d),P=_*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,P>>16],u_pixel_coord_lower:[65535&w,65535&P]}}const ef=(g,e,i,u)=>{const d=g.style.light,_=d.properties.get("position"),w=[_.x,_.y,_.z],P=l.bK();d.properties.get("anchor")==="viewport"&&l.bL(P,g.transform.bearingInRadians),l.bM(w,w,P);const M=g.transform.transformLightDirection(w),k=d.properties.get("color");return{u_lightpos:w,u_lightpos_globe:M,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:u}},Ea=(g,e,i,u,d,_,w)=>l.e(ef(g,e,i,u),ic(_,g,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),oc=(g,e,i,u)=>l.e(ic(e,g,i),{u_fill_translate:u}),Ma=(g,e)=>({u_world:g,u_fill_translate:e}),kp=(g,e,i,u,d)=>l.e(oc(g,e,i,d),{u_world:u}),zh=(g,e,i,u,d)=>{const _=g.transform;let w,P,M=0;if(i.paint.get("circle-pitch-alignment")==="map"){const k=l.av(e,1,_.zoom);w=!0,P=[k,k],M=k/(l.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else w=!1,P=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:P,u_globe_extrude_scale:M,u_translate:u}},cu=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),uu=g=>({u_viewport_size:[g.width,g.height]}),sc=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),hu=(g,e,i,u)=>{const d=l.av(g,1,e)/(l.Z*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:l.av(g,1,e),u_intensity:i,u_globe_extrude_scale:d}},Rh=(g,e,i,u)=>{const d=l.K();l.bN(d,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:i,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},bs=(g,e,i)=>{const u=i.paint.get("hillshade-shadow-color"),d=i.paint.get("hillshade-highlight-color"),_=i.paint.get("hillshade-accent-color");let w=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);return i.paint.get("hillshade-illumination-anchor")==="viewport"&&(w+=g.transform.bearingInRadians),{u_image:0,u_latrange:tf(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),w],u_shadow:u,u_highlight:d,u_accent:_}},du=(g,e)=>{const i=e.stride,u=l.K();return l.bN(u,0,l.Z,-8192,0,0,1),l.L(u,u,[0,-8192,0]),{u_matrix:u,u_image:1,u_dimension:[i,i],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function tf(g,e){const i=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new l.$(0,u/i).toLngLat().lat,new l.$(0,(u+1)/i).toLngLat().lat]}const Js=(g,e,i,u)=>{const d=g.transform;return{u_translation:fu(g,e,i),u_ratio:u/l.av(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},oo=(g,e,i,u,d)=>l.e(Js(g,e,i,u),{u_image:0,u_image_height:d}),dl=(g,e,i,u,d)=>{const _=g.transform,w=Dh(e,_);return{u_translation:fu(g,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:u/l.av(e,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ac=(g,e,i,u,d,_)=>{const w=g.lineAtlas,P=Dh(e,g.transform),M=i.layout.get("line-cap")==="round",k=w.getDash(d.from,M),D=w.getDash(d.to,M),O=k.width*_.fromScale,B=D.width*_.toScale;return l.e(Js(g,e,i,u),{u_patternscale_a:[P/O,-k.height/2],u_patternscale_b:[P/B,-D.height/2],u_sdfgamma:w.width/(256*Math.min(O,B)*g.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:D.y,u_mix:_.t})};function Dh(g,e){return 1/l.av(g,1,e.tileZoom)}function fu(g,e,i){return l.aw(g.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const nf=(g,e,i,u,d)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(w=u.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:rf(u.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,w};function rf(g){g*=Math.PI/180;const e=Math.sin(g),i=Math.cos(g);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const pu=(g,e,i,u,d,_,w,P,M,k,D,O,B)=>{const G=w.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:G.width/G.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:P,u_coord_matrix:M,u_is_text:+D,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:O,u_texture:0,u_translation:k,u_pitched_scale:B}},Lh=(g,e,i,u,d,_,w,P,M,k,D,O,B,G)=>{const W=w.transform;return l.e(pu(g,e,i,u,d,_,w,P,M,k,D,O,G),{u_gamma_scale:u?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},mu=(g,e,i,u,d,_,w,P,M,k,D,O,B)=>l.e(Lh(g,e,i,u,d,_,w,P,M,k,!0,D,0,B),{u_texsize_icon:O,u_texture_icon:1}),Wi=(g,e)=>({u_opacity:g,u_color:e}),Fh=(g,e,i,u,d)=>l.e(function(_,w,P,M){const k=P.imageManager.getPattern(_.from.toString()),D=P.imageManager.getPattern(_.to.toString()),{width:O,height:B}=P.imageManager.getPixelSize(),G=Math.pow(2,M.tileID.overscaledZ),W=M.tileSize*Math.pow(2,P.transform.tileZoom)/G,ie=W*(M.tileID.canonical.x+M.tileID.wrap*G),re=W*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[O,B],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/l.av(M,1,P.transform.tileZoom),u_pixel_coord_upper:[ie>>16,re>>16],u_pixel_coord_lower:[65535&ie,65535&re]}}(i,d,e,u),{u_opacity:g}),gu=(g,e)=>{},lc={fillExtrusion:(g,e)=>({u_lightpos:new l.bI(g,e.u_lightpos),u_lightpos_globe:new l.bI(g,e.u_lightpos_globe),u_lightintensity:new l.b7(g,e.u_lightintensity),u_lightcolor:new l.bI(g,e.u_lightcolor),u_vertical_gradient:new l.b7(g,e.u_vertical_gradient),u_opacity:new l.b7(g,e.u_opacity),u_fill_translate:new l.bJ(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new l.bI(g,e.u_lightpos),u_lightpos_globe:new l.bI(g,e.u_lightpos_globe),u_lightintensity:new l.b7(g,e.u_lightintensity),u_lightcolor:new l.bI(g,e.u_lightcolor),u_vertical_gradient:new l.b7(g,e.u_vertical_gradient),u_height_factor:new l.b7(g,e.u_height_factor),u_opacity:new l.b7(g,e.u_opacity),u_fill_translate:new l.bJ(g,e.u_fill_translate),u_image:new l.bE(g,e.u_image),u_texsize:new l.bJ(g,e.u_texsize),u_pixel_coord_upper:new l.bJ(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bJ(g,e.u_pixel_coord_lower),u_scale:new l.bI(g,e.u_scale),u_fade:new l.b7(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new l.bJ(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new l.bE(g,e.u_image),u_texsize:new l.bJ(g,e.u_texsize),u_pixel_coord_upper:new l.bJ(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bJ(g,e.u_pixel_coord_lower),u_scale:new l.bI(g,e.u_scale),u_fade:new l.b7(g,e.u_fade),u_fill_translate:new l.bJ(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new l.bJ(g,e.u_world),u_fill_translate:new l.bJ(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new l.bJ(g,e.u_world),u_image:new l.bE(g,e.u_image),u_texsize:new l.bJ(g,e.u_texsize),u_pixel_coord_upper:new l.bJ(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bJ(g,e.u_pixel_coord_lower),u_scale:new l.bI(g,e.u_scale),u_fade:new l.b7(g,e.u_fade),u_fill_translate:new l.bJ(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new l.b7(g,e.u_camera_to_center_distance),u_scale_with_map:new l.bE(g,e.u_scale_with_map),u_pitch_with_map:new l.bE(g,e.u_pitch_with_map),u_extrude_scale:new l.bJ(g,e.u_extrude_scale),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.b7(g,e.u_globe_extrude_scale),u_translate:new l.bJ(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new l.bJ(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new l.bJ(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new l.bF(g,e.u_color),u_overlay:new l.bE(g,e.u_overlay),u_overlay_scale:new l.b7(g,e.u_overlay_scale)}),depth:gu,clippingMask:gu,heatmap:(g,e)=>({u_extrude_scale:new l.b7(g,e.u_extrude_scale),u_intensity:new l.b7(g,e.u_intensity),u_globe_extrude_scale:new l.b7(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new l.bG(g,e.u_matrix),u_world:new l.bJ(g,e.u_world),u_image:new l.bE(g,e.u_image),u_color_ramp:new l.bE(g,e.u_color_ramp),u_opacity:new l.b7(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new l.bE(g,e.u_image),u_latrange:new l.bJ(g,e.u_latrange),u_light:new l.bJ(g,e.u_light),u_shadow:new l.bF(g,e.u_shadow),u_highlight:new l.bF(g,e.u_highlight),u_accent:new l.bF(g,e.u_accent)}),hillshadePrepare:(g,e)=>({u_matrix:new l.bG(g,e.u_matrix),u_image:new l.bE(g,e.u_image),u_dimension:new l.bJ(g,e.u_dimension),u_zoom:new l.b7(g,e.u_zoom),u_unpack:new l.bH(g,e.u_unpack)}),line:(g,e)=>({u_translation:new l.bJ(g,e.u_translation),u_ratio:new l.b7(g,e.u_ratio),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bJ(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new l.bJ(g,e.u_translation),u_ratio:new l.b7(g,e.u_ratio),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bJ(g,e.u_units_to_pixels),u_image:new l.bE(g,e.u_image),u_image_height:new l.b7(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new l.bJ(g,e.u_translation),u_texsize:new l.bJ(g,e.u_texsize),u_ratio:new l.b7(g,e.u_ratio),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_image:new l.bE(g,e.u_image),u_units_to_pixels:new l.bJ(g,e.u_units_to_pixels),u_scale:new l.bI(g,e.u_scale),u_fade:new l.b7(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new l.bJ(g,e.u_translation),u_ratio:new l.b7(g,e.u_ratio),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bJ(g,e.u_units_to_pixels),u_patternscale_a:new l.bJ(g,e.u_patternscale_a),u_patternscale_b:new l.bJ(g,e.u_patternscale_b),u_sdfgamma:new l.b7(g,e.u_sdfgamma),u_image:new l.bE(g,e.u_image),u_tex_y_a:new l.b7(g,e.u_tex_y_a),u_tex_y_b:new l.b7(g,e.u_tex_y_b),u_mix:new l.b7(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new l.bJ(g,e.u_tl_parent),u_scale_parent:new l.b7(g,e.u_scale_parent),u_buffer_scale:new l.b7(g,e.u_buffer_scale),u_fade_t:new l.b7(g,e.u_fade_t),u_opacity:new l.b7(g,e.u_opacity),u_image0:new l.bE(g,e.u_image0),u_image1:new l.bE(g,e.u_image1),u_brightness_low:new l.b7(g,e.u_brightness_low),u_brightness_high:new l.b7(g,e.u_brightness_high),u_saturation_factor:new l.b7(g,e.u_saturation_factor),u_contrast_factor:new l.b7(g,e.u_contrast_factor),u_spin_weights:new l.bI(g,e.u_spin_weights),u_coords_top:new l.bH(g,e.u_coords_top),u_coords_bottom:new l.bH(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new l.bE(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bE(g,e.u_is_size_feature_constant),u_size_t:new l.b7(g,e.u_size_t),u_size:new l.b7(g,e.u_size),u_camera_to_center_distance:new l.b7(g,e.u_camera_to_center_distance),u_pitch:new l.b7(g,e.u_pitch),u_rotate_symbol:new l.bE(g,e.u_rotate_symbol),u_aspect_ratio:new l.b7(g,e.u_aspect_ratio),u_fade_change:new l.b7(g,e.u_fade_change),u_label_plane_matrix:new l.bG(g,e.u_label_plane_matrix),u_coord_matrix:new l.bG(g,e.u_coord_matrix),u_is_text:new l.bE(g,e.u_is_text),u_pitch_with_map:new l.bE(g,e.u_pitch_with_map),u_is_along_line:new l.bE(g,e.u_is_along_line),u_is_variable_anchor:new l.bE(g,e.u_is_variable_anchor),u_texsize:new l.bJ(g,e.u_texsize),u_texture:new l.bE(g,e.u_texture),u_translation:new l.bJ(g,e.u_translation),u_pitched_scale:new l.b7(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new l.bE(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bE(g,e.u_is_size_feature_constant),u_size_t:new l.b7(g,e.u_size_t),u_size:new l.b7(g,e.u_size),u_camera_to_center_distance:new l.b7(g,e.u_camera_to_center_distance),u_pitch:new l.b7(g,e.u_pitch),u_rotate_symbol:new l.bE(g,e.u_rotate_symbol),u_aspect_ratio:new l.b7(g,e.u_aspect_ratio),u_fade_change:new l.b7(g,e.u_fade_change),u_label_plane_matrix:new l.bG(g,e.u_label_plane_matrix),u_coord_matrix:new l.bG(g,e.u_coord_matrix),u_is_text:new l.bE(g,e.u_is_text),u_pitch_with_map:new l.bE(g,e.u_pitch_with_map),u_is_along_line:new l.bE(g,e.u_is_along_line),u_is_variable_anchor:new l.bE(g,e.u_is_variable_anchor),u_texsize:new l.bJ(g,e.u_texsize),u_texture:new l.bE(g,e.u_texture),u_gamma_scale:new l.b7(g,e.u_gamma_scale),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_is_halo:new l.bE(g,e.u_is_halo),u_translation:new l.bJ(g,e.u_translation),u_pitched_scale:new l.b7(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new l.bE(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bE(g,e.u_is_size_feature_constant),u_size_t:new l.b7(g,e.u_size_t),u_size:new l.b7(g,e.u_size),u_camera_to_center_distance:new l.b7(g,e.u_camera_to_center_distance),u_pitch:new l.b7(g,e.u_pitch),u_rotate_symbol:new l.bE(g,e.u_rotate_symbol),u_aspect_ratio:new l.b7(g,e.u_aspect_ratio),u_fade_change:new l.b7(g,e.u_fade_change),u_label_plane_matrix:new l.bG(g,e.u_label_plane_matrix),u_coord_matrix:new l.bG(g,e.u_coord_matrix),u_is_text:new l.bE(g,e.u_is_text),u_pitch_with_map:new l.bE(g,e.u_pitch_with_map),u_is_along_line:new l.bE(g,e.u_is_along_line),u_is_variable_anchor:new l.bE(g,e.u_is_variable_anchor),u_texsize:new l.bJ(g,e.u_texsize),u_texsize_icon:new l.bJ(g,e.u_texsize_icon),u_texture:new l.bE(g,e.u_texture),u_texture_icon:new l.bE(g,e.u_texture_icon),u_gamma_scale:new l.b7(g,e.u_gamma_scale),u_device_pixel_ratio:new l.b7(g,e.u_device_pixel_ratio),u_is_halo:new l.bE(g,e.u_is_halo),u_translation:new l.bJ(g,e.u_translation),u_pitched_scale:new l.b7(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new l.b7(g,e.u_opacity),u_color:new l.bF(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new l.b7(g,e.u_opacity),u_image:new l.bE(g,e.u_image),u_pattern_tl_a:new l.bJ(g,e.u_pattern_tl_a),u_pattern_br_a:new l.bJ(g,e.u_pattern_br_a),u_pattern_tl_b:new l.bJ(g,e.u_pattern_tl_b),u_pattern_br_b:new l.bJ(g,e.u_pattern_br_b),u_texsize:new l.bJ(g,e.u_texsize),u_mix:new l.b7(g,e.u_mix),u_pattern_size_a:new l.bJ(g,e.u_pattern_size_a),u_pattern_size_b:new l.bJ(g,e.u_pattern_size_b),u_scale_a:new l.b7(g,e.u_scale_a),u_scale_b:new l.b7(g,e.u_scale_b),u_pixel_coord_upper:new l.bJ(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bJ(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.b7(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new l.bE(g,e.u_texture),u_ele_delta:new l.b7(g,e.u_ele_delta),u_fog_matrix:new l.bG(g,e.u_fog_matrix),u_fog_color:new l.bF(g,e.u_fog_color),u_fog_ground_blend:new l.b7(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.b7(g,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bF(g,e.u_horizon_color),u_horizon_fog_blend:new l.b7(g,e.u_horizon_fog_blend),u_is_globe_mode:new l.b7(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new l.b7(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new l.bE(g,e.u_texture),u_terrain_coords_id:new l.b7(g,e.u_terrain_coords_id),u_ele_delta:new l.b7(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new l.b7(g,e.u_input),u_output_expected:new l.b7(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new l.bI(g,e.u_sun_pos),u_atmosphere_blend:new l.b7(g,e.u_atmosphere_blend),u_globe_position:new l.bI(g,e.u_globe_position),u_globe_radius:new l.b7(g,e.u_globe_radius),u_inv_proj_matrix:new l.bG(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new l.bF(g,e.u_sky_color),u_horizon_color:new l.bF(g,e.u_horizon_color),u_horizon:new l.bJ(g,e.u_horizon),u_horizon_normal:new l.bJ(g,e.u_horizon_normal),u_sky_horizon_blend:new l.b7(g,e.u_sky_horizon_blend),u_sky_blend:new l.b7(g,e.u_sky_blend)})};class Oh{constructor(e,i,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const is={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class os{constructor(e,i,u,d){this.length=i.length,this.attributes=u,this.itemSize=i.bytesPerElement,this.dynamicDraw=d,this.context=e;const _=e.gl;this.buffer=_.createBuffer(),e.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let u=0;u<this.attributes.length;u++){const d=i.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,i,u){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],w=i.attributes[_.name];w!==void 0&&e.vertexAttribPointer(w,_.components,e[is[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ap extends Dn{getDefault(){return l.b6.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class zp extends Dn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class fl extends Dn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Lo extends Dn{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Bh extends Dn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Rp extends Dn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class of extends Dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class _u extends Dn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class yu extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class vu extends Dn{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Qs extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ae extends Dn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class nt extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class Ve extends Dn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class zt extends Dn{getDefault(){return l.b6.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class un extends Dn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class jn extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class gr extends Dn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class qn extends Dn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class pl extends Dn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class cc extends Dn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class zi extends Dn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class uc extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ml extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Fo extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class hc extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class gl extends Dn{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bt extends Dn{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const u=this.gl;Tn(u)?u.bindVertexArray(e):(i=u.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class xu extends Dn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class sf extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class dc extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ia extends Dn{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class Dp extends Ia{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Lp extends Ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fc extends Ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const ws="Framebuffer is not complete";class _l{constructor(e,i,u,d,_){this.context=e,this.width=i,this.height=u;const w=e.gl,P=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Dp(e,P),d)this.depthAttachment=_?new fc(e,P):new Lp(e,P);else if(_)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(ws)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class pc{constructor(e){var i,u;if(this.gl=e,this.clearColor=new Ap(this),this.clearDepth=new zp(this),this.clearStencil=new fl(this),this.colorMask=new Lo(this),this.depthMask=new Bh(this),this.stencilMask=new Rp(this),this.stencilFunc=new of(this),this.stencilOp=new _u(this),this.stencilTest=new yu(this),this.depthRange=new vu(this),this.depthTest=new Qs(this),this.depthFunc=new Ae(this),this.blend=new nt(this),this.blendFunc=new Ve(this),this.blendColor=new zt(this),this.blendEquation=new un(this),this.cullFace=new jn(this),this.cullFaceSide=new gr(this),this.frontFace=new qn(this),this.program=new pl(this),this.activeTexture=new cc(this),this.viewport=new zi(this),this.bindFramebuffer=new uc(this),this.bindRenderbuffer=new ml(this),this.bindTexture=new Fo(this),this.bindVertexBuffer=new hc(this),this.bindElementBuffer=new gl(this),this.bindVertexArray=new Bt(this),this.pixelStoreUnpack=new xu(this),this.pixelStoreUnpackPremultiplyAlpha=new sf(this),this.pixelStoreUnpackFlipY=new dc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Tn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new Oh(this,e,i)}createVertexBuffer(e,i,u){return new os(this,e,i,u)}createRenderbuffer(e,i,u){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,e,i,u),this.bindRenderbuffer.set(null),_}createFramebuffer(e,i,u,d){return new _l(this,e,i,u,d)}clear({color:e,depth:i,stencil:u}){const d=this.gl;let _=0;e&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),u!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(_)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bB(e.blendFunction,sr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Tn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return Tn(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let ss;function mc(g,e,i,u,d){const _=g.context,w=g.transform,P=_.gl,M=g.useProgram("collisionBox"),k=[];let D=0,O=0;for(let se=0;se<u.length;se++){const ue=u[se],me=e.getTile(ue).getBucket(i);if(!me)continue;const ge=d?me.textCollisionBox:me.iconCollisionBox,be=me.collisionCircleArray;be.length>0&&(k.push({circleArray:be,circleOffset:O,coord:ue}),D+=be.length/4,O=D),ge&&M.draw(_,P.LINES,cn.disabled,In.disabled,g.colorModeForRenderPass(),Sn.disabled,cu(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ue),w.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,g.transform.zoom,null,null,ge.collisionVertexBuffer)}if(!d||!k.length)return;const B=g.useProgram("collisionCircle"),G=new l.bO;G.resize(4*D),G._trim();let W=0;for(const se of k)for(let ue=0;ue<se.circleArray.length/4;ue++){const me=4*ue,ge=se.circleArray[me+0],be=se.circleArray[me+1],Pe=se.circleArray[me+2],Se=se.circleArray[me+3];G.emplace(W++,ge,be,Pe,Se,0),G.emplace(W++,ge,be,Pe,Se,1),G.emplace(W++,ge,be,Pe,Se,2),G.emplace(W++,ge,be,Pe,Se,3)}(!ss||ss.length<2*D)&&(ss=function(se){const ue=2*se,me=new l.bQ;me.resize(ue),me._trim();for(let ge=0;ge<ue;ge++){const be=6*ge;me.uint16[be+0]=4*ge+0,me.uint16[be+1]=4*ge+1,me.uint16[be+2]=4*ge+2,me.uint16[be+3]=4*ge+2,me.uint16[be+4]=4*ge+3,me.uint16[be+5]=4*ge+0}return me}(D));const ie=_.createIndexBuffer(ss,!0),re=_.createVertexBuffer(G,l.bP.members,!0);for(const se of k){const ue=uu(g.transform);B.draw(_,P.TRIANGLES,cn.disabled,In.disabled,g.colorModeForRenderPass(),Sn.disabled,ue,g.style.map.terrain&&g.style.map.terrain.getTerrainData(se.coord),null,i.id,re,ie,l.aF.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,g.transform.zoom,null,null,null)}re.destroy(),ie.destroy()}const bu=l.as(new Float32Array(16));function gc(g,e,i,u,d,_){const{horizontalAlign:w,verticalAlign:P}=l.aA(g);return new l.P((-(w-.5)*e/d+u[0])*_,(-(P-.5)*i/d+u[1])*_)}function _c(g,e,i,u,d,_){const w=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let P=u.mult(_);i||(P=P.rotate(-d));const M=w.add(P);return $e(M.x,M.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const P=It(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),M=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return g.add(u.rotate(M))}return g.add(u)}function ea(g,e,i,u,d,_,w,P,M,k,D,O){const B=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,W=g.icon.dynamicLayoutVertexArray,ie={};G.clear();for(let re=0;re<B.length;re++){const se=B.get(re),ue=se.hidden||!se.crossTileID||g.allowVerticalPlacement&&!se.placedOrientation?null:u[se.crossTileID];if(ue){const me=new l.P(se.anchorX,se.anchorY),ge={getElevation:O,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:i,transform:d,tileAnchorPoint:me,translation:k,unwrappedTileID:D},be=i?hn(me.x,me.y,ge):It(me.x,me.y,ge),Pe=Re(d.cameraToCenterDistance,be.signedDistanceFromCamera);let Se=l.ah(g.textSizeData,P,se)*Pe/l.au;i&&(Se*=g.tilePixelRatio/w);const{width:Be,height:je,anchor:He,textOffset:Ye,textBoxScale:Ze}=ue,tt=gc(He,Be,je,Ye,Ze,Se),mt=d.getPitchedTextCorrection(me.x+k[0],me.y+k[1],D),ot=_c(be.point,ge,e,tt,-d.bearingInRadians,mt),Mt=g.allowVerticalPlacement&&se.placedOrientation===l.ag.vertical?Math.PI/2:0;for(let Ot=0;Ot<se.numGlyphs;Ot++)l.an(G,ot,Mt);M&&se.associatedIconIndex>=0&&(ie[se.associatedIconIndex]={shiftedAnchor:ot,angle:Mt})}else Nr(se.numGlyphs,G)}if(M){W.clear();const re=g.icon.placedSymbolArray;for(let se=0;se<re.length;se++){const ue=re.get(se);if(ue.hidden)Nr(ue.numGlyphs,W);else{const me=ie[se];if(me)for(let ge=0;ge<ue.numGlyphs;ge++)l.an(W,me.shiftedAnchor,me.angle);else Nr(ue.numGlyphs,W)}}g.icon.dynamicLayoutVertexBuffer.updateData(W)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function Ss(g,e,i){return i.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function yc(g,e,i,u,d,_,w,P,M,k,D,O,B){const G=g.context,W=G.gl,ie=g.transform,re=P==="map",se=M==="map",ue=P!=="viewport"&&i.layout.get("symbol-placement")!=="point",me=re&&!se&&!ue,ge=!i.layout.get("symbol-sort-key").isConstant();let be=!1;const Pe=g.getDepthModeForSublayer(0,cn.ReadOnly),Se=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[],je=ie.getCircleRadiusCorrection();for(const He of u){const Ye=e.getTile(He),Ze=Ye.getBucket(i);if(!Ze)continue;const tt=d?Ze.text:Ze.icon;if(!tt||!tt.segments.get().length||!tt.hasVisibleVertices)continue;const mt=tt.programConfigurations.get(i.id),ot=d||Ze.sdfIcons,Mt=d?Ze.textSizeData:Ze.iconSizeData,Ot=se||ie.pitch!==0,Fn=g.useProgram(Ss(ot,d,Ze),mt),ar=l.af(Mt,ie.zoom),vn=g.style.map.terrain&&g.style.map.terrain.getTerrainData(He);let _r,Jn,zn,Wn,Qr=[0,0],Hn=null;if(d)Jn=Ye.glyphAtlasTexture,zn=W.LINEAR,_r=Ye.glyphAtlasTexture.size,Ze.iconsInText&&(Qr=Ye.imageAtlasTexture.size,Hn=Ye.imageAtlasTexture,Wn=Ot||g.options.rotating||g.options.zooming||Mt.kind==="composite"||Mt.kind==="camera"?W.LINEAR:W.NEAREST);else{const or=i.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;Jn=Ye.imageAtlasTexture,zn=ot||g.options.rotating||g.options.zooming||or||Ot?W.LINEAR:W.NEAREST,_r=Ye.imageAtlasTexture.size}const dr=l.av(Ye,1,g.transform.zoom),ei=Ue(re,g.transform,dr),Ms=l.K();l.ai(Ms,ei);const wo=Me(se,re,g.transform,dr),$o=l.aw(ie,Ye,_,w),Xi=ie.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),ca=Se&&Ze.hasTextData(),Na=i.layout.get("icon-text-fit")!=="none"&&ca&&Ze.hasIconData();if(ue){const or=g.style.map.terrain?(ni,ri)=>g.style.map.terrain.getElevation(He,ni,ri):null,Xn=i.layout.get("text-rotation-alignment")==="map";De(Ze,g,d,ei,Ms,se,k,Xn,He.toUnwrapped(),ie.width,ie.height,$o,or)}const Is=d&&Se||Na,ti=ue||Is?bu:se?ei:g.transform.clipSpaceToPixelsMatrix,cs=ot&&i.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ui;ui=ot?Ze.iconsInText?mu(Mt.kind,ar,me,se,ue,Is,g,ti,wo,$o,_r,Qr,je):Lh(Mt.kind,ar,me,se,ue,Is,g,ti,wo,$o,d,_r,0,je):pu(Mt.kind,ar,me,se,ue,Is,g,ti,wo,$o,d,_r,je);const Zo={program:Fn,buffers:tt,uniformValues:ui,projectionData:Xi,atlasTexture:Jn,atlasTextureIcon:Hn,atlasInterpolation:zn,atlasInterpolationIcon:Wn,isSDF:ot,hasHalo:cs};if(ge&&Ze.canOverlap){be=!0;const or=tt.segments.get();for(const Xn of or)Be.push({segments:new l.aF([Xn]),sortKey:Xn.sortKey,state:Zo,terrainData:vn})}else Be.push({segments:tt.segments,sortKey:0,state:Zo,terrainData:vn})}be&&Be.sort((He,Ye)=>He.sortKey-Ye.sortKey);for(const He of Be){const Ye=He.state;if(G.activeTexture.set(W.TEXTURE0),Ye.atlasTexture.bind(Ye.atlasInterpolation,W.CLAMP_TO_EDGE),Ye.atlasTextureIcon&&(G.activeTexture.set(W.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ye.isSDF){const Ze=Ye.uniformValues;Ye.hasHalo&&(Ze.u_is_halo=1,wu(Ye.buffers,He.segments,i,g,Ye.program,Pe,D,O,Ze,Ye.projectionData,He.terrainData)),Ze.u_is_halo=0}wu(Ye.buffers,He.segments,i,g,Ye.program,Pe,D,O,Ye.uniformValues,Ye.projectionData,He.terrainData)}}function wu(g,e,i,u,d,_,w,P,M,k,D){const O=u.context;d.draw(O,O.gl.TRIANGLES,_,w,P,Sn.backCCW,M,D,k,i.id,g.layoutVertexBuffer,g.indexBuffer,e,i.paint,u.transform.zoom,g.programConfigurations.get(i.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Fp(g,e,i,u,d){const _=g.context,w=_.gl,P=In.disabled,M=new sr([w.ONE,w.ONE],l.b6.transparent,[!0,!0,!0,!0]),k=e.getBucket(i);if(!k)return;const D=u.key;let O=i.heatmapFbos.get(D);O||(O=ta(_,e.tileSize,e.tileSize),i.heatmapFbos.set(D,O)),_.bindFramebuffer.set(O.framebuffer),_.viewport.set([0,0,e.tileSize,e.tileSize]),_.clear({color:l.b6.transparent});const B=k.programConfigurations.get(i.id),G=g.useProgram("heatmap",B,!d),W=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=g.style.map.terrain.getTerrainData(u);G.draw(_,w.TRIANGLES,cn.disabled,P,M,Sn.disabled,hu(e,g.transform.zoom,i.paint.get("heatmap-intensity"),1),ie,W,i.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,i.paint,g.transform.zoom,B)}function af(g,e,i,u,d){const _=g.context,w=_.gl,P=g.transform;_.setColorMode(g.colorModeForRenderPass());const M=ka(_,e),k=i.key,D=e.heatmapFbos.get(k);if(!D)return;_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(w.TEXTURE1),M.bind(w.LINEAR,w.CLAMP_TO_EDGE);const O=P.getProjectionData({overscaledTileID:i,applyTerrainMatrix:d,applyGlobeMatrix:!u});g.useProgram("heatmapTexture").draw(_,w.TRIANGLES,cn.disabled,In.disabled,g.colorModeForRenderPass(),Sn.disabled,Rh(g,e,0,1),null,O,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,P.zoom),D.destroy(),e.heatmapFbos.delete(k)}function ta(g,e,i){var u,d;const _=g.gl,w=_.createTexture();_.bindTexture(_.TEXTURE_2D,w),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const P=(u=g.HALF_FLOAT)!==null&&u!==void 0?u:_.UNSIGNED_BYTE,M=(d=g.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,M,e,i,0,_.RGBA,P,null);const k=g.createFramebuffer(e,i,!1,!1);return k.colorAttachment.set(w),k}function ka(g,e){return e.colorRampTexture||(e.colorRampTexture=new ne(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function vc(g,e,i,u,d){if(!i||!u||!u.imageAtlas)return;const _=u.imageAtlas.patternPositions;let w=_[i.to.toString()],P=_[i.from.toString()];if(!w&&P&&(w=P),!P&&w&&(P=w),!w||!P){const M=d.getPaintProperty(e);w=_[M],P=_[M]}w&&P&&g.setConstantPatternPositions(w,P)}function Nh(g,e,i,u,d,_,w,P){const M=g.context.gl,k="fill-pattern",D=i.paint.get(k),O=D&&D.constantOr(1),B=i.getCrossfadeParameters();let G,W,ie,re,se;const ue=g.transform,me=i.paint.get("fill-translate"),ge=i.paint.get("fill-translate-anchor");w?(W=O&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=M.LINES):(W=O?"fillPattern":"fill",G=M.TRIANGLES);const be=D.constantOr(null);for(const Pe of u){const Se=e.getTile(Pe);if(O&&!Se.patternsLoaded())continue;const Be=Se.getBucket(i);if(!Be)continue;const je=Be.programConfigurations.get(i.id),He=g.useProgram(W,je),Ye=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe);O&&(g.context.activeTexture.set(M.TEXTURE0),Se.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),je.updatePaintBuffers(B)),vc(je,k,be,Se,i);const Ze=ue.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),tt=l.aw(ue,Se,me,ge);if(w){re=Be.indexBuffer2,se=Be.segments2;const ot=[M.drawingBufferWidth,M.drawingBufferHeight];ie=W==="fillOutlinePattern"&&O?kp(g,B,Se,ot,tt):Ma(ot,tt)}else re=Be.indexBuffer,se=Be.segments,ie=O?oc(g,B,Se,tt):{u_fill_translate:tt};let mt;if(g.renderPass==="translucent"&&P){const[ot]=g.getStencilConfigForOverlapAndUpdateStencilID(u);mt=ot[Pe.overscaledZ]}else mt=g.stencilModeForClipping(Pe);He.draw(g.context,G,d,mt,_,Sn.backCCW,ie,Ye,Ze,i.id,Be.layoutVertexBuffer,re,se,i.paint,g.transform.zoom,je)}}function Aa(g,e,i,u,d,_,w,P){const M=g.context,k=M.gl,D="fill-extrusion-pattern",O=i.paint.get(D),B=O.constantOr(1),G=i.getCrossfadeParameters(),W=i.paint.get("fill-extrusion-opacity"),ie=O.constantOr(null),re=g.transform;for(const se of u){const ue=e.getTile(se),me=ue.getBucket(i);if(!me)continue;const ge=g.style.map.terrain&&g.style.map.terrain.getTerrainData(se),be=me.programConfigurations.get(i.id),Pe=g.useProgram(B?"fillExtrusionPattern":"fillExtrusion",be);B&&(g.context.activeTexture.set(k.TEXTURE0),ue.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),be.updatePaintBuffers(G));const Se=re.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!P,applyTerrainMatrix:!0});vc(be,D,ie,ue,i);const Be=l.aw(re,ue,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),je=i.paint.get("fill-extrusion-vertical-gradient"),He=B?Ea(g,je,W,Be,se,G,ue):ef(g,je,W,Be);Pe.draw(M,M.gl.TRIANGLES,d,_,w,Sn.backCCW,He,ge,Se,i.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,i.paint,g.transform.zoom,be,g.style.map.terrain&&me.centroidVertexBuffer)}}function xc(g,e,i,u,d,_,w,P,M){var k;const D=g.style.projection,O=g.context,B=g.transform,G=O.gl,W=g.useProgram("hillshade"),ie=!g.options.moving;for(const re of u){const se=e.getTile(re),ue=se.fbo;if(!ue)continue;const me=D.getMeshFromTileID(O,re.canonical,P,!0,"raster"),ge=(k=g.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(re);O.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ue.colorAttachment.get());const be=B.getProjectionData({overscaledTileID:re,aligned:ie,applyGlobeMatrix:!M,applyTerrainMatrix:!0});W.draw(O,G.TRIANGLES,_,d[re.overscaledZ],w,Sn.backCCW,bs(g,se,i),ge,be,i.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const jh=[new l.P(0,0),new l.P(l.Z,0),new l.P(l.Z,l.Z),new l.P(0,l.Z)];function Tr(g,e,i,u,d,_,w,P,M=!1,k=!1){const D=u[u.length-1].overscaledZ,O=g.context,B=O.gl,G=g.useProgram("raster"),W=g.transform,ie=g.style.projection,re=g.colorModeForRenderPass(),se=!g.options.moving;for(const ue of u){const me=g.getDepthModeForSublayer(ue.overscaledZ-D,i.paint.get("raster-opacity")===1?cn.ReadWrite:cn.ReadOnly,B.LESS),ge=e.getTile(ue);ge.registerFadeDuration(i.paint.get("raster-fade-duration"));const be=e.findLoadedParent(ue,0),Pe=e.findLoadedSibling(ue),Se=Cn(ge,be||Pe||null,e,i,g.transform,g.style.map.terrain);let Be,je;const He=i.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;O.activeTexture.set(B.TEXTURE0),ge.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(B.TEXTURE1),be?(be.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),Be=Math.pow(2,be.tileID.overscaledZ-ge.tileID.overscaledZ),je=[ge.tileID.canonical.x*Be%1,ge.tileID.canonical.y*Be%1]):ge.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),ge.texture.useMipmap&&O.extTextureFilterAnisotropic&&g.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const Ye=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ue),Ze=W.getProjectionData({overscaledTileID:ue,aligned:se,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),tt=nf(je||[0,0],Be||1,Se,i,P),mt=ie.getMeshFromTileID(O,ue.canonical,_,w,"raster");G.draw(O,B.TRIANGLES,me,d?d[ue.overscaledZ]:In.disabled,re,M?Sn.frontCCW:Sn.backCCW,tt,Ye,Ze,i.id,mt.vertexBuffer,mt.indexBuffer,mt.segments)}}function Cn(g,e,i,u,d,_){const w=u.paint.get("raster-fade-duration");if(!_&&w>0){const P=oe.now(),M=(P-g.timeAdded)/w,k=e?(P-e.timeAdded)/w:-1,D=i.getSource(),O=ji(d,{tileSize:D.tileSize,roundZoom:D.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),G=B&&g.refreshedUponExpiration?1:l.ad(B?M:1-k,0,1);return g.refreshedUponExpiration&&M>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const za=new l.b6(1,0,0,1),bo=new l.b6(0,1,0,1),Su=new l.b6(0,0,1,1),Uh=new l.b6(1,0,1,1),Tu=new l.b6(0,1,1,1);function Oo(g,e,i,u){Bo(g,0,e+i/2,g.transform.width,i,u)}function na(g,e,i,u){Bo(g,e-i/2,0,i,g.transform.height,u)}function Bo(g,e,i,u,d,_){const w=g.context,P=w.gl;P.enable(P.SCISSOR_TEST),P.scissor(e*g.pixelRatio,i*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),w.clear({color:_}),P.disable(P.SCISSOR_TEST)}function yl(g,e,i){const u=g.context,d=u.gl,_=g.useProgram("debug"),w=cn.disabled,P=In.disabled,M=g.colorModeForRenderPass(),k="$debug",D=g.style.map.terrain&&g.style.map.terrain.getTerrainData(i);u.activeTexture.set(d.TEXTURE0);const O=e.getTileByID(i.key).latestRawTileData,B=Math.floor((O&&O.byteLength||0)/1024),G=e.getTile(i).tileSize,W=512/Math.min(G,512)*(i.overscaledZ/g.transform.zoom)*.5;let ie=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(ie+=` => ${i.overscaledZ}`),function(se,ue){se.initDebugOverlayCanvas();const me=se.debugOverlayCanvas,ge=se.context.gl,be=se.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,me.width,me.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(ue,5,5),be.strokeText(ue,5,5),se.debugOverlayTexture.update(me),se.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(g,`${ie} ${B}kB`);const re=g.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(u,d.TRIANGLES,w,P,sr.alphaBlended,Sn.disabled,sc(l.b6.transparent,W),null,re,k,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(u,d.LINE_STRIP,w,P,M,Sn.disabled,sc(l.b6.red),D,re,k,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Ra(g,e,i,u){const{isRenderingGlobe:d}=u,_=g.context,w=_.gl,P=g.transform,M=g.colorModeForRenderPass(),k=g.getDepthModeFor3D(),D=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const O of i){const B=e.getTerrainMesh(O.tileID),G=g.renderToTexture.getTexture(O),W=e.getTerrainData(O.tileID);_.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,G.texture);const ie=e.getMeshFrameDelta(P.zoom),re=P.calculateFogMatrix(O.tileID.toUnwrapped()),se=nc(ie,re,g.style.sky,P.pitch,d),ue=P.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(_,w.TRIANGLES,k,In.disabled,M,Sn.backCCW,se,W,ue,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function vl(g,e){if(!e.mesh){const i=new l.aE;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const u=new l.aG;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new Vi(g.createVertexBuffer(i,$i.members),g.createIndexBuffer(u),l.aF.simpleSegment(0,0,i.length,u.length))}return e.mesh}class Da{constructor(e,i){this.context=new pc(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=F.maxUnderzooming+F.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al}resize(e,i,u){if(this.width=Math.floor(e*u),this.height=Math.floor(i*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,i=new l.aE;i.emplaceBack(0,0),i.emplaceBack(l.Z,0),i.emplaceBack(0,l.Z),i.emplaceBack(l.Z,l.Z),this.tileExtentBuffer=e.createVertexBuffer(i,$i.members),this.tileExtentSegments=l.aF.simpleSegment(0,0,4,2);const u=new l.aE;u.emplaceBack(0,0),u.emplaceBack(l.Z,0),u.emplaceBack(0,l.Z),u.emplaceBack(l.Z,l.Z),this.debugBuffer=e.createVertexBuffer(u,$i.members),this.debugSegments=l.aF.simpleSegment(0,0,4,5);const d=new l.bV;d.emplaceBack(0,0,0,0),d.emplaceBack(l.Z,0,l.Z,0),d.emplaceBack(0,l.Z,0,l.Z),d.emplaceBack(l.Z,l.Z,l.Z,l.Z),this.rasterBoundsBuffer=e.createVertexBuffer(d,Nn.members),this.rasterBoundsSegments=l.aF.simpleSegment(0,0,4,2);const _=new l.aE;_.emplaceBack(0,0),_.emplaceBack(l.Z,0),_.emplaceBack(0,l.Z),_.emplaceBack(l.Z,l.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(_,$i.members),this.rasterBoundsSegmentsPosOnly=l.aF.simpleSegment(0,0,4,5);const w=new l.aE;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(w,$i.members),this.viewportSegments=l.aF.simpleSegment(0,0,4,2);const P=new l.bW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(P);const M=new l.aG;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(M);const k=this.context.gl;this.stencilClearMode=new In({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new Vi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.K();l.bN(u,0,this.width,this.height,0,0,1),l.M(u,u,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const d={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,cn.disabled,this.stencilClearMode,sr.disabled,Sn.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const d=this.context;d.setColorMode(sr.disabled),d.setDepthMode(cn.disabled);const _={};for(const w of i)_[w.key]=this.nextStencilID++;this._renderTileMasks(_,i,u,!0),this._renderTileMasks(_,i,u,!1),this._tileClippingMaskIDs=_}_renderTileMasks(e,i,u,d){const _=this.context,w=_.gl,P=this.style.projection,M=this.transform,k=this.useProgram("clippingMask");for(const D of i){const O=e[D.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),G=P.getMeshFromTileID(this.context,D.canonical,d,!0,"stencil"),W=M.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});k.draw(_,w.TRIANGLES,cn.disabled,new In({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),sr.disabled,u?Sn.disabled:Sn.backCCW,null,B,W,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,u=this.style.projection,d=this.transform,_=this.useProgram("depth"),w=this.getDepthModeFor3D(),P=ze(d,{tileSize:d.tileSize});for(const M of P){const k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),D=u.getMeshFromTileID(this.context,M.canonical,!0,!0,"raster"),O=d.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(e,i.TRIANGLES,w,In.disabled,sr.disabled,Sn.backCCW,null,k,O,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new In({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new In({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,u=e.sort((w,P)=>P.overscaledZ-w.overscaledZ),d=u[u.length-1].overscaledZ,_=u[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let P=0;P<_;P++)w[P+d]=new In({func:i.GEQUAL,mask:255},P+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=_,[w,u]}return[{[d]:In.disabled},u]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,u=e.sort((w,P)=>P.overscaledZ-w.overscaledZ),d=u[u.length-1].overscaledZ,_=u[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const w={},P={};for(let M=0;M<_;M++)w[M+d]=new In({func:i.GREATER,mask:255},_+1+M,255,i.KEEP,i.KEEP,i.REPLACE),P[M+d]=new In({func:i.GREATER,mask:255},1+M,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*_+1,[w,P,u]}return this.nextStencilID=3,[{[d]:new In({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[d]:new In({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new sr([e.CONSTANT_COLOR,e.ONE],new l.b6(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sr.unblended:sr.alphaBlended}getDepthModeForSublayer(e,i,u){if(!this.opaquePassEnabledForLayer())return cn.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new cn(u||this.context.gl.LEQUAL,i,[d,d])}getDepthModeFor3D(){return new cn(this.context.gl.LEQUAL,cn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var u,d;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(oe.now()),this.imageManager.beginFrame();const _=this.style._order,w=this.style.sourceCaches,P={},M={},k={},D={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const B in w){const G=w[B];G.used&&G.prepare(this.context),P[B]=G.getVisibleCoordinates(!1),M[B]=P[B].slice().reverse(),k[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of _){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const W=M[G.source];(G.type==="custom"||W.length)&&this.renderLayer(this,w[G.source],G,W,D)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?l.b6.black:l.b6.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,G){const W=B.context,ie=W.gl,re=((Pe,Se,Be)=>{const je=Math.cos(Se.rollInRadians),He=Math.sin(Se.rollInRadians),Ye=Yr(Se),Ze=Se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(Se.width/2-Ye*He)*Be,(Se.height/2+Ye*je)*Be],u_horizon_normal:[-He,je],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*Se.height/2*Be,u_sky_blend:Ze}})(G,B.style.map.transform,B.pixelRatio),se=new cn(ie.LEQUAL,cn.ReadWrite,[0,1]),ue=In.disabled,me=B.colorModeForRenderPass(),ge=B.useProgram("sky"),be=vl(W,G);ge.draw(W,ie.TRIANGLES,se,ue,me,Sn.disabled,re,null,void 0,"sky",be.vertexBuffer,be.indexBuffer,be.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],G=w[B.source],W=P[B.source];this._renderTileClippingMasks(B,W,!1),this.renderLayer(this,G,B,W,D)}this.renderPass="translucent";let O=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],G=w[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,D))continue;this.opaquePassEnabledForLayer()||O||(O=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(B.type==="symbol"?k:M)[B.source];this._renderTileClippingMasks(B,P[B.source],!1),this.renderLayer(this,G,B,W,D)}if(D.isRenderingGlobe&&function(B,G,W){const ie=B.context,re=ie.gl,se=B.useProgram("atmosphere"),ue=new cn(re.LEQUAL,cn.ReadOnly,[0,1]),me=B.transform,ge=function(Ze,tt){const mt=Ze.properties.get("position"),ot=[-mt.x,-mt.y,-mt.z],Mt=l.as(new Float64Array(16));return Ze.properties.get("anchor")==="map"&&(l.aZ(Mt,Mt,tt.rollInRadians),l.a_(Mt,Mt,-tt.pitchInRadians),l.aZ(Mt,Mt,tt.bearingInRadians),l.a_(Mt,Mt,tt.center.lat*Math.PI/180),l.bl(Mt,Mt,-tt.center.lng*Math.PI/180)),l.bU(ot,ot,Mt),ot}(W,B.transform),be=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=G.properties.get("atmosphere-blend")*be.projectionTransition;if(Pe===0)return;const Se=kr(me.worldSize,me.center.lat),Be=me.inverseProjectionMatrix,je=new Float64Array(4);je[3]=1,l.ao(je,je,me.modelViewProjectionMatrix),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1,l.ao(je,je,Be),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1;const He=((Ze,tt,mt,ot,Mt)=>({u_sun_pos:Ze,u_atmosphere_blend:tt,u_globe_position:mt,u_globe_radius:ot,u_inv_proj_matrix:Mt}))(ge,Pe,[je[0],je[1],je[2]],Se,Be),Ye=vl(ie,G);se.draw(ie,re.TRIANGLES,ue,In.disabled,sr.alphaBlended,Sn.disabled,He,null,null,"atmosphere",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=function(G,W){let ie=null;const re=Object.values(G._layers).flatMap(ge=>ge.source&&!ge.isHidden(W)?[G.sourceCaches[ge.source]]:[]),se=re.filter(ge=>ge.getSource().type==="vector"),ue=re.filter(ge=>ge.getSource().type!=="vector"),me=ge=>{(!ie||ie.getSource().maxzoom<ge.getSource().maxzoom)&&(ie=ge)};return se.forEach(ge=>me(ge)),ie||ue.forEach(ge=>me(ge)),ie}(this.style,this.transform.zoom);B&&function(G,W,ie){for(let re=0;re<ie.length;re++)yl(G,W,ie[re])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const G=B.transform.padding;Oo(B,B.transform.height-(G.top||0),3,za),Oo(B,G.bottom||0,3,bo),na(B,G.left||0,3,Su),na(B,B.transform.width-(G.right||0),3,Uh);const W=B.transform.centerPoint;(function(ie,re,se,ue){Bo(ie,re-1,se-10,2,20,ue),Bo(ie,re-10,se-1,20,2,ue)})(B,W.x,B.transform.height-W.y,Tu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!l.bX(i,u):!l.bY(i,u)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(l.bZ(i,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,w){const P=_.context,M=P.gl,k=_.transform,D=sr.unblended,O=new cn(M.LEQUAL,cn.ReadWrite,[0,1]),B=w.sourceCache.getRenderableTiles(),G=_.useProgram("terrainDepth");P.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:l.b6.transparent,depth:1});for(const W of B){const ie=w.getTerrainMesh(W.tileID),re=w.getTerrainData(W.tileID),se=k.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:w.getMeshFrameDelta(k.zoom)};G.draw(P,M.TRIANGLES,O,In.disabled,D,Sn.backCCW,ue,re,se,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,w){const P=_.context,M=P.gl,k=_.transform,D=sr.unblended,O=new cn(M.LEQUAL,cn.ReadWrite,[0,1]),B=w.getCoordsTexture(),G=w.sourceCache.getRenderableTiles(),W=_.useProgram("terrainCoords");P.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),P.clear({color:l.b6.transparent,depth:1}),w.coordsIndex=[];for(const ie of G){const re=w.getTerrainMesh(ie.tileID),se=w.getTerrainData(ie.tileID);P.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,B.texture);const ue={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(k.zoom)},me=k.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(P,M.TRIANGLES,O,In.disabled,D,Sn.backCCW,ue,se,me,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),w.coordsIndex.push(ie.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(e,i,u,d,_){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,l.b_(u)?function(w,P,M,k,D,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:B}=O,G=In.disabled,W=w.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ie,re,se,ue,me,ge,be,Pe,Se){const Be=re.transform,je=re.style.map.terrain,He=me==="map",Ye=ge==="map";for(const Ze of ie){const tt=ue.getTile(Ze),mt=tt.getBucket(se);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const ot=l.af(mt.textSizeData,Be.zoom),Mt=l.av(tt,1,re.transform.zoom),Ot=Ue(He,re.transform,Mt),Fn=se.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(ot){const ar=Math.pow(2,Be.zoom-tt.tileID.overscaledZ),vn=je?(_r,Jn)=>je.getElevation(Ze,_r,Jn):null;ea(mt,He,Ye,Se,Be,Ot,ar,ot,Fn,l.aw(Be,tt,be,Pe),Ze.toUnwrapped(),vn)}}}(k,w,M,P,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),D),M.paint.get("icon-opacity").constantOr(1)!==0&&yc(w,P,M,k,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),G,W,B),M.paint.get("text-opacity").constantOr(1)!==0&&yc(w,P,M,k,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),G,W,B),P.map.showCollisionBoxes&&(mc(w,P,M,k,!0),mc(w,P,M,k,!1))}(e,i,u,d,this.style.placement.variableOffsets,_):l.b$(u)?function(w,P,M,k,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:O}=D,B=M.paint.get("circle-opacity"),G=M.paint.get("circle-stroke-width"),W=M.paint.get("circle-stroke-opacity"),ie=!M.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(G.constantOr(1)===0||W.constantOr(1)===0))return;const re=w.context,se=re.gl,ue=w.transform,me=w.getDepthModeForSublayer(0,cn.ReadOnly),ge=In.disabled,be=w.colorModeForRenderPass(),Pe=[],Se=ue.getCircleRadiusCorrection();for(let Be=0;Be<k.length;Be++){const je=k[Be],He=P.getTile(je),Ye=He.getBucket(M);if(!Ye)continue;const Ze=M.paint.get("circle-translate"),tt=M.paint.get("circle-translate-anchor"),mt=l.aw(ue,He,Ze,tt),ot=Ye.programConfigurations.get(M.id),Mt=w.useProgram("circle",ot),Ot=Ye.layoutVertexBuffer,Fn=Ye.indexBuffer,ar=w.style.map.terrain&&w.style.map.terrain.getTerrainData(je),vn={programConfiguration:ot,program:Mt,layoutVertexBuffer:Ot,indexBuffer:Fn,uniformValues:zh(w,He,M,mt,Se),terrainData:ar,projectionData:ue.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!O,applyTerrainMatrix:!0})};if(ie){const _r=Ye.segments.get();for(const Jn of _r)Pe.push({segments:new l.aF([Jn]),sortKey:Jn.sortKey,state:vn})}else Pe.push({segments:Ye.segments,sortKey:0,state:vn})}ie&&Pe.sort((Be,je)=>Be.sortKey-je.sortKey);for(const Be of Pe){const{programConfiguration:je,program:He,layoutVertexBuffer:Ye,indexBuffer:Ze,uniformValues:tt,terrainData:mt,projectionData:ot}=Be.state;He.draw(re,se.TRIANGLES,me,ge,be,Sn.backCCW,tt,mt,ot,M.id,Ye,Ze,Be.segments,M.paint,w.transform.zoom,je)}}(e,i,u,d,_):l.c0(u)?function(w,P,M,k,D){if(M.paint.get("heatmap-opacity")===0)return;const O=w.context,{isRenderingToTexture:B,isRenderingGlobe:G}=D;if(w.style.map.terrain){for(const W of k){const ie=P.getTile(W);P.hasRenderableParent(W)||(w.renderPass==="offscreen"?Fp(w,ie,M,W,G):w.renderPass==="translucent"&&af(w,M,W,B,G))}O.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(W,ie,re,se){const ue=W.context,me=ue.gl,ge=W.transform,be=In.disabled,Pe=new sr([me.ONE,me.ONE],l.b6.transparent,[!0,!0,!0,!0]);(function(Se,Be,je){const He=Se.gl;Se.activeTexture.set(He.TEXTURE1),Se.viewport.set([0,0,Be.width/4,Be.height/4]);let Ye=je.heatmapFbos.get(l.bR);Ye?(He.bindTexture(He.TEXTURE_2D,Ye.colorAttachment.get()),Se.bindFramebuffer.set(Ye.framebuffer)):(Ye=ta(Se,Be.width/4,Be.height/4),je.heatmapFbos.set(l.bR,Ye))})(ue,W,re),ue.clear({color:l.b6.transparent});for(let Se=0;Se<se.length;Se++){const Be=se[Se];if(ie.hasRenderableParent(Be))continue;const je=ie.getTile(Be),He=je.getBucket(re);if(!He)continue;const Ye=He.programConfigurations.get(re.id),Ze=W.useProgram("heatmap",Ye),tt=ge.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),mt=ge.getCircleRadiusCorrection();Ze.draw(ue,me.TRIANGLES,cn.disabled,be,Pe,Sn.backCCW,hu(je,ge.zoom,re.paint.get("heatmap-intensity"),mt),null,tt,re.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,re.paint,ge.zoom,Ye)}ue.viewport.set([0,0,W.width,W.height])}(w,P,M,k):w.renderPass==="translucent"&&function(W,ie){const re=W.context,se=re.gl;re.setColorMode(W.colorModeForRenderPass());const ue=ie.heatmapFbos.get(l.bR);ue&&(re.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,ue.colorAttachment.get()),re.activeTexture.set(se.TEXTURE1),ka(re,ie).bind(se.LINEAR,se.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(re,se.TRIANGLES,cn.disabled,In.disabled,W.colorModeForRenderPass(),Sn.disabled,Rh(W,ie,0,1),null,null,ie.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,ie.paint,W.transform.zoom))}(w,M)}(e,i,u,d,_):l.c1(u)?function(w,P,M,k,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:O}=D,B=M.paint.get("line-opacity"),G=M.paint.get("line-width");if(B.constantOr(1)===0||G.constantOr(1)===0)return;const W=w.getDepthModeForSublayer(0,cn.ReadOnly),ie=w.colorModeForRenderPass(),re=M.paint.get("line-dasharray"),se=M.paint.get("line-pattern"),ue=se.constantOr(1),me=M.paint.get("line-gradient"),ge=M.getCrossfadeParameters(),be=ue?"linePattern":re?"lineSDF":me?"lineGradient":"line",Pe=w.context,Se=Pe.gl,Be=w.transform;let je=!0;for(const He of k){const Ye=P.getTile(He);if(ue&&!Ye.patternsLoaded())continue;const Ze=Ye.getBucket(M);if(!Ze)continue;const tt=Ze.programConfigurations.get(M.id),mt=w.context.program.get(),ot=w.useProgram(be,tt),Mt=je||ot.program!==mt,Ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData(He),Fn=se.constantOr(null);if(Fn&&Ye.imageAtlas){const zn=Ye.imageAtlas,Wn=zn.patternPositions[Fn.to.toString()],Qr=zn.patternPositions[Fn.from.toString()];Wn&&Qr&&tt.setConstantPatternPositions(Wn,Qr)}const ar=Be.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),vn=Be.getPixelScale(),_r=ue?dl(w,Ye,M,vn,ge):re?ac(w,Ye,M,vn,re,ge):me?oo(w,Ye,M,vn,Ze.lineClipsArray.length):Js(w,Ye,M,vn);if(ue)Pe.activeTexture.set(Se.TEXTURE0),Ye.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),tt.updatePaintBuffers(ge);else if(re&&(Mt||w.lineAtlas.dirty))Pe.activeTexture.set(Se.TEXTURE0),w.lineAtlas.bind(Pe);else if(me){const zn=Ze.gradients[M.id];let Wn=zn.texture;if(M.gradientVersion!==zn.version){let Qr=256;if(M.stepInterpolant){const Hn=P.getSource().maxzoom,dr=He.canonical.z===Hn?Math.ceil(1<<w.transform.maxZoom-He.canonical.z):1;Qr=l.ad(l.bS(Ze.maxLineLength/l.Z*1024*dr),256,Pe.maxTextureSize)}zn.gradient=l.bT({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Qr,image:zn.gradient||void 0,clips:Ze.lineClipsArray}),zn.texture?zn.texture.update(zn.gradient):zn.texture=new ne(Pe,zn.gradient,Se.RGBA),zn.version=M.gradientVersion,Wn=zn.texture}Pe.activeTexture.set(Se.TEXTURE0),Wn.bind(M.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}let Jn;if(O){const[zn]=w.getStencilConfigForOverlapAndUpdateStencilID(k);Jn=zn[He.overscaledZ]}else Jn=w.stencilModeForClipping(He);ot.draw(Pe,Se.TRIANGLES,W,Jn,ie,Sn.disabled,_r,Ot,ar,M.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,M.paint,w.transform.zoom,tt,Ze.layoutVertexBuffer2),je=!1}}(e,i,u,d,_):l.c2(u)?function(w,P,M,k,D){const O=M.paint.get("fill-color"),B=M.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const{isRenderingToTexture:G}=D,W=w.colorModeForRenderPass(),ie=M.paint.get("fill-pattern"),re=w.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&O.constantOr(l.b6.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===re){const se=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly);Nh(w,P,M,k,se,W,!1,G)}if(w.renderPass==="translucent"&&M.paint.get("fill-antialias")){const se=w.getDepthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly);Nh(w,P,M,k,se,W,!0,G)}}(e,i,u,d,_):l.c3(u)?function(w,P,M,k,D){const O=M.paint.get("fill-extrusion-opacity");if(O===0)return;const{isRenderingToTexture:B}=D;if(w.renderPass==="translucent"){const G=new cn(w.context.gl.LEQUAL,cn.ReadWrite,w.depthRangeFor3D);if(O!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Aa(w,P,M,k,G,In.disabled,sr.disabled,B),Aa(w,P,M,k,G,w.stencilModeFor3D(),w.colorModeForRenderPass(),B);else{const W=w.colorModeForRenderPass();Aa(w,P,M,k,G,In.disabled,W,B)}}}(e,i,u,d,_):l.c4(u)?function(w,P,M,k,D){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:O}=D,B=w.context,G=w.style.projection.useSubdivision,W=w.getDepthModeForSublayer(0,cn.ReadOnly),ie=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(re,se,ue,me,ge,be,Pe){const Se=re.context,Be=Se.gl;for(const je of ue){const He=se.getTile(je),Ye=He.dem;if(!Ye||!Ye.data||!He.needsHillshadePrepare)continue;const Ze=Ye.dim,tt=Ye.stride,mt=Ye.getPixels();if(Se.activeTexture.set(Be.TEXTURE1),Se.pixelStoreUnpackPremultiplyAlpha.set(!1),He.demTexture=He.demTexture||re.getTileTexture(tt),He.demTexture){const Mt=He.demTexture;Mt.update(mt,{premultiply:!1}),Mt.bind(Be.NEAREST,Be.CLAMP_TO_EDGE)}else He.demTexture=new ne(Se,mt,Be.RGBA,{premultiply:!1}),He.demTexture.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);Se.activeTexture.set(Be.TEXTURE0);let ot=He.fbo;if(!ot){const Mt=new ne(Se,{width:Ze,height:Ze,data:null},Be.RGBA);Mt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),ot=He.fbo=Se.createFramebuffer(Ze,Ze,!0,!1),ot.colorAttachment.set(Mt.texture)}Se.bindFramebuffer.set(ot.framebuffer),Se.viewport.set([0,0,Ze,Ze]),re.useProgram("hillshadePrepare").draw(Se,Be.TRIANGLES,ge,be,Pe,Sn.disabled,du(He.tileID,Ye),null,null,me.id,re.rasterBoundsBuffer,re.quadTriangleIndexBuffer,re.rasterBoundsSegments),He.needsHillshadePrepare=!1}})(w,P,k,M,W,In.disabled,ie),B.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(G){const[re,se,ue]=w.stencilConfigForOverlapTwoPass(k);xc(w,P,M,ue,re,W,ie,!1,O),xc(w,P,M,ue,se,W,ie,!0,O)}else{const[re,se]=w.getStencilConfigForOverlapAndUpdateStencilID(k);xc(w,P,M,se,re,W,ie,!1,O)}}(e,i,u,d,_):l.c5(u)?function(w,P,M,k,D){if(w.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!k.length)return;const{isRenderingToTexture:O}=D,B=P.getSource(),G=w.style.projection.useSubdivision;if(B instanceof Rn)Tr(w,P,M,k,null,!1,!1,B.tileCoords,B.flippedWindingOrder,O);else if(G){const[W,ie,re]=w.stencilConfigForOverlapTwoPass(k);Tr(w,P,M,re,W,!1,!0,jh,!1,O),Tr(w,P,M,re,ie,!0,!0,jh,!1,O)}else{const[W,ie]=w.getStencilConfigForOverlapAndUpdateStencilID(k);Tr(w,P,M,ie,W,!1,!0,jh,!1,O)}}(e,i,u,d,_):l.c6(u)?function(w,P,M,k,D){const O=M.paint.get("background-color"),B=M.paint.get("background-opacity");if(B===0)return;const{isRenderingToTexture:G}=D,W=w.context,ie=W.gl,re=w.style.projection,se=w.transform,ue=se.tileSize,me=M.paint.get("background-pattern");if(w.isPatternMissing(me))return;const ge=!me&&O.a===1&&B===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ge)return;const be=In.disabled,Pe=w.getDepthModeForSublayer(0,ge==="opaque"?cn.ReadWrite:cn.ReadOnly),Se=w.colorModeForRenderPass(),Be=w.useProgram(me?"backgroundPattern":"background"),je=k||ze(se,{tileSize:ue,terrain:w.style.map.terrain});me&&(W.activeTexture.set(ie.TEXTURE0),w.imageManager.bind(w.context));const He=M.getCrossfadeParameters();for(const Ye of je){const Ze=se.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),tt=me?Fh(B,w,me,{tileID:Ye,tileSize:ue},He):Wi(B,O),mt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ye),ot=re.getMeshFromTileID(W,Ye.canonical,!1,!0,"raster");Be.draw(W,ie.TRIANGLES,Pe,be,Se,Sn.backCCW,tt,mt,Ze,M.id,ot.vertexBuffer,ot.indexBuffer,ot.segments)}}(e,0,u,d,_):l.c7(u)&&function(w,P,M,k){const{isRenderingGlobe:D}=k,O=w.context,B=M.implementation,G=w.style.projection,W=w.transform,ie=W.getProjectionDataForCustomLayer(D),re={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:ie},se=B.renderingMode?B.renderingMode:"2d";if(w.renderPass==="offscreen"){const ue=B.prerender;ue&&(w.setCustomLayerDefaults(),O.setColorMode(w.colorModeForRenderPass()),ue.call(B,O.gl,re),O.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),O.setColorMode(w.colorModeForRenderPass()),O.setStencilMode(In.disabled);const ue=se==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,cn.ReadOnly);O.setDepthMode(ue),B.render(O.gl,re),O.setDirty(),w.setBaseState(),O.bindFramebuffer.set(null)}}(e,0,u,_))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!i||!u}useProgram(e,i,u=!1){this.cache=this.cache||{};const d=!!this.style.map.terrain,_=this.style.projection,w=e+(i?i.cacheKey:"")+`/${u?Gl:_.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(d?"/terrain":"");return this.cache[w]||(this.cache[w]=new Ip(this.context,zo[e],i,lc[e],this._showOverdrawInspector,d,u?zo.projectionMercator:_.shaderPreludeCode,u?An:_.shaderDefine)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Vh(g,e){let i,u=!1,d=null,_=null;const w=()=>{d=null,u&&(g.apply(_,i),d=setTimeout(w,e),u=!1)};return(...P)=>(u=!0,_=this,i=P,d||w(),d)}class ra{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const u=i.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let w=window.location.href.replace(/(#.+)?$/,_);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=Vh(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),w=Math.round(i.lng*_)/_,P=Math.round(i.lat*_)/_,M=this._map.getBearing(),k=this._map.getPitch();let D="";if(D+=e?`/${w}/${P}/${u}`:`${u}/${P}/${w}`,(M||k)&&(D+="/"+Math.round(10*M)/10),k&&(D+=`/${Math.round(k)}`),this._hashName){const O=this._hashName;let B=!1;const G=window.location.hash.slice(1).split("&").map(W=>{const ie=W.split("=")[0];return ie===O?(B=!0,`${ie}=${D}`):W}).filter(W=>W);return B||G.push(`${O}=${D}`),`#${G.join("&")}`}return`#${D}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.Q(+e[2],+e[1])}catch{return!1}const i=+e[0],u=+(e[3]||0),d=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&u>=-180&&u<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const xl={linearity:.3,easing:l.c8(0,0,.3,1)},lf=l.e({deceleration:2500,maxSpeed:1400},xl),cf=l.e({deceleration:20,maxSpeed:1400},xl),bc=l.e({deceleration:1e3,maxSpeed:360},xl),bl=l.e({deceleration:1e3,maxSpeed:90},xl),$h=l.e({deceleration:1e3,maxSpeed:360},xl);class X{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:oe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=oe.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)i.zoom+=_.zoomDelta||0,i.bearing+=_.bearingDelta||0,i.pitch+=_.pitchDelta||0,i.roll+=_.rollDelta||0,_.panDelta&&i.pan._add(_.panDelta),_.around&&(i.around=_.around),_.pinchAround&&(i.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(i.pan.mag()){const _=Ts(i.pan.mag(),u,l.e({},lf,e||{})),w=i.pan.mult(_.amount/i.pan.mag()),P=this._map.cameraHelper.handlePanInertia(w,this._map.transform);d.center=P.easingCenter,d.offset=P.easingOffset,so(d,_)}if(i.zoom){const _=Ts(i.zoom,u,cf);d.zoom=this._map.transform.zoom+_.amount,so(d,_)}if(i.bearing){const _=Ts(i.bearing,u,bc);d.bearing=this._map.transform.bearing+l.ad(_.amount,-179,179),so(d,_)}if(i.pitch){const _=Ts(i.pitch,u,bl);d.pitch=this._map.transform.pitch+_.amount,so(d,_)}if(i.roll){const _=Ts(i.roll,u,$h);d.roll=this._map.transform.roll+l.ad(_.amount,-179,179),so(d,_)}if(d.zoom||d.bearing){const _=i.pinchAround===void 0?i.around:i.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function so(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function Ts(g,e,i){const{maxSpeed:u,linearity:d,deceleration:_}=i,w=l.ad(g*d/(e/1e3),-u,u),P=Math.abs(w)/(_*d);return{easing:i.easing,duration:1e3*P,amount:w*(P/2)}}class Ln extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u,d={}){const _=Y.mousePos(i.getCanvas(),u),w=i.unproject(_);super(e,l.e({point:_,lngLat:w,originalEvent:u},d)),this._defaultPrevented=!1,this.target=i}}class en extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){const d=e==="touchend"?u.changedTouches:u.touches,_=Y.touchPos(i.getCanvasContainer(),d),w=_.map(M=>i.unproject(M)),P=_.reduce((M,k,D,O)=>M.add(k.div(O.length)),new l.P(0,0));super(e,{points:_,point:P,lngLats:w,lngLat:i.unproject(P),originalEvent:u}),this._defaultPrevented=!1}}class Zh extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class as{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Zh(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new Ln(e.type,this._map,e))}mouseup(e){this._map.fire(new Ln(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new Ln(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ln(e.type,this._map,e))}mouseover(e){this._map.fire(new Ln(e.type,this._map,e))}mouseout(e){this._map.fire(new Ln(e.type,this._map,e))}touchstart(e){return this._firePreventable(new en(e.type,this._map,e))}touchmove(e){this._map.fire(new en(e.type,this._map,e))}touchend(e){this._map.fire(new en(e.type,this._map,e))}touchcancel(e){this._map.fire(new en(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wl{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ln(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ln(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class No{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class uf{constructor(e,i){this._map=e,this._tr=new No(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const u=i;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const _=Math.min(d.x,u.x),w=Math.max(d.x,u.x),P=Math.min(d.y,u.y),M=Math.max(d.y,u.y);Y.setTransform(this._box,`translate(${_}px,${P}px)`),this._box.style.width=w-_+"px",this._box.style.height=M-P+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const u=this._startPos,d=i;if(this.reset(),Y.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:_=>_.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new l.l(e,{originalEvent:i}))}}function Gh(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const i={};for(let u=0;u<g.length;u++)i[g[u].identifier]=e[u];return i}class Op{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const _=new l.P(0,0);for(const w of d)_._add(w);return _.div(d.length)}(i),this.touches=Gh(u,i)))}touchmove(e,i,u){if(this.aborted||!this.centroid)return;const d=Gh(u,i);for(const _ in this.touches){const w=d[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(e,i,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Cu{constructor(e){this.singleTap=new Op(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,u){this.singleTap.touchstart(e,i,u)}touchmove(e,i,u){this.singleTap.touchmove(e,i,u)}touchend(e,i,u){const d=this.singleTap.touchend(e,i,u);if(d){const _=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(_&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class wc{constructor(e){this._tr=new No(e),this._zoomIn=new Cu({numTouches:1,numTaps:2}),this._zoomOut=new Cu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,u){this._zoomIn.touchstart(e,i,u),this._zoomOut.touchstart(e,i,u)}touchmove(e,i,u){this._zoomIn.touchmove(e,i,u),this._zoomOut.touchmove(e,i,u)}touchend(e,i,u){const d=this._zoomIn.touchend(e,i,u),_=this._zoomOut.touchend(e,i,u),w=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(d)},{originalEvent:e})}):_?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(_)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(i)?i[0]:i;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Y.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const St={0:1,2:2};class Sl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=Y.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,u){const d=St[u];return i.buttons===void 0||(i.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return Y.mouseButton(e)===this._eventButton}}class qh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class hf{constructor(e=new Sl({checkCorrectEvent:()=>!0}),i=new qh){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,u){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const ia=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class ao{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,u){return this._calculateTransform(e,i,u)}touchmove(e,i,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,i,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,u){this._calculateTransform(e,i,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,u){u.length>0&&(this._active=!0);const d=Gh(u,i),_=new l.P(0,0),w=new l.P(0,0);let P=0;for(const k in d){const D=d[k],O=this._touches[k];O&&(_._add(D),w._add(D.sub(O)),P++,d[k]=D)}if(this._touches=d,this._shouldBePrevented(P)||!w.mag())return;const M=w.div(P);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(P),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,_]=this._firstTwoTouches,w=fn(u,i,d),P=fn(u,i,_);if(!w||!P)return;const M=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],M,e)}touchend(e,i,u){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,w=fn(u,i,d),P=fn(u,i,_);w&&P||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function fn(g,e,i){for(let u=0;u<g.length;u++)if(g[u].identifier===i)return e[u]}function Eu(g,e){return Math.log(g/e)/Math.LN2}class df extends Pu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Eu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Eu(this._distance,u),pinchAround:i}}}function Mu(g,e){return 180*g.angleWith(e)/Math.PI}class oa extends Pu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mu(this._vector,d),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,u=Mu(e,this._startVector);return Math.abs(u)<i}}function Wh(g){return Math.abs(g.y)>Math.abs(g.x)}class Hh extends Pu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,u){super.touchstart(e,i,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,Wh(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),_=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,_=i.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=e.y>0==i.y>0;return Wh(e)&&Wh(i)&&w}}const lo={panStep:100,bearingStep:15,pitchStep:10};class Xh{constructor(e){this._tr=new No(e);const i=lo;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,u=0,d=0,_=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),_=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),_=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:P=>{const M=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Bp,zoom:i?Math.round(M.zoom)+i*(e.shiftKey?2:1):M.zoom,bearing:M.bearing+u*this._bearingStep,pitch:M.pitch+d*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:M.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bp(g){return g*(2-g)}const Kh=4.000244140625;class ff{constructor(e,i){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new No(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=oe.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,i!==0&&i%Kh==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Y.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(l.Q.convert(u.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const P=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=P),typeof this._targetZoom=="number"&&(this._targetZoom+=P)}if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Kh?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&M!==0&&(M=1/M);const k=typeof this._targetZoom!="number"?e.scale:l.aH(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,l.aa(k*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,d=this._easing;let _,w=!1;if(this._type==="wheel"&&u&&d){const P=oe.now()-this._lastWheelEventTime,M=Math.min((P+5)/200,1),k=d(M);_=l.B.number(u,i,k),M<1?this._frameId||(this._frameId=!0):w=!0}else _=i,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!w,zoomDelta:_-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=l.ca;if(this._prevEase){const u=this._prevEase,d=(oe.now()-u.start)/u.duration,_=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-w*w);i=l.c8(w,P,.25,1)}return this._prevEase={start:oe.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pf{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cs{constructor(e){this._tr=new No(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hr{constructor(){this._tap=new Cu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,u){if(!this._swipePoint)if(this._tapTime){const d=i[0],_=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;_&&w?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,i,u)}touchmove(e,i,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=i[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(e,i,u)}touchend(e,i,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,i,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sc{constructor(e,i,u){this._el=e,this._mousePan=i,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Iu{constructor(e,i,u,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=u,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Tc{constructor(e,i,u,d){this._el=e,this._touchZoom=i,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class La{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=i,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=u,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const sa=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Np extends l.l{}function co(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class ku{constructor(e,i){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,P={needsRenderFrame:!1},M={},k={},D=d.touches,O=D?this._getMapTouches(D):void 0,B=O?Y.touchPos(this._map.getCanvas(),O):Y.mousePos(this._map.getCanvas(),d);for(const{handlerName:ie,handler:re,allowed:se}of this._handlers){if(!re.isEnabled())continue;let ue;this._blockedByActive(k,se,ie)?re.reset():re[_||d.type]&&(ue=re[_||d.type](d,B,O),this.mergeHandlerResult(P,M,ue,ie,w),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||re.isActive())&&(k[ie]=re)}const G={};for(const ie in this._previousActiveHandlers)k[ie]||(G[ie]=w);this._previousActiveHandlers=k,(Object.keys(G).length||co(P))&&(this._changes.push([P,M,G]),this._triggerRenderFrame()),(Object.keys(k).length||co(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=P;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new X(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,w]of this._listeners)Y.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,i,u]of this._listeners)Y.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const i=this._map,u=i.getCanvasContainer();this._add("mapEvent",new as(i,e));const d=i.boxZoom=new uf(i,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const _=i.cooperativeGestures=new La(i,e.cooperativeGestures);this._add("cooperativeGestures",_),e.cooperativeGestures&&_.enable();const w=new wc(i),P=new Cs(i);i.doubleClickZoom=new pf(P,w),this._add("tapZoom",w),this._add("clickZoom",P),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const M=new hr;this._add("tapDragZoom",M);const k=i.touchPitch=new Hh(i);this._add("touchPitch",k),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const D=()=>i.project(i.getCenter()),O=function({enable:ge,clickTolerance:be,aroundCenter:Pe=!0,minPixelCenterThreshold:Se=100,rotateDegreesPerPixelMoved:Be=.8},je){const He=new Sl({checkCorrectEvent:Ye=>Y.mouseButton(Ye)===0&&Ye.ctrlKey||Y.mouseButton(Ye)===2&&!Ye.ctrlKey});return new Lr({clickTolerance:be,move:(Ye,Ze)=>{const tt=je();if(Pe&&Math.abs(tt.y-Ye.y)>Se)return{bearingDelta:l.c9(new l.P(Ye.x,Ze.y),Ze,tt)};let mt=(Ze.x-Ye.x)*Be;return Pe&&Ze.y<tt.y&&(mt=-mt),{bearingDelta:mt}},moveStateManager:He,enable:ge,assignEvents:ia})}(e,D),B=function({enable:ge,clickTolerance:be,pitchDegreesPerPixelMoved:Pe=-.5}){const Se=new Sl({checkCorrectEvent:Be=>Y.mouseButton(Be)===0&&Be.ctrlKey||Y.mouseButton(Be)===2});return new Lr({clickTolerance:be,move:(Be,je)=>({pitchDelta:(je.y-Be.y)*Pe}),moveStateManager:Se,enable:ge,assignEvents:ia})}(e),G=function({enable:ge,clickTolerance:be,rollDegreesPerPixelMoved:Pe=.3},Se){const Be=new Sl({checkCorrectEvent:je=>Y.mouseButton(je)===2&&je.ctrlKey});return new Lr({clickTolerance:be,move:(je,He)=>{const Ye=Se();let Ze=(He.x-je.x)*Pe;return He.y<Ye.y&&(Ze=-Ze),{rollDelta:Ze}},moveStateManager:Be,enable:ge,assignEvents:ia})}(e,D);i.dragRotate=new Iu(e,O,B,G),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const W=function({enable:ge,clickTolerance:be}){const Pe=new Sl({checkCorrectEvent:Se=>Y.mouseButton(Se)===0&&!Se.ctrlKey});return new Lr({clickTolerance:be,move:(Se,Be)=>({around:Be,panDelta:Be.sub(Se)}),activateOnStart:!0,moveStateManager:Pe,enable:ge,assignEvents:ia})}(e),ie=new ao(e,i);i.dragPan=new Sc(u,W,ie),this._add("mousePan",W),this._add("touchPan",ie,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const re=new oa,se=new df;i.touchZoomRotate=new Tc(u,se,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const ue=i.scrollZoom=new ff(i,()=>this._triggerRenderFrame());this._add("scrollZoom",ue,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const me=i.keyboard=new Xh(i);this._add("keyboard",me),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new wl(i))}_add(e,i,u){this._handlers.push({handlerName:e,handler:i,allowed:u}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,u){for(const d in e)if(d!==u&&(!i||i.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const u of e)this._el.contains(u.target)&&i.push(u);return i}mergeHandlerResult(e,i,u,d,_){if(!u)return;l.e(e,u);const w={handlerName:d,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(i.zoom=w),u.panDelta!==void 0&&(i.drag=w),u.rollDelta!==void 0&&(i.roll=w),u.pitchDelta!==void 0&&(i.pitch=w),u.bearingDelta!==void 0&&(i.rotate=w)}_applyChanges(){const e={},i={},u={};for(const[d,_,w]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),l.e(i,_),l.e(u,w);this._updateMapTransform(e,i,u),this._changes=[]}_updateMapTransform(e,i,u){const d=this._map,_=d._getTransformForUpdate(),w=d.terrain;if(!(co(e)||w&&this._terrainMovement))return this._fireEvents(i,u,!0);d._stop(!0);let{panDelta:P,zoomDelta:M,bearingDelta:k,pitchDelta:D,rollDelta:O,around:B,pinchAround:G}=e;G!==void 0&&(B=G),B=B||d.transform.centerPoint,w&&!_.isPointOnMapSurface(B)&&(B=_.centerPoint);const W={panDelta:P,zoomDelta:M,rollDelta:O,pitchDelta:D,bearingDelta:k,around:B};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(B)&&(B=_.centerPoint);const ie=B.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(P?B.sub(P):B);w?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,_),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?_.setCenter(_.screenPointToLocation(_.centerPoint.sub(P))):this._map.cameraHelper.handleMapControlsPan(W,_,ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(W,_,ie))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,_),this._map.cameraHelper.handleMapControlsPan(W,_,ie)),d._applyUpdatedTransform(_),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,u,!0)}_fireEvents(e,i,u){const d=sa(this._eventsInProgress),_=sa(e),w={};for(const O in e){const{originalEvent:B}=e[O];this._eventsInProgress[O]||(w[`${O}start`]=B),this._eventsInProgress[O]=e[O]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const O in w)this._fireEvent(O,w[O]);_&&this._fireEvent("move",_.originalEvent);for(const O in e){const{originalEvent:B}=e[O];this._fireEvent(O,B)}const P={};let M;for(const O in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[O];this._handlersById[B].isActive()||(delete this._eventsInProgress[O],M=i[B]||G,P[`${O}end`]=M)}for(const O in P)this._fireEvent(O,P[O]);const k=sa(this._eventsInProgress),D=(d||_)&&!k;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const O=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&O.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(O)}if(u&&D){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!O||!O.essential&&oe.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:M})),B(this._map.getBearing())&&this._map.resetNorth()):(B(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new l.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Np("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Et extends l.E{constructor(e,i,u){super(),this._renderFrameCallback=()=>{const d=Math.min((oe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new l.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,u){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},i),u)}panTo(e,i,u){return this.easeTo(l.e({center:e},i),u)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,u){return this.easeTo(l.e({zoom:e},i),u)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",i)).fire(new l.l("move",i)).fire(new l.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,u){return this.easeTo(l.e({bearing:e},i),u)}resetNorth(e,i){return this.rotateTo(0,l.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=qt.convert(e).adjustAntiMeridian();const u=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,i)}_cameraForBoxAndBearing(e,i,u,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const k=d.padding;d.padding={top:k,bottom:k,right:k,left:k}}const w=l.e(_,d.padding);d.padding=w;const P=this.transform,M=new qt(e,i);return this.cameraHelper.cameraForBoxAndBearing(d,w,M,u,P)}fitBounds(e,i,u){return this._fitInternal(this.cameraForBounds(e,i),i,u)}fitScreenCoordinates(e,i,u,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(i)),u,d),d,_)}_fitInternal(e,i,u){return e?(delete(i=l.e(e,i)).padding,i.linear?this.easeTo(i,u):this.flyTo(i,u)):this}jumpTo(e,i){this.stop();const u=this._getTransformForUpdate();let d=!1,_=!1,w=!1;const P=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const M=u.zoom!==P;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(d=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(_=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(w=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new l.l("movestart",i)).fire(new l.l("move",i)),M&&this.fire(new l.l("zoomstart",i)).fire(new l.l("zoom",i)).fire(new l.l("zoomend",i)),d&&this.fire(new l.l("rotatestart",i)).fire(new l.l("rotate",i)).fire(new l.l("rotateend",i)),_&&this.fire(new l.l("pitchstart",i)).fire(new l.l("pitch",i)).fire(new l.l("pitchend",i)),w&&this.fire(new l.l("rollstart",i)).fire(new l.l("roll",i)).fire(new l.l("rollend",i)),this.fire(new l.l("moveend",i))}calculateCameraOptionsFromTo(e,i,u,d=0){const _=l.$.fromLngLat(e,i),w=l.$.fromLngLat(u,d),P=w.x-_.x,M=w.y-_.y,k=w.z-_.z,D=Math.hypot(P,M,k);if(D===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(P,M),B=l.aa(this.transform.cameraToCenterDistance/D/this.transform.tileSize),G=180*Math.atan2(P,-M)/Math.PI;let W=180*Math.acos(O/D)/Math.PI;return W=k<0?90-W:90+W,{center:w.toLngLat(),elevation:d,zoom:B,pitch:W,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,u,d,_){const w=this.transform.calculateCenterFromCameraLngLatAlt(e,i,u,d);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:u,pitch:d,roll:_}}easeTo(e,i){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.ca},e)).animate===!1||!e.essential&&oe.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),d=this.getBearing(),_=u.pitch,w=u.roll,P="bearing"in e?this._normalizeBearing(e.bearing,d):d,M="pitch"in e?+e.pitch:_,k="roll"in e?this._normalizeBearing(e.roll,w):w,D="padding"in e?e.padding:u.padding,O=l.P.convert(e.offset);let B,G;e.around&&(B=l.Q.convert(e.around),G=u.locationToScreenPoint(B));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(u,{bearing:P,pitch:M,roll:k,padding:D,around:B,aroundPoint:G,offsetAsPoint:O,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==P,this._pitching=this._pitching||M!==_,this._rolling=this._rolling||k!==w,this._padding=!u.isPaddingEqual(D),this._zooming=this._zooming||ie.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,W),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease(re=>{ie.easeFunc(re),this.terrain&&!e.freezeElevation&&this._updateElevation(re),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},re=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,re)},e),this}_prepareEase(e,i,u={}){this._moving=!0,i||u.moving||this.fire(new l.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(i-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(l.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),u=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(u<d){const _=this.calculateCameraOptionsFromTo(i,d,e.center,e.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&i.push(d=>this.transformCameraUpdate(d)),!i.length)return;const u=e.clone();for(const d of i){const _=u.clone(),{center:w,zoom:P,roll:M,pitch:k,bearing:D,elevation:O}=d(_);w&&_.setCenter(w),O!==void 0&&_.setElevation(O),P!==void 0&&_.setZoom(P),M!==void 0&&_.setRoll(M),k!==void 0&&_.setPitch(k),D!==void 0&&_.setBearing(D),u.apply(_)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const u=this._zooming,d=this._rotating,_=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new l.l("zoomend",e)),d&&this.fire(new l.l("rotateend",e)),_&&this.fire(new l.l("pitchend",e)),w&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,i){if(!e.essential&&oe.prefersReducedMotion){const Ze=l.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ze,i)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.ca},e);const u=this._getTransformForUpdate(),d=u.bearing,_=u.pitch,w=u.roll,P=u.padding,M="bearing"in e?this._normalizeBearing(e.bearing,d):d,k="pitch"in e?+e.pitch:_,D="roll"in e?this._normalizeBearing(e.roll,w):w,O="padding"in e?e.padding:u.padding,B=l.P.convert(e.offset);let G=u.centerPoint.add(B);const W=u.screenPointToLocation(G),ie=this.cameraHelper.handleFlyTo(u,{bearing:M,pitch:k,roll:D,padding:O,locationAtOffset:W,offsetAsPoint:B,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let re=e.curve;const se=Math.max(u.width,u.height),ue=se/ie.scaleOfZoom,me=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(re=Math.sqrt(se/ie.scaleOfMinZoom/me*2));const ge=re*re;function be(Ze){const tt=(ue*ue-se*se+(Ze?-1:1)*ge*ge*me*me)/(2*(Ze?ue:se)*ge*me);return Math.log(Math.sqrt(tt*tt+1)-tt)}function Pe(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Se(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Be=be(!1);let je=function(Ze){return Se(Be)/Se(Be+re*Ze)},He=function(Ze){return se*((Se(Be)*(Pe(tt=Be+re*Ze)/Se(tt))-Pe(Be))/ge)/me;var tt},Ye=(be(!0)-Be)/re;if(Math.abs(me)<2e-6||!isFinite(Ye)){if(Math.abs(se-ue)<1e-6)return this.easeTo(e,i);const Ze=ue<se?-1:1;Ye=Math.abs(Math.log(ue/se))/re,He=()=>0,je=tt=>Math.exp(Ze*re*tt)}return e.duration="duration"in e?+e.duration:1e3*Ye/("screenSpeed"in e?+e.screenSpeed/re:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==M,this._pitching=k!==_,this._rolling=D!==w,this._padding=!u.isPaddingEqual(O),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease(Ze=>{const tt=Ze*Ye,mt=1/je(tt),ot=He(tt);this._rotating&&u.setBearing(l.B.number(d,M,Ze)),this._pitching&&u.setPitch(l.B.number(_,k,Ze)),this._rolling&&u.setRoll(l.B.number(w,D,Ze)),this._padding&&(u.interpolatePadding(P,O,Ze),G=u.centerPoint.add(B)),ie.easeFunc(Ze,mt,ot,G),this.terrain&&!e.freezeElevation&&this._updateElevation(Ze),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,i)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,i,u){u.animate===!1||u.duration===0?(e(1),i()):(this._easeStart=oe.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=l.aK(e,-180,180);const u=Math.abs(e-i);return Math.abs(e-360-i)<u&&(e-=360),Math.abs(e+360-i)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.Q.convert(e),this.transform.tileZoom):null}}const Vt={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class jo{constructor(e=Vt){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,i){const u=this._map._getUIString(`AttributionControl.${i}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const i=this._map.style.sourceCaches;for(const d in i){const _=i[d];if(_.used||_.usedForTerrain){const w=_.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,_)=>d.length-_.length),e=e.filter((d,_)=>{for(let w=_+1;w<e.length;w++)if(e[w].indexOf(d)>=0)return!1;return!0});const u=e.join(" | ");u!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=Y.sanitize(u),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ri{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const i=Y.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Yh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,u=i?this._queue.concat(i):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const u of i)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Di=l.aC([{name:"a_pos3d",type:"Int16",components:3}]);class Jh extends l.E{constructor(e){super(),this._lastTilesetChange=oe.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const u={};for(const d of ze(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),l.bN(d.terrainRttPosMatrix32f,0,l.Z,l.Z,0,0,1),this._tiles[d.key]=new Bi(d,this.tileSize),this._lastTilesetChange=oe.now());for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const i in this._tiles){const u=this._tiles[i];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const i={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID,_=e.clone(),w=l.b1();if(d.canonical.equals(e.canonical))l.bN(w,0,l.Z,l.Z,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const P=d.canonical.z-e.canonical.z,M=d.canonical.x-(d.canonical.x>>P<<P),k=d.canonical.y-(d.canonical.y>>P<<P),D=l.Z>>P;l.bN(w,0,D,D,0,0,1),l.L(w,w,[-M*D,-k*D,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const P=e.canonical.z-d.canonical.z,M=e.canonical.x-(e.canonical.x>>P<<P),k=e.canonical.y-(e.canonical.y>>P<<P),D=l.Z>>P;l.bN(w,0,l.Z,l.Z,0,0,1),l.L(w,w,[M*D,k*D,0]),l.M(w,w,[1/2**P,1/2**P,0])}}_.terrainRttPosMatrix32f=new Float32Array(w),i[u]=_}return i}getSourceTile(e,i){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!_||!_.dem)&&i)for(;d>=u.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(e.scaledTo(d--).key);return _}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class Hi{constructor(e,i,u){this._meshCache={},this.painter=e,this.sourceCache=new Jh(i),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,u,d=l.Z){var _;if(!(i>=0&&i<d&&u>=0&&u<d))return 0;const w=this.getTerrainData(e),P=(_=w.tile)===null||_===void 0?void 0:_.dem;if(!P)return 0;const M=l.cb([],[i/d*l.Z,u/d*l.Z],w.u_terrain_matrix),k=[M[0]*P.dim,M[1]*P.dim],D=Math.floor(k[0]),O=Math.floor(k[1]),B=k[0]-D,G=k[1]-O;return P.get(D,O)*(1-B)*(1-G)+P.get(D+1,O)*B*(1-G)+P.get(D,O+1)*(1-B)*G+P.get(D+1,O+1)*B*G}getElevationForLngLatZoom(e,i){if(!l.cc(i,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(u,d%l.Z,_%l.Z,l.Z)}getElevation(e,i,u,d=l.Z){return this.getDEMElevation(e,i,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.as([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const d=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new ne(d,i.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),i.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const u=i&&i+i.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?_=e.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>_<<_),P=e.canonical.y-(e.canonical.y>>_<<_),M=l.cd(new Float64Array(16),[1/(l.Z<<_),1/(l.Z<<_),0]);l.L(M,M,[w*l.Z,P*l.Z,0]),this._demMatrixCache[e.key]={matrix:M,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,u=i.width/devicePixelRatio,d=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(i.context,{width:u,height:d,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(i.context,{width:u,height:d,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,w=0;_<this._coordsTextureSize;_++)for(let P=0;P<this._coordsTextureSize;P++,w+=4)i[w+0]=255&P,i[w+1]=255&_,i[w+2]=P>>8<<4|_>>8,i[w+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),d=new ne(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),u=this.painter.context,d=u.gl,_=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,P-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null);const M=i[0]+(i[2]>>4<<8),k=i[1]+((15&i[2])<<8),D=this.coordsIndex[255-i[3]],O=D&&this.sourceCache.getTileByID(D);if(!O)return null;const B=this._coordsTextureSize,G=(1<<O.tileID.canonical.z)*B;return new l.$((O.tileID.canonical.x*B+M)/G+O.tileID.wrap,(O.tileID.canonical.y*B+k)/G,this.getElevation(O.tileID,M,k,B))}depthAtPoint(e){const i=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const u=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,d=u&&e.canonical.y===0,_=u&&e.canonical.y===(1<<e.canonical.z)-1,w=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const P=this.painter.context,M=new l.ce,k=new l.aG,D=this.meshSize,O=l.Z/D,B=D*D;for(let Se=0;Se<=D;Se++)for(let Be=0;Be<=D;Be++)M.emplaceBack(Be*O,Se*O,0);for(let Se=0;Se<B;Se+=D+1)for(let Be=0;Be<D;Be++)k.emplaceBack(Be+Se,D+Be+Se+1,D+Be+Se+2),k.emplaceBack(Be+Se,D+Be+Se+2,Be+Se+1);const G=M.length,W=G+(D+1),ie=(D+1)*D,re=d?l.b8:0,se=d?0:1,ue=_?l.b9:l.Z,me=_?0:1;for(let Se=0;Se<=D;Se++)M.emplaceBack(Se*O,re,se);for(let Se=0;Se<=D;Se++)M.emplaceBack(Se*O,ue,me);for(let Se=0;Se<D;Se++)k.emplaceBack(ie+Se,W+Se,W+Se+1),k.emplaceBack(ie+Se,W+Se+1,ie+Se+1),k.emplaceBack(0+Se,G+Se+1,G+Se),k.emplaceBack(0+Se,0+Se+1,G+Se+1);const ge=M.length,be=ge+2*(D+1);for(const Se of[0,1])for(let Be=0;Be<=D;Be++)for(const je of[0,1])M.emplaceBack(Se*l.Z,Be*O,je);for(let Se=0;Se<2*D;Se+=2)k.emplaceBack(ge+Se,ge+Se+1,ge+Se+3),k.emplaceBack(ge+Se,ge+Se+3,ge+Se+2),k.emplaceBack(be+Se,be+Se+3,be+Se+1),k.emplaceBack(be+Se,be+Se+2,be+Se+3);const Pe=new Vi(P.createVertexBuffer(M,Di.members),P.createIndexBuffer(k),l.aF.simpleSegment(0,0,M.length,k.length));return this._meshCache[w]=Pe,Pe}getMeshFrameDelta(e){return 2*Math.PI*l.bq/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return i&&i.dem&&(u.minElevation=i.dem.min*this.exaggeration,u.maxElevation=i.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,i){const u=l.$.fromLngLat(e.wrap()),d=(1<<i)*l.Z,_=u.x*d,w=u.y*d,P=Math.floor(_/l.Z),M=Math.floor(w/l.Z);return{tileID:new l.Y(i,0,i,P,M),mercatorX:_,mercatorY:w}}}class aa{constructor(e,i,u){this._context=e,this._size=i,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(u.texture),{id:e,fbo:i,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Uo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cr{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new aa(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(i)),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const d=e.sourceCaches[u].getVisibleCoordinates();for(const _ of d){const w=this.terrain.sourceCache.getTerrainCoords(_);for(const P in w)this._coordsAscending[u][P]||(this._coordsAscending[u][P]=[]),this._coordsAscending[u][P].push(w[P])}}this._coordsAscendingStr={};for(const u of e._order){const d=e._layers[u],_=d.source;if(Uo[d.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const w in this._coordsAscending[_])this._coordsAscendingStr[_][w]=this._coordsAscending[_][w].map(P=>P.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsAscendingStr){const _=this._coordsAscendingStr[d][u.tileID.key];_&&_!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),d=e.type,_=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Uo[d]&&(this._prevType&&Uo[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!w))return!0;if(Uo[this._prevType]||Uo[d]&&w){this._prevType=d;const P=this._stacks.length-1,M=this._stacks[P]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(Ra(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[P]){const O=this.pool.getObjectForId(k.rtt[P].id);if(O.stamp===k.rtt[P].stamp){this.pool.useObject(O);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),k.rtt[P]={id:D.id,stamp:D.stamp},_.context.bindFramebuffer.set(D.fbo.framebuffer),_.context.clear({color:l.b6.transparent,stencil:0}),_.currentStencilSource=void 0;for(let O=0;O<M.length;O++){const B=_.style._layers[M[O]],G=B.source?this._coordsAscending[B.source][k.tileID.key]:[k.tileID];_.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),_._renderTileClippingMasks(B,G,!0),_.renderLayer(_,_.style.sourceCaches[B.source],B,G,u),B.source&&(k.rttCoords[B.source]=this._coordsAscendingStr[B.source][k.tileID.key])}}return Ra(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Uo[d]}return!1}}const wr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},mf=L,Fa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Vt,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Vr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Cc{constructor(e,i,u=!1){this.mousedown=_=>{this.startMove(_,Y.mousePos(this.element,_)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Y.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHanlder.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const d=new hf;this._rotatePitchHanlder=new Lr({clickTolerance:3,move:(_,w)=>{const P=i.getBoundingClientRect(),M=new l.P((P.bottom-P.top)/2,(P.right-P.left)/2);return{bearingDelta:l.c9(new l.P(_.x,w.y),w,M),pitchDelta:u?-.5*(w.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,Y.addEventListener(i,"mousedown",this.mousedown),Y.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),Y.disableDrag()}move(e,i){const u=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHanlder.dragMove(e,i)||{};d&&u.setBearing(u.getBearing()+d),_&&u.setPitch(u.getPitch()+_)}off(){const e=this.element;Y.removeEventListener(e,"mousedown",this.mousedown),Y.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let ls;function uo(g,e,i){const u=new l.Q(g.lng,g.lat);if(g=new l.Q(g.lng,g.lat),e){const d=new l.Q(g.lng-360,g.lat),_=new l.Q(g.lng+360,g.lat),w=i.locationToScreenPoint(g).distSqr(e);i.locationToScreenPoint(d).distSqr(e)<w?g=d:i.locationToScreenPoint(_).distSqr(e)<w&&(g=_)}for(;Math.abs(g.lng-i.center.lng)>180;){const d=i.locationToScreenPoint(g);if(d.x>=0&&d.y>=0&&d.x<=i.width&&d.y<=i.height)break;g.lng>i.center.lng?g.lng-=360:g.lng+=360}return g.lng!==u.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(g))?g:u}const Ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oa(g,e,i){const u=g.classList;for(const d in Ps)u.remove(`maplibregl-${i}-anchor-${d}`);u.add(`maplibregl-${i}-anchor-${e}`)}class Vo extends l.E{constructor(e){if(super(),this._onKeyPress=i=>{const u=i.code,d=i.charCode||i.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=i=>{const u=i.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=i=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?uo(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${Ps[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${_}`),oe.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const i=Y.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${u}px`),i.setAttributeNS(null,"width",`${d}px`),i.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const _=Y.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const w=Y.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const P=Y.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of M){const ue=Y.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",se.rx),ue.setAttributeNS(null,"ry",se.ry),P.appendChild(ue)}const k=Y.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const D=Y.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(D);const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const B=Y.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(B);const G=Y.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const W=Y.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=Y.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const re=Y.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),W.appendChild(ie),W.appendChild(re),w.appendChild(P),w.appendChild(k),w.appendChild(O),w.appendChild(G),w.appendChild(W),i.appendChild(w),i.setAttributeNS(null,"height",u*this._scale+"px"),i.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(i),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),Oa(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,u;if(!(!((i=this._map)===null||i===void 0)&&i.terrain)){const O=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,_=d.terrain.depthAtPoint(this._pos),w=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,w)-_<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/d.transform.pixelsPerMeter,M=Math.sin(d.getPitch()*Math.PI/180)*P,k=d.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),D=d.transform.lngLatToCameraDepth(this._lngLat,w+M)-k>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const Au={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $r=0,Es=!1;const Qh={maxWidth:100,unit:"metric"};function zu(g,e,i){const u=i&&i.maxWidth||100,d=g._container.clientHeight/2,_=g._container.clientWidth/2,w=g.unproject([_-u/2,d]),P=g.unproject([_+u/2,d]),M=Math.round(g.project(P).x-g.project(w).x),k=Math.min(u,M,g._container.clientWidth),D=w.distanceTo(P);if(i&&i.unit==="imperial"){const O=3.2808*D;O>5280?Ba(e,k,O/5280,g._getUIString("ScaleControl.Miles")):Ba(e,k,O,g._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Ba(e,k,D/1852,g._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Ba(e,k,D/1e3,g._getUIString("ScaleControl.Kilometers")):Ba(e,k,D,g._getUIString("ScaleControl.Meters"))}function Ba(g,e,i,u){const d=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let P=_/w;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(M){const k=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*k)/k}(P),w*P}(i);g.style.width=e*(d/i)+"px",g.innerHTML=`${d}&nbsp;${u}`}const Tl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ed=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function la(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-g),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const e=l.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return la(new l.P(0,0))}const Pc=L;b.AJAXError=l.ci,b.Event=l.l,b.Evented=l.E,b.LngLat=l.Q,b.MercatorCoordinate=l.$,b.Point=l.P,b.addProtocol=l.cj,b.config=l.a,b.removeProtocol=l.ck,b.AttributionControl=jo,b.BoxZoomHandler=uf,b.CanvasSource=zr,b.CooperativeGesturesHandler=La,b.DoubleClickZoomHandler=pf,b.DragPanHandler=Sc,b.DragRotateHandler=Iu,b.EdgeInsets=Jr,b.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=Bn,b.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new l.Q(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),_=l.e({bearing:d},this.options.fitBoundsOptions),w=qt.fromLngLat(i,u);this._map.fitBounds(w,_,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new l.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Es)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vo({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))})}},this.options=l.e({},Au,g)}onAdd(g){return this._map=g,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(e=!1){if(ls!==void 0&&!e)return ls;if(window.navigator.permissions===void 0)return ls=!!window.navigator.geolocation,ls;try{ls=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ls=!!window.navigator.geolocation}return ls})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$r=0,Es=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),i=g.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),i=g.getNorthEast(),u=e.distanceTo(i),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$r--,Es=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$r++,$r>1?(g={maximumAge:6e5,timeout:0},Es=!0):(g=this.options.positionOptions,Es=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=ra,b.ImageSource=Rn,b.KeyboardHandler=Xh,b.LngLatBounds=qt,b.LogoControl=Ri,b.Map=class extends Et{constructor(g){var e,i;l.cf.mark(l.cg.create);const u=Object.assign(Object.assign(Object.assign({},Fa),g),{canvasContextAttributes:Object.assign(Object.assign({},Fa.canvasContextAttributes),g.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new ro,_=new Do;if(u.minZoom!==void 0&&d.setMinZoom(u.minZoom),u.maxZoom!==void 0&&d.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&d.setMinPitch(u.minPitch),u.maxPitch!==void 0&&d.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&d.setRenderWorldCopies(u.renderWorldCopies),super(d,_,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Yh,this._controls=[],this._mapId=l.a3(),this._contextLost=P=>{P.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:P}))},this._contextRestored=P=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:P}))},this._onMapScroll=P=>{if(P.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wr),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Oe.addThrottleControl(()=>this.isMoving()),this._requestManager=new it(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let P=!1;const M=Vh(k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())},50);this._resizeObserver=new ResizeObserver(k=>{P?M(k):P=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ku(this,u),this._hash=u.hash&&new ra(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,l.e({},u.fitBoundsOptions,{duration:0}))));const w=typeof u.style=="string"||((i=(e=u.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new jo(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new Ri,u.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const P=l.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(P)}}),this.on("data",P=>{this._update(P.dataType==="style"),this.fire(new l.l(`${P.dataType}data`,P))}),this.on("dataloading",P=>{this.fire(new l.l(`${P.dataType}dataloading`,P))}),this.on("dataabort",P=>{this.fire(new l.l("sourcedataabort",P))})}_getMapId(){return this._mapId}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(i,u.firstChild):u.appendChild(i),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,i,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,i,u)}resize(g,e=!0){const[i,u]=this._containerDimensions(),d=this._getClampedPixelRatio(i,u);if(this._resizeCanvas(i,u,d),this.painter.resize(i,u,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const P=this._getClampedPixelRatio(i,u);this._resizeCanvas(i,u,P),this.painter.resize(i,u,P)}this._resizeTransform(e);const _=!this._moving;return _&&(this.stop(),this.fire(new l.l("movestart",g)).fire(new l.l("move",g))),this.fire(new l.l("resize",g)),_&&this.fire(new l.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[i,u]=this._containerDimensions();this.transform.resize(i,u,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,u,g)}_getClampedPixelRatio(g,e){const{0:i,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,w=e*d;return Math.min(_>i?i/_:1,w>u?u/w:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(qt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(l.Q.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,i){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:_=>{const w=e.filter(M=>this.getLayer(M)),P=w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[];P.length?u||(u=!0,i.call(this,new Ln(g,this,_.originalEvent,{features:P}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:w=>{const P=e.filter(M=>this.getLayer(M));(P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[]).length?u=!0:u&&(u=!1,i.call(this,new Ln(g,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,i.call(this,new Ln(g,this,w.originalEvent)))}}}}{const u=d=>{const _=e.filter(P=>this.getLayer(P)),w=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];w.length&&(d.features=w,i.call(this,d),delete d.features)};return{layers:e,listener:i,delegates:{[g]:u}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,i){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const u=this._delegatedListeners[g];for(let d=0;d<u.length;d++){const _=u[d];if(_.listener===i&&_.layers.length===e.length&&_.layers.every(w=>e.includes(w))){for(const w in _.delegates)this.off(w,_.delegates[w]);return void u.splice(d,1)}}}on(g,e,i){if(i===void 0)return super.on(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,i);this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,u,i)}}}once(g,e,i){if(i===void 0)return super.once(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,i);for(const _ in d.delegates){const w=d.delegates[_];d.delegates[_]=(...P)=>{this._removeDelegatedListener(g,u,i),w(...P)}}this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(g,e,i){return i===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let i;const u=g instanceof l.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:g)||{},d instanceof l.P||typeof d[0]=="number")i=[l.P.convert(d)];else{const _=l.P.convert(d[0]),w=l.P.convert(d[1]);i=[_,new l.P(w.x,_.y),w,new l.P(_.x,w.y),_]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var i,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,e));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new Pa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,d):this.style.loadJSON(g,e,d),this):((u=(i=this.style)===null||i===void 0?void 0:i.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const i=this._requestManager.transformRequest(g,"Style");l.j(i,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new l.k(u))})}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(i){l.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const u=this.style._layers[i];u.type==="hillshade"&&u.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Hi(this.painter,e,g),this.painter.renderToTexture=new Cr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const i=g[e]._tiles;for(const u in i){const d=i[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,e,i={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:O,data:B}=e,G=e;return this.style.addImage(g,{data:new l.R({width:D,height:O},new Uint8Array(B)),pixelRatio:u,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k,sdf:d,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:D,height:O,data:B}=oe.getImageData(e);this.style.addImage(g,{data:new l.R({width:D,height:O},B),pixelRatio:u,stretchX:_,stretchY:w,content:P,textFitWidth:M,textFitHeight:k,sdf:d,version:0})}}updateImage(g,e){const i=this.style.getImage(g);if(!i)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||l.b(e)?oe.getImageData(e):e,{width:d,height:_,data:w}=u;if(d===void 0||_===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==i.data.width||_!==i.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(e instanceof HTMLImageElement||l.b(e));return i.data.replace(w,P),this.style.updateImage(g,i),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return Oe.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,i){return this.style.setLayerZoomRange(g,e,i),this._update(!0)}setFilter(g,e,i={}){return this.style.setFilter(g,e,i),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,i,u={}){return this.style.setPaintProperty(g,e,i,u),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,i,u={}){return this.style.setLayoutProperty(g,e,i,u),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,i,u=>{u||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,i=>{i||this._update(!0)}),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=Y.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),u=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],u);const d=this._controlContainer=Y.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=Y.create("div",`maplibregl-ctrl-${w} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,i){this._canvas.width=Math.floor(i*g),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:g},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!i){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Da(i,this.transform),Te.testSupport(i)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,i,u,d,_;const w=this._idleTriggered?this._fadeDuration:0,P=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let M=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,B=oe.now();this.style.zoomHistory.update(O,B);const G=new l.C(O,{now:B,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),W=G.crossFadingFactor();W===1&&W===this._crossFadingFactor||(M=!0,this._crossFadingFactor=W),this.style.update(G)}const k=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==P;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cf.mark(l.cg.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,l.cf.mark(l.cg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Oe.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cf.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,oe.frame(this._frameRequest,g=>{l.cf.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!l.ch(e)&&!function(i){return i.message===ws}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return mf}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},b.MapMouseEvent=Ln,b.MapTouchEvent=en,b.MapWheelEvent=Zh,b.Marker=Vo,b.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const u=this._map._getUIString(`NavigationControl.${i}`);e.title=u,e.setAttribute("aria-label",u)},this.options=l.e({},Vr,g),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const i=Y.create("button",g,this._container);return i.type="button",i.addEventListener("click",e),i}},b.Popup=class extends l.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._closeButton&&this._closeButton.removeEventListener("click",this._onClose),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var i;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?uo(this._lngLat,this._flatPos,this._map.transform):(i=this._lngLat)===null||i===void 0?void 0:i.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const _=la(this.options.offset);if(!d){const P=this._container.offsetWidth,M=this._container.offsetHeight;let k;k=u.y+_.bottom.y<M?["top"]:u.y>this._map.transform.height-M?["bottom"]:[],u.x<P/2?k.push("left"):u.x>this._map.transform.width-P/2&&k.push("right"),d=k.length===0?"bottom":k.join("-")}let w=u.add(_[d]);this.options.subpixelPositioning||(w=w.round()),Y.setTransform(this._container,`${Ps[d]} translate(${w.x}px,${w.y}px)`),Oa(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Tl),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.Q.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),i=document.createElement("body");let u;for(i.innerHTML=g;u=i.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ed);g&&g.focus()}},b.RasterDEMTileSource=yn,b.RasterTileSource=En,b.ScaleControl=class{constructor(g){this._onMove=()=>{zu(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,zu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Qh),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=ff,b.Style=Pa,b.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=Hh,b.TwoFingersTouchRotateHandler=oa,b.TwoFingersTouchZoomHandler=df,b.TwoFingersTouchZoomRotateHandler=Tc,b.VectorTileSource=ln,b.VideoSource=nr,b.addSourceType=(g,e)=>l._(void 0,void 0,void 0,function*(){if(vr(g))throw new Error(`A source type called "${g}" already exists.`);((i,u)=>{Si[i]=u})(g,e)}),b.clearPrewarmedResources=function(){const g=gn;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(wt),gn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=Kl,b.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return xr().getRTLTextPluginStatus()},b.getVersion=function(){return Pc},b.getWorkerCount=function(){return Dt.workerCount},b.getWorkerUrl=function(){return l.a.WORKER_URL},b.importScriptInWorkers=function(g){return rn().broadcast("IS",g)},b.prewarm=function(){Pn().acquire(wt)},b.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},b.setRTLTextPlugin=function(g,e){return xr().setRTLTextPlugin(g,e)},b.setWorkerCount=function(g){Dt.workerCount=g},b.setWorkerUrl=function(g){l.a.WORKER_URL=g}});var T=a;return T})})(BC);var GA=BC.exports;const qA=bg(GA),Ob="map",_0=t=>{const[r,a]=Lt.useState(null);return Lt.useEffect(()=>{(async()=>{const p=await t();a(p)})()},[t]),r},Bb="z-index-1",WA="z-index-2",U0="z-index-3",Ig="z-index-4",jC="z-index-5",HA=t=>{t.addSource("empty",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:Bb,type:"symbol",source:"empty"}),t.addLayer({id:WA,type:"symbol",source:"empty"}),t.addLayer({id:U0,type:"symbol",source:"empty"}),t.addLayer({id:Ig,type:"symbol",source:"empty"}),t.addLayer({id:jC,type:"symbol",source:"empty"})},XA="#CBE2FF",Rx="#ffffff",KA="#999999",UC="#6EE143",VC=0,YA={fillColor:"#6EE143",fillOpacity:0,strokeColor:"#000000",strokeOpacity:1,strokeWidth:3.5,zIndex:Ig},JA={fillColor:"#6EE143",fillOpacity:0,strokeColor:"#000000",strokeOpacity:1,strokeWidth:3.5,zIndex:Ig},w2=[70,-31];let Mr=null;const QA=()=>Mr,e3=()=>{const t=Mg(),r=_0(Rb),a=_0(bp);Lt.useEffect(()=>{if(!(!a||!r))return Mr=new qA.Map({container:Ob,style:{glyphs:"/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":XA}}],sources:{},version:8},center:w2,zoom:2,minZoom:1.5}),Mr.on("style.load",()=>{Mr.setProjection({type:"globe"})}),Mr.on("load",async()=>{HA(Mr),Mr.setCenter(w2),t(Ul.actions.setIsMapInitialized(!0))}),()=>{t(Ul.actions.setIsMapInitialized(!1)),Mr.remove(),Mr=null}},[a,r,t])},eu=()=>{const t=Oi(r=>r.main.isMapInitialized);return Lt.useCallback(r=>{if(!t||Mr===null)return()=>null;const a=r();return typeof a=="function"?()=>{!t||Mr===null||a()}:a},[t])},t3=()=>{const t=eu();return Lt.useCallback((r,a,p)=>t(()=>{Mr.setLayoutProperty(r,a,p)}),[t])},n3=()=>{const t=eu();return Lt.useCallback((r,a)=>t(()=>{const p=r.id??`layer-${Math.random().toString()}`;return Mr.addLayer({...r,id:p},a),()=>Mr.removeLayer(p)}),[t])},r3=()=>{const t=eu();return Lt.useCallback(()=>t(()=>{Mr.resize()}),[t])},$C=()=>{const t=eu();return Lt.useCallback((r,a)=>t(()=>(Mr.on(r,a),()=>Mr.off(r,a))),[t])},i3=()=>{const t=$C();return Lt.useCallback(r=>t("click",r),[t])},S2={strokeColor:"black",strokeOpacity:1,strokeWidth:2,fillColor:"white",fillOpacity:.5,zIndex:Bb},Hd=()=>{const t=eu();return Lt.useCallback((r,a=S2)=>t(()=>{const p=L=>a[L]??S2[L],x=`geo-json-${Math.random()}`,T=`${x}-fill`,b=`${x}-stroke`,l=p("zIndex");return Mr.addSource(x,{type:"geojson",data:r}),Mr.addLayer({id:T,type:"fill",source:x,paint:{"fill-color":p("fillColor"),"fill-opacity":p("fillOpacity")}},l),Mr.addLayer({id:b,type:"line",source:x,paint:{"line-color":p("strokeColor"),"line-opacity":p("strokeOpacity"),"line-width":p("strokeWidth")}},l),()=>{Mr.removeLayer(T),Mr.removeLayer(b),Mr.removeSource(x)}}),[t])},o3={duration:500},ZC=()=>{const t=eu();return Lt.useCallback((r,a=o3)=>t(()=>{Mr.fitBounds([[r[0],r[1]],[r[2],r[3]]],a)}),[t])},s3={},a3=()=>{const t=eu();return Lt.useCallback((r,a,p,x=s3)=>t(()=>{Mr.flyTo({center:[r,a],zoom:p,...x})}),[t])},l3=()=>{const t=eu();return Lt.useCallback((r,a=500)=>t(()=>{Mr.flyTo({zoom:r,duration:a})}),[t])},c3=()=>{const t=eu();return Lt.useCallback((r,a)=>t(()=>{const p=Mr.unproject([r,a]);return[p.lng,p.lat]}),[t])},u3=()=>{const t=l3(),r=Mg(),a=Oi(x=>x.main.focusedCountry);if(!a)return null;const p=()=>{r(Ul.actions.setFocusedCountry(null)),r(Ul.actions.setFocusedState(null)),t(QA().getZoom()-.3,1e3)};return ct.jsx(CC,{title:a.name,extraDescriptions:[`Country Name: ${a.name}`],getDatasets:()=>gC(a.codeIso3),onClickBack:p})},GC=t=>qC(["mousemove","touchmove"],WC(t)),h3=t=>qC(["mouseup","touchend"],WC(t)),qC=(t,r)=>(t.forEach(a=>document.addEventListener(a,r)),()=>{t.forEach(a=>document.removeEventListener(a,r))}),WC=t=>r=>{var a;!r.clientX&&!r.clientY&&((a=r.touches)!=null&&a[0])&&(r.clientX=r.touches[0].clientX,r.clientY=r.touches[0].clientY),t(r)},d3="_container_1krxa_1",f3={container:d3},HC=200,p3=.5,m3=()=>Math.max(Math.min(document.body.clientWidth*.5,500),HC),g3=()=>{const[t,r]=Lt.useState(null),[a,p]=Lt.useState(null),x=Oi(L=>L.main.menuWidthPx),T=Lt.useCallback(L=>{p({x:L.clientX,y:L.clientY}),r(x)},[x]);Lt.useEffect(()=>h3(()=>{p(null),r(null)}),[]);const b=Mg();Lt.useEffect(()=>GC(L=>{if(a!==null){const $=L.clientX-a.x;let Q=t+$;const ce=document.body.clientWidth*p3;Q=Math.max(Q,HC),Q=Math.min(Q,ce),b(Ul.actions.setMenuWidthPx(Q))}}),[b,a,x,t]);const l=Lt.useCallback(()=>{const L=m3();b(Ul.actions.setMenuWidthPx(L))},[b]);return Lt.useEffect(()=>{l();const L=()=>l();return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[l]),ct.jsx("div",{className:f3.container,onMouseDown:T,onTouchStart:T})},_3="_attributions_101um_1",y3="_attribution_101um_1",v3="_attributionKey_101um_13",x3="_attributionValue_101um_19",b3="_attributionUrl_101um_23",w3="_line_101um_46",S3="_header_101um_53",T3="_subheaderText_101um_62",C3="_suggestedCitation_101um_69",P3="_suggestedCitationTitle_101um_73",ps={attributions:_3,attribution:y3,attributionKey:v3,attributionValue:x3,attributionUrl:b3,line:w3,header:S3,subheaderText:T3,suggestedCitation:C3,suggestedCitationTitle:P3},E3=()=>{const t=Lt.useMemo(()=>[{key:"This data in this map was compiled by Maria Powell and her team for a forthcoming publication",value:ct.jsxs(ct.Fragment,{children:["Powell, M.E., Salvi Cruz, S., Farb, A., Prasad Kodibagkar, A., Ghosh, S., Rudzicz, F., Rameau, A., Bensoussan, Y., Towards Protocol Harmonization: A Scoping Review of Publicly-Accessible Speech and Voice Datasets in Three Voice-Affecting Disease Cohorts,",ct.jsx("i",{children:"Journal of Speech, Language, and Hearing Research"}),", Forthcoming."]})},{key:"Country Borders and Names",value:"Natural Earth",url:"https://www.naturalearthdata.com/downloads/10m-cultural-vectors/"},{key:"USA State Borders",value:"US State Boundaries",url:"https://public.opendatasoft.com/explore/dataset/us-state-boundaries/"},{key:"Canada Province and Territory Borders",value:"Provinces and territories - Canada",url:"https://data.opendatasoft.com/explore/dataset/georef-canada-province%40public"},{key:"Software Dependencies",values:[{name:"MapLibre",url:"https://maplibre.org/"},{name:"React",url:"https://react.dev/"},{name:"Redux",url:"https://redux.js.org/"},{name:"Vite",url:"https://vite.dev/"},{name:"Turf.js",url:"https://turfjs.org/"},{name:"Lodash",url:"https://lodash.com/"},{name:"Font Awesome",url:"https://fontawesome.com/"}]}].map(({key:r,values:a,value:p,url:x},T)=>ct.jsxs("div",{className:ps.attribution,children:[a&&ct.jsxs(ct.Fragment,{children:[ct.jsxs("div",{className:ps.attributionKey,children:[r,":"]}),ct.jsx("ul",{children:a.map(({name:b,url:l},L)=>ct.jsxs("li",{children:[ct.jsx("div",{children:b}),ct.jsx("div",{className:ps.line}),ct.jsx("a",{href:l,target:"_",rel:"noreferrer",className:ps.attributionUrl,children:l})]},L))})]}),p&&ct.jsxs("div",{children:[ct.jsxs("div",{className:ps.attributionKey,children:[r,":"]}),ct.jsx("div",{className:ps.attributionValue,children:p})]}),x&&ct.jsx("a",{href:x,target:"_",rel:"noreferrer",className:ps.attributionUrl,children:x})]},T)),[]);return ct.jsxs(ct.Fragment,{children:[ct.jsx("div",{className:ps.header,children:ct.jsxs("div",{className:ps.headerTexts,children:[ct.jsx("h1",{className:ps.headerText,children:"Global Voice Datasets Repository Map"}),ct.jsx("h3",{className:ps.subheaderText,children:"Accessibility, Licensing, and Research Ethics"})]})}),ct.jsx(Rd,{title:"About",descriptions:["This map tracks publicly accessible speech and voice datasets collected for neurological, mood, and speech disorder research in different countries. Information about the institutional source of the datasets, the number of speakers, languages, and types of voice samples are included, but the focus of the map is on the governance of these voice datasets. The type of accessibility (open or safeguarded), access instructions, and licensing are detailed and can be compared between datasets, institutions, and countries/regions. This map complements a forthcoming searchable tool that can be used to find voice datasets specific to disease categories, diagnoses, or vocal tasks.","In an upcoming iteration of the map, a research ethics element will be added to the dataset information, focusing on the informed consent process that participants went through to contribute their voice data. The aim is to provide information about the research ethics process and related documentation (e.g., consent forms, IRB/REB documentation) to make these datasets more easily useable for researchers whose institutions have stringent data governance requirements."]}),ct.jsx(Rd,{title:"Contact",descriptions:[ct.jsxs(ct.Fragment,{children:["You can contact us with questions, comments, or information about other voice datasets for health research by emailing:"," ",ct.jsx("a",{href:"mailto:alden_blatter@sfu.ca",target:"_",rel:"noreferrer",children:"alden_blatter@sfu.ca"})]})]}),ct.jsx(Rd,{title:"Suggested Citation",descriptions:[ct.jsxs("div",{className:ps.suggestedCitation,children:[ct.jsx("div",{className:ps.suggestedCitationTitle,children:"To cite the Global Voice Datasets Repository Map, please use the following citation:"}),"Alden Blatter, Hortense Gallois, Samantha Salvi Cruz, Yael Bensoussan, Bride2AI Voice Consortium, Maria Powell, Jean-Christophe Blisle-Pipon. (2025). Global Voice Datasets Repository Map. Voice Data Governance. Retrieved Month Day, Year, from"," ",ct.jsx("a",{href:"https://voicedatagovernance.com/",children:"https://voicedatagovernance.com/"}),"."]},"suggested-citation")]}),ct.jsx(Rd,{title:"Attributions",children:ct.jsx("div",{className:ps.attributions,children:t})})]})},XC=t=>t==="USA"?"State":t==="CAN"?"Province / Territory":"State",M3=3,KC=()=>{const t=ZC(),r=a3();return Lt.useCallback(a=>{const p=a.bbox[0];if(a.bbox[2]-p>180){const[b,l]=a.coordLonLat;r(b,l,M3)}else t(a.bbox)},[t,r])},I3=()=>{const t=Mg(),r=KC(),a=Oi(T=>T.main.focusedCountry),p=Oi(T=>T.main.focusedState);if(!a||!p)return null;const x=()=>{t(Ul.actions.setFocusedState(null)),r(a)};return ct.jsx(CC,{title:`${p.name}, ${a.name}`,extraDescriptions:[`${XC(a.codeIso3)} Name: ${p.name}`,`Country Name: ${a.name}`],getDatasets:()=>xC(a.codeIso3,p.stateCode),onClickBack:x})},k3="_container_1e9td_1",A3="_content_1e9td_8",T2={container:k3,content:A3},z3=()=>{const t=Oi(x=>x.main.focusedCountry),r=Oi(x=>x.main.focusedState),a=Oi(x=>x.main.menuWidthPx);let p;return r?p=ct.jsx(I3,{}):t?p=ct.jsx(u3,{}):p=ct.jsx(E3,{}),ct.jsxs(cC,{className:T2.container,style:{width:`${a}px`},children:[ct.jsx(g3,{}),ct.jsx("div",{className:T2.content,children:p})]})},{min:R3,max:D3}=Math,Fd=(t,r=0,a=1)=>R3(D3(r,t),a),Nb=t=>{t._clipped=!1,t._unclipped=t.slice(0);for(let r=0;r<=3;r++)r<3?((t[r]<0||t[r]>255)&&(t._clipped=!0),t[r]=Fd(t[r],0,255)):r===3&&(t[r]=Fd(t[r],0,1));return t},YC={};for(let t of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])YC[`[object ${t}]`]=t.toLowerCase();function On(t){return YC[Object.prototype.toString.call(t)]||"object"}const wn=(t,r=null)=>t.length>=3?Array.prototype.slice.call(t):On(t[0])=="object"&&r?r.split("").filter(a=>t[0][a]!==void 0).map(a=>t[0][a]):t[0].slice(0),wp=t=>{if(t.length<2)return null;const r=t.length-1;return On(t[r])=="string"?t[r].toLowerCase():null},{PI:V0,min:JC,max:QC}=Math,va=t=>Math.round(t*100)/100,Dx=t=>Math.round(t*100)/100,Vc=V0*2,x1=V0/3,L3=V0/180,F3=180/V0;function eP(t){return[...t.slice(0,3).reverse(),...t.slice(3)]}const bn={format:{},autodetect:[]};class xt{constructor(...r){const a=this;if(On(r[0])==="object"&&r[0].constructor&&r[0].constructor===this.constructor)return r[0];let p=wp(r),x=!1;if(!p){x=!0,bn.sorted||(bn.autodetect=bn.autodetect.sort((T,b)=>b.p-T.p),bn.sorted=!0);for(let T of bn.autodetect)if(p=T.test(...r),p)break}if(bn.format[p]){const T=bn.format[p].apply(null,x?r:r.slice(0,-1));a._rgb=Nb(T)}else throw new Error("unknown format: "+r);a._rgb.length===3&&a._rgb.push(1)}toString(){return On(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const O3="3.1.2",Zn=(...t)=>new xt(...t);Zn.version=O3;const gp={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},B3=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,N3=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,tP=t=>{if(t.match(B3)){(t.length===4||t.length===7)&&(t=t.substr(1)),t.length===3&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);const r=parseInt(t,16),a=r>>16,p=r>>8&255,x=r&255;return[a,p,x,1]}if(t.match(N3)){(t.length===5||t.length===9)&&(t=t.substr(1)),t.length===4&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const r=parseInt(t,16),a=r>>24&255,p=r>>16&255,x=r>>8&255,T=Math.round((r&255)/255*100)/100;return[a,p,x,T]}throw new Error(`unknown hex color: ${t}`)},{round:xy}=Math,nP=(...t)=>{let[r,a,p,x]=wn(t,"rgba"),T=wp(t)||"auto";x===void 0&&(x=1),T==="auto"&&(T=x<1?"rgba":"rgb"),r=xy(r),a=xy(a),p=xy(p);let l="000000"+(r<<16|a<<8|p).toString(16);l=l.substr(l.length-6);let L="0"+xy(x*255).toString(16);switch(L=L.substr(L.length-2),T.toLowerCase()){case"rgba":return`#${l}${L}`;case"argb":return`#${L}${l}`;default:return`#${l}`}};xt.prototype.name=function(){const t=nP(this._rgb,"rgb");for(let r of Object.keys(gp))if(gp[r]===t)return r.toLowerCase();return t};bn.format.named=t=>{if(t=t.toLowerCase(),gp[t])return tP(gp[t]);throw new Error("unknown color name: "+t)};bn.autodetect.push({p:5,test:(t,...r)=>{if(!r.length&&On(t)==="string"&&gp[t.toLowerCase()])return"named"}});xt.prototype.alpha=function(t,r=!1){return t!==void 0&&On(t)==="number"?r?(this._rgb[3]=t,this):new xt([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]};xt.prototype.clipped=function(){return this._rgb._clipped||!1};const jl={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},j3=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function Gc(t){const r=j3.get(String(t).toLowerCase());if(!r)throw new Error("unknown Lab illuminant "+t);jl.labWhitePoint=t,jl.Xn=r[0],jl.Zn=r[1]}function xg(){return jl.labWhitePoint}const jb=(...t)=>{t=wn(t,"lab");const[r,a,p]=t,[x,T,b]=U3(r,a,p),[l,L,$]=rP(x,T,b);return[l,L,$,t.length>3?t[3]:1]},U3=(t,r,a)=>{const{kE:p,kK:x,kKE:T,Xn:b,Yn:l,Zn:L}=jl,$=(t+16)/116,Q=.002*r+$,ce=$-.005*a,oe=Q*Q*Q,Y=ce*ce*ce,Te=oe>p?oe:(116*Q-16)/x,et=t>T?Math.pow((t+16)/116,3):t/x,We=Y>p?Y:(116*ce-16)/x,he=Te*b,pe=et*l,ve=We*L;return[he,pe,ve]},b1=t=>{const r=Math.sign(t);return t=Math.abs(t),(t<=.0031308?t*12.92:1.055*Math.pow(t,1/2.4)-.055)*r},rP=(t,r,a)=>{const{MtxAdaptMa:p,MtxAdaptMaI:x,MtxXYZ2RGB:T,RefWhiteRGB:b,Xn:l,Yn:L,Zn:$}=jl,Q=l*p.m00+L*p.m10+$*p.m20,ce=l*p.m01+L*p.m11+$*p.m21,oe=l*p.m02+L*p.m12+$*p.m22,Y=b.X*p.m00+b.Y*p.m10+b.Z*p.m20,Te=b.X*p.m01+b.Y*p.m11+b.Z*p.m21,et=b.X*p.m02+b.Y*p.m12+b.Z*p.m22,We=(t*p.m00+r*p.m10+a*p.m20)*(Y/Q),he=(t*p.m01+r*p.m11+a*p.m21)*(Te/ce),pe=(t*p.m02+r*p.m12+a*p.m22)*(et/oe),ve=We*x.m00+he*x.m10+pe*x.m20,Oe=We*x.m01+he*x.m11+pe*x.m21,it=We*x.m02+he*x.m12+pe*x.m22,qe=b1(ve*T.m00+Oe*T.m10+it*T.m20),we=b1(ve*T.m01+Oe*T.m11+it*T.m21),ne=b1(ve*T.m02+Oe*T.m12+it*T.m22);return[qe*255,we*255,ne*255]},Ub=(...t)=>{const[r,a,p,...x]=wn(t,"rgb"),[T,b,l]=iP(r,a,p),[L,$,Q]=V3(T,b,l);return[L,$,Q,...x.length>0&&x[0]<1?[x[0]]:[]]};function V3(t,r,a){const{Xn:p,Yn:x,Zn:T,kE:b,kK:l}=jl,L=t/p,$=r/x,Q=a/T,ce=L>b?Math.pow(L,1/3):(l*L+16)/116,oe=$>b?Math.pow($,1/3):(l*$+16)/116,Y=Q>b?Math.pow(Q,1/3):(l*Q+16)/116;return[116*oe-16,500*(ce-oe),200*(oe-Y)]}function w1(t){const r=Math.sign(t);return t=Math.abs(t),(t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4))*r}const iP=(t,r,a)=>{t=w1(t/255),r=w1(r/255),a=w1(a/255);const{MtxRGB2XYZ:p,MtxAdaptMa:x,MtxAdaptMaI:T,Xn:b,Yn:l,Zn:L,As:$,Bs:Q,Cs:ce}=jl;let oe=t*p.m00+r*p.m10+a*p.m20,Y=t*p.m01+r*p.m11+a*p.m21,Te=t*p.m02+r*p.m12+a*p.m22;const et=b*x.m00+l*x.m10+L*x.m20,We=b*x.m01+l*x.m11+L*x.m21,he=b*x.m02+l*x.m12+L*x.m22;let pe=oe*x.m00+Y*x.m10+Te*x.m20,ve=oe*x.m01+Y*x.m11+Te*x.m21,Oe=oe*x.m02+Y*x.m12+Te*x.m22;return pe*=et/$,ve*=We/Q,Oe*=he/ce,oe=pe*T.m00+ve*T.m10+Oe*T.m20,Y=pe*T.m01+ve*T.m11+Oe*T.m21,Te=pe*T.m02+ve*T.m12+Oe*T.m22,[oe,Y,Te]};xt.prototype.lab=function(){return Ub(this._rgb)};const $3=(...t)=>new xt(...t,"lab");Object.assign(Zn,{lab:$3,getLabWhitePoint:xg,setLabWhitePoint:Gc});bn.format.lab=jb;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"lab"),On(t)==="array"&&t.length===3)return"lab"}});xt.prototype.darken=function(t=1){const r=this,a=r.lab();return a[0]-=jl.Kn*t,new xt(a,"lab").alpha(r.alpha(),!0)};xt.prototype.brighten=function(t=1){return this.darken(-t)};xt.prototype.darker=xt.prototype.darken;xt.prototype.brighter=xt.prototype.brighten;xt.prototype.get=function(t){const[r,a]=t.split("."),p=this[r]();if(a){const x=r.indexOf(a)-(r.substr(0,2)==="ok"?2:0);if(x>-1)return p[x];throw new Error(`unknown channel ${a} in mode ${r}`)}else return p};const{pow:Z3}=Math,G3=1e-7,q3=20;xt.prototype.luminance=function(t,r="rgb"){if(t!==void 0&&On(t)==="number"){if(t===0)return new xt([0,0,0,this._rgb[3]],"rgb");if(t===1)return new xt([255,255,255,this._rgb[3]],"rgb");let a=this.luminance(),p=q3;const x=(b,l)=>{const L=b.interpolate(l,.5,r),$=L.luminance();return Math.abs(t-$)<G3||!p--?L:$>t?x(b,L):x(L,l)},T=(a>t?x(new xt([0,0,0]),this):x(this,new xt([255,255,255]))).rgb();return new xt([...T,this._rgb[3]])}return W3(...this._rgb.slice(0,3))};const W3=(t,r,a)=>(t=S1(t),r=S1(r),a=S1(a),.2126*t+.7152*r+.0722*a),S1=t=>(t/=255,t<=.03928?t/12.92:Z3((t+.055)/1.055,2.4)),ko={},_p=(t,r,a=.5,...p)=>{let x=p[0]||"lrgb";if(!ko[x]&&!p.length&&(x=Object.keys(ko)[0]),!ko[x])throw new Error(`interpolation mode ${x} is not defined`);return On(t)!=="object"&&(t=new xt(t)),On(r)!=="object"&&(r=new xt(r)),ko[x](t,r,a).alpha(t.alpha()+a*(r.alpha()-t.alpha()))};xt.prototype.mix=xt.prototype.interpolate=function(t,r=.5,...a){return _p(this,t,r,...a)};xt.prototype.premultiply=function(t=!1){const r=this._rgb,a=r[3];return t?(this._rgb=[r[0]*a,r[1]*a,r[2]*a,a],this):new xt([r[0]*a,r[1]*a,r[2]*a,a],"rgb")};const{sin:H3,cos:X3}=Math,oP=(...t)=>{let[r,a,p]=wn(t,"lch");return isNaN(p)&&(p=0),p=p*L3,[r,X3(p)*a,H3(p)*a]},Vb=(...t)=>{t=wn(t,"lch");const[r,a,p]=t,[x,T,b]=oP(r,a,p),[l,L,$]=jb(x,T,b);return[l,L,$,t.length>3?t[3]:1]},K3=(...t)=>{const r=eP(wn(t,"hcl"));return Vb(...r)},{sqrt:Y3,atan2:J3,round:Q3}=Math,sP=(...t)=>{const[r,a,p]=wn(t,"lab"),x=Y3(a*a+p*p);let T=(J3(p,a)*F3+360)%360;return Q3(x*1e4)===0&&(T=Number.NaN),[r,x,T]},$b=(...t)=>{const[r,a,p,...x]=wn(t,"rgb"),[T,b,l]=Ub(r,a,p),[L,$,Q]=sP(T,b,l);return[L,$,Q,...x.length>0&&x[0]<1?[x[0]]:[]]};xt.prototype.lch=function(){return $b(this._rgb)};xt.prototype.hcl=function(){return eP($b(this._rgb))};const ez=(...t)=>new xt(...t,"lch"),tz=(...t)=>new xt(...t,"hcl");Object.assign(Zn,{lch:ez,hcl:tz});bn.format.lch=Vb;bn.format.hcl=K3;["lch","hcl"].forEach(t=>bn.autodetect.push({p:2,test:(...r)=>{if(r=wn(r,t),On(r)==="array"&&r.length===3)return t}}));xt.prototype.saturate=function(t=1){const r=this,a=r.lch();return a[1]+=jl.Kn*t,a[1]<0&&(a[1]=0),new xt(a,"lch").alpha(r.alpha(),!0)};xt.prototype.desaturate=function(t=1){return this.saturate(-t)};xt.prototype.set=function(t,r,a=!1){const[p,x]=t.split("."),T=this[p]();if(x){const b=p.indexOf(x)-(p.substr(0,2)==="ok"?2:0);if(b>-1){if(On(r)=="string")switch(r.charAt(0)){case"+":T[b]+=+r;break;case"-":T[b]+=+r;break;case"*":T[b]*=+r.substr(1);break;case"/":T[b]/=+r.substr(1);break;default:T[b]=+r}else if(On(r)==="number")T[b]=r;else throw new Error("unsupported value for Color.set");const l=new xt(T,p);return a?(this._rgb=l._rgb,this):l}throw new Error(`unknown channel ${x} in mode ${p}`)}else return T};xt.prototype.tint=function(t=.5,...r){return _p(this,"white",t,...r)};xt.prototype.shade=function(t=.5,...r){return _p(this,"black",t,...r)};const nz=(t,r,a)=>{const p=t._rgb,x=r._rgb;return new xt(p[0]+a*(x[0]-p[0]),p[1]+a*(x[1]-p[1]),p[2]+a*(x[2]-p[2]),"rgb")};ko.rgb=nz;const{sqrt:T1,pow:Uf}=Math,rz=(t,r,a)=>{const[p,x,T]=t._rgb,[b,l,L]=r._rgb;return new xt(T1(Uf(p,2)*(1-a)+Uf(b,2)*a),T1(Uf(x,2)*(1-a)+Uf(l,2)*a),T1(Uf(T,2)*(1-a)+Uf(L,2)*a),"rgb")};ko.lrgb=rz;const iz=(t,r,a)=>{const p=t.lab(),x=r.lab();return new xt(p[0]+a*(x[0]-p[0]),p[1]+a*(x[1]-p[1]),p[2]+a*(x[2]-p[2]),"lab")};ko.lab=iz;const Sp=(t,r,a,p)=>{let x,T;p==="hsl"?(x=t.hsl(),T=r.hsl()):p==="hsv"?(x=t.hsv(),T=r.hsv()):p==="hcg"?(x=t.hcg(),T=r.hcg()):p==="hsi"?(x=t.hsi(),T=r.hsi()):p==="lch"||p==="hcl"?(p="hcl",x=t.hcl(),T=r.hcl()):p==="oklch"&&(x=t.oklch().reverse(),T=r.oklch().reverse());let b,l,L,$,Q,ce;(p.substr(0,1)==="h"||p==="oklch")&&([b,L,Q]=x,[l,$,ce]=T);let oe,Y,Te,et;return!isNaN(b)&&!isNaN(l)?(l>b&&l-b>180?et=l-(b+360):l<b&&b-l>180?et=l+360-b:et=l-b,Y=b+a*et):isNaN(b)?isNaN(l)?Y=Number.NaN:(Y=l,(Q==1||Q==0)&&p!="hsv"&&(oe=$)):(Y=b,(ce==1||ce==0)&&p!="hsv"&&(oe=L)),oe===void 0&&(oe=L+a*($-L)),Te=Q+a*(ce-Q),p==="oklch"?new xt([Te,oe,Y],p):new xt([Y,oe,Te],p)},aP=(t,r,a)=>Sp(t,r,a,"lch");ko.lch=aP;ko.hcl=aP;const oz=t=>{if(On(t)=="number"&&t>=0&&t<=16777215){const r=t>>16,a=t>>8&255,p=t&255;return[r,a,p,1]}throw new Error("unknown num color: "+t)},sz=(...t)=>{const[r,a,p]=wn(t,"rgb");return(r<<16)+(a<<8)+p};xt.prototype.num=function(){return sz(this._rgb)};const az=(...t)=>new xt(...t,"num");Object.assign(Zn,{num:az});bn.format.num=oz;bn.autodetect.push({p:5,test:(...t)=>{if(t.length===1&&On(t[0])==="number"&&t[0]>=0&&t[0]<=16777215)return"num"}});const lz=(t,r,a)=>{const p=t.num(),x=r.num();return new xt(p+a*(x-p),"num")};ko.num=lz;const{floor:cz}=Math,uz=(...t)=>{t=wn(t,"hcg");let[r,a,p]=t,x,T,b;p=p*255;const l=a*255;if(a===0)x=T=b=p;else{r===360&&(r=0),r>360&&(r-=360),r<0&&(r+=360),r/=60;const L=cz(r),$=r-L,Q=p*(1-a),ce=Q+l*(1-$),oe=Q+l*$,Y=Q+l;switch(L){case 0:[x,T,b]=[Y,oe,Q];break;case 1:[x,T,b]=[ce,Y,Q];break;case 2:[x,T,b]=[Q,Y,oe];break;case 3:[x,T,b]=[Q,ce,Y];break;case 4:[x,T,b]=[oe,Q,Y];break;case 5:[x,T,b]=[Y,Q,ce];break}}return[x,T,b,t.length>3?t[3]:1]},hz=(...t)=>{const[r,a,p]=wn(t,"rgb"),x=JC(r,a,p),T=QC(r,a,p),b=T-x,l=b*100/255,L=x/(255-b)*100;let $;return b===0?$=Number.NaN:(r===T&&($=(a-p)/b),a===T&&($=2+(p-r)/b),p===T&&($=4+(r-a)/b),$*=60,$<0&&($+=360)),[$,l,L]};xt.prototype.hcg=function(){return hz(this._rgb)};const dz=(...t)=>new xt(...t,"hcg");Zn.hcg=dz;bn.format.hcg=uz;bn.autodetect.push({p:1,test:(...t)=>{if(t=wn(t,"hcg"),On(t)==="array"&&t.length===3)return"hcg"}});const fz=(t,r,a)=>Sp(t,r,a,"hcg");ko.hcg=fz;const{cos:Vf}=Math,pz=(...t)=>{t=wn(t,"hsi");let[r,a,p]=t,x,T,b;return isNaN(r)&&(r=0),isNaN(a)&&(a=0),r>360&&(r-=360),r<0&&(r+=360),r/=360,r<1/3?(b=(1-a)/3,x=(1+a*Vf(Vc*r)/Vf(x1-Vc*r))/3,T=1-(b+x)):r<2/3?(r-=1/3,x=(1-a)/3,T=(1+a*Vf(Vc*r)/Vf(x1-Vc*r))/3,b=1-(x+T)):(r-=2/3,T=(1-a)/3,b=(1+a*Vf(Vc*r)/Vf(x1-Vc*r))/3,x=1-(T+b)),x=Fd(p*x*3),T=Fd(p*T*3),b=Fd(p*b*3),[x*255,T*255,b*255,t.length>3?t[3]:1]},{min:mz,sqrt:gz,acos:_z}=Math,yz=(...t)=>{let[r,a,p]=wn(t,"rgb");r/=255,a/=255,p/=255;let x;const T=mz(r,a,p),b=(r+a+p)/3,l=b>0?1-T/b:0;return l===0?x=NaN:(x=(r-a+(r-p))/2,x/=gz((r-a)*(r-a)+(r-p)*(a-p)),x=_z(x),p>a&&(x=Vc-x),x/=Vc),[x*360,l,b]};xt.prototype.hsi=function(){return yz(this._rgb)};const vz=(...t)=>new xt(...t,"hsi");Zn.hsi=vz;bn.format.hsi=pz;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"hsi"),On(t)==="array"&&t.length===3)return"hsi"}});const xz=(t,r,a)=>Sp(t,r,a,"hsi");ko.hsi=xz;const Lx=(...t)=>{t=wn(t,"hsl");const[r,a,p]=t;let x,T,b;if(a===0)x=T=b=p*255;else{const l=[0,0,0],L=[0,0,0],$=p<.5?p*(1+a):p+a-p*a,Q=2*p-$,ce=r/360;l[0]=ce+1/3,l[1]=ce,l[2]=ce-1/3;for(let oe=0;oe<3;oe++)l[oe]<0&&(l[oe]+=1),l[oe]>1&&(l[oe]-=1),6*l[oe]<1?L[oe]=Q+($-Q)*6*l[oe]:2*l[oe]<1?L[oe]=$:3*l[oe]<2?L[oe]=Q+($-Q)*(2/3-l[oe])*6:L[oe]=Q;[x,T,b]=[L[0]*255,L[1]*255,L[2]*255]}return t.length>3?[x,T,b,t[3]]:[x,T,b,1]},lP=(...t)=>{t=wn(t,"rgba");let[r,a,p]=t;r/=255,a/=255,p/=255;const x=JC(r,a,p),T=QC(r,a,p),b=(T+x)/2;let l,L;return T===x?(l=0,L=Number.NaN):l=b<.5?(T-x)/(T+x):(T-x)/(2-T-x),r==T?L=(a-p)/(T-x):a==T?L=2+(p-r)/(T-x):p==T&&(L=4+(r-a)/(T-x)),L*=60,L<0&&(L+=360),t.length>3&&t[3]!==void 0?[L,l,b,t[3]]:[L,l,b]};xt.prototype.hsl=function(){return lP(this._rgb)};const bz=(...t)=>new xt(...t,"hsl");Zn.hsl=bz;bn.format.hsl=Lx;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"hsl"),On(t)==="array"&&t.length===3)return"hsl"}});const wz=(t,r,a)=>Sp(t,r,a,"hsl");ko.hsl=wz;const{floor:Sz}=Math,Tz=(...t)=>{t=wn(t,"hsv");let[r,a,p]=t,x,T,b;if(p*=255,a===0)x=T=b=p;else{r===360&&(r=0),r>360&&(r-=360),r<0&&(r+=360),r/=60;const l=Sz(r),L=r-l,$=p*(1-a),Q=p*(1-a*L),ce=p*(1-a*(1-L));switch(l){case 0:[x,T,b]=[p,ce,$];break;case 1:[x,T,b]=[Q,p,$];break;case 2:[x,T,b]=[$,p,ce];break;case 3:[x,T,b]=[$,Q,p];break;case 4:[x,T,b]=[ce,$,p];break;case 5:[x,T,b]=[p,$,Q];break}}return[x,T,b,t.length>3?t[3]:1]},{min:Cz,max:Pz}=Math,Ez=(...t)=>{t=wn(t,"rgb");let[r,a,p]=t;const x=Cz(r,a,p),T=Pz(r,a,p),b=T-x;let l,L,$;return $=T/255,T===0?(l=Number.NaN,L=0):(L=b/T,r===T&&(l=(a-p)/b),a===T&&(l=2+(p-r)/b),p===T&&(l=4+(r-a)/b),l*=60,l<0&&(l+=360)),[l,L,$]};xt.prototype.hsv=function(){return Ez(this._rgb)};const Mz=(...t)=>new xt(...t,"hsv");Zn.hsv=Mz;bn.format.hsv=Tz;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"hsv"),On(t)==="array"&&t.length===3)return"hsv"}});const Iz=(t,r,a)=>Sp(t,r,a,"hsv");ko.hsv=Iz;function y0(t,r){let a=t.length;Array.isArray(t[0])||(t=[t]),Array.isArray(r[0])||(r=r.map(b=>[b]));let p=r[0].length,x=r[0].map((b,l)=>r.map(L=>L[l])),T=t.map(b=>x.map(l=>Array.isArray(b)?b.reduce((L,$,Q)=>L+$*(l[Q]||0),0):l.reduce((L,$)=>L+$*b,0)));return a===1&&(T=T[0]),p===1?T.map(b=>b[0]):T}const Zb=(...t)=>{t=wn(t,"lab");const[r,a,p,...x]=t,[T,b,l]=kz([r,a,p]),[L,$,Q]=rP(T,b,l);return[L,$,Q,...x.length>0&&x[0]<1?[x[0]]:[]]};function kz(t){var r=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],a=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],p=y0(a,t);return y0(r,p.map(x=>x**3))}const Gb=(...t)=>{const[r,a,p,...x]=wn(t,"rgb"),T=iP(r,a,p);return[...Az(T),...x.length>0&&x[0]<1?[x[0]]:[]]};function Az(t){const r=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],a=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],p=y0(r,t);return y0(a,p.map(x=>Math.cbrt(x)))}xt.prototype.oklab=function(){return Gb(this._rgb)};const zz=(...t)=>new xt(...t,"oklab");Object.assign(Zn,{oklab:zz});bn.format.oklab=Zb;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"oklab"),On(t)==="array"&&t.length===3)return"oklab"}});const Rz=(t,r,a)=>{const p=t.oklab(),x=r.oklab();return new xt(p[0]+a*(x[0]-p[0]),p[1]+a*(x[1]-p[1]),p[2]+a*(x[2]-p[2]),"oklab")};ko.oklab=Rz;const Dz=(t,r,a)=>Sp(t,r,a,"oklch");ko.oklch=Dz;const{pow:C1,sqrt:P1,PI:E1,cos:C2,sin:P2,atan2:Lz}=Math,Fz=(t,r="lrgb",a=null)=>{const p=t.length;a||(a=Array.from(new Array(p)).map(()=>1));const x=p/a.reduce(function(ce,oe){return ce+oe});if(a.forEach((ce,oe)=>{a[oe]*=x}),t=t.map(ce=>new xt(ce)),r==="lrgb")return Oz(t,a);const T=t.shift(),b=T.get(r),l=[];let L=0,$=0;for(let ce=0;ce<b.length;ce++)if(b[ce]=(b[ce]||0)*a[0],l.push(isNaN(b[ce])?0:a[0]),r.charAt(ce)==="h"&&!isNaN(b[ce])){const oe=b[ce]/180*E1;L+=C2(oe)*a[0],$+=P2(oe)*a[0]}let Q=T.alpha()*a[0];t.forEach((ce,oe)=>{const Y=ce.get(r);Q+=ce.alpha()*a[oe+1];for(let Te=0;Te<b.length;Te++)if(!isNaN(Y[Te]))if(l[Te]+=a[oe+1],r.charAt(Te)==="h"){const et=Y[Te]/180*E1;L+=C2(et)*a[oe+1],$+=P2(et)*a[oe+1]}else b[Te]+=Y[Te]*a[oe+1]});for(let ce=0;ce<b.length;ce++)if(r.charAt(ce)==="h"){let oe=Lz($/l[ce],L/l[ce])/E1*180;for(;oe<0;)oe+=360;for(;oe>=360;)oe-=360;b[ce]=oe}else b[ce]=b[ce]/l[ce];return Q/=p,new xt(b,r).alpha(Q>.99999?1:Q,!0)},Oz=(t,r)=>{const a=t.length,p=[0,0,0,0];for(let x=0;x<t.length;x++){const T=t[x],b=r[x]/a,l=T._rgb;p[0]+=C1(l[0],2)*b,p[1]+=C1(l[1],2)*b,p[2]+=C1(l[2],2)*b,p[3]+=l[3]*b}return p[0]=P1(p[0]),p[1]=P1(p[1]),p[2]=P1(p[2]),p[3]>.9999999&&(p[3]=1),new xt(Nb(p))},{pow:Bz}=Math;function v0(t){let r="rgb",a=Zn("#ccc"),p=0,x=[0,1],T=[],b=[0,0],l=!1,L=[],$=!1,Q=0,ce=1,oe=!1,Y={},Te=!0,et=1;const We=function(we){if(we=we||["#fff","#000"],we&&On(we)==="string"&&Zn.brewer&&Zn.brewer[we.toLowerCase()]&&(we=Zn.brewer[we.toLowerCase()]),On(we)==="array"){we.length===1&&(we=[we[0],we[0]]),we=we.slice(0);for(let ne=0;ne<we.length;ne++)we[ne]=Zn(we[ne]);T.length=0;for(let ne=0;ne<we.length;ne++)T.push(ne/(we.length-1))}return it(),L=we},he=function(we){if(l!=null){const ne=l.length-1;let ye=0;for(;ye<ne&&we>=l[ye];)ye++;return ye-1}return 0};let pe=we=>we,ve=we=>we;const Oe=function(we,ne){let ye,ke;if(ne==null&&(ne=!1),isNaN(we)||we===null)return a;ne?ke=we:l&&l.length>2?ke=he(we)/(l.length-2):ce!==Q?ke=(we-Q)/(ce-Q):ke=1,ke=ve(ke),ne||(ke=pe(ke)),et!==1&&(ke=Bz(ke,et)),ke=b[0]+ke*(1-b[0]-b[1]),ke=Fd(ke,0,1);const st=Math.floor(ke*1e4);if(Te&&Y[st])ye=Y[st];else{if(On(L)==="array")for(let lt=0;lt<T.length;lt++){const bt=T[lt];if(ke<=bt){ye=L[lt];break}if(ke>=bt&&lt===T.length-1){ye=L[lt];break}if(ke>bt&&ke<T[lt+1]){ke=(ke-bt)/(T[lt+1]-bt),ye=Zn.interpolate(L[lt],L[lt+1],ke,r);break}}else On(L)==="function"&&(ye=L(ke));Te&&(Y[st]=ye)}return ye};var it=()=>Y={};We(t);const qe=function(we){const ne=Zn(Oe(we));return $&&ne[$]?ne[$]():ne};return qe.classes=function(we){if(we!=null){if(On(we)==="array")l=we,x=[we[0],we[we.length-1]];else{const ne=Zn.analyze(x);we===0?l=[ne.min,ne.max]:l=Zn.limits(ne,"e",we)}return qe}return l},qe.domain=function(we){if(!arguments.length)return x;Q=we[0],ce=we[we.length-1],T=[];const ne=L.length;if(we.length===ne&&Q!==ce)for(let ye of Array.from(we))T.push((ye-Q)/(ce-Q));else{for(let ye=0;ye<ne;ye++)T.push(ye/(ne-1));if(we.length>2){const ye=we.map((st,lt)=>lt/(we.length-1)),ke=we.map(st=>(st-Q)/(ce-Q));ke.every((st,lt)=>ye[lt]===st)||(ve=st=>{if(st<=0||st>=1)return st;let lt=0;for(;st>=ke[lt+1];)lt++;const bt=(st-ke[lt])/(ke[lt+1]-ke[lt]);return ye[lt]+bt*(ye[lt+1]-ye[lt])})}}return x=[Q,ce],qe},qe.mode=function(we){return arguments.length?(r=we,it(),qe):r},qe.range=function(we,ne){return We(we),qe},qe.out=function(we){return $=we,qe},qe.spread=function(we){return arguments.length?(p=we,qe):p},qe.correctLightness=function(we){return we==null&&(we=!0),oe=we,it(),oe?pe=function(ne){const ye=Oe(0,!0).lab()[0],ke=Oe(1,!0).lab()[0],st=ye>ke;let lt=Oe(ne,!0).lab()[0];const bt=ye+(ke-ye)*ne;let tn=lt-bt,lr=0,Kt=1,Zt=20;for(;Math.abs(tn)>.01&&Zt-- >0;)(function(){return st&&(tn*=-1),tn<0?(lr=ne,ne+=(Kt-ne)*.5):(Kt=ne,ne+=(lr-ne)*.5),lt=Oe(ne,!0).lab()[0],tn=lt-bt})();return ne}:pe=ne=>ne,qe},qe.padding=function(we){return we!=null?(On(we)==="number"&&(we=[we,we]),b=we,qe):b},qe.colors=function(we,ne){arguments.length<2&&(ne="hex");let ye=[];if(arguments.length===0)ye=L.slice(0);else if(we===1)ye=[qe(.5)];else if(we>1){const ke=x[0],st=x[1]-ke;ye=Nz(0,we).map(lt=>qe(ke+lt/(we-1)*st))}else{t=[];let ke=[];if(l&&l.length>2)for(let st=1,lt=l.length,bt=1<=lt;bt?st<lt:st>lt;bt?st++:st--)ke.push((l[st-1]+l[st])*.5);else ke=x;ye=ke.map(st=>qe(st))}return Zn[ne]&&(ye=ye.map(ke=>ke[ne]())),ye},qe.cache=function(we){return we!=null?(Te=we,qe):Te},qe.gamma=function(we){return we!=null?(et=we,qe):et},qe.nodata=function(we){return we!=null?(a=Zn(we),qe):a},qe}function Nz(t,r,a){let p=[],x=t<r,T=r;for(let b=t;x?b<T:b>T;x?b++:b--)p.push(b);return p}const jz=function(t){let r=[1,1];for(let a=1;a<t;a++){let p=[1];for(let x=1;x<=r.length;x++)p[x]=(r[x]||0)+r[x-1];r=p}return r},Uz=function(t){let r,a,p,x;if(t=t.map(T=>new xt(T)),t.length===2)[a,p]=t.map(T=>T.lab()),r=function(T){const b=[0,1,2].map(l=>a[l]+T*(p[l]-a[l]));return new xt(b,"lab")};else if(t.length===3)[a,p,x]=t.map(T=>T.lab()),r=function(T){const b=[0,1,2].map(l=>(1-T)*(1-T)*a[l]+2*(1-T)*T*p[l]+T*T*x[l]);return new xt(b,"lab")};else if(t.length===4){let T;[a,p,x,T]=t.map(b=>b.lab()),r=function(b){const l=[0,1,2].map(L=>(1-b)*(1-b)*(1-b)*a[L]+3*(1-b)*(1-b)*b*p[L]+3*(1-b)*b*b*x[L]+b*b*b*T[L]);return new xt(l,"lab")}}else if(t.length>=5){let T,b,l;T=t.map(L=>L.lab()),l=t.length-1,b=jz(l),r=function(L){const $=1-L,Q=[0,1,2].map(ce=>T.reduce((oe,Y,Te)=>oe+b[Te]*$**(l-Te)*L**Te*Y[ce],0));return new xt(Q,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return r},Vz=t=>{const r=Uz(t);return r.scale=()=>v0(r),r},{round:cP}=Math;xt.prototype.rgb=function(t=!0){return t===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(cP)};xt.prototype.rgba=function(t=!0){return this._rgb.slice(0,4).map((r,a)=>a<3?t===!1?r:cP(r):r)};const $z=(...t)=>new xt(...t,"rgb");Object.assign(Zn,{rgb:$z});bn.format.rgb=(...t)=>{const r=wn(t,"rgba");return r[3]===void 0&&(r[3]=1),r};bn.autodetect.push({p:3,test:(...t)=>{if(t=wn(t,"rgba"),On(t)==="array"&&(t.length===3||t.length===4&&On(t[3])=="number"&&t[3]>=0&&t[3]<=1))return"rgb"}});const il=(t,r,a)=>{if(!il[a])throw new Error("unknown blend mode "+a);return il[a](t,r)},Sh=t=>(r,a)=>{const p=Zn(a).rgb(),x=Zn(r).rgb();return Zn.rgb(t(p,x))},Th=t=>(r,a)=>{const p=[];return p[0]=t(r[0],a[0]),p[1]=t(r[1],a[1]),p[2]=t(r[2],a[2]),p},Zz=t=>t,Gz=(t,r)=>t*r/255,qz=(t,r)=>t>r?r:t,Wz=(t,r)=>t>r?t:r,Hz=(t,r)=>255*(1-(1-t/255)*(1-r/255)),Xz=(t,r)=>r<128?2*t*r/255:255*(1-2*(1-t/255)*(1-r/255)),Kz=(t,r)=>255*(1-(1-r/255)/(t/255)),Yz=(t,r)=>t===255?255:(t=255*(r/255)/(1-t/255),t>255?255:t);il.normal=Sh(Th(Zz));il.multiply=Sh(Th(Gz));il.screen=Sh(Th(Hz));il.overlay=Sh(Th(Xz));il.darken=Sh(Th(qz));il.lighten=Sh(Th(Wz));il.dodge=Sh(Th(Yz));il.burn=Sh(Th(Kz));const{pow:Jz,sin:Qz,cos:eR}=Math;function tR(t=300,r=-1.5,a=1,p=1,x=[0,1]){let T=0,b;On(x)==="array"?b=x[1]-x[0]:(b=0,x=[x,x]);const l=function(L){const $=Vc*((t+120)/360+r*L),Q=Jz(x[0]+b*L,p),oe=(T!==0?a[0]+L*T:a)*Q*(1-Q)/2,Y=eR($),Te=Qz($),et=Q+oe*(-.14861*Y+1.78277*Te),We=Q+oe*(-.29227*Y-.90649*Te),he=Q+oe*(1.97294*Y);return Zn(Nb([et*255,We*255,he*255,1]))};return l.start=function(L){return L==null?t:(t=L,l)},l.rotations=function(L){return L==null?r:(r=L,l)},l.gamma=function(L){return L==null?p:(p=L,l)},l.hue=function(L){return L==null?a:(a=L,On(a)==="array"?(T=a[1]-a[0],T===0&&(a=a[1])):T=0,l)},l.lightness=function(L){return L==null?x:(On(L)==="array"?(x=L,b=L[1]-L[0]):(x=[L,L],b=0),l)},l.scale=()=>Zn.scale(l),l.hue(a),l}const nR="0123456789abcdef",{floor:rR,random:iR}=Math,oR=()=>{let t="#";for(let r=0;r<6;r++)t+=nR.charAt(rR(iR()*16));return new xt(t,"hex")},{log:E2,pow:sR,floor:aR,abs:lR}=Math;function uP(t,r=null){const a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return On(t)==="object"&&(t=Object.values(t)),t.forEach(p=>{r&&On(p)==="object"&&(p=p[r]),p!=null&&!isNaN(p)&&(a.values.push(p),a.sum+=p,p<a.min&&(a.min=p),p>a.max&&(a.max=p),a.count+=1)}),a.domain=[a.min,a.max],a.limits=(p,x)=>hP(a,p,x),a}function hP(t,r="equal",a=7){On(t)=="array"&&(t=uP(t));const{min:p,max:x}=t,T=t.values.sort((l,L)=>l-L);if(a===1)return[p,x];const b=[];if(r.substr(0,1)==="c"&&(b.push(p),b.push(x)),r.substr(0,1)==="e"){b.push(p);for(let l=1;l<a;l++)b.push(p+l/a*(x-p));b.push(x)}else if(r.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");const l=Math.LOG10E*E2(p),L=Math.LOG10E*E2(x);b.push(p);for(let $=1;$<a;$++)b.push(sR(10,l+$/a*(L-l)));b.push(x)}else if(r.substr(0,1)==="q"){b.push(p);for(let l=1;l<a;l++){const L=(T.length-1)*l/a,$=aR(L);if($===L)b.push(T[$]);else{const Q=L-$;b.push(T[$]*(1-Q)+T[$+1]*Q)}}b.push(x)}else if(r.substr(0,1)==="k"){let l;const L=T.length,$=new Array(L),Q=new Array(a);let ce=!0,oe=0,Y=null;Y=[],Y.push(p);for(let We=1;We<a;We++)Y.push(p+We/a*(x-p));for(Y.push(x);ce;){for(let he=0;he<a;he++)Q[he]=0;for(let he=0;he<L;he++){const pe=T[he];let ve=Number.MAX_VALUE,Oe;for(let it=0;it<a;it++){const qe=lR(Y[it]-pe);qe<ve&&(ve=qe,Oe=it),Q[Oe]++,$[he]=Oe}}const We=new Array(a);for(let he=0;he<a;he++)We[he]=null;for(let he=0;he<L;he++)l=$[he],We[l]===null?We[l]=T[he]:We[l]+=T[he];for(let he=0;he<a;he++)We[he]*=1/Q[he];ce=!1;for(let he=0;he<a;he++)if(We[he]!==Y[he]){ce=!0;break}Y=We,oe++,oe>200&&(ce=!1)}const Te={};for(let We=0;We<a;We++)Te[We]=[];for(let We=0;We<L;We++)l=$[We],Te[l].push(T[We]);let et=[];for(let We=0;We<a;We++)et.push(Te[We][0]),et.push(Te[We][Te[We].length-1]);et=et.sort((We,he)=>We-he),b.push(et[0]);for(let We=1;We<et.length;We+=2){const he=et[We];!isNaN(he)&&b.indexOf(he)===-1&&b.push(he)}}return b}const cR=(t,r)=>{t=new xt(t),r=new xt(r);const a=t.luminance(),p=r.luminance();return a>p?(a+.05)/(p+.05):(p+.05)/(a+.05)};/**
 * @license
 *
 * The APCA contrast prediction algorithm is based of the formulas published
 * in the APCA-1.0.98G specification by Myndex. The specification is available at:
 * https://raw.githubusercontent.com/Myndex/apca-w3/master/images/APCAw3_0.1.17_APCA0.0.98G.svg
 *
 * Note that the APCA implementation is still beta, so please update to
 * future versions of chroma.js when they become available.
 *
 * You can read more about the APCA Readability Criterion at
 * https://readtech.org/ARC/
 */const M2=.027,uR=5e-4,hR=.1,I2=1.14,by=.022,k2=1.414,dR=(t,r)=>{t=new xt(t),r=new xt(r),t.alpha()<1&&(t=_p(r,t,t.alpha(),"rgb"));const a=A2(...t.rgb()),p=A2(...r.rgb()),x=a>=by?a:a+Math.pow(by-a,k2),T=p>=by?p:p+Math.pow(by-p,k2),b=Math.pow(T,.56)-Math.pow(x,.57),l=Math.pow(T,.65)-Math.pow(x,.62),L=Math.abs(T-x)<uR?0:x<T?b*I2:l*I2;return(Math.abs(L)<hR?0:L>0?L-M2:L+M2)*100};function A2(t,r,a){return .2126729*Math.pow(t/255,2.4)+.7151522*Math.pow(r/255,2.4)+.072175*Math.pow(a/255,2.4)}const{sqrt:Nc,pow:Pi,min:fR,max:pR,atan2:z2,abs:R2,cos:wy,sin:D2,exp:mR,PI:L2}=Math;function gR(t,r,a=1,p=1,x=1){var T=function(Tt){return 360*Tt/(2*L2)},b=function(Tt){return 2*L2*Tt/360};t=new xt(t),r=new xt(r);const[l,L,$]=Array.from(t.lab()),[Q,ce,oe]=Array.from(r.lab()),Y=(l+Q)/2,Te=Nc(Pi(L,2)+Pi($,2)),et=Nc(Pi(ce,2)+Pi(oe,2)),We=(Te+et)/2,he=.5*(1-Nc(Pi(We,7)/(Pi(We,7)+Pi(25,7)))),pe=L*(1+he),ve=ce*(1+he),Oe=Nc(Pi(pe,2)+Pi($,2)),it=Nc(Pi(ve,2)+Pi(oe,2)),qe=(Oe+it)/2,we=T(z2($,pe)),ne=T(z2(oe,ve)),ye=we>=0?we:we+360,ke=ne>=0?ne:ne+360,st=R2(ye-ke)>180?(ye+ke+360)/2:(ye+ke)/2,lt=1-.17*wy(b(st-30))+.24*wy(b(2*st))+.32*wy(b(3*st+6))-.2*wy(b(4*st-63));let bt=ke-ye;bt=R2(bt)<=180?bt:ke<=ye?bt+360:bt-360,bt=2*Nc(Oe*it)*D2(b(bt)/2);const tn=Q-l,lr=it-Oe,Kt=1+.015*Pi(Y-50,2)/Nc(20+Pi(Y-50,2)),Zt=1+.045*qe,dt=1+.015*qe*lt,_t=30*mR(-Pi((st-275)/25,2)),wt=-(2*Nc(Pi(qe,7)/(Pi(qe,7)+Pi(25,7))))*D2(2*b(_t)),Dt=Nc(Pi(tn/(a*Kt),2)+Pi(lr/(p*Zt),2)+Pi(bt/(x*dt),2)+wt*(lr/(p*Zt))*(bt/(x*dt)));return pR(0,fR(100,Dt))}function _R(t,r,a="lab"){t=new xt(t),r=new xt(r);const p=t.get(a),x=r.get(a);let T=0;for(let b in p){const l=(p[b]||0)-(x[b]||0);T+=l*l}return Math.sqrt(T)}const yR=(...t)=>{try{return new xt(...t),!0}catch{return!1}},vR={cool(){return v0([Zn.hsl(180,1,.9),Zn.hsl(250,.7,.4)])},hot(){return v0(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Fx={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},dP=Object.keys(Fx),F2=new Map(dP.map(t=>[t.toLowerCase(),t])),xR=typeof Proxy=="function"?new Proxy(Fx,{get(t,r){const a=r.toLowerCase();if(F2.has(a))return t[F2.get(a)]},getOwnPropertyNames(){return Object.getOwnPropertyNames(dP)}}):Fx,bR=(...t)=>{t=wn(t,"cmyk");const[r,a,p,x]=t,T=t.length>4?t[4]:1;return x===1?[0,0,0,T]:[r>=1?0:255*(1-r)*(1-x),a>=1?0:255*(1-a)*(1-x),p>=1?0:255*(1-p)*(1-x),T]},{max:O2}=Math,wR=(...t)=>{let[r,a,p]=wn(t,"rgb");r=r/255,a=a/255,p=p/255;const x=1-O2(r,O2(a,p)),T=x<1?1/(1-x):0,b=(1-r-x)*T,l=(1-a-x)*T,L=(1-p-x)*T;return[b,l,L,x]};xt.prototype.cmyk=function(){return wR(this._rgb)};const SR=(...t)=>new xt(...t,"cmyk");Object.assign(Zn,{cmyk:SR});bn.format.cmyk=bR;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"cmyk"),On(t)==="array"&&t.length===4)return"cmyk"}});const TR=(...t)=>{const r=wn(t,"hsla");let a=wp(t)||"lsa";return r[0]=va(r[0]||0)+"deg",r[1]=va(r[1]*100)+"%",r[2]=va(r[2]*100)+"%",a==="hsla"||r.length>3&&r[3]<1?(r[3]="/ "+(r.length>3?r[3]:1),a="hsla"):r.length=3,`${a.substr(0,3)}(${r.join(" ")})`},CR=(...t)=>{const r=wn(t,"lab");let a=wp(t)||"lab";return r[0]=va(r[0])+"%",r[1]=va(r[1]),r[2]=va(r[2]),a==="laba"||r.length>3&&r[3]<1?r[3]="/ "+(r.length>3?r[3]:1):r.length=3,`lab(${r.join(" ")})`},PR=(...t)=>{const r=wn(t,"lch");let a=wp(t)||"lab";return r[0]=va(r[0])+"%",r[1]=va(r[1]),r[2]=isNaN(r[2])?"none":va(r[2])+"deg",a==="lcha"||r.length>3&&r[3]<1?r[3]="/ "+(r.length>3?r[3]:1):r.length=3,`lch(${r.join(" ")})`},ER=(...t)=>{const r=wn(t,"lab");return r[0]=va(r[0]*100)+"%",r[1]=Dx(r[1]),r[2]=Dx(r[2]),r.length>3&&r[3]<1?r[3]="/ "+(r.length>3?r[3]:1):r.length=3,`oklab(${r.join(" ")})`},fP=(...t)=>{const[r,a,p,...x]=wn(t,"rgb"),[T,b,l]=Gb(r,a,p),[L,$,Q]=sP(T,b,l);return[L,$,Q,...x.length>0&&x[0]<1?[x[0]]:[]]},MR=(...t)=>{const r=wn(t,"lch");return r[0]=va(r[0]*100)+"%",r[1]=Dx(r[1]),r[2]=isNaN(r[2])?"none":va(r[2])+"deg",r.length>3&&r[3]<1?r[3]="/ "+(r.length>3?r[3]:1):r.length=3,`oklch(${r.join(" ")})`},{round:M1}=Math,IR=(...t)=>{const r=wn(t,"rgba");let a=wp(t)||"rgb";if(a.substr(0,3)==="hsl")return TR(lP(r),a);if(a.substr(0,3)==="lab"){const p=xg();Gc("d50");const x=CR(Ub(r),a);return Gc(p),x}if(a.substr(0,3)==="lch"){const p=xg();Gc("d50");const x=PR($b(r),a);return Gc(p),x}return a.substr(0,5)==="oklab"?ER(Gb(r)):a.substr(0,5)==="oklch"?MR(fP(r)):(r[0]=M1(r[0]),r[1]=M1(r[1]),r[2]=M1(r[2]),(a==="rgba"||r.length>3&&r[3]<1)&&(r[3]="/ "+(r.length>3?r[3]:1),a="rgba"),`${a.substr(0,3)}(${r.slice(0,a==="rgb"?3:4).join(" ")})`)},pP=(...t)=>{t=wn(t,"lch");const[r,a,p,...x]=t,[T,b,l]=oP(r,a,p),[L,$,Q]=Zb(T,b,l);return[L,$,Q,...x.length>0&&x[0]<1?[x[0]]:[]]},Wc=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,nl=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,x0=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,wa=/\s*/.source,Tp=/\s+/.source,qb=/\s*,\s*/.source,$0=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,Cp=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,mP=new RegExp("^rgba?\\("+wa+[Wc,Wc,Wc].join(Tp)+Cp+"\\)$"),gP=new RegExp("^rgb\\("+wa+[Wc,Wc,Wc].join(qb)+wa+"\\)$"),_P=new RegExp("^rgba\\("+wa+[Wc,Wc,Wc,nl].join(qb)+wa+"\\)$"),yP=new RegExp("^hsla?\\("+wa+[$0,x0,x0].join(Tp)+Cp+"\\)$"),vP=new RegExp("^hsl?\\("+wa+[$0,x0,x0].join(qb)+wa+"\\)$"),xP=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,bP=new RegExp("^lab\\("+wa+[nl,nl,nl].join(Tp)+Cp+"\\)$"),wP=new RegExp("^lch\\("+wa+[nl,nl,$0].join(Tp)+Cp+"\\)$"),SP=new RegExp("^oklab\\("+wa+[nl,nl,nl].join(Tp)+Cp+"\\)$"),TP=new RegExp("^oklch\\("+wa+[nl,nl,$0].join(Tp)+Cp+"\\)$"),{round:CP}=Math,$f=t=>t.map((r,a)=>a<=2?Fd(CP(r),0,255):r),Ei=(t,r=0,a=100,p=!1)=>(typeof t=="string"&&t.endsWith("%")&&(t=parseFloat(t.substring(0,t.length-1))/100,p?t=r+(t+1)*.5*(a-r):t=r+t*(a-r)),+t),Jo=(t,r)=>t==="none"?r:t,Wb=t=>{if(t=t.toLowerCase().trim(),t==="transparent")return[0,0,0,0];let r;if(bn.format.named)try{return bn.format.named(t)}catch{}if((r=t.match(mP))||(r=t.match(gP))){let a=r.slice(1,4);for(let x=0;x<3;x++)a[x]=+Ei(Jo(a[x],0),0,255);a=$f(a);const p=r[4]!==void 0?+Ei(r[4],0,1):1;return a[3]=p,a}if(r=t.match(_P)){const a=r.slice(1,5);for(let p=0;p<4;p++)a[p]=+Ei(a[p],0,255);return a}if((r=t.match(yP))||(r=t.match(vP))){const a=r.slice(1,4);a[0]=+Jo(a[0].replace("deg",""),0),a[1]=+Ei(Jo(a[1],0),0,100)*.01,a[2]=+Ei(Jo(a[2],0),0,100)*.01;const p=$f(Lx(a)),x=r[4]!==void 0?+Ei(r[4],0,1):1;return p[3]=x,p}if(r=t.match(xP)){const a=r.slice(1,4);a[1]*=.01,a[2]*=.01;const p=Lx(a);for(let x=0;x<3;x++)p[x]=CP(p[x]);return p[3]=+r[4],p}if(r=t.match(bP)){const a=r.slice(1,4);a[0]=Ei(Jo(a[0],0),0,100),a[1]=Ei(Jo(a[1],0),-125,125,!0),a[2]=Ei(Jo(a[2],0),-125,125,!0);const p=xg();Gc("d50");const x=$f(jb(a));Gc(p);const T=r[4]!==void 0?+Ei(r[4],0,1):1;return x[3]=T,x}if(r=t.match(wP)){const a=r.slice(1,4);a[0]=Ei(a[0],0,100),a[1]=Ei(Jo(a[1],0),0,150,!1),a[2]=+Jo(a[2].replace("deg",""),0);const p=xg();Gc("d50");const x=$f(Vb(a));Gc(p);const T=r[4]!==void 0?+Ei(r[4],0,1):1;return x[3]=T,x}if(r=t.match(SP)){const a=r.slice(1,4);a[0]=Ei(Jo(a[0],0),0,1),a[1]=Ei(Jo(a[1],0),-.4,.4,!0),a[2]=Ei(Jo(a[2],0),-.4,.4,!0);const p=$f(Zb(a)),x=r[4]!==void 0?+Ei(r[4],0,1):1;return p[3]=x,p}if(r=t.match(TP)){const a=r.slice(1,4);a[0]=Ei(Jo(a[0],0),0,1),a[1]=Ei(Jo(a[1],0),0,.4,!1),a[2]=+Jo(a[2].replace("deg",""),0);const p=$f(pP(a)),x=r[4]!==void 0?+Ei(r[4],0,1):1;return p[3]=x,p}};Wb.test=t=>mP.test(t)||yP.test(t)||bP.test(t)||wP.test(t)||SP.test(t)||TP.test(t)||gP.test(t)||_P.test(t)||vP.test(t)||xP.test(t)||t==="transparent";xt.prototype.css=function(t){return IR(this._rgb,t)};const kR=(...t)=>new xt(...t,"css");Zn.css=kR;bn.format.css=Wb;bn.autodetect.push({p:5,test:(t,...r)=>{if(!r.length&&On(t)==="string"&&Wb.test(t))return"css"}});bn.format.gl=(...t)=>{const r=wn(t,"rgba");return r[0]*=255,r[1]*=255,r[2]*=255,r};const AR=(...t)=>new xt(...t,"gl");Zn.gl=AR;xt.prototype.gl=function(){const t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};xt.prototype.hex=function(t){return nP(this._rgb,t)};const zR=(...t)=>new xt(...t,"hex");Zn.hex=zR;bn.format.hex=tP;bn.autodetect.push({p:4,test:(t,...r)=>{if(!r.length&&On(t)==="string"&&[3,4,5,6,7,8,9].indexOf(t.length)>=0)return"hex"}});const{log:Sy}=Math,PP=t=>{const r=t/100;let a,p,x;return r<66?(a=255,p=r<6?0:-155.25485562709179-.44596950469579133*(p=r-2)+104.49216199393888*Sy(p),x=r<20?0:-254.76935184120902+.8274096064007395*(x=r-10)+115.67994401066147*Sy(x)):(a=351.97690566805693+.114206453784165*(a=r-55)-40.25366309332127*Sy(a),p=325.4494125711974+.07943456536662342*(p=r-50)-28.0852963507957*Sy(p),x=255),[a,p,x,1]},{round:RR}=Math,DR=(...t)=>{const r=wn(t,"rgb"),a=r[0],p=r[2];let x=1e3,T=4e4;const b=.4;let l;for(;T-x>b;){l=(T+x)*.5;const L=PP(l);L[2]/L[0]>=p/a?T=l:x=l}return RR(l)};xt.prototype.temp=xt.prototype.kelvin=xt.prototype.temperature=function(){return DR(this._rgb)};const I1=(...t)=>new xt(...t,"temp");Object.assign(Zn,{temp:I1,kelvin:I1,temperature:I1});bn.format.temp=bn.format.kelvin=bn.format.temperature=PP;xt.prototype.oklch=function(){return fP(this._rgb)};const LR=(...t)=>new xt(...t,"oklch");Object.assign(Zn,{oklch:LR});bn.format.oklch=pP;bn.autodetect.push({p:2,test:(...t)=>{if(t=wn(t,"oklch"),On(t)==="array"&&t.length===3)return"oklch"}});Object.assign(Zn,{analyze:uP,average:Fz,bezier:Vz,blend:il,brewer:xR,Color:xt,colors:gp,contrast:cR,contrastAPCA:dR,cubehelix:tR,deltaE:gR,distance:_R,input:bn,interpolate:_p,limits:hP,mix:_p,random:oR,scale:v0,scales:vR,valid:yR});const EP="#FFFF00",MP="#FF0000",Id=.6,IP=.5,FR=Zn.scale([EP,MP]),eg=(t,r)=>{const a=x=>Math.log2(x),p=a(t)/a(r);return FR(p).hex()},OR=()=>{const[t,r]=Lt.useState(null);Lt.useEffect(()=>{(async()=>{const p=await mC(),x=await _C(),T={};for(const[L,$]of Object.entries(p)){const Q=eg($,x);T[L]=Q}const b={type:"FeatureCollection",features:[]},l=await bp();for(const[L,$]of Object.entries(T)){const Q=l.find(ce=>ce.codeIso3===L);b.features.push({...Q.geojson,properties:{color:$}})}r(b)})()},[]);const a=Hd();return Lt.useCallback(()=>t===null?()=>null:a(t,{fillColor:["get","color"],fillOpacity:Id,strokeOpacity:IP,zIndex:U0}),[t,a])},BR=()=>{const t=Oi(x=>x.main.focusedCountry),[r,a]=Lt.useState(null);Lt.useEffect(()=>{if(!t||!Vd(t.codeIso3)){a(null);return}(async()=>{const x=await vC(t.codeIso3),T=await bC(t.codeIso3),b={};for(const[$,Q]of Object.entries(x)){const ce=eg(Q,T);b[$]=ce}const l={type:"FeatureCollection",features:[]},L=await nC(t.codeIso3);for(const[$,Q]of Object.entries(b)){const ce=L.find(oe=>oe.stateCode===$);l.features.push({...ce.geojson,properties:{color:Q}})}a(l)})()},[t]);const p=Hd();return Lt.useCallback(()=>r===null?()=>null:p(r,{fillColor:["get","color"],fillOpacity:Id,strokeOpacity:IP,zIndex:U0}),[r,p])},NR="_card_w5zql_1",jR="_title_w5zql_11",UR="_legendContent_w5zql_15",VR="_legendGradient_w5zql_19",$R="_legendGradientFill_w5zql_28",ZR="_legendItems_w5zql_32",GR="_legendItem_w5zql_32",qR="_legendItemColor_w5zql_44",WR="_legendItemColorFill_w5zql_53",HR="_etc_w5zql_58",oi={card:NR,title:jR,legendContent:UR,legendGradient:VR,legendGradientFill:$R,legendItems:ZR,legendItem:GR,legendItemColor:qR,legendItemColorFill:WR,etc:HR},XR=()=>{const t=Oi(x=>x.main.focusedCountry),[r,a]=Lt.useState(0);return Lt.useEffect(()=>{(async()=>{if(!t||!Vd(t.codeIso3)){const x=await _C();a(x)}else{const x=await bC(t.codeIso3);a(x)}})()},[t]),Oi(x=>x.main.isMapInitialized)?ct.jsxs(cC,{className:oi.card,children:[ct.jsx("h2",{className:oi.title,children:"Legend"}),ct.jsxs("div",{className:oi.legendContent,children:[ct.jsx("div",{className:oi.legendGradient,style:{},children:ct.jsx("div",{className:oi.legendGradientFill,style:{background:`linear-gradient(to top, ${Rx} 5%, ${EP} 20%, ${MP}) 95%`,opacity:Id}})}),ct.jsxs("div",{className:oi.legendItems,children:[ct.jsxs("div",{className:oi.legendItem,children:[ct.jsx("div",{className:oi.legendItemColor,children:ct.jsx("div",{className:oi.legendItemColorFill,style:{opacity:Id,backgroundColor:eg(r,r)}})}),ct.jsxs("div",{className:oi.legendItemText,children:[r," Datasets"]})]}),ct.jsx("div",{className:oi.etc}),ct.jsxs("div",{className:oi.legendItem,children:[ct.jsx("div",{className:oi.legendItemColor,children:ct.jsx("div",{className:oi.legendItemColorFill,style:{opacity:Id,backgroundColor:eg(2,r)}})}),ct.jsx("div",{className:oi.legendItemText,children:"2 Datasets"})]}),ct.jsxs("div",{className:oi.legendItem,children:[ct.jsx("div",{className:oi.legendItemColor,children:ct.jsx("div",{className:oi.legendItemColorFill,style:{opacity:Id,backgroundColor:eg(1,r)}})}),ct.jsx("div",{className:oi.legendItemText,children:"1 Dataset"})]}),ct.jsxs("div",{className:oi.legendItem,children:[ct.jsx("div",{className:oi.legendItemColor,children:ct.jsx("div",{className:oi.legendItemColorFill,style:{opacity:Id,backgroundColor:Rx}})}),ct.jsx("div",{className:oi.legendItemText,children:"0 Datasets"})]})]})]})]}):null},KR=()=>/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),YR="_container_12pwg_1",JR="_triangle_12pwg_13",QR="_content_12pwg_23",eD="_title_12pwg_32",tD="_description_12pwg_40",Bm={container:YR,triangle:JR,content:QR,title:eD,description:tD},nD=({x:t,y:r})=>{const[a,p]=Lt.useState(!1),[x,T]=Lt.useState(!1),[b,l]=Lt.useState(null),[L,$]=Lt.useState(null),Q=Oi(We=>We.main.focusedCountry),ce=c3();Lt.useEffect(()=>{(async()=>{if(a||x){l(null),$(null);return}const We=ce(t,r),he=We[0],pe=We[1],ve=await rC(he,pe);if(l(ve),Q&&ve&&Q.name===ve.name&&Q.statesData){const Oe=await iC(he,pe,Q.statesData);$(Oe)}})()},[Q,ce,a,x,t,r]);const oe=$C();Lt.useEffect(()=>oe("movestart",()=>p(!0)),[oe]),Lt.useEffect(()=>oe("moveend",()=>p(!1)),[oe]),Lt.useEffect(()=>oe("zoomstart",()=>T(!0)),[oe]),Lt.useEffect(()=>oe("zoomend",()=>T(!1)),[oe]);const[Y,Te]=Lt.useState(null);Lt.useEffect(()=>{(async()=>{if(b&&L){const We=await zk(b.codeIso3,L.stateCode);Te({title:`${L.name}, ${b.name}`,descriptions:[`Number of Datasets: ${We}`,`${XC(b.codeIso3)} Name: ${L.name}`,`Country Name: ${b.name}`]})}else if(b&&!L){const We=await Ak(b.codeIso3);Te({title:`${b.name}`,descriptions:[`Number of Datasets: ${We}`,`Country Name: ${b.name}`]})}else Te(null)})()},[b,L]);const et=Hd();return Lt.useEffect(()=>{if(L)return et(L.geojson,JA);if(b)return et(b.geojson,YA)},[b,L,et]),KR()||Y===null?null:ct.jsxs("div",{className:Bm.container,style:{top:r,left:t},children:[ct.jsx("div",{className:Bm.triangle}),ct.jsxs("div",{className:Bm.content,children:[ct.jsx("h3",{className:Bm.title,children:Y.title}),Y.descriptions.map((We,he)=>ct.jsx("p",{className:Bm.description,children:We},he))]})]})};let k1=null;const rD=100,iD=()=>{const[t,r]=Lt.useState(null);return Lt.useEffect(()=>GC(a=>{k1&&clearTimeout(k1),r(null);const p=a.target.closest(`#${Ob}`);if(!!p){const{top:T,left:b}=p.getBoundingClientRect(),l=a.clientX-b,L=a.clientY-T;k1=setTimeout(()=>{r(ct.jsx(nD,{x:l,y:L}))},rD)}}),[]),t},oD="_container_t9xta_1",sD="_loading_t9xta_11",aD="_isMapInitialized_t9xta_21",lD="_map_t9xta_25",cD="_star_t9xta_36",Nm={container:oD,loading:sD,isMapInitialized:aD,map:lD,star:cD};let B2=!1;const uD=()=>{const t=Oi($=>$.main.isMapInitialized);e3();const r=Lt.useRef(),a=r3(),[p,x]=Lt.useState({width:window.innerWidth/2,height:window.innerHeight/2}),T=Lt.useCallback(()=>{if(r.current){const{width:$,height:Q}=r.current.getBoundingClientRect();x({width:$,height:Q}),a()}},[a]);Lt.useEffect(()=>{if(r.current){T();const $=$d.debounce(T,75,{maxWait:300,leading:!1,trailing:!0}),Q=new ResizeObserver($);return Q.observe(r.current),()=>Q.disconnect()}},[T]);const b=iD(),l=ZC();Lt.useEffect(()=>{t&&!B2&&(B2=!0,l([-120,-60,40,80],{duration:4e3}))},[l,t]);const L=Lt.useMemo(()=>$d.range(300).map(()=>({x:Math.random()*100,y:Math.random()*100,blur:Math.random()**2*5+2,size:Math.random()*3})),[]);return ct.jsxs("div",{className:lC(Nm.container,{[Nm.isMapInitialized]:t}),ref:r,children:[L.map(($,Q)=>ct.jsx("div",{className:Nm.star,style:{left:`${$.x}%`,top:`${$.y}%`,width:$.size,height:$.size,filter:`blur(${$.blur}px)`}},`star-${Q}`)),ct.jsx("div",{className:Nm.loading,children:"Loading..."}),ct.jsx("div",{className:Nm.map,id:Ob,style:{width:`${p.width}px`,height:`${p.height}px`}}),ct.jsx(XR,{}),b]})},hD=[[1,1],[10,40],[20,400]].reduce((t,[r,a])=>[...t,Number(r),Number(a)],[]),dD=()=>{fD(),pD()},fD=()=>{const t=_0(bp),r=Hd();Lt.useEffect(()=>{if(!t)return;const p={type:"FeatureCollection",features:t.map(x=>x.geojson)};return r(p,{strokeColor:KA,strokeOpacity:1,strokeWidth:1,fillColor:Rx,fillOpacity:1,zIndex:Bb})},[t,r])},pD=()=>{const t=n3(),r=Oi(x=>x.main.focusedCountry),a=_0(bp);Lt.useEffect(()=>{if(a)return t({id:"countries-labels",type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:a.map(x=>({type:"Feature",geometry:{type:"Point",coordinates:x.coordLonLat},properties:{name:x.name}}))}},layout:{"text-field":["get","name"],"text-size":["interpolate",["exponential",1.1],["zoom"],...hD],"text-font":["NotoSansRegular"],"symbol-placement":"point","text-allow-overlap":!0},paint:{"text-color":"#000000","text-halo-color":"#FFFFFF","text-halo-width":2,"text-halo-blur":1,"text-opacity":["interpolate",["linear"],["zoom"],1,0,2,1]}},jC)},[t,a]);const p=t3();Lt.useEffect(()=>{const T=r&&r.statesData?"none":"visible";p("countries-labels","visibility",T)},[r,p])},mD=()=>{const t=Hd(),r=Oi(p=>p.main.focusedCountry),a=gD();return Lt.useCallback(()=>{if(r===null)return()=>null;const p=[],x=!!r.statesData;return p.push(t(r.geojson,{fillColor:UC,fillOpacity:x?0:VC,strokeWidth:3,zIndex:U0})),p.push(a()),()=>p.forEach(T=>T())},[r,a,t])},gD=()=>{const t=Hd(),r=Oi(a=>a.main.focusedCountry);return Lt.useCallback(()=>{if(!(r!=null&&r.statesData))return()=>null;const a={type:"FeatureCollection",features:r.statesData.map(p=>({...p.geojson,properties:{color:"#ffffff"}}))};return t(a,{fillColor:["get","color"],fillOpacity:0,strokeOpacity:.5,zIndex:Ig})},[r,t])},_D=()=>{const t=Hd(),r=Oi(a=>a.main.focusedState);return Lt.useCallback(()=>r?t(r.geojson,{fillColor:UC,fillOpacity:VC,zIndex:Ig}):()=>null,[r,t])},yD="_container_hjxyf_1",vD="_content_hjxyf_11",xD="_infoCardContainer_hjxyf_17",A1={container:yD,content:vD,infoCardContainer:xD},bD=()=>{const t=Mg(),r=KC(),a=i3(),p=Oi($=>$.main.focusedCountry),x=Oi($=>$.main.focusedState);Lt.useEffect(()=>a(async $=>{const Q=$.lngLat.lng,ce=$.lngLat.lat,oe=await rC(Q,ce);let Y=null;oe&&p&&oe.name===p.name&&p.statesData&&(Y=await iC(Q,ce,p.statesData)),t(Ul.actions.setFocusedCountry(oe)),t(Ul.actions.setFocusedState(Y)),Y?r(Y):oe&&r(oe)}),[a,t,r,p]),dD();const T=OR();Lt.useEffect(()=>{if(!p||!Vd(p.codeIso3))return T()},[p,x,T]);const b=BR();Lt.useEffect(()=>{if(p&&Vd(p.codeIso3))return b()},[p,x,b]);const l=mD();Lt.useEffect(()=>l(),[l]);const L=_D();return Lt.useEffect(()=>L(),[L]),ct.jsxs("div",{className:A1.container,children:[ct.jsx(u2,{isMobile:!0}),ct.jsxs("div",{className:A1.content,children:[ct.jsxs("div",{className:A1.infoCardContainer,children:[ct.jsx(u2,{}),ct.jsx(z3,{})]}),ct.jsx(uD,{})]})]})},wD=zA({reducer:{main:Ul.reducer}});z1.createRoot(document.getElementById("root")).render(ct.jsx(Fl.StrictMode,{children:ct.jsx(JI,{store:wD,children:ct.jsx(bD,{})})}));
